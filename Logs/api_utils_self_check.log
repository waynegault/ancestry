13:17:50 INF [api_util log_msg  808 ] 
                                      [api_utils.py self-check starting...]
13:17:50 INF [api_util log_msg  808 ] 
                                      --- Phase 0: Prerequisite Checks ---
13:17:50 INF [api_util log_msg  808 ] - BeautifulSoup Import: OK
13:17:50 INF [api_util log_msg  808 ] - format_name Import/Fallback: OK
13:17:50 INF [api_util log_msg  808 ] - ordinal_case Import/Fallback: OK
13:17:50 INF [api_util log_msg  808 ] - _parse_date Import/Fallback: OK
13:17:50 INF [api_util log_msg  808 ] - _clean_display_date Import/Fallback: OK
13:17:50 INF [api_util log_msg  808 ] - Config Check: Essential credentials/URLs/IDs present.
13:17:50 INF [api_util log_msg  808 ] 
                                      --- Phase 1: Session Setup & Login ---
13:17:50 DEB [utils    __init__ 619 ] Initialized shared requests.Session with HTTPAdapter.
13:17:50 DEB [utils    __init__ 634 ] Initialized shared cloudscraper instance with retry strategy.
13:17:50 DEB [utils    __init__ 474 ] RateLimiter Init: Capacity=10.0, FillRate=2.0/s, InitialDelay=0.50s, Backoff=1.80, Decrease=0.98
13:17:50 DEB [utils    __init__ 645 ] SessionManager instance created: ID=79642592
                                      
13:17:50 DEB [utils    start_se 649 ] --- SessionManager Phase 1: Starting Driver (api_utils Self Check Start) ---
                                      
13:17:50 DEB [utils    _initial 986 ] SessionManager ID=79642592 initializing SQLAlchemy Engine/Session...
13:17:50 DEB [utils    _initial 1001] DB Path: C:\Users\wayne\GitHub\Python\Projects\Ancestry\Data\ancestry.db
13:17:50 DEB [utils    _initial 1035] DB Pool Config: Size=10, MaxOverflow=5, Timeout=30
13:17:50 DEB [utils    _initial 1047] Created NEW SQLAlchemy engine: ID=116348240 for SM ID=79642592
13:17:50 DEB [utils    _initial 1064] Created Session factory for Engine ID=116348240
13:17:50 DEB [utils    enable_s 1057] SQLite PRAGMA settings applied (WAL, Foreign Keys).
13:17:50 DEB [database _create_ 310 ] Executing CREATE VIEW statement for 'messages' view...
13:17:50 DEB [database _create_ 313 ] Database view 'messages' created or already exists.
13:17:50 DEB [utils    _initial 1067] DB tables checked/created successfully.
13:17:50 DEB [utils    start_se 676 ] Initializing WebDriver instance (using init_webdvr)...
13:17:50 DEB [chromedr init_web 175 ] WebDriver initialization attempt 1/3...
13:17:50 INF [chromedr init_web 192 ] User data directory (no --profile-directory):
                                      C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
13:17:50 DEB [chromedr init_web 203 ] Using browser executable:
                                      C:\Program Files\Google\Chrome\Application\chrome.exe
13:17:50 DEB [chromedr init_web 220 ] Setting User-Agent:
                                      Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
13:17:50 DEB [chromedr init_web 229 ] Letting undetected_chromedriver auto-manage ChromeDriver version (self-patching mode).
13:17:50 INF [chromedr init_web 231 ] [init_webdvr] Attempting uc.Chrome() self-patching (attempt 1)...
13:17:52 INF [chromedr init_web 234 ] [init_webdvr] uc.Chrome() self-patching succeeded in 2.33s (attempt 1)
13:17:52 DEB [chromedr init_web 235 ] WebDriver instance object potentially created (attempt 1).
13:17:52 DEB [chromedr init_web 277 ] User-Agent override applied via CDP.
13:17:52 DEB [chromedr init_web 282 ] Attempting to minimize window (non-headless mode)...
13:17:52 DEB [chromedr init_web 285 ] Browser window minimized.
13:17:52 DEB [chromedr init_web 309 ] WebDriver instance fully configured successfully (attempt 1).
13:17:52 DEB [utils    start_se 684 ] WebDriver initialization successful.
13:17:52 DEB [utils    start_se 685 ] Navigating to Base URL (https://www.ancestry.co.uk/) to stabilize...
13:17:52 DEB [utils    nav_to_p 3354] Navigation Attempt 1/3 to: https://www.ancestry.co.uk/
13:17:52 DEB [utils    nav_to_p 3377] Executing driver.get('https://www.ancestry.co.uk/')...
13:17:55 DEB [utils    nav_to_p 3390] Landed on URL base: https://www.ancestry.co.uk
13:17:57 DEB [utils    nav_to_p 3485] On correct URL base. Waiting up to 20s for selector: 'body'
13:17:57 DEB [utils    nav_to_p 3492] Navigation successful and element 'body' found on:
                                      https://www.ancestry.co.uk/
13:17:57 DEB [utils    start_se 698 ] Initial navigation to Base URL successful.
13:17:57 DEB [utils    start_se 702 ] --- SessionManager Phase 1: Driver Start Successful ---
13:17:57 INF [api_util log_msg  808 ] - SessionManager.start_sess(): PASSED
13:17:57 DEB [utils    ensure_s 737 ] TRACE: Entered ensure_session_ready
13:17:57 DEB [utils    ensure_d 723 ] Driver already live (Action: api_utils Self Check Ready - Ensure Driver).
13:17:57 DEB [utils    ensure_s 746 ] TRACE: About to call _perform_readiness_checks
13:17:57 DEB [utils    ensure_s 749 ] TRACE: Calling _perform_readiness_checks
13:17:57 DEB [utils    _perform 795 ] Performing readiness checks (action=api_utils Self Check Ready - Readiness Checks)...
13:17:57 INF [utils    _perform 815 ] [Persistence] Chrome user data directory is present: C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
13:17:57 DEB [utils    login_st 3229] Checking login status (API prioritized)...
13:17:57 DEB [utils    login_st 3242] Attempting API login verification (_verify_api_login_status)...
13:17:57 DEB [utils    _verify_ 1730] Verifying login status via API endpoint: https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna...
13:17:57 DEB [utils    _verify_ 1737] Syncing cookies before API login check...
13:17:57 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:17:57 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:17:57 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
13:17:57 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:17:57 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:17:57 DEB [utils    _api_req 2155] API Login Verification (header/dna): Cookies synced (Attempt 1).
13:17:57 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.424s (CurrentDelay: 0.50s)
13:17:57 DEB [utils    _api_req 2193] API Login Verification (header/dna): Rate limit wait: 0.42s (Attempt 1)
13:17:57 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Headers.
13:17:57 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Cookies.
13:17:59 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:17:59 DEB [utils    _verify_ 1769] API Login Verification (header/dna): API login check successful ('testId' found).
13:17:59 DEB [utils    login_st 3245] Login status confirmed TRUE via API check.
13:17:59 DEB [utils    _perform 892 ] Checking/Handling current URL...
13:17:59 DEB [utils    _check_a 1089] Current URL for check: https://www.ancestry.co.uk/
13:17:59 DEB [utils    _check_a 1126] Current URL is suitable, no extra navigation needed.
13:17:59 DEB [utils    _perform 896 ] URL check/handling OK.
13:17:59 DEB [utils    _perform 899 ] Verifying essential cookies...
13:17:59 DEB [utils    get_cook 1255] Waiting up to 5s for cookies: ['ANCSESSIONID', 'SecureATT']...
13:17:59 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
13:17:59 DEB [utils    _perform 908 ] Essential cookies OK.
13:17:59 DEB [utils    _perform 911 ] Syncing cookies to requests session...
13:17:59 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:17:59 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:17:59 DEB [utils    _perform 913 ] Cookies synced.
13:17:59 DEB [utils    _perform 916 ] Ensuring CSRF token...
13:17:59 DEB [utils    get_csrf 1215] Attempting to fetch fresh CSRF token from: https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken
13:17:59 DEB [utils    get_cook 1255] Waiting up to 10s for cookies: ['ANCSESSIONID', 'SecureATT']...
13:17:59 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
13:17:59 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken (Timeout: 60s, AllowRedirects: True)
13:17:59 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:17:59 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:17:59 DEB [utils    _api_req 2155] CSRF Token API: Cookies synced (Attempt 1).
13:17:59 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.535s (CurrentDelay: 0.50s)
13:17:59 DEB [utils    _api_req 2193] CSRF Token API: Rate limit wait: 0.53s (Attempt 1)
13:17:59 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'CSRF Token API'] Sending Headers.
13:17:59 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'CSRF Token API'] Sending Cookies.
13:17:59 DEB [utils    _api_req 2217] <-- Response Status: 200 OK
13:17:59 DEB [utils    get_csrf 1233] CSRF token successfully retrieved (Length: 144).
13:17:59 DEB [utils    _perform 924 ] CSRF token OK.
13:17:59 INF [utils    _perform 927 ] Readiness checks PASSED on attempt 0.
13:17:59 DEB [utils    ensure_s 752 ] TRACE: _perform_readiness_checks returned: True
13:17:59 DEB [utils    ensure_s 767 ] [Patch] Attempting to retrieve identifiers and tree owner after readiness checks...
13:17:59 DEB [utils    _retriev 1131] TRACE: Entered _retrieve_identifiers
13:17:59 DEB [utils    _retriev 1135] Retrieving profile ID (ucdmid)...
13:17:59 DEB [utils    get_my_p 1531] Attempting to fetch own profile ID (ucdmid)...
13:17:59 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/app-api/cdp-p13n/api/v1/users/me?attributes=ucdmid (Timeout: 60s, AllowRedirects: True)
13:17:59 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:17:59 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:17:59 DEB [utils    _api_req 2155] Get my profile_id: Cookies synced (Attempt 1).
13:17:59 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.531s (CurrentDelay: 0.50s)
13:18:00 DEB [utils    _api_req 2193] Get my profile_id: Rate limit wait: 0.53s (Attempt 1)
13:18:00 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Get my profile_id'] Sending Headers.
13:18:00 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Get my profile_id'] Sending Cookies.
13:18:00 DEB [utils    _api_req 2217] <-- Response Status: 200 OK
13:18:00 DEB [utils    get_my_p 1552] Successfully retrieved profile_id: 07BDD45E-0006-0000-0000-000000000000
13:18:00 INF [utils    _retriev 1141] My profile id: 07BDD45E-0006-0000-0000-000000000000
13:18:00 DEB [utils    _retriev 1147] Retrieving UUID (testId)...
13:18:00 DEB [utils    get_my_u 1569] Attempting to fetch own UUID (testId) from header/dna API...
13:18:00 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
13:18:00 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:18:00 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:18:00 DEB [utils    _api_req 2155] Get UUID API: Cookies synced (Attempt 1).
13:18:00 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.499s (CurrentDelay: 0.50s)
13:18:01 DEB [utils    _api_req 2193] Get UUID API: Rate limit wait: 0.50s (Attempt 1)
13:18:01 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Get UUID API'] Sending Headers.
13:18:01 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Get UUID API'] Sending Cookies.
13:18:02 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:18:02 DEB [utils    get_my_u 1581] Successfully retrieved UUID: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
13:18:02 INF [utils    _retriev 1153] My uuid: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
13:18:02 DEB [utils    _retriev 1159] Retrieving tree ID for tree name: 'Gault Family'...
13:18:02 DEB [utils    get_my_t 1604] Attempting to fetch tree ID for TREE_NAME='Gault Family'...
13:18:02 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/trees (Timeout: 60s, AllowRedirects: True)
13:18:02 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:18:02 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:18:02 DEB [utils    _api_req 2155] Header Trees API: Cookies synced (Attempt 1).
13:18:02 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.549s (CurrentDelay: 0.50s)
13:18:02 DEB [utils    _api_req 2193] Header Trees API: Rate limit wait: 0.55s (Attempt 1)
13:18:02 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Header Trees API'] Sending Headers.
13:18:02 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Header Trees API'] Sending Cookies.
13:18:03 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:18:03 DEB [utils    get_my_t 1628] Found tree ID '175946702' for tree 'Gault Family'.
13:18:03 INF [utils    _retriev 1169] My tree id: 175946702
13:18:03 DEB [utils    _retriev 1176] TRACE: Exiting _retrieve_identifiers
13:18:03 DEB [utils    _retriev 1182] TRACE: Entered _retrieve_tree_owner
13:18:03 DEB [utils    _retriev 1191] Retrieving tree owner name...
13:18:03 DEB [utils    get_tree 1668] Attempting to fetch tree owner name for tree ID: 175946702...
13:18:03 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/user/tree-info?tree_id=175946702 (Timeout: 60s, AllowRedirects: True)
13:18:03 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:18:03 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:18:03 DEB [utils    _api_req 2155] Tree Owner Name API: Cookies synced (Attempt 1).
13:18:03 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.500s (CurrentDelay: 0.50s)
13:18:03 DEB [utils    _api_req 2193] Tree Owner Name API: Rate limit wait: 0.50s (Attempt 1)
13:18:03 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Headers.
13:18:03 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Cookies.
13:18:03 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:18:03 DEB [utils    get_tree 1683] Found tree owner 'Wayne Gault' for tree ID 175946702.
13:18:03 INF [utils    _retriev 1203] Tree owner name: Wayne Gault
13:18:03 DEB [utils    _retriev 1205] TRACE: Exiting _retrieve_tree_owner (success)
13:18:03 DEB [utils    ensure_s 772 ] [Patch] Identifiers after fetch: profile_id=07BDD45E-0006-0000-0000-000000000000, uuid=FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7, tree_id=175946702
13:18:03 DEB [utils    ensure_s 773 ] [Patch] Tree owner name after fetch: Wayne Gault
13:18:03 DEB [utils    ensure_s 777 ] TRACE: Set self.session_ready to: True
13:18:03 DEB [utils    ensure_s 779 ] TRACE: Exiting ensure_session_ready (returning True)
13:18:03 INF [api_util log_msg  808 ] - SessionManager.ensure_session_ready(): PASSED
13:18:03 INF [api_util log_msg  808 ] 
                                      --- Phase 2: Validate Test Parameters (Post-Login) ---
13:18:03 INF [api_util log_msg  808 ] - Target Profile ID (TESTING_PROFILE_ID): 08FA6E79-0006-0000-0000-000000000000
13:18:03 INF [api_util log_msg  808 ] - Target Tree ID (MY_TREE_ID): 175946702
13:18:03 INF [api_util log_msg  808 ] - Target Owner Name: Wayne Gault
13:18:03 INF [api_util log_msg  808 ] 
                                      --- Phase 3: Test parse_ancestry_person_details (Facts API) ---
13:18:03 INF [api_util log_msg  808 ] - Calling Facts API: https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/08FA6E79-0006-0000-0000-000000000000/facts
13:18:03 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/08FA6E79-0006-0000-0000-000000000000/facts (Timeout: 60s, AllowRedirects: True)
13:18:03 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:18:03 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:18:03 DEB [utils    _api_req 2155] Ancestry Facts JSON Endpoint: Cookies synced (Attempt 1).
13:18:03 DEB [utils    _api_req 2177] Omitting 'ancestry-userid' header for 'Ancestry Facts JSON Endpoint'.
13:18:03 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.525s (CurrentDelay: 0.50s)
13:18:04 DEB [utils    _api_req 2193] Ancestry Facts JSON Endpoint: Rate limit wait: 0.52s (Attempt 1)
13:18:04 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Ancestry Facts JSON Endpoint'] Sending Headers.
13:18:04 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Ancestry Facts JSON Endpoint'] Sending Cookies.
13:18:06 DEB [utils    _api_req 2217] <-- Response Status: 200 OK
13:18:06 DEB [utils    _api_req 2237] Ancestry Facts JSON Endpoint: OK (200), Content-Type 'text/html; charset=utf-8'. Returning raw TEXT.
13:18:06 ERR [api_util log_msg  804 ] - Facts API call: FAILED (Returned <class 'str'>)
13:18:06 INF [api_util log_msg  808 ] 
                                      --- Phase 4: Test Relationship Ladder Parsing ---
13:18:06 WAR [api_util log_msg  806 ] - Skipping Relationship Ladder test: Owner or Target Name missing.
13:18:06 INF [api_util log_msg  808 ] 
                                      --- Finalizing: Closing Session ---
13:18:06 DEB [utils    close_se 1889] Attempting to close WebDriver session...
13:18:06 DEB [utils    close_se 1892] WebDriver session quit successfully.
13:18:06 DEB [utils    close_se 1903] Closing database connection pool...
13:18:06 DEB [utils    cls_db_c 1509] SessionManager ID=79642592 cls_db_conn called (keep_db=False). Disposing Engine ID: 116348240
13:18:06 DEB [utils    cls_db_c 1514] Engine ID=116348240 disposed successfully.
13:18:06 ERR [api_util self_che 1213] api_utils self-check status: FAIL
13:18:06 DEB [cache    close_ca 261 ] Closing DiskCache connection...
13:18:06 DEB [cache    close_ca 263 ] DiskCache connection closed.
13:37:46 INF [api_util log_msg  907 ] 
                                      [api_utils.py self-check starting...]
13:37:46 INF [api_util log_msg  907 ] 
                                      --- Phase 0: Prerequisite Checks ---
13:37:46 INF [api_util log_msg  907 ] - BeautifulSoup Import: OK
13:37:46 INF [api_util log_msg  907 ] - format_name Import/Fallback: OK
13:37:46 INF [api_util log_msg  907 ] - ordinal_case Import/Fallback: OK
13:37:46 INF [api_util log_msg  907 ] - _parse_date Import/Fallback: OK
13:37:46 INF [api_util log_msg  907 ] - _clean_display_date Import/Fallback: OK
13:37:46 INF [api_util log_msg  907 ] - Config Check: Essential credentials/URLs/IDs present.
13:37:46 INF [api_util log_msg  907 ] 
                                      --- Phase 1: Session Setup & Login ---
13:37:46 DEB [utils    __init__ 619 ] Initialized shared requests.Session with HTTPAdapter.
13:37:46 DEB [utils    __init__ 634 ] Initialized shared cloudscraper instance with retry strategy.
13:37:46 DEB [utils    __init__ 474 ] RateLimiter Init: Capacity=10.0, FillRate=2.0/s, InitialDelay=0.50s, Backoff=1.80, Decrease=0.98
13:37:46 DEB [utils    __init__ 645 ] SessionManager instance created: ID=114859792
                                      
13:37:46 DEB [utils    start_se 649 ] --- SessionManager Phase 1: Starting Driver (api_utils Self Check Start) ---
                                      
13:37:46 DEB [utils    _initial 986 ] SessionManager ID=114859792 initializing SQLAlchemy Engine/Session...
13:37:46 DEB [utils    _initial 1001] DB Path: C:\Users\wayne\GitHub\Python\Projects\Ancestry\Data\ancestry.db
13:37:46 DEB [utils    _initial 1035] DB Pool Config: Size=10, MaxOverflow=5, Timeout=30
13:37:46 DEB [utils    _initial 1047] Created NEW SQLAlchemy engine: ID=116613792 for SM ID=114859792
13:37:46 DEB [utils    _initial 1064] Created Session factory for Engine ID=116613792
13:37:46 DEB [utils    enable_s 1057] SQLite PRAGMA settings applied (WAL, Foreign Keys).
13:37:46 DEB [database _create_ 310 ] Executing CREATE VIEW statement for 'messages' view...
13:37:46 DEB [database _create_ 313 ] Database view 'messages' created or already exists.
13:37:46 DEB [utils    _initial 1067] DB tables checked/created successfully.
13:37:46 DEB [utils    start_se 676 ] Initializing WebDriver instance (using init_webdvr)...
13:37:46 DEB [chromedr init_web 175 ] WebDriver initialization attempt 1/3...
13:37:46 INF [chromedr init_web 192 ] User data directory (no --profile-directory):
                                      C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
13:37:46 DEB [chromedr init_web 203 ] Using browser executable:
                                      C:\Program Files\Google\Chrome\Application\chrome.exe
13:37:46 DEB [chromedr init_web 220 ] Setting User-Agent:
                                      Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36
13:37:46 DEB [chromedr init_web 229 ] Letting undetected_chromedriver auto-manage ChromeDriver version (self-patching mode).
13:37:46 INF [chromedr init_web 231 ] [init_webdvr] Attempting uc.Chrome() self-patching (attempt 1)...
13:37:50 INF [chromedr init_web 234 ] [init_webdvr] uc.Chrome() self-patching succeeded in 3.76s (attempt 1)
13:37:50 DEB [chromedr init_web 235 ] WebDriver instance object potentially created (attempt 1).
13:37:50 DEB [chromedr init_web 277 ] User-Agent override applied via CDP.
13:37:50 DEB [chromedr init_web 282 ] Attempting to minimize window (non-headless mode)...
13:37:50 DEB [chromedr init_web 285 ] Browser window minimized.
13:37:50 DEB [chromedr init_web 309 ] WebDriver instance fully configured successfully (attempt 1).
13:37:50 DEB [utils    start_se 684 ] WebDriver initialization successful.
13:37:50 DEB [utils    start_se 685 ] Navigating to Base URL (https://www.ancestry.co.uk/) to stabilize...
13:37:50 DEB [utils    nav_to_p 3354] Navigation Attempt 1/3 to: https://www.ancestry.co.uk/
13:37:50 DEB [utils    nav_to_p 3377] Executing driver.get('https://www.ancestry.co.uk/')...
13:37:52 DEB [utils    nav_to_p 3390] Landed on URL base: https://www.ancestry.co.uk
13:37:55 DEB [utils    nav_to_p 3485] On correct URL base. Waiting up to 20s for selector: 'body'
13:37:55 DEB [utils    nav_to_p 3492] Navigation successful and element 'body' found on:
                                      https://www.ancestry.co.uk/
13:37:55 DEB [utils    start_se 698 ] Initial navigation to Base URL successful.
13:37:55 DEB [utils    start_se 702 ] --- SessionManager Phase 1: Driver Start Successful ---
13:37:55 INF [api_util log_msg  907 ] - SessionManager.start_sess(): PASSED
13:37:55 DEB [utils    ensure_s 737 ] TRACE: Entered ensure_session_ready
13:37:55 DEB [utils    ensure_d 723 ] Driver already live (Action: api_utils Self Check Ready - Ensure Driver).
13:37:55 DEB [utils    ensure_s 746 ] TRACE: About to call _perform_readiness_checks
13:37:55 DEB [utils    ensure_s 749 ] TRACE: Calling _perform_readiness_checks
13:37:55 DEB [utils    _perform 795 ] Performing readiness checks (action=api_utils Self Check Ready - Readiness Checks)...
13:37:55 INF [utils    _perform 815 ] [Persistence] Chrome user data directory is present: C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
13:37:55 DEB [utils    login_st 3229] Checking login status (API prioritized)...
13:37:55 DEB [utils    login_st 3242] Attempting API login verification (_verify_api_login_status)...
13:37:55 DEB [utils    _verify_ 1730] Verifying login status via API endpoint: https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna...
13:37:55 DEB [utils    _verify_ 1737] Syncing cookies before API login check...
13:37:55 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:37:55 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:37:55 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
13:37:55 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:37:55 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:37:55 DEB [utils    _api_req 2155] API Login Verification (header/dna): Cookies synced (Attempt 1).
13:37:55 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.468s (CurrentDelay: 0.50s)
13:37:55 DEB [utils    _api_req 2193] API Login Verification (header/dna): Rate limit wait: 0.47s (Attempt 1)
13:37:55 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Headers.
13:37:55 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Cookies.
13:37:56 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:37:56 DEB [utils    _verify_ 1769] API Login Verification (header/dna): API login check successful ('testId' found).
13:37:56 DEB [utils    login_st 3245] Login status confirmed TRUE via API check.
13:37:56 DEB [utils    _perform 892 ] Checking/Handling current URL...
13:37:56 DEB [utils    _check_a 1089] Current URL for check: https://www.ancestry.co.uk/
13:37:56 DEB [utils    _check_a 1126] Current URL is suitable, no extra navigation needed.
13:37:56 DEB [utils    _perform 896 ] URL check/handling OK.
13:37:56 DEB [utils    _perform 899 ] Verifying essential cookies...
13:37:56 DEB [utils    get_cook 1255] Waiting up to 5s for cookies: ['ANCSESSIONID', 'SecureATT']...
13:37:56 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
13:37:56 DEB [utils    _perform 908 ] Essential cookies OK.
13:37:56 DEB [utils    _perform 911 ] Syncing cookies to requests session...
13:37:56 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:37:56 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:37:56 DEB [utils    _perform 913 ] Cookies synced.
13:37:56 DEB [utils    _perform 916 ] Ensuring CSRF token...
13:37:56 DEB [utils    get_csrf 1215] Attempting to fetch fresh CSRF token from: https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken
13:37:56 DEB [utils    get_cook 1255] Waiting up to 10s for cookies: ['ANCSESSIONID', 'SecureATT']...
13:37:56 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
13:37:56 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken (Timeout: 60s, AllowRedirects: True)
13:37:56 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:37:56 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:37:56 DEB [utils    _api_req 2155] CSRF Token API: Cookies synced (Attempt 1).
13:37:56 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.443s (CurrentDelay: 0.50s)
13:37:56 DEB [utils    _api_req 2193] CSRF Token API: Rate limit wait: 0.44s (Attempt 1)
13:37:56 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'CSRF Token API'] Sending Headers.
13:37:56 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'CSRF Token API'] Sending Cookies.
13:37:57 DEB [utils    _api_req 2217] <-- Response Status: 200 OK
13:37:57 DEB [utils    get_csrf 1233] CSRF token successfully retrieved (Length: 144).
13:37:57 DEB [utils    _perform 924 ] CSRF token OK.
13:37:57 INF [utils    _perform 927 ] Readiness checks PASSED on attempt 1.
13:37:57 DEB [utils    ensure_s 752 ] TRACE: _perform_readiness_checks returned: True
13:37:57 DEB [utils    ensure_s 767 ] [Patch] Attempting to retrieve identifiers and tree owner after readiness checks...
13:37:57 DEB [utils    _retriev 1131] TRACE: Entered _retrieve_identifiers
13:37:57 DEB [utils    _retriev 1135] Retrieving profile ID (ucdmid)...
13:37:57 DEB [utils    get_my_p 1531] Attempting to fetch own profile ID (ucdmid)...
13:37:57 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/app-api/cdp-p13n/api/v1/users/me?attributes=ucdmid (Timeout: 60s, AllowRedirects: True)
13:37:57 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:37:57 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:37:57 DEB [utils    _api_req 2155] Get my profile_id: Cookies synced (Attempt 1).
13:37:57 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.543s (CurrentDelay: 0.50s)
13:37:57 DEB [utils    _api_req 2193] Get my profile_id: Rate limit wait: 0.54s (Attempt 1)
13:37:57 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Get my profile_id'] Sending Headers.
13:37:57 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Get my profile_id'] Sending Cookies.
13:37:57 DEB [utils    _api_req 2217] <-- Response Status: 200 OK
13:37:57 DEB [utils    get_my_p 1552] Successfully retrieved profile_id: 07BDD45E-0006-0000-0000-000000000000
13:37:57 INF [utils    _retriev 1141] My profile id: 07BDD45E-0006-0000-0000-000000000000
13:37:57 DEB [utils    _retriev 1147] Retrieving UUID (testId)...
13:37:57 DEB [utils    get_my_u 1569] Attempting to fetch own UUID (testId) from header/dna API...
13:37:57 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
13:37:57 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:37:57 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:37:57 DEB [utils    _api_req 2155] Get UUID API: Cookies synced (Attempt 1).
13:37:57 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.410s (CurrentDelay: 0.50s)
13:37:58 DEB [utils    _api_req 2193] Get UUID API: Rate limit wait: 0.41s (Attempt 1)
13:37:58 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Get UUID API'] Sending Headers.
13:37:58 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Get UUID API'] Sending Cookies.
13:37:58 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:37:58 DEB [utils    get_my_u 1581] Successfully retrieved UUID: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
13:37:58 INF [utils    _retriev 1153] My uuid: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
13:37:58 DEB [utils    _retriev 1159] Retrieving tree ID for tree name: 'Gault Family'...
13:37:58 DEB [utils    get_my_t 1604] Attempting to fetch tree ID for TREE_NAME='Gault Family'...
13:37:58 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/trees (Timeout: 60s, AllowRedirects: True)
13:37:58 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:37:58 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:37:58 DEB [utils    _api_req 2155] Header Trees API: Cookies synced (Attempt 1).
13:37:58 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.412s (CurrentDelay: 0.50s)
13:37:59 DEB [utils    _api_req 2193] Header Trees API: Rate limit wait: 0.41s (Attempt 1)
13:37:59 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Header Trees API'] Sending Headers.
13:37:59 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Header Trees API'] Sending Cookies.
13:37:59 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:37:59 DEB [utils    get_my_t 1628] Found tree ID '175946702' for tree 'Gault Family'.
13:37:59 INF [utils    _retriev 1169] My tree id: 175946702
13:37:59 DEB [utils    _retriev 1176] TRACE: Exiting _retrieve_identifiers
13:37:59 DEB [utils    _retriev 1182] TRACE: Entered _retrieve_tree_owner
13:37:59 DEB [utils    _retriev 1191] Retrieving tree owner name...
13:37:59 DEB [utils    get_tree 1668] Attempting to fetch tree owner name for tree ID: 175946702...
13:37:59 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/user/tree-info?tree_id=175946702 (Timeout: 60s, AllowRedirects: True)
13:37:59 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:37:59 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:37:59 DEB [utils    _api_req 2155] Tree Owner Name API: Cookies synced (Attempt 1).
13:37:59 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.460s (CurrentDelay: 0.50s)
13:38:00 DEB [utils    _api_req 2193] Tree Owner Name API: Rate limit wait: 0.46s (Attempt 1)
13:38:00 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Headers.
13:38:00 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Cookies.
13:38:00 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:38:00 DEB [utils    get_tree 1683] Found tree owner 'Wayne Gault' for tree ID 175946702.
13:38:00 INF [utils    _retriev 1203] Tree owner name: Wayne Gault
13:38:00 DEB [utils    _retriev 1205] TRACE: Exiting _retrieve_tree_owner (success)
13:38:00 DEB [utils    ensure_s 772 ] [Patch] Identifiers after fetch: profile_id=07BDD45E-0006-0000-0000-000000000000, uuid=FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7, tree_id=175946702
13:38:00 DEB [utils    ensure_s 773 ] [Patch] Tree owner name after fetch: Wayne Gault
13:38:00 DEB [utils    ensure_s 777 ] TRACE: Set self.session_ready to: True
13:38:00 DEB [utils    ensure_s 779 ] TRACE: Exiting ensure_session_ready (returning True)
13:38:00 INF [api_util log_msg  907 ] - SessionManager.ensure_session_ready(): PASSED
13:38:00 INF [api_util log_msg  907 ] 
                                      --- Phase 2: Validate Test Parameters (Post-Login) ---
13:38:00 INF [api_util log_msg  907 ] - Target Profile ID (TESTING_PROFILE_ID): 08FA6E79-0006-0000-0000-000000000000
13:38:00 INF [api_util log_msg  907 ] - Target Tree ID (MY_TREE_ID): 175946702
13:38:00 INF [api_util log_msg  907 ] - Target Owner Name: Wayne Gault
13:38:00 INF [api_util log_msg  907 ] 
                                      --- Phase 3: Test parse_ancestry_person_details (Profile Details API) ---
13:38:00 INF [api_util log_msg  907 ] - Calling Profile Details API: https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000
13:38:00 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000 (Timeout: 60s, AllowRedirects: True)
13:38:00 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:38:00 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:38:00 DEB [utils    _api_req 2155] Profile Details API (Self Check): Cookies synced (Attempt 1).
13:38:00 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.563s (CurrentDelay: 0.50s)
13:38:01 DEB [utils    _api_req 2193] Profile Details API (Self Check): Rate limit wait: 0.56s (Attempt 1)
13:38:01 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Profile Details API (Self Check)'] Sending Headers.
13:38:01 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Profile Details API (Self Check)'] Sending Cookies.
13:38:01 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:38:01 INF [api_util log_msg  907 ] - Profile Details API call: SUCCESS (Received dict)
13:38:01 DEB [api_util parse_an 396 ] Parsed API details for 'Frances Mc Hardy': ID=08FA6E79-0006-0000-0000-000000000000, Tree=175946702, Born='N/A' in 'None', Died='N/A' in 'None', Gender='None', Living=None
13:38:01 INF [api_util log_msg  907 ] - parse_ancestry_person_details call: SUCCESS
13:38:01 INF [api_util log_msg  907 ] - Parsed Details Validation: PASSED (Name: 'Frances Mc Hardy', Link: https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/08FA6E79-0006-0000-0000-000000000000/facts)
13:38:01 INF [api_util log_msg  907 ] 
                                      --- Phase 4: Test Relationship Ladder Parsing ---
13:38:01 INF [api_util log_msg  907 ] - Calling Relationship Ladder API: https://www.ancestry.co.uk/discoveryui-matches/ancestryrelationship/api/v1/relationship/ladder/08FA6E79-0006-0000-0000-000000000000
13:38:01 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/ancestryrelationship/api/v1/relationship/ladder/08FA6E79-0006-0000-0000-000000000000 (Timeout: 60s, AllowRedirects: True)
13:38:01 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
13:38:01 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
13:38:01 DEB [utils    _api_req 2155] Get Ladder API (Self Check): Cookies synced (Attempt 1).
13:38:01 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.502s (CurrentDelay: 0.50s)
13:38:02 DEB [utils    _api_req 2193] Get Ladder API (Self Check): Rate limit wait: 0.50s (Attempt 1)
13:38:02 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Get Ladder API (Self Check)'] Sending Headers.
13:38:02 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Get Ladder API (Self Check)'] Sending Cookies.
13:50:02 INF [api_util log_msg  919 ] 
                                      [api_utils.py self-check starting...]
13:50:02 INF [api_util log_msg  919 ] 
                                      --- Phase 0: Prerequisite Checks ---
13:50:02 INF [api_util log_msg  919 ] - BeautifulSoup Import: OK
13:50:02 INF [api_util log_msg  919 ] - format_name Import/Fallback: OK
13:50:02 INF [api_util log_msg  919 ] - ordinal_case Import/Fallback: OK
13:50:02 INF [api_util log_msg  919 ] - _parse_date Import/Fallback: OK
13:50:02 INF [api_util log_msg  919 ] - _clean_display_date Import/Fallback: OK
13:50:02 INF [api_util log_msg  919 ] - Config Check: Essential credentials/URLs/IDs present.
13:50:02 INF [api_util log_msg  919 ] 
                                      --- Phase 1: Session Setup & Login ---
13:50:02 DEB [utils    __init__ 619 ] Initialized shared requests.Session with HTTPAdapter.
13:50:02 DEB [utils    __init__ 634 ] Initialized shared cloudscraper instance with retry strategy.
13:50:02 DEB [utils    __init__ 474 ] RateLimiter Init: Capacity=10.0, FillRate=2.0/s, InitialDelay=0.50s, Backoff=1.80, Decrease=0.98
13:50:02 DEB [utils    __init__ 645 ] SessionManager instance created: ID=110938256
                                      
13:50:02 DEB [utils    start_se 649 ] --- SessionManager Phase 1: Starting Driver (api_utils Self Check Start) ---
                                      
13:50:02 DEB [utils    _initial 986 ] SessionManager ID=110938256 initializing SQLAlchemy Engine/Session...
13:50:02 DEB [utils    _initial 1001] DB Path: C:\Users\wayne\GitHub\Python\Projects\Ancestry\Data\ancestry.db
13:50:02 DEB [utils    _initial 1035] DB Pool Config: Size=10, MaxOverflow=5, Timeout=30
13:50:02 DEB [utils    _initial 1047] Created NEW SQLAlchemy engine: ID=116698592 for SM ID=110938256
13:50:02 DEB [utils    _initial 1064] Created Session factory for Engine ID=116698592
13:50:02 DEB [utils    enable_s 1057] SQLite PRAGMA settings applied (WAL, Foreign Keys).
13:50:02 DEB [database _create_ 310 ] Executing CREATE VIEW statement for 'messages' view...
13:50:02 DEB [database _create_ 313 ] Database view 'messages' created or already exists.
13:50:02 DEB [utils    _initial 1067] DB tables checked/created successfully.
13:50:02 DEB [utils    start_se 676 ] Initializing WebDriver instance (using init_webdvr)...
13:50:03 DEB [chromedr cleanup_ 394 ] Cleaned 8 chrome processes.
13:50:03 DEB [chromedr init_web 175 ] WebDriver initialization attempt 1/3...
13:50:03 INF [chromedr init_web 192 ] User data directory (no --profile-directory):
                                      C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
13:50:03 DEB [chromedr init_web 203 ] Using browser executable:
                                      C:\Program Files\Google\Chrome\Application\chrome.exe
13:50:03 DEB [chromedr init_web 220 ] Setting User-Agent:
                                      Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36
13:50:03 DEB [chromedr init_web 229 ] Letting undetected_chromedriver auto-manage ChromeDriver version (self-patching mode).
13:50:03 INF [chromedr init_web 231 ] [init_webdvr] Attempting uc.Chrome() self-patching (attempt 1)...
13:50:05 INF [chromedr init_web 234 ] [init_webdvr] uc.Chrome() self-patching succeeded in 2.50s (attempt 1)
13:50:05 DEB [chromedr init_web 235 ] WebDriver instance object potentially created (attempt 1).
13:50:05 DEB [chromedr init_web 277 ] User-Agent override applied via CDP.
13:50:05 DEB [chromedr init_web 282 ] Attempting to minimize window (non-headless mode)...
13:50:05 DEB [chromedr init_web 285 ] Browser window minimized.
13:50:05 DEB [chromedr init_web 309 ] WebDriver instance fully configured successfully (attempt 1).
13:50:05 DEB [utils    start_se 684 ] WebDriver initialization successful.
13:50:05 DEB [utils    start_se 685 ] Navigating to Base URL (https://www.ancestry.co.uk/) to stabilize...
13:50:05 DEB [utils    nav_to_p 3354] Navigation Attempt 1/3 to: https://www.ancestry.co.uk/
13:50:05 DEB [utils    nav_to_p 3377] Executing driver.get('https://www.ancestry.co.uk/')...
13:50:08 DEB [utils    nav_to_p 3390] Landed on URL base: https://www.ancestry.co.uk
13:50:10 DEB [utils    nav_to_p 3485] On correct URL base. Waiting up to 20s for selector: 'body'
13:50:10 DEB [utils    nav_to_p 3492] Navigation successful and element 'body' found on:
                                      https://www.ancestry.co.uk/
13:50:10 DEB [utils    start_se 698 ] Initial navigation to Base URL successful.
13:50:10 DEB [utils    start_se 702 ] --- SessionManager Phase 1: Driver Start Successful ---
13:50:10 INF [api_util log_msg  919 ] - SessionManager.start_sess(): PASSED
13:50:10 DEB [utils    ensure_s 737 ] TRACE: Entered ensure_session_ready
13:50:10 DEB [utils    ensure_d 723 ] Driver already live (Action: api_utils Self Check Ready - Ensure Driver).
13:50:10 DEB [utils    ensure_s 746 ] TRACE: About to call _perform_readiness_checks
13:50:10 DEB [utils    ensure_s 749 ] TRACE: Calling _perform_readiness_checks
13:50:10 DEB [utils    _perform 795 ] Performing readiness checks (action=api_utils Self Check Ready - Readiness Checks)...
13:50:10 INF [utils    _perform 815 ] [Persistence] Chrome user data directory is present: C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
13:50:10 DEB [utils    login_st 3229] Checking login status (API prioritized)...
13:50:10 DEB [utils    login_st 3242] Attempting API login verification (_verify_api_login_status)...
13:50:10 DEB [utils    _verify_ 1730] Verifying login status via API endpoint: https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna...
13:50:10 DEB [utils    _verify_ 1737] Syncing cookies before API login check...
13:50:10 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:50:10 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:50:10 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
13:50:10 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:50:10 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:50:10 DEB [utils    _api_req 2155] API Login Verification (header/dna): Cookies synced (Attempt 1).
13:50:10 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.558s (CurrentDelay: 0.50s)
13:50:11 DEB [utils    _api_req 2193] API Login Verification (header/dna): Rate limit wait: 0.56s (Attempt 1)
13:50:11 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Headers.
13:50:11 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Cookies.
13:50:11 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:50:11 DEB [utils    _verify_ 1769] API Login Verification (header/dna): API login check successful ('testId' found).
13:50:11 DEB [utils    login_st 3245] Login status confirmed TRUE via API check.
13:50:11 DEB [utils    _perform 892 ] Checking/Handling current URL...
13:50:11 DEB [utils    _check_a 1089] Current URL for check: https://www.ancestry.co.uk/
13:50:11 DEB [utils    _check_a 1126] Current URL is suitable, no extra navigation needed.
13:50:11 DEB [utils    _perform 896 ] URL check/handling OK.
13:50:11 DEB [utils    _perform 899 ] Verifying essential cookies...
13:50:11 DEB [utils    get_cook 1255] Waiting up to 5s for cookies: ['ANCSESSIONID', 'SecureATT']...
13:50:11 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
13:50:11 DEB [utils    _perform 908 ] Essential cookies OK.
13:50:11 DEB [utils    _perform 911 ] Syncing cookies to requests session...
13:50:11 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:50:11 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:50:11 DEB [utils    _perform 913 ] Cookies synced.
13:50:11 DEB [utils    _perform 916 ] Ensuring CSRF token...
13:50:11 DEB [utils    get_csrf 1215] Attempting to fetch fresh CSRF token from: https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken
13:50:11 DEB [utils    get_cook 1255] Waiting up to 10s for cookies: ['ANCSESSIONID', 'SecureATT']...
13:50:11 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
13:50:11 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken (Timeout: 60s, AllowRedirects: True)
13:50:11 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:50:11 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:50:11 DEB [utils    _api_req 2155] CSRF Token API: Cookies synced (Attempt 1).
13:50:11 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.498s (CurrentDelay: 0.50s)
13:50:12 DEB [utils    _api_req 2193] CSRF Token API: Rate limit wait: 0.50s (Attempt 1)
13:50:12 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'CSRF Token API'] Sending Headers.
13:50:12 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'CSRF Token API'] Sending Cookies.
13:50:12 DEB [utils    _api_req 2217] <-- Response Status: 200 OK
13:50:12 DEB [utils    get_csrf 1233] CSRF token successfully retrieved (Length: 144).
13:50:12 DEB [utils    _perform 924 ] CSRF token OK.
13:50:12 INF [utils    _perform 927 ] Readiness checks PASSED on attempt 1.
13:50:12 DEB [utils    ensure_s 752 ] TRACE: _perform_readiness_checks returned: True
13:50:12 DEB [utils    ensure_s 767 ] [Patch] Attempting to retrieve identifiers and tree owner after readiness checks...
13:50:12 DEB [utils    _retriev 1131] TRACE: Entered _retrieve_identifiers
13:50:12 DEB [utils    _retriev 1135] Retrieving profile ID (ucdmid)...
13:50:12 DEB [utils    get_my_p 1531] Attempting to fetch own profile ID (ucdmid)...
13:50:12 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/app-api/cdp-p13n/api/v1/users/me?attributes=ucdmid (Timeout: 60s, AllowRedirects: True)
13:50:12 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:50:12 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:50:12 DEB [utils    _api_req 2155] Get my profile_id: Cookies synced (Attempt 1).
13:50:12 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.471s (CurrentDelay: 0.50s)
13:50:13 DEB [utils    _api_req 2193] Get my profile_id: Rate limit wait: 0.47s (Attempt 1)
13:50:13 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Get my profile_id'] Sending Headers.
13:50:13 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Get my profile_id'] Sending Cookies.
13:50:13 DEB [utils    _api_req 2217] <-- Response Status: 200 OK
13:50:13 DEB [utils    get_my_p 1552] Successfully retrieved profile_id: 07BDD45E-0006-0000-0000-000000000000
13:50:13 INF [utils    _retriev 1141] My profile id: 07BDD45E-0006-0000-0000-000000000000
13:50:13 DEB [utils    _retriev 1147] Retrieving UUID (testId)...
13:50:13 DEB [utils    get_my_u 1569] Attempting to fetch own UUID (testId) from header/dna API...
13:50:13 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
13:50:13 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:50:13 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:50:13 DEB [utils    _api_req 2155] Get UUID API: Cookies synced (Attempt 1).
13:50:13 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.569s (CurrentDelay: 0.50s)
13:50:14 DEB [utils    _api_req 2193] Get UUID API: Rate limit wait: 0.57s (Attempt 1)
13:50:14 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Get UUID API'] Sending Headers.
13:50:14 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Get UUID API'] Sending Cookies.
13:50:14 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:50:14 DEB [utils    get_my_u 1581] Successfully retrieved UUID: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
13:50:14 INF [utils    _retriev 1153] My uuid: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
13:50:14 DEB [utils    _retriev 1159] Retrieving tree ID for tree name: 'Gault Family'...
13:50:14 DEB [utils    get_my_t 1604] Attempting to fetch tree ID for TREE_NAME='Gault Family'...
13:50:14 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/trees (Timeout: 60s, AllowRedirects: True)
13:50:14 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:50:14 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:50:14 DEB [utils    _api_req 2155] Header Trees API: Cookies synced (Attempt 1).
13:50:14 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.527s (CurrentDelay: 0.50s)
13:50:15 DEB [utils    _api_req 2193] Header Trees API: Rate limit wait: 0.53s (Attempt 1)
13:50:15 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Header Trees API'] Sending Headers.
13:50:15 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Header Trees API'] Sending Cookies.
13:50:15 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:50:15 DEB [utils    get_my_t 1628] Found tree ID '175946702' for tree 'Gault Family'.
13:50:15 INF [utils    _retriev 1169] My tree id: 175946702
13:50:15 DEB [utils    _retriev 1176] TRACE: Exiting _retrieve_identifiers
13:50:15 DEB [utils    _retriev 1182] TRACE: Entered _retrieve_tree_owner
13:50:15 DEB [utils    _retriev 1191] Retrieving tree owner name...
13:50:15 DEB [utils    get_tree 1668] Attempting to fetch tree owner name for tree ID: 175946702...
13:50:15 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/user/tree-info?tree_id=175946702 (Timeout: 60s, AllowRedirects: True)
13:50:15 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:50:15 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:50:15 DEB [utils    _api_req 2155] Tree Owner Name API: Cookies synced (Attempt 1).
13:50:15 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.580s (CurrentDelay: 0.50s)
13:50:16 DEB [utils    _api_req 2193] Tree Owner Name API: Rate limit wait: 0.58s (Attempt 1)
13:50:16 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Headers.
13:50:16 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Cookies.
13:50:17 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:50:17 DEB [utils    get_tree 1683] Found tree owner 'Wayne Gault' for tree ID 175946702.
13:50:17 INF [utils    _retriev 1203] Tree owner name: Wayne Gault
13:50:17 DEB [utils    _retriev 1205] TRACE: Exiting _retrieve_tree_owner (success)
13:50:17 DEB [utils    ensure_s 772 ] [Patch] Identifiers after fetch: profile_id=07BDD45E-0006-0000-0000-000000000000, uuid=FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7, tree_id=175946702
13:50:17 DEB [utils    ensure_s 773 ] [Patch] Tree owner name after fetch: Wayne Gault
13:50:17 DEB [utils    ensure_s 777 ] TRACE: Set self.session_ready to: True
13:50:17 DEB [utils    ensure_s 779 ] TRACE: Exiting ensure_session_ready (returning True)
13:50:17 INF [api_util log_msg  919 ] - SessionManager.ensure_session_ready(): PASSED
13:50:17 INF [api_util log_msg  919 ] 
                                      --- Phase 2: Validate Test Parameters (Post-Login) ---
13:50:17 INF [api_util log_msg  919 ] - Target Profile ID (TESTING_PROFILE_ID): 08FA6E79-0006-0000-0000-000000000000
13:50:17 INF [api_util log_msg  919 ] - Target Tree ID (MY_TREE_ID): 175946702
13:50:17 INF [api_util log_msg  919 ] - Target Owner Name: Wayne Gault
13:50:17 INF [api_util log_msg  919 ] 
                                      --- Phase 3: Test parse_ancestry_person_details (Profile Details API) ---
13:50:17 INF [api_util log_msg  919 ] - Calling Profile Details API: https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000
13:50:17 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000 (Timeout: 60s, AllowRedirects: True)
13:50:17 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:50:17 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:50:17 DEB [utils    _api_req 2155] Profile Details API (Self Check): Cookies synced (Attempt 1).
13:50:17 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.404s (CurrentDelay: 0.50s)
13:50:17 DEB [utils    _api_req 2193] Profile Details API (Self Check): Rate limit wait: 0.40s (Attempt 1)
13:50:17 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Profile Details API (Self Check)'] Sending Headers.
13:50:17 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Profile Details API (Self Check)'] Sending Cookies.
13:50:18 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:50:18 INF [api_util log_msg  919 ] - Profile Details API call: SUCCESS (Received dict)
13:50:18 DEB [api_util parse_an 408 ] Parsed API details for 'Frances Mc Hardy': ID=08FA6E79-0006-0000-0000-000000000000, Tree=175946702, Born='N/A' in 'None', Died='N/A' in 'None', Gender='None', Living=None
13:50:18 INF [api_util log_msg  919 ] - parse_ancestry_person_details call: SUCCESS
13:50:18 INF [api_util log_msg  919 ] - Parsed Details Validation: PASSED (Name: 'Frances Mc Hardy', Link: https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/08FA6E79-0006-0000-0000-000000000000/facts)
13:50:18 INF [api_util log_msg  919 ] 
                                      --- Phase 4: Test Relationship Ladder Parsing ---
13:50:18 INF [api_util log_msg  919 ] - Calling Relationship Ladder API: https://www.ancestry.co.uk/discoveryui-matches/ancestryrelationship/api/v1/relationship/ladder/08FA6E79-0006-0000-0000-000000000000
13:50:18 INF [api_util log_msg  919 ] - Cookies in requests session before Ladder call (43): AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg, ANCATT, ANCSESSIONID, ANCUUID, ATT, BAIT, Cache-Key, LAU, OMNITURE, OPTOUTMULTI, RMEATT, SecureATT, TI, TI.SI, UAUTH_DEVICE, VARS, __adal_ca, __adal_cw, __adal_id, __adal_ses, __cf_bm, __spdt, _cfuvid, _derived_epik, _dnamatches-matchlistui-x-csrf-token, _fbp, _ga, _ga_4QT8FMEX30, _ga_6R6RRSB9ZD, _gcl_au, _pin_unauth, _tt_enable_cookie, _ttp, _uetsid, _uetvid, an_s_split, an_split, at_check, cf_clearance, mbox, mboxEdgeCluster, ttcsid, ttcsid_CN1QODBC77UELPL12JV0
13:50:18 INF [api_util log_msg  919 ] - Found '_dnamatches-matchlistui-x-csrf-token' cookie: No
13:50:18 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/ancestryrelationship/api/v1/relationship/ladder/08FA6E79-0006-0000-0000-000000000000 (Timeout: 20s, AllowRedirects: True)
13:50:18 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:50:18 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:50:18 DEB [utils    _api_req 2155] Get Ladder API (Self Check): Cookies synced (Attempt 1).
13:50:18 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.484s (CurrentDelay: 0.50s)
13:50:18 DEB [utils    _api_req 2193] Get Ladder API (Self Check): Rate limit wait: 0.48s (Attempt 1)
13:50:18 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Get Ladder API (Self Check)'] Sending Headers.
13:50:18 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Get Ladder API (Self Check)'] Sending Cookies.
13:51:42 WAR [utils    _api_req 2251] Get Ladder API (Self Check): ConnectionError (Attempt 1/3). Retrying in 0.67s... Error: HTTPSConnectionPool(host='www.ancestry.co.uk', port=443): Max retries exceeded with url: /discoveryui-matches/ancestryrelationship/api/v1/relationship/ladder/08FA6E79-0006-0000-0000-000000000000 (Caused by ReadTimeoutError("HTTPSConnectionPool(host='www.ancestry.co.uk', port=443): Read timed out. (read timeout=20)"))
13:51:42 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:51:42 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:51:42 DEB [utils    _api_req 2155] Get Ladder API (Self Check): Cookies synced (Attempt 2).
13:51:42 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.434s (CurrentDelay: 0.50s)
13:51:43 DEB [utils    _api_req 2193] Get Ladder API (Self Check): Rate limit wait: 0.43s (Attempt 2)
13:51:43 DEB [utils    _api_req 2203] [_api_req Attempt 2 for 'Get Ladder API (Self Check)'] Sending Headers.
13:51:43 DEB [utils    _api_req 2206] [_api_req Attempt 2 for 'Get Ladder API (Self Check)'] Sending Cookies.
13:57:19 INF [api_util log_msg  919 ] 
                                      [api_utils.py self-check starting...]
13:57:19 INF [api_util log_msg  919 ] 
                                      --- Phase 0: Prerequisite Checks ---
13:57:19 INF [api_util log_msg  919 ] - BeautifulSoup Import: OK
13:57:19 INF [api_util log_msg  919 ] - format_name Import/Fallback: OK
13:57:19 INF [api_util log_msg  919 ] - ordinal_case Import/Fallback: OK
13:57:19 INF [api_util log_msg  919 ] - _parse_date Import/Fallback: OK
13:57:19 INF [api_util log_msg  919 ] - _clean_display_date Import/Fallback: OK
13:57:19 INF [api_util log_msg  919 ] - Config Check: Essential credentials/URLs/IDs present.
13:57:19 INF [api_util log_msg  919 ] 
                                      --- Phase 1: Session Setup & Login ---
13:57:19 DEB [utils    __init__ 619 ] Initialized shared requests.Session with HTTPAdapter.
13:57:19 DEB [utils    __init__ 634 ] Initialized shared cloudscraper instance with retry strategy.
13:57:19 DEB [utils    __init__ 474 ] RateLimiter Init: Capacity=10.0, FillRate=2.0/s, InitialDelay=0.50s, Backoff=1.80, Decrease=0.98
13:57:19 DEB [utils    __init__ 645 ] SessionManager instance created: ID=111072880
                                      
13:57:19 DEB [utils    start_se 649 ] --- SessionManager Phase 1: Starting Driver (api_utils Self Check Start) ---
                                      
13:57:19 DEB [utils    _initial 986 ] SessionManager ID=111072880 initializing SQLAlchemy Engine/Session...
13:57:19 DEB [utils    _initial 1001] DB Path: C:\Users\wayne\GitHub\Python\Projects\Ancestry\Data\ancestry.db
13:57:19 DEB [utils    _initial 1035] DB Pool Config: Size=10, MaxOverflow=5, Timeout=30
13:57:19 DEB [utils    _initial 1047] Created NEW SQLAlchemy engine: ID=110784160 for SM ID=111072880
13:57:19 DEB [utils    _initial 1064] Created Session factory for Engine ID=110784160
13:57:19 DEB [utils    enable_s 1057] SQLite PRAGMA settings applied (WAL, Foreign Keys).
13:57:19 DEB [database _create_ 310 ] Executing CREATE VIEW statement for 'messages' view...
13:57:19 DEB [database _create_ 313 ] Database view 'messages' created or already exists.
13:57:19 DEB [utils    _initial 1067] DB tables checked/created successfully.
13:57:19 DEB [utils    start_se 676 ] Initializing WebDriver instance (using init_webdvr)...
13:57:20 DEB [chromedr cleanup_ 394 ] Cleaned 10 chrome processes.
13:57:20 DEB [chromedr init_web 175 ] WebDriver initialization attempt 1/3...
13:57:20 INF [chromedr init_web 192 ] User data directory (no --profile-directory):
                                      C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
13:57:20 DEB [chromedr init_web 203 ] Using browser executable:
                                      C:\Program Files\Google\Chrome\Application\chrome.exe
13:57:20 DEB [chromedr init_web 220 ] Setting User-Agent:
                                      Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
13:57:20 DEB [chromedr init_web 229 ] Letting undetected_chromedriver auto-manage ChromeDriver version (self-patching mode).
13:57:20 INF [chromedr init_web 231 ] [init_webdvr] Attempting uc.Chrome() self-patching (attempt 1)...
13:57:33 INF [api_util log_msg  954 ] 
                                      [api_utils.py self-check starting...]
13:57:33 INF [api_util log_msg  954 ] 
                                      --- Phase 0: Prerequisite Checks ---
13:57:33 INF [api_util log_msg  954 ] - BeautifulSoup Import: OK
13:57:33 INF [api_util log_msg  954 ] - format_name Import/Fallback: OK
13:57:33 INF [api_util log_msg  954 ] - ordinal_case Import/Fallback: OK
13:57:33 INF [api_util log_msg  954 ] - _parse_date Import/Fallback: OK
13:57:33 INF [api_util log_msg  954 ] - _clean_display_date Import/Fallback: OK
13:57:33 INF [api_util log_msg  954 ] - Config Check: Essential credentials/URLs/IDs present.
13:57:33 INF [api_util log_msg  954 ] 
                                      --- Phase 1: Session Setup & Login ---
13:57:33 DEB [utils    __init__ 619 ] Initialized shared requests.Session with HTTPAdapter.
13:57:33 DEB [utils    __init__ 634 ] Initialized shared cloudscraper instance with retry strategy.
13:57:33 DEB [utils    __init__ 474 ] RateLimiter Init: Capacity=10.0, FillRate=2.0/s, InitialDelay=0.50s, Backoff=1.80, Decrease=0.98
13:57:33 DEB [utils    __init__ 645 ] SessionManager instance created: ID=116457840
                                      
13:57:33 DEB [utils    start_se 649 ] --- SessionManager Phase 1: Starting Driver (api_utils Self Check Start) ---
                                      
13:57:33 DEB [utils    _initial 986 ] SessionManager ID=116457840 initializing SQLAlchemy Engine/Session...
13:57:33 DEB [utils    _initial 1001] DB Path: C:\Users\wayne\GitHub\Python\Projects\Ancestry\Data\ancestry.db
13:57:33 DEB [utils    _initial 1035] DB Pool Config: Size=10, MaxOverflow=5, Timeout=30
13:57:33 DEB [utils    _initial 1047] Created NEW SQLAlchemy engine: ID=69583840 for SM ID=116457840
13:57:33 DEB [utils    _initial 1064] Created Session factory for Engine ID=69583840
13:57:33 DEB [utils    enable_s 1057] SQLite PRAGMA settings applied (WAL, Foreign Keys).
13:57:33 DEB [database _create_ 310 ] Executing CREATE VIEW statement for 'messages' view...
13:57:33 DEB [database _create_ 313 ] Database view 'messages' created or already exists.
13:57:33 DEB [utils    _initial 1067] DB tables checked/created successfully.
13:57:33 DEB [utils    start_se 676 ] Initializing WebDriver instance (using init_webdvr)...
13:57:33 DEB [chromedr init_web 175 ] WebDriver initialization attempt 1/3...
13:57:33 INF [chromedr init_web 192 ] User data directory (no --profile-directory):
                                      C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
13:57:33 DEB [chromedr init_web 203 ] Using browser executable:
                                      C:\Program Files\Google\Chrome\Application\chrome.exe
13:57:33 DEB [chromedr init_web 220 ] Setting User-Agent:
                                      Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
13:57:33 DEB [chromedr init_web 229 ] Letting undetected_chromedriver auto-manage ChromeDriver version (self-patching mode).
13:57:33 INF [chromedr init_web 231 ] [init_webdvr] Attempting uc.Chrome() self-patching (attempt 1)...
13:57:36 INF [chromedr init_web 234 ] [init_webdvr] uc.Chrome() self-patching succeeded in 2.34s (attempt 1)
13:57:36 DEB [chromedr init_web 235 ] WebDriver instance object potentially created (attempt 1).
13:57:36 DEB [chromedr init_web 277 ] User-Agent override applied via CDP.
13:57:36 DEB [chromedr init_web 282 ] Attempting to minimize window (non-headless mode)...
13:57:36 DEB [chromedr init_web 285 ] Browser window minimized.
13:57:36 DEB [chromedr init_web 309 ] WebDriver instance fully configured successfully (attempt 1).
13:57:36 DEB [utils    start_se 684 ] WebDriver initialization successful.
13:57:36 DEB [utils    start_se 685 ] Navigating to Base URL (https://www.ancestry.co.uk/) to stabilize...
13:57:36 DEB [utils    nav_to_p 3354] Navigation Attempt 1/3 to: https://www.ancestry.co.uk/
13:57:36 DEB [utils    nav_to_p 3377] Executing driver.get('https://www.ancestry.co.uk/')...
13:57:38 DEB [utils    nav_to_p 3390] Landed on URL base: https://www.ancestry.co.uk
13:57:40 DEB [utils    nav_to_p 3485] On correct URL base. Waiting up to 20s for selector: 'body'
13:57:40 DEB [utils    nav_to_p 3492] Navigation successful and element 'body' found on:
                                      https://www.ancestry.co.uk/
13:57:40 DEB [utils    start_se 698 ] Initial navigation to Base URL successful.
13:57:40 DEB [utils    start_se 702 ] --- SessionManager Phase 1: Driver Start Successful ---
13:57:40 INF [api_util log_msg  954 ] - SessionManager.start_sess(): PASSED
13:57:40 DEB [utils    ensure_s 737 ] TRACE: Entered ensure_session_ready
13:57:40 DEB [utils    ensure_d 723 ] Driver already live (Action: api_utils Self Check Ready - Ensure Driver).
13:57:40 DEB [utils    ensure_s 746 ] TRACE: About to call _perform_readiness_checks
13:57:40 DEB [utils    ensure_s 749 ] TRACE: Calling _perform_readiness_checks
13:57:40 DEB [utils    _perform 795 ] Performing readiness checks (action=api_utils Self Check Ready - Readiness Checks)...
13:57:40 INF [utils    _perform 815 ] [Persistence] Chrome user data directory is present: C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
13:57:40 DEB [utils    login_st 3229] Checking login status (API prioritized)...
13:57:40 DEB [utils    login_st 3242] Attempting API login verification (_verify_api_login_status)...
13:57:40 DEB [utils    _verify_ 1730] Verifying login status via API endpoint: https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna...
13:57:40 DEB [utils    _verify_ 1737] Syncing cookies before API login check...
13:57:40 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:57:40 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:57:40 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
13:57:40 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:57:40 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:57:40 DEB [utils    _api_req 2155] API Login Verification (header/dna): Cookies synced (Attempt 1).
13:57:40 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.419s (CurrentDelay: 0.50s)
13:57:41 DEB [utils    _api_req 2193] API Login Verification (header/dna): Rate limit wait: 0.42s (Attempt 1)
13:57:41 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Headers.
13:57:41 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Cookies.
13:57:42 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:57:42 DEB [utils    _verify_ 1769] API Login Verification (header/dna): API login check successful ('testId' found).
13:57:42 DEB [utils    login_st 3245] Login status confirmed TRUE via API check.
13:57:42 DEB [utils    _perform 892 ] Checking/Handling current URL...
13:57:42 DEB [utils    _check_a 1089] Current URL for check: https://www.ancestry.co.uk/
13:57:42 DEB [utils    _check_a 1126] Current URL is suitable, no extra navigation needed.
13:57:42 DEB [utils    _perform 896 ] URL check/handling OK.
13:57:42 DEB [utils    _perform 899 ] Verifying essential cookies...
13:57:42 DEB [utils    get_cook 1255] Waiting up to 5s for cookies: ['ANCSESSIONID', 'SecureATT']...
13:57:42 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
13:57:42 DEB [utils    _perform 908 ] Essential cookies OK.
13:57:42 DEB [utils    _perform 911 ] Syncing cookies to requests session...
13:57:42 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:57:42 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:57:42 DEB [utils    _perform 913 ] Cookies synced.
13:57:42 DEB [utils    _perform 916 ] Ensuring CSRF token...
13:57:42 DEB [utils    get_csrf 1215] Attempting to fetch fresh CSRF token from: https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken
13:57:42 DEB [utils    get_cook 1255] Waiting up to 10s for cookies: ['ANCSESSIONID', 'SecureATT']...
13:57:42 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
13:57:42 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken (Timeout: 60s, AllowRedirects: True)
13:57:42 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:57:42 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:57:42 DEB [utils    _api_req 2155] CSRF Token API: Cookies synced (Attempt 1).
13:57:42 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.575s (CurrentDelay: 0.50s)
13:57:42 DEB [utils    _api_req 2193] CSRF Token API: Rate limit wait: 0.58s (Attempt 1)
13:57:42 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'CSRF Token API'] Sending Headers.
13:57:42 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'CSRF Token API'] Sending Cookies.
13:57:43 DEB [utils    _api_req 2217] <-- Response Status: 200 OK
13:57:43 DEB [utils    get_csrf 1233] CSRF token successfully retrieved (Length: 144).
13:57:43 DEB [utils    _perform 924 ] CSRF token OK.
13:57:43 INF [utils    _perform 927 ] Readiness checks PASSED on attempt 1.
13:57:43 DEB [utils    ensure_s 752 ] TRACE: _perform_readiness_checks returned: True
13:57:43 DEB [utils    ensure_s 767 ] [Patch] Attempting to retrieve identifiers and tree owner after readiness checks...
13:57:43 DEB [utils    _retriev 1131] TRACE: Entered _retrieve_identifiers
13:57:43 DEB [utils    _retriev 1135] Retrieving profile ID (ucdmid)...
13:57:43 DEB [utils    get_my_p 1531] Attempting to fetch own profile ID (ucdmid)...
13:57:43 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/app-api/cdp-p13n/api/v1/users/me?attributes=ucdmid (Timeout: 60s, AllowRedirects: True)
13:57:43 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:57:43 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:57:43 DEB [utils    _api_req 2155] Get my profile_id: Cookies synced (Attempt 1).
13:57:43 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.542s (CurrentDelay: 0.50s)
13:57:43 DEB [utils    _api_req 2193] Get my profile_id: Rate limit wait: 0.54s (Attempt 1)
13:57:43 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Get my profile_id'] Sending Headers.
13:57:43 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Get my profile_id'] Sending Cookies.
13:57:44 DEB [utils    _api_req 2217] <-- Response Status: 200 OK
13:57:44 DEB [utils    get_my_p 1552] Successfully retrieved profile_id: 07BDD45E-0006-0000-0000-000000000000
13:57:44 INF [utils    _retriev 1141] My profile id: 07BDD45E-0006-0000-0000-000000000000
13:57:44 DEB [utils    _retriev 1147] Retrieving UUID (testId)...
13:57:44 DEB [utils    get_my_u 1569] Attempting to fetch own UUID (testId) from header/dna API...
13:57:44 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
13:57:44 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:57:44 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:57:44 DEB [utils    _api_req 2155] Get UUID API: Cookies synced (Attempt 1).
13:57:44 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.478s (CurrentDelay: 0.50s)
13:57:44 DEB [utils    _api_req 2193] Get UUID API: Rate limit wait: 0.48s (Attempt 1)
13:57:44 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Get UUID API'] Sending Headers.
13:57:44 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Get UUID API'] Sending Cookies.
13:57:45 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:57:45 DEB [utils    get_my_u 1581] Successfully retrieved UUID: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
13:57:45 INF [utils    _retriev 1153] My uuid: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
13:57:45 DEB [utils    _retriev 1159] Retrieving tree ID for tree name: 'Gault Family'...
13:57:45 DEB [utils    get_my_t 1604] Attempting to fetch tree ID for TREE_NAME='Gault Family'...
13:57:45 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/trees (Timeout: 60s, AllowRedirects: True)
13:57:45 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:57:45 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:57:45 DEB [utils    _api_req 2155] Header Trees API: Cookies synced (Attempt 1).
13:57:45 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.591s (CurrentDelay: 0.50s)
13:57:45 DEB [utils    _api_req 2193] Header Trees API: Rate limit wait: 0.59s (Attempt 1)
13:57:45 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Header Trees API'] Sending Headers.
13:57:45 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Header Trees API'] Sending Cookies.
13:57:46 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:57:46 DEB [utils    get_my_t 1628] Found tree ID '175946702' for tree 'Gault Family'.
13:57:46 INF [utils    _retriev 1169] My tree id: 175946702
13:57:46 DEB [utils    _retriev 1176] TRACE: Exiting _retrieve_identifiers
13:57:46 DEB [utils    _retriev 1182] TRACE: Entered _retrieve_tree_owner
13:57:46 DEB [utils    _retriev 1191] Retrieving tree owner name...
13:57:46 DEB [utils    get_tree 1668] Attempting to fetch tree owner name for tree ID: 175946702...
13:57:46 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/user/tree-info?tree_id=175946702 (Timeout: 60s, AllowRedirects: True)
13:57:46 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:57:46 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:57:46 DEB [utils    _api_req 2155] Tree Owner Name API: Cookies synced (Attempt 1).
13:57:46 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.583s (CurrentDelay: 0.50s)
13:57:47 DEB [utils    _api_req 2193] Tree Owner Name API: Rate limit wait: 0.58s (Attempt 1)
13:57:47 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Headers.
13:57:47 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Cookies.
13:57:48 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:57:48 DEB [utils    get_tree 1683] Found tree owner 'Wayne Gault' for tree ID 175946702.
13:57:48 INF [utils    _retriev 1203] Tree owner name: Wayne Gault
13:57:48 DEB [utils    _retriev 1205] TRACE: Exiting _retrieve_tree_owner (success)
13:57:48 DEB [utils    ensure_s 772 ] [Patch] Identifiers after fetch: profile_id=07BDD45E-0006-0000-0000-000000000000, uuid=FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7, tree_id=175946702
13:57:48 DEB [utils    ensure_s 773 ] [Patch] Tree owner name after fetch: Wayne Gault
13:57:48 DEB [utils    ensure_s 777 ] TRACE: Set self.session_ready to: True
13:57:48 DEB [utils    ensure_s 779 ] TRACE: Exiting ensure_session_ready (returning True)
13:57:48 INF [api_util log_msg  954 ] - SessionManager.ensure_session_ready(): PASSED
13:57:48 INF [api_util log_msg  954 ] 
                                      --- Phase 2: Get Target Info & Tree-Specific Person ID ---
13:57:48 INF [api_util log_msg  954 ] - Target Profile ID (TESTING_PROFILE_ID): 08FA6E79-0006-0000-0000-000000000000
13:57:48 INF [api_util log_msg  954 ] - Target Tree ID (MY_TREE_ID): 175946702
13:57:48 INF [api_util log_msg  954 ] - Target Owner Name: Wayne Gault
13:57:48 INF [api_util log_msg  954 ] - Getting target name from Profile API: https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000
13:57:48 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000 (Timeout: 60s, AllowRedirects: True)
13:57:48 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:57:48 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:57:48 DEB [utils    _api_req 2155] Get Target Name (Profile Details): Cookies synced (Attempt 1).
13:57:48 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.542s (CurrentDelay: 0.50s)
13:57:48 DEB [utils    _api_req 2193] Get Target Name (Profile Details): Rate limit wait: 0.54s (Attempt 1)
13:57:48 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Headers.
13:57:48 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Cookies.
13:57:48 DEB [utils    _api_req 2217] <-- Response Status: 200 
13:57:48 INF [api_util log_msg  954 ] - Target Name found: 'Frances Mc Hardy'
13:57:48 INF [api_util log_msg  954 ] - Searching for 'Frances Mc Hardy' in tree 175946702 via API: https://www.ancestry.co.uk/api/treesui-list/trees/175946702/persons?name=Frances+Mc+Hardy&limit=5&fields=NAMES
13:57:48 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/treesui-list/trees/175946702/persons?name=Frances+Mc+Hardy&limit=5&fields=NAMES (Timeout: 60s, AllowRedirects: True)
13:57:48 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
13:57:48 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
13:57:48 DEB [utils    _api_req 2155] Tree Person Search API (Self Check): Cookies synced (Attempt 1).
13:57:48 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.434s (CurrentDelay: 0.50s)
13:57:49 DEB [utils    _api_req 2193] Tree Person Search API (Self Check): Rate limit wait: 0.43s (Attempt 1)
13:57:49 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] Sending Headers.
13:57:49 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] Sending Cookies.
14:03:12 INF [api_util log_msg  956 ] 
                                      [api_utils.py self-check starting...]
14:03:12 INF [api_util log_msg  956 ] 
                                      --- Phase 0: Prerequisite Checks ---
14:03:12 INF [api_util log_msg  956 ] - BeautifulSoup Import: OK
14:03:12 INF [api_util log_msg  956 ] - format_name Import/Fallback: OK
14:03:12 INF [api_util log_msg  956 ] - ordinal_case Import/Fallback: OK
14:03:12 INF [api_util log_msg  956 ] - _parse_date Import/Fallback: OK
14:03:12 INF [api_util log_msg  956 ] - _clean_display_date Import/Fallback: OK
14:03:12 INF [api_util log_msg  956 ] - Config Check: Essential credentials/URLs/IDs present.
14:03:12 INF [api_util log_msg  956 ] 
                                      --- Phase 1: Session Setup & Login ---
14:03:12 DEB [utils    __init__ 619 ] Initialized shared requests.Session with HTTPAdapter.
14:03:12 DEB [utils    __init__ 634 ] Initialized shared cloudscraper instance with retry strategy.
14:03:12 DEB [utils    __init__ 474 ] RateLimiter Init: Capacity=10.0, FillRate=2.0/s, InitialDelay=0.50s, Backoff=1.80, Decrease=0.98
14:03:12 DEB [utils    __init__ 645 ] SessionManager instance created: ID=29273040
                                      
14:03:12 DEB [utils    start_se 649 ] --- SessionManager Phase 1: Starting Driver (api_utils Self Check Start) ---
                                      
14:03:12 DEB [utils    _initial 986 ] SessionManager ID=29273040 initializing SQLAlchemy Engine/Session...
14:03:12 DEB [utils    _initial 1001] DB Path: C:\Users\wayne\GitHub\Python\Projects\Ancestry\Data\ancestry.db
14:03:12 DEB [utils    _initial 1035] DB Pool Config: Size=10, MaxOverflow=5, Timeout=30
14:03:12 DEB [utils    _initial 1047] Created NEW SQLAlchemy engine: ID=117470464 for SM ID=29273040
14:03:12 DEB [utils    _initial 1064] Created Session factory for Engine ID=117470464
14:03:12 DEB [utils    enable_s 1057] SQLite PRAGMA settings applied (WAL, Foreign Keys).
14:03:12 DEB [database _create_ 310 ] Executing CREATE VIEW statement for 'messages' view...
14:03:12 DEB [database _create_ 313 ] Database view 'messages' created or already exists.
14:03:12 DEB [utils    _initial 1067] DB tables checked/created successfully.
14:03:12 DEB [utils    start_se 676 ] Initializing WebDriver instance (using init_webdvr)...
14:03:12 DEB [chromedr cleanup_ 394 ] Cleaned 9 chrome processes.
14:03:12 DEB [chromedr init_web 175 ] WebDriver initialization attempt 1/3...
14:03:12 INF [chromedr init_web 192 ] User data directory (no --profile-directory):
                                      C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
14:03:12 DEB [chromedr init_web 203 ] Using browser executable:
                                      C:\Program Files\Google\Chrome\Application\chrome.exe
14:03:12 DEB [chromedr init_web 220 ] Setting User-Agent:
                                      Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
14:03:12 DEB [chromedr init_web 229 ] Letting undetected_chromedriver auto-manage ChromeDriver version (self-patching mode).
14:03:12 INF [chromedr init_web 231 ] [init_webdvr] Attempting uc.Chrome() self-patching (attempt 1)...
14:03:15 INF [chromedr init_web 234 ] [init_webdvr] uc.Chrome() self-patching succeeded in 2.55s (attempt 1)
14:03:15 DEB [chromedr init_web 235 ] WebDriver instance object potentially created (attempt 1).
14:03:15 DEB [chromedr init_web 277 ] User-Agent override applied via CDP.
14:03:15 DEB [chromedr init_web 282 ] Attempting to minimize window (non-headless mode)...
14:03:15 DEB [chromedr init_web 285 ] Browser window minimized.
14:03:15 DEB [chromedr init_web 309 ] WebDriver instance fully configured successfully (attempt 1).
14:03:15 DEB [utils    start_se 684 ] WebDriver initialization successful.
14:03:15 DEB [utils    start_se 685 ] Navigating to Base URL (https://www.ancestry.co.uk/) to stabilize...
14:03:15 DEB [utils    nav_to_p 3354] Navigation Attempt 1/3 to: https://www.ancestry.co.uk/
14:03:15 DEB [utils    nav_to_p 3377] Executing driver.get('https://www.ancestry.co.uk/')...
14:03:17 DEB [utils    nav_to_p 3390] Landed on URL base: https://www.ancestry.co.uk
14:03:19 DEB [utils    nav_to_p 3485] On correct URL base. Waiting up to 20s for selector: 'body'
14:03:19 DEB [utils    nav_to_p 3492] Navigation successful and element 'body' found on:
                                      https://www.ancestry.co.uk/
14:03:19 DEB [utils    start_se 698 ] Initial navigation to Base URL successful.
14:03:19 DEB [utils    start_se 702 ] --- SessionManager Phase 1: Driver Start Successful ---
14:03:19 INF [api_util log_msg  956 ] - SessionManager.start_sess(): PASSED
14:03:19 DEB [utils    ensure_s 737 ] TRACE: Entered ensure_session_ready
14:03:19 DEB [utils    ensure_d 723 ] Driver already live (Action: api_utils Self Check Ready - Ensure Driver).
14:03:19 DEB [utils    ensure_s 746 ] TRACE: About to call _perform_readiness_checks
14:03:19 DEB [utils    ensure_s 749 ] TRACE: Calling _perform_readiness_checks
14:03:19 DEB [utils    _perform 795 ] Performing readiness checks (action=api_utils Self Check Ready - Readiness Checks)...
14:03:19 INF [utils    _perform 815 ] [Persistence] Chrome user data directory is present: C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
14:03:19 DEB [utils    login_st 3229] Checking login status (API prioritized)...
14:03:19 DEB [utils    login_st 3242] Attempting API login verification (_verify_api_login_status)...
14:03:19 DEB [utils    _verify_ 1730] Verifying login status via API endpoint: https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna...
14:03:19 DEB [utils    _verify_ 1737] Syncing cookies before API login check...
14:03:19 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
14:03:19 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
14:03:19 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
14:03:19 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
14:03:19 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
14:03:19 DEB [utils    _api_req 2155] API Login Verification (header/dna): Cookies synced (Attempt 1).
14:03:19 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.419s (CurrentDelay: 0.50s)
14:03:20 DEB [utils    _api_req 2193] API Login Verification (header/dna): Rate limit wait: 0.42s (Attempt 1)
14:03:20 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Headers.
14:03:20 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Cookies.
14:03:20 DEB [utils    _api_req 2217] <-- Response Status: 200 
14:03:20 DEB [utils    _verify_ 1769] API Login Verification (header/dna): API login check successful ('testId' found).
14:03:20 DEB [utils    login_st 3245] Login status confirmed TRUE via API check.
14:03:20 DEB [utils    _perform 892 ] Checking/Handling current URL...
14:03:20 DEB [utils    _check_a 1089] Current URL for check: https://www.ancestry.co.uk/
14:03:20 DEB [utils    _check_a 1126] Current URL is suitable, no extra navigation needed.
14:03:20 DEB [utils    _perform 896 ] URL check/handling OK.
14:03:20 DEB [utils    _perform 899 ] Verifying essential cookies...
14:03:20 DEB [utils    get_cook 1255] Waiting up to 5s for cookies: ['ANCSESSIONID', 'SecureATT']...
14:03:20 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
14:03:20 DEB [utils    _perform 908 ] Essential cookies OK.
14:03:20 DEB [utils    _perform 911 ] Syncing cookies to requests session...
14:03:20 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
14:03:20 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
14:03:20 DEB [utils    _perform 913 ] Cookies synced.
14:03:20 DEB [utils    _perform 916 ] Ensuring CSRF token...
14:03:20 DEB [utils    get_csrf 1215] Attempting to fetch fresh CSRF token from: https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken
14:03:20 DEB [utils    get_cook 1255] Waiting up to 10s for cookies: ['ANCSESSIONID', 'SecureATT']...
14:03:20 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
14:03:20 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken (Timeout: 60s, AllowRedirects: True)
14:03:20 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
14:03:20 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
14:03:20 DEB [utils    _api_req 2155] CSRF Token API: Cookies synced (Attempt 1).
14:03:20 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.569s (CurrentDelay: 0.50s)
14:03:21 DEB [utils    _api_req 2193] CSRF Token API: Rate limit wait: 0.57s (Attempt 1)
14:03:21 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'CSRF Token API'] Sending Headers.
14:03:21 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'CSRF Token API'] Sending Cookies.
14:03:21 DEB [utils    _api_req 2217] <-- Response Status: 200 OK
14:03:21 DEB [utils    get_csrf 1233] CSRF token successfully retrieved (Length: 144).
14:03:21 DEB [utils    _perform 924 ] CSRF token OK.
14:03:21 INF [utils    _perform 927 ] Readiness checks PASSED on attempt 1.
14:03:21 DEB [utils    ensure_s 752 ] TRACE: _perform_readiness_checks returned: True
14:03:21 DEB [utils    ensure_s 767 ] [Patch] Attempting to retrieve identifiers and tree owner after readiness checks...
14:03:21 DEB [utils    _retriev 1131] TRACE: Entered _retrieve_identifiers
14:03:21 DEB [utils    _retriev 1135] Retrieving profile ID (ucdmid)...
14:03:21 DEB [utils    get_my_p 1531] Attempting to fetch own profile ID (ucdmid)...
14:03:21 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/app-api/cdp-p13n/api/v1/users/me?attributes=ucdmid (Timeout: 60s, AllowRedirects: True)
14:03:21 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
14:03:21 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
14:03:21 DEB [utils    _api_req 2155] Get my profile_id: Cookies synced (Attempt 1).
14:03:21 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.444s (CurrentDelay: 0.50s)
14:03:22 DEB [utils    _api_req 2193] Get my profile_id: Rate limit wait: 0.44s (Attempt 1)
14:03:22 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Get my profile_id'] Sending Headers.
14:03:22 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Get my profile_id'] Sending Cookies.
14:03:22 DEB [utils    _api_req 2217] <-- Response Status: 200 OK
14:03:22 DEB [utils    get_my_p 1552] Successfully retrieved profile_id: 07BDD45E-0006-0000-0000-000000000000
14:03:22 INF [utils    _retriev 1141] My profile id: 07BDD45E-0006-0000-0000-000000000000
14:03:22 DEB [utils    _retriev 1147] Retrieving UUID (testId)...
14:03:22 DEB [utils    get_my_u 1569] Attempting to fetch own UUID (testId) from header/dna API...
14:03:22 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
14:03:22 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
14:03:22 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
14:03:22 DEB [utils    _api_req 2155] Get UUID API: Cookies synced (Attempt 1).
14:03:22 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.556s (CurrentDelay: 0.50s)
14:03:23 DEB [utils    _api_req 2193] Get UUID API: Rate limit wait: 0.56s (Attempt 1)
14:03:23 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Get UUID API'] Sending Headers.
14:03:23 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Get UUID API'] Sending Cookies.
14:03:23 DEB [utils    _api_req 2217] <-- Response Status: 200 
14:03:23 DEB [utils    get_my_u 1581] Successfully retrieved UUID: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
14:03:23 INF [utils    _retriev 1153] My uuid: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
14:03:23 DEB [utils    _retriev 1159] Retrieving tree ID for tree name: 'Gault Family'...
14:03:23 DEB [utils    get_my_t 1604] Attempting to fetch tree ID for TREE_NAME='Gault Family'...
14:03:23 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/trees (Timeout: 60s, AllowRedirects: True)
14:03:23 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
14:03:23 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
14:03:23 DEB [utils    _api_req 2155] Header Trees API: Cookies synced (Attempt 1).
14:03:23 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.411s (CurrentDelay: 0.50s)
14:03:24 DEB [utils    _api_req 2193] Header Trees API: Rate limit wait: 0.41s (Attempt 1)
14:03:24 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Header Trees API'] Sending Headers.
14:03:24 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Header Trees API'] Sending Cookies.
14:03:24 DEB [utils    _api_req 2217] <-- Response Status: 200 
14:03:24 DEB [utils    get_my_t 1628] Found tree ID '175946702' for tree 'Gault Family'.
14:03:24 INF [utils    _retriev 1169] My tree id: 175946702
14:03:24 DEB [utils    _retriev 1176] TRACE: Exiting _retrieve_identifiers
14:03:24 DEB [utils    _retriev 1182] TRACE: Entered _retrieve_tree_owner
14:03:24 DEB [utils    _retriev 1191] Retrieving tree owner name...
14:03:24 DEB [utils    get_tree 1668] Attempting to fetch tree owner name for tree ID: 175946702...
14:03:24 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/user/tree-info?tree_id=175946702 (Timeout: 60s, AllowRedirects: True)
14:03:24 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
14:03:24 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
14:03:24 DEB [utils    _api_req 2155] Tree Owner Name API: Cookies synced (Attempt 1).
14:03:24 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.573s (CurrentDelay: 0.50s)
14:03:25 DEB [utils    _api_req 2193] Tree Owner Name API: Rate limit wait: 0.57s (Attempt 1)
14:03:25 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Headers.
14:03:25 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Cookies.
14:03:25 DEB [utils    _api_req 2217] <-- Response Status: 200 
14:03:25 DEB [utils    get_tree 1683] Found tree owner 'Wayne Gault' for tree ID 175946702.
14:03:25 INF [utils    _retriev 1203] Tree owner name: Wayne Gault
14:03:25 DEB [utils    _retriev 1205] TRACE: Exiting _retrieve_tree_owner (success)
14:03:25 DEB [utils    ensure_s 772 ] [Patch] Identifiers after fetch: profile_id=07BDD45E-0006-0000-0000-000000000000, uuid=FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7, tree_id=175946702
14:03:25 DEB [utils    ensure_s 773 ] [Patch] Tree owner name after fetch: Wayne Gault
14:03:25 DEB [utils    ensure_s 777 ] TRACE: Set self.session_ready to: True
14:03:25 DEB [utils    ensure_s 779 ] TRACE: Exiting ensure_session_ready (returning True)
14:03:25 INF [api_util log_msg  956 ] - SessionManager.ensure_session_ready(): PASSED
14:03:25 INF [api_util log_msg  956 ] 
                                      --- Phase 2: Get Target Info & Tree-Specific Person ID ---
14:03:25 INF [api_util log_msg  956 ] - Target Profile ID (TESTING_PROFILE_ID): 08FA6E79-0006-0000-0000-000000000000
14:03:25 INF [api_util log_msg  956 ] - Target Tree ID (MY_TREE_ID): 175946702
14:03:25 INF [api_util log_msg  956 ] - Target Owner Name: Wayne Gault
14:03:25 INF [api_util log_msg  956 ] - Getting target name from Profile API: https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000
14:03:25 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000 (Timeout: 60s, AllowRedirects: True)
14:03:25 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
14:03:25 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
14:03:25 DEB [utils    _api_req 2155] Get Target Name (Profile Details): Cookies synced (Attempt 1).
14:03:25 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.520s (CurrentDelay: 0.50s)
14:03:25 DEB [utils    _api_req 2193] Get Target Name (Profile Details): Rate limit wait: 0.52s (Attempt 1)
14:03:25 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Headers.
14:03:25 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Cookies.
14:03:26 DEB [utils    _api_req 2217] <-- Response Status: 200 
14:03:26 INF [api_util log_msg  956 ] - Target Name found: 'Frances Mc Hardy'
14:03:26 INF [api_util log_msg  956 ] - Searching for 'Frances Mc Hardy' in tree 175946702 via API: https://www.ancestry.co.uk/api/treesui-list/trees/175946702/persons?name=Frances+Mc+Hardy&limit=5&fields=NAMES
14:03:26 DEB [utils    _api_req 2124] Applied 1 explicit header overrides for Tree Person Search API (Self Check).
14:03:26 DEB [utils    _api_req 2135] API Req: GET https://www.ancestry.co.uk/api/treesui-list/trees/175946702/persons?name=Frances+Mc+Hardy&limit=5&fields=NAMES (Timeout: 20s, AllowRedirects: True)
14:03:26 DEB [utils    _sync_co 1314] Retrieved 43 cookies from WebDriver for sync.
14:03:26 DEB [utils    _sync_co 1376] Successfully synced 43 cookies to requests session.
14:03:26 DEB [utils    _api_req 2155] Tree Person Search API (Self Check): Cookies synced (Attempt 1).
14:03:26 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.511s (CurrentDelay: 0.50s)
14:03:26 DEB [utils    _api_req 2193] Tree Person Search API (Self Check): Rate limit wait: 0.51s (Attempt 1)
14:03:26 DEB [utils    _api_req 2203] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] Sending Headers.
14:03:26 DEB [utils    _api_req 2206] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] Sending Cookies.
14:03:27 DEB [utils    _api_req 2217] <-- Response Status: 200 OK
14:03:27 ERR [api_util log_msg  952 ] - Tree Search API call: FAILED (Returned <class 'list'> or invalid structure)
14:03:27 ERR [api_util log_msg  952 ] Could not determine tree-specific Person ID. Subsequent tests requiring it will be skipped.
14:03:27 INF [api_util log_msg  956 ] 
                                      --- Phase 3: Test parse_ancestry_person_details (Profile Details API) ---
14:03:27 INF [api_util log_msg  956 ] - Using Profile Details API response from Phase 2.
14:03:27 DEB [api_util parse_an 413 ] Parsed API details for 'Frances Mc Hardy': ID=08FA6E79-0006-0000-0000-000000000000, Tree=175946702, Born='N/A' in 'None', Died='N/A' in 'None', Gender='None', Living=None
14:03:27 INF [api_util log_msg  956 ] - parse_ancestry_person_details call: SUCCESS
14:03:27 INF [api_util log_msg  956 ] - Parsed Details Validation: PASSED (Name: 'Frances Mc Hardy', Link: https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/08FA6E79-0006-0000-0000-000000000000/facts)
14:03:27 INF [api_util log_msg  956 ] 
                                      --- Phase 4: Test Relationship Ladder Parsing (using /getladder) ---
14:03:27 WAR [api_util log_msg  954 ] - Skipping Relationship Ladder test: Missing required info (Target Person ID).
14:03:27 INF [api_util log_msg  956 ] 
                                      --- Finalizing: Closing Session ---
14:03:27 DEB [utils    close_se 1889] Attempting to close WebDriver session...
14:03:27 DEB [utils    close_se 1892] WebDriver session quit successfully.
14:03:27 DEB [utils    close_se 1903] Closing database connection pool...
14:03:27 DEB [utils    cls_db_c 1509] SessionManager ID=29273040 cls_db_conn called (keep_db=False). Disposing Engine ID: 117470464
14:03:27 DEB [utils    cls_db_c 1514] Engine ID=117470464 disposed successfully.
14:03:27 ERR [api_util self_che 1525] api_utils self-check status: FAIL
14:03:27 DEB [cache    close_ca 261 ] Closing DiskCache connection...
14:03:27 DEB [cache    close_ca 263 ] DiskCache connection closed.
14:05:06 INF [api_util log_msg  956 ] 
                                      [api_utils.py self-check starting...]
14:05:06 INF [api_util log_msg  956 ] 
                                      --- Phase 0: Prerequisite Checks ---
14:05:06 INF [api_util log_msg  956 ] - BeautifulSoup Import: OK
14:05:06 INF [api_util log_msg  956 ] - format_name Import/Fallback: OK
14:05:06 INF [api_util log_msg  956 ] - ordinal_case Import/Fallback: OK
14:05:06 INF [api_util log_msg  956 ] - _parse_date Import/Fallback: OK
14:05:06 INF [api_util log_msg  956 ] - _clean_display_date Import/Fallback: OK
14:05:06 INF [api_util log_msg  956 ] - Config Check: Essential credentials/URLs/IDs present.
14:05:06 INF [api_util log_msg  956 ] 
                                      --- Phase 1: Session Setup & Login ---
14:05:06 DEB [utils    __init__ 619 ] Initialized shared requests.Session with HTTPAdapter.
14:05:06 DEB [utils    __init__ 634 ] Initialized shared cloudscraper instance with retry strategy.
14:05:06 DEB [utils    __init__ 474 ] RateLimiter Init: Capacity=10.0, FillRate=2.0/s, InitialDelay=0.50s, Backoff=1.80, Decrease=0.98
14:05:06 DEB [utils    __init__ 645 ] SessionManager instance created: ID=91895424
                                      
14:05:06 DEB [utils    start_se 649 ] --- SessionManager Phase 1: Starting Driver (api_utils Self Check Start) ---
                                      
14:05:06 DEB [utils    _initial 986 ] SessionManager ID=91895424 initializing SQLAlchemy Engine/Session...
14:05:06 DEB [utils    _initial 1001] DB Path: C:\Users\wayne\GitHub\Python\Projects\Ancestry\Data\ancestry.db
14:05:06 DEB [utils    _initial 1035] DB Pool Config: Size=10, MaxOverflow=5, Timeout=30
14:05:06 DEB [utils    _initial 1047] Created NEW SQLAlchemy engine: ID=116751152 for SM ID=91895424
14:05:06 DEB [utils    _initial 1064] Created Session factory for Engine ID=116751152
14:05:06 DEB [utils    enable_s 1057] SQLite PRAGMA settings applied (WAL, Foreign Keys).
14:05:06 DEB [database _create_ 310 ] Executing CREATE VIEW statement for 'messages' view...
14:05:06 DEB [database _create_ 313 ] Database view 'messages' created or already exists.
14:05:06 DEB [utils    _initial 1067] DB tables checked/created successfully.
14:05:06 DEB [utils    start_se 676 ] Initializing WebDriver instance (using init_webdvr)...
14:05:06 DEB [chromedr init_web 175 ] WebDriver initialization attempt 1/3...
14:05:06 INF [chromedr init_web 192 ] User data directory (no --profile-directory):
                                      C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
14:05:06 DEB [chromedr init_web 203 ] Using browser executable:
                                      C:\Program Files\Google\Chrome\Application\chrome.exe
14:05:06 DEB [chromedr init_web 220 ] Setting User-Agent:
                                      Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
14:05:06 DEB [chromedr init_web 229 ] Letting undetected_chromedriver auto-manage ChromeDriver version (self-patching mode).
14:05:06 INF [chromedr init_web 231 ] [init_webdvr] Attempting uc.Chrome() self-patching (attempt 1)...
14:05:13 INF [api_util log_msg  956 ] 
                                      [api_utils.py self-check starting...]
14:05:13 INF [api_util log_msg  956 ] 
                                      --- Phase 0: Prerequisite Checks ---
14:05:13 INF [api_util log_msg  956 ] - BeautifulSoup Import: OK
14:05:13 INF [api_util log_msg  956 ] - format_name Import/Fallback: OK
14:05:13 INF [api_util log_msg  956 ] - ordinal_case Import/Fallback: OK
14:05:13 INF [api_util log_msg  956 ] - _parse_date Import/Fallback: OK
14:05:13 INF [api_util log_msg  956 ] - _clean_display_date Import/Fallback: OK
14:05:13 INF [api_util log_msg  956 ] - Config Check: Essential credentials/URLs/IDs present.
14:05:13 INF [api_util log_msg  956 ] 
                                      --- Phase 1: Session Setup & Login ---
14:05:13 DEB [utils    __init__ 619 ] Initialized shared requests.Session with HTTPAdapter.
14:05:13 DEB [utils    __init__ 634 ] Initialized shared cloudscraper instance with retry strategy.
14:05:13 DEB [utils    __init__ 474 ] RateLimiter Init: Capacity=10.0, FillRate=2.0/s, InitialDelay=0.50s, Backoff=1.80, Decrease=0.98
14:05:13 DEB [utils    __init__ 645 ] SessionManager instance created: ID=110188576
                                      
14:05:13 DEB [utils    start_se 649 ] --- SessionManager Phase 1: Starting Driver (api_utils Self Check Start) ---
                                      
14:05:13 DEB [utils    _initial 986 ] SessionManager ID=110188576 initializing SQLAlchemy Engine/Session...
14:05:13 DEB [utils    _initial 1001] DB Path: C:\Users\wayne\GitHub\Python\Projects\Ancestry\Data\ancestry.db
14:05:13 DEB [utils    _initial 1035] DB Pool Config: Size=10, MaxOverflow=5, Timeout=30
14:05:13 DEB [utils    _initial 1047] Created NEW SQLAlchemy engine: ID=111739728 for SM ID=110188576
14:05:13 DEB [utils    _initial 1064] Created Session factory for Engine ID=111739728
14:05:13 DEB [utils    enable_s 1057] SQLite PRAGMA settings applied (WAL, Foreign Keys).
14:05:13 DEB [database _create_ 310 ] Executing CREATE VIEW statement for 'messages' view...
14:05:13 DEB [database _create_ 313 ] Database view 'messages' created or already exists.
14:05:13 DEB [utils    _initial 1067] DB tables checked/created successfully.
14:05:13 DEB [utils    start_se 676 ] Initializing WebDriver instance (using init_webdvr)...
14:05:14 DEB [chromedr init_web 175 ] WebDriver initialization attempt 1/3...
14:05:14 INF [chromedr init_web 192 ] User data directory (no --profile-directory):
                                      C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
14:05:14 DEB [chromedr init_web 203 ] Using browser executable:
                                      C:\Program Files\Google\Chrome\Application\chrome.exe
14:05:14 DEB [chromedr init_web 220 ] Setting User-Agent:
                                      Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36
14:05:14 DEB [chromedr init_web 229 ] Letting undetected_chromedriver auto-manage ChromeDriver version (self-patching mode).
14:05:14 INF [chromedr init_web 231 ] [init_webdvr] Attempting uc.Chrome() self-patching (attempt 1)...
14:05:16 INF [chromedr init_web 234 ] [init_webdvr] uc.Chrome() self-patching succeeded in 2.36s (attempt 1)
14:05:16 DEB [chromedr init_web 235 ] WebDriver instance object potentially created (attempt 1).
14:05:16 DEB [chromedr init_web 277 ] User-Agent override applied via CDP.
14:05:16 DEB [chromedr init_web 282 ] Attempting to minimize window (non-headless mode)...
14:05:16 DEB [chromedr init_web 285 ] Browser window minimized.
14:05:16 DEB [chromedr init_web 309 ] WebDriver instance fully configured successfully (attempt 1).
14:05:16 DEB [utils    start_se 684 ] WebDriver initialization successful.
14:05:16 DEB [utils    start_se 685 ] Navigating to Base URL (https://www.ancestry.co.uk/) to stabilize...
14:05:16 DEB [utils    nav_to_p 3519] Navigation Attempt 1/3 to: https://www.ancestry.co.uk/
14:05:16 DEB [utils    nav_to_p 3542] Executing driver.get('https://www.ancestry.co.uk/')...
14:05:19 DEB [utils    nav_to_p 3555] Landed on URL base: https://www.ancestry.co.uk
14:05:21 DEB [utils    nav_to_p 3650] On correct URL base. Waiting up to 20s for selector: 'body'
14:05:21 DEB [utils    nav_to_p 3657] Navigation successful and element 'body' found on:
                                      https://www.ancestry.co.uk/
14:05:21 DEB [utils    start_se 698 ] Initial navigation to Base URL successful.
14:05:21 DEB [utils    start_se 702 ] --- SessionManager Phase 1: Driver Start Successful ---
14:05:21 INF [api_util log_msg  956 ] - SessionManager.start_sess(): PASSED
14:05:21 DEB [utils    ensure_s 737 ] TRACE: Entered ensure_session_ready
14:05:21 DEB [utils    ensure_d 723 ] Driver already live (Action: api_utils Self Check Ready - Ensure Driver).
14:05:21 DEB [utils    ensure_s 746 ] TRACE: About to call _perform_readiness_checks
14:05:21 DEB [utils    ensure_s 749 ] TRACE: Calling _perform_readiness_checks
14:05:21 DEB [utils    _perform 795 ] Performing readiness checks (action=api_utils Self Check Ready - Readiness Checks)...
14:05:21 INF [utils    _perform 815 ] [Persistence] Chrome user data directory is present: C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
14:05:21 DEB [utils    login_st 3394] Checking login status (API prioritized)...
14:05:21 DEB [utils    login_st 3407] Attempting API login verification (_verify_api_login_status)...
14:05:21 DEB [utils    _verify_ 1730] Verifying login status via API endpoint: https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna...
14:05:21 DEB [utils    _verify_ 1737] Syncing cookies before API login check...
14:05:21 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:05:21 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:05:21 DEB [utils    _api_req 2143] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
14:05:21 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:05:21 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:05:21 DEB [utils    _api_req 2171] API Login Verification (header/dna): Cookies synced (Attempt 1).
14:05:21 DEB [utils    _api_req 2410] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] <<< requests.request raised UNEXPECTED NameError
14:05:21 CRI [utils    _api_req 2413] API Login Verification (header/dna): CRITICAL Unexpected error during request attempt 1: name 'utils' is not defined
14:05:21 WAR [utils    _verify_ 1751] API Login Verification (header/dna): _api_req returned None. Returning None.
14:05:21 WAR [utils    login_st 3417] API login check returned None (critical error). Falling back to UI check.
14:05:21 DEB [utils    login_st 3420] Performing fallback UI login check...
14:05:21 DEB [utils    login_st 3423] UI Check Step 1: Checking ABSENCE of login button: '[href^='https://www.ancestry.co.uk/account/signin']'
14:05:23 DEB [utils    login_st 3436] Login button NOT found during UI check (good indication).
14:05:23 DEB [utils    login_st 3447] UI Check Step 2: Checking PRESENCE of logged-in element: '#navAccount[data-tracking-name='Account']'
14:05:23 DEB [utils    login_st 3454] Login status confirmed TRUE via UI check (login button absent AND logged-in element found).
14:05:23 DEB [utils    _perform 892 ] Checking/Handling current URL...
14:05:23 DEB [utils    _check_a 1089] Current URL for check: https://www.ancestry.co.uk/
14:05:23 DEB [utils    _check_a 1126] Current URL is suitable, no extra navigation needed.
14:05:23 DEB [utils    _perform 896 ] URL check/handling OK.
14:05:23 DEB [utils    _perform 899 ] Verifying essential cookies...
14:05:23 DEB [utils    get_cook 1255] Waiting up to 5s for cookies: ['ANCSESSIONID', 'SecureATT']...
14:05:23 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
14:05:23 DEB [utils    _perform 908 ] Essential cookies OK.
14:05:23 DEB [utils    _perform 911 ] Syncing cookies to requests session...
14:05:23 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:05:23 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:05:23 DEB [utils    _perform 913 ] Cookies synced.
14:05:23 DEB [utils    _perform 916 ] Ensuring CSRF token...
14:05:23 DEB [utils    get_csrf 1215] Attempting to fetch fresh CSRF token from: https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken
14:05:23 DEB [utils    get_cook 1255] Waiting up to 10s for cookies: ['ANCSESSIONID', 'SecureATT']...
14:05:23 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
14:05:23 DEB [utils    _api_req 2143] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken (Timeout: 60s, AllowRedirects: True)
14:05:23 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:05:23 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:05:23 DEB [utils    _api_req 2171] CSRF Token API: Cookies synced (Attempt 1).
14:05:23 DEB [utils    _api_req 2410] [_api_req Attempt 1 for 'CSRF Token API'] <<< requests.request raised UNEXPECTED NameError
14:05:23 CRI [utils    _api_req 2413] CSRF Token API: CRITICAL Unexpected error during request attempt 1: name 'utils' is not defined
14:05:23 WAR [utils    get_csrf 1241] Failed to get CSRF token response via _api_req (returned None).
14:05:23 ERR [utils    _perform 922 ] Failed to retrieve/verify CSRF token.
14:05:23 DEB [utils    ensure_s 752 ] TRACE: _perform_readiness_checks returned: False
14:05:23 DEB [utils    ensure_s 767 ] [Patch] Attempting to retrieve identifiers and tree owner after readiness checks...
14:05:23 DEB [utils    _retriev 1131] TRACE: Entered _retrieve_identifiers
14:05:23 DEB [utils    _retriev 1135] Retrieving profile ID (ucdmid)...
14:05:23 DEB [utils    get_my_p 1531] Attempting to fetch own profile ID (ucdmid)...
14:05:23 DEB [utils    _api_req 2143] API Req: GET https://www.ancestry.co.uk/app-api/cdp-p13n/api/v1/users/me?attributes=ucdmid (Timeout: 60s, AllowRedirects: True)
14:05:23 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:05:23 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:05:23 DEB [utils    _api_req 2171] Get my profile_id: Cookies synced (Attempt 1).
14:05:23 DEB [utils    _api_req 2410] [_api_req Attempt 1 for 'Get my profile_id'] <<< requests.request raised UNEXPECTED NameError
14:05:23 CRI [utils    _api_req 2413] Get my profile_id: CRITICAL Unexpected error during request attempt 1: name 'utils' is not defined
14:05:23 WAR [utils    get_my_p 1542] Failed to get profile_id response via _api_req (returned None).
14:05:23 ERR [utils    _retriev 1138] Failed to retrieve profile ID (ucdmid).
14:05:23 DEB [utils    _retriev 1147] Retrieving UUID (testId)...
14:05:23 DEB [utils    get_my_u 1569] Attempting to fetch own UUID (testId) from header/dna API...
14:05:23 DEB [utils    _api_req 2143] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
14:05:23 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:05:23 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:05:23 DEB [utils    _api_req 2171] Get UUID API: Cookies synced (Attempt 1).
14:05:23 DEB [utils    _api_req 2410] [_api_req Attempt 1 for 'Get UUID API'] <<< requests.request raised UNEXPECTED NameError
14:05:23 CRI [utils    _api_req 2413] Get UUID API: CRITICAL Unexpected error during request attempt 1: name 'utils' is not defined
14:05:23 ERR [utils    get_my_u 1588] Failed to get header/dna data via _api_req (returned None or error response).
14:05:23 ERR [utils    _retriev 1150] Failed to retrieve UUID (testId).
14:05:23 DEB [utils    _retriev 1159] Retrieving tree ID for tree name: 'Gault Family'...
14:05:23 DEB [utils    get_my_t 1604] Attempting to fetch tree ID for TREE_NAME='Gault Family'...
14:05:23 DEB [utils    _api_req 2143] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/trees (Timeout: 60s, AllowRedirects: True)
14:05:23 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:05:23 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:05:23 DEB [utils    _api_req 2171] Header Trees API: Cookies synced (Attempt 1).
14:05:23 DEB [utils    _api_req 2410] [_api_req Attempt 1 for 'Header Trees API'] <<< requests.request raised UNEXPECTED NameError
14:05:23 CRI [utils    _api_req 2413] Header Trees API: CRITICAL Unexpected error during request attempt 1: name 'utils' is not defined
14:05:23 WAR [utils    get_my_t 1646] Unexpected response format from Header Trees API (missing 'menuitems'?).
14:05:23 DEB [utils    get_my_t 1649] Full Header Trees response data: None
14:05:23 ERR [utils    _retriev 1164] TREE_NAME 'Gault Family' configured, but failed to get corresponding tree ID.
14:05:23 DEB [utils    _retriev 1176] TRACE: Exiting _retrieve_identifiers
14:05:23 DEB [utils    _retriev 1182] TRACE: Entered _retrieve_tree_owner
14:05:23 DEB [utils    _retriev 1191] Retrieving tree owner name...
14:05:23 ERR [utils    _retriev 1193] Cannot retrieve tree owner name: my_tree_id is not set.
14:05:23 DEB [utils    _retriev 1194] TRACE: Exiting _retrieve_tree_owner (no tree id)
14:05:23 DEB [utils    ensure_s 772 ] [Patch] Identifiers after fetch: profile_id=None, uuid=None, tree_id=None
14:05:23 DEB [utils    ensure_s 773 ] [Patch] Tree owner name after fetch: None
14:05:23 DEB [utils    ensure_s 777 ] TRACE: Set self.session_ready to: False
14:05:23 DEB [utils    ensure_s 779 ] TRACE: Exiting ensure_session_ready (returning False)
14:05:23 ERR [api_util log_msg  952 ] - SessionManager.ensure_session_ready(): FAILED
14:05:23 ERR [api_util log_msg  952 ] 
                                      --- CRITICAL ERROR during self-check execution ---
14:05:23 ERR [api_util log_msg  952 ] - Error Type: RuntimeError
14:05:23 ERR [api_util log_msg  952 ] - Error Details: Failed to ensure session readiness (login/setup failed).
14:05:23 INF [api_util log_msg  956 ] - Traceback:
                                      Traceback (most recent call last):
                                      File "c:\Users\wayne\GitHub\Python\Projects\Ancestry\api_utils.py", line 1056, in self_check
                                      raise RuntimeError(
                                      RuntimeError: Failed to ensure session readiness (login/setup failed).
                                      
14:05:23 INF [api_util log_msg  956 ] 
                                      --- Finalizing: Closing Session ---
14:05:23 DEB [utils    close_se 1889] Attempting to close WebDriver session...
14:05:23 DEB [utils    close_se 1892] WebDriver session quit successfully.
14:05:23 DEB [utils    close_se 1903] Closing database connection pool...
14:05:23 DEB [utils    cls_db_c 1509] SessionManager ID=110188576 cls_db_conn called (keep_db=False). Disposing Engine ID: 111739728
14:05:23 DEB [utils    cls_db_c 1514] Engine ID=111739728 disposed successfully.
14:05:23 ERR [api_util self_che 1525] api_utils self-check status: FAIL
14:05:23 DEB [cache    close_ca 261 ] Closing DiskCache connection...
14:05:23 DEB [cache    close_ca 263 ] DiskCache connection closed.
14:08:09 INF [api_util log_msg  956 ] 
                                      [api_utils.py self-check starting...]
14:08:09 INF [api_util log_msg  956 ] 
                                      --- Phase 0: Prerequisite Checks ---
14:08:09 INF [api_util log_msg  956 ] - BeautifulSoup Import: OK
14:08:09 INF [api_util log_msg  956 ] - format_name Import/Fallback: OK
14:08:09 INF [api_util log_msg  956 ] - ordinal_case Import/Fallback: OK
14:08:09 INF [api_util log_msg  956 ] - _parse_date Import/Fallback: OK
14:08:09 INF [api_util log_msg  956 ] - _clean_display_date Import/Fallback: OK
14:08:09 INF [api_util log_msg  956 ] - Config Check: Essential credentials/URLs/IDs present.
14:08:09 INF [api_util log_msg  956 ] 
                                      --- Phase 1: Session Setup & Login ---
14:08:09 DEB [utils    __init__ 619 ] Initialized shared requests.Session with HTTPAdapter.
14:08:09 DEB [utils    __init__ 634 ] Initialized shared cloudscraper instance with retry strategy.
14:08:09 DEB [utils    __init__ 474 ] RateLimiter Init: Capacity=10.0, FillRate=2.0/s, InitialDelay=0.50s, Backoff=1.80, Decrease=0.98
14:08:09 DEB [utils    __init__ 645 ] SessionManager instance created: ID=111784304
                                      
14:08:09 DEB [utils    start_se 649 ] --- SessionManager Phase 1: Starting Driver (api_utils Self Check Start) ---
                                      
14:08:09 DEB [utils    _initial 986 ] SessionManager ID=111784304 initializing SQLAlchemy Engine/Session...
14:08:09 DEB [utils    _initial 1001] DB Path: C:\Users\wayne\GitHub\Python\Projects\Ancestry\Data\ancestry.db
14:08:09 DEB [utils    _initial 1035] DB Pool Config: Size=10, MaxOverflow=5, Timeout=30
14:08:09 DEB [utils    _initial 1047] Created NEW SQLAlchemy engine: ID=117094256 for SM ID=111784304
14:08:09 DEB [utils    _initial 1064] Created Session factory for Engine ID=117094256
14:08:09 DEB [utils    enable_s 1057] SQLite PRAGMA settings applied (WAL, Foreign Keys).
14:08:09 DEB [database _create_ 310 ] Executing CREATE VIEW statement for 'messages' view...
14:08:09 DEB [database _create_ 313 ] Database view 'messages' created or already exists.
14:08:09 DEB [utils    _initial 1067] DB tables checked/created successfully.
14:08:09 DEB [utils    start_se 676 ] Initializing WebDriver instance (using init_webdvr)...
14:08:09 DEB [chromedr init_web 175 ] WebDriver initialization attempt 1/3...
14:08:09 INF [chromedr init_web 192 ] User data directory (no --profile-directory):
                                      C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
14:08:09 DEB [chromedr init_web 203 ] Using browser executable:
                                      C:\Program Files\Google\Chrome\Application\chrome.exe
14:08:09 DEB [chromedr init_web 220 ] Setting User-Agent:
                                      Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
14:08:09 DEB [chromedr init_web 229 ] Letting undetected_chromedriver auto-manage ChromeDriver version (self-patching mode).
14:08:09 INF [chromedr init_web 231 ] [init_webdvr] Attempting uc.Chrome() self-patching (attempt 1)...
14:08:12 INF [chromedr init_web 234 ] [init_webdvr] uc.Chrome() self-patching succeeded in 2.33s (attempt 1)
14:08:12 DEB [chromedr init_web 235 ] WebDriver instance object potentially created (attempt 1).
14:08:12 DEB [chromedr init_web 277 ] User-Agent override applied via CDP.
14:08:12 DEB [chromedr init_web 282 ] Attempting to minimize window (non-headless mode)...
14:08:12 DEB [chromedr init_web 285 ] Browser window minimized.
14:08:12 DEB [chromedr init_web 309 ] WebDriver instance fully configured successfully (attempt 1).
14:08:12 DEB [utils    start_se 684 ] WebDriver initialization successful.
14:08:12 DEB [utils    start_se 685 ] Navigating to Base URL (https://www.ancestry.co.uk/) to stabilize...
14:08:12 DEB [utils    nav_to_p 3516] Navigation Attempt 1/3 to: https://www.ancestry.co.uk/
14:08:12 DEB [utils    nav_to_p 3539] Executing driver.get('https://www.ancestry.co.uk/')...
14:08:14 DEB [utils    nav_to_p 3552] Landed on URL base: https://www.ancestry.co.uk
14:08:16 DEB [utils    nav_to_p 3647] On correct URL base. Waiting up to 20s for selector: 'body'
14:08:16 DEB [utils    nav_to_p 3654] Navigation successful and element 'body' found on:
                                      https://www.ancestry.co.uk/
14:08:16 DEB [utils    start_se 698 ] Initial navigation to Base URL successful.
14:08:16 DEB [utils    start_se 702 ] --- SessionManager Phase 1: Driver Start Successful ---
14:08:16 INF [api_util log_msg  956 ] - SessionManager.start_sess(): PASSED
14:08:16 DEB [utils    ensure_s 737 ] TRACE: Entered ensure_session_ready
14:08:16 DEB [utils    ensure_d 723 ] Driver already live (Action: api_utils Self Check Ready - Ensure Driver).
14:08:16 DEB [utils    ensure_s 746 ] TRACE: About to call _perform_readiness_checks
14:08:16 DEB [utils    ensure_s 749 ] TRACE: Calling _perform_readiness_checks
14:08:16 DEB [utils    _perform 795 ] Performing readiness checks (action=api_utils Self Check Ready - Readiness Checks)...
14:08:16 INF [utils    _perform 815 ] [Persistence] Chrome user data directory is present: C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
14:08:16 DEB [utils    login_st 3391] Checking login status (API prioritized)...
14:08:16 DEB [utils    login_st 3404] Attempting API login verification (_verify_api_login_status)...
14:08:16 DEB [utils    _verify_ 1730] Verifying login status via API endpoint: https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna...
14:08:16 DEB [utils    _verify_ 1737] Syncing cookies before API login check...
14:08:16 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:08:16 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:08:16 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
14:08:16 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:08:16 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:08:16 DEB [utils    _api_req 2172] API Login Verification (header/dna): Cookies synced (Attempt 1).
14:08:16 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.403s (CurrentDelay: 0.50s)
14:08:16 DEB [utils    _api_req 2245] API Login Verification (header/dna): Rate limit wait: 0.40s (Attempt 1)
14:08:16 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-b1ceaa7...90-01', 'tracestate': '2611750@nr...96506', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:08:16 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:08:16 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] >>> Calling requests.request...
14:08:17 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] <<< requests.request returned.
14:08:17 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:08:17 DEB [utils    _verify_ 1769] API Login Verification (header/dna): API login check successful ('testId' found).
14:08:17 DEB [utils    login_st 3407] Login status confirmed TRUE via API check.
14:08:17 DEB [utils    _perform 892 ] Checking/Handling current URL...
14:08:17 DEB [utils    _check_a 1089] Current URL for check: https://www.ancestry.co.uk/
14:08:17 DEB [utils    _check_a 1126] Current URL is suitable, no extra navigation needed.
14:08:17 DEB [utils    _perform 896 ] URL check/handling OK.
14:08:17 DEB [utils    _perform 899 ] Verifying essential cookies...
14:08:17 DEB [utils    get_cook 1255] Waiting up to 5s for cookies: ['ANCSESSIONID', 'SecureATT']...
14:08:17 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
14:08:17 DEB [utils    _perform 908 ] Essential cookies OK.
14:08:17 DEB [utils    _perform 911 ] Syncing cookies to requests session...
14:08:17 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:08:17 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:08:17 DEB [utils    _perform 913 ] Cookies synced.
14:08:17 DEB [utils    _perform 916 ] Ensuring CSRF token...
14:08:17 DEB [utils    get_csrf 1215] Attempting to fetch fresh CSRF token from: https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken
14:08:17 DEB [utils    get_cook 1255] Waiting up to 10s for cookies: ['ANCSESSIONID', 'SecureATT']...
14:08:17 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
14:08:17 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken (Timeout: 60s, AllowRedirects: True)
14:08:17 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:08:17 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:08:17 DEB [utils    _api_req 2172] CSRF Token API: Cookies synced (Attempt 1).
14:08:17 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.418s (CurrentDelay: 0.50s)
14:08:18 DEB [utils    _api_req 2245] CSRF Token API: Rate limit wait: 0.42s (Attempt 1)
14:08:18 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'CSRF Token API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-e7270d8...70-01', 'tracestate': '2611750@nr...97708', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:08:18 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'CSRF Token API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:08:18 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'CSRF Token API'] >>> Calling requests.request...
14:08:18 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'CSRF Token API'] <<< requests.request returned.
14:08:18 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
14:08:18 DEB [utils    get_csrf 1233] CSRF token successfully retrieved (Length: 144).
14:08:18 DEB [utils    _perform 924 ] CSRF token OK.
14:08:18 INF [utils    _perform 927 ] Readiness checks PASSED on attempt 1.
14:08:18 DEB [utils    ensure_s 752 ] TRACE: _perform_readiness_checks returned: True
14:08:18 DEB [utils    ensure_s 767 ] [Patch] Attempting to retrieve identifiers and tree owner after readiness checks...
14:08:18 DEB [utils    _retriev 1131] TRACE: Entered _retrieve_identifiers
14:08:18 DEB [utils    _retriev 1135] Retrieving profile ID (ucdmid)...
14:08:18 DEB [utils    get_my_p 1531] Attempting to fetch own profile ID (ucdmid)...
14:08:18 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/cdp-p13n/api/v1/users/me?attributes=ucdmid (Timeout: 60s, AllowRedirects: True)
14:08:18 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:08:18 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:08:18 DEB [utils    _api_req 2172] Get my profile_id: Cookies synced (Attempt 1).
14:08:18 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.516s (CurrentDelay: 0.50s)
14:08:19 DEB [utils    _api_req 2245] Get my profile_id: Rate limit wait: 0.52s (Attempt 1)
14:08:19 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get my profile_id'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'p13n-js', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-d483370...66-01', 'tracestate': '2611750@nr...98539', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:08:19 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get my profile_id'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:08:19 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get my profile_id'] >>> Calling requests.request...
14:08:19 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get my profile_id'] <<< requests.request returned.
14:08:19 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
14:08:19 DEB [utils    get_my_p 1552] Successfully retrieved profile_id: 07BDD45E-0006-0000-0000-000000000000
14:08:19 INF [utils    _retriev 1141] My profile id: 07BDD45E-0006-0000-0000-000000000000
14:08:19 DEB [utils    _retriev 1147] Retrieving UUID (testId)...
14:08:19 DEB [utils    get_my_u 1569] Attempting to fetch own UUID (testId) from header/dna API...
14:08:19 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
14:08:19 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:08:19 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:08:19 DEB [utils    _api_req 2172] Get UUID API: Cookies synced (Attempt 1).
14:08:19 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.447s (CurrentDelay: 0.50s)
14:08:19 DEB [utils    _api_req 2245] Get UUID API: Rate limit wait: 0.45s (Attempt 1)
14:08:19 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get UUID API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-653eb49...15-01', 'tracestate': '2611750@nr...99432', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:08:19 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get UUID API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:08:19 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get UUID API'] >>> Calling requests.request...
14:08:20 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get UUID API'] <<< requests.request returned.
14:08:20 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:08:20 DEB [utils    get_my_u 1581] Successfully retrieved UUID: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
14:08:20 INF [utils    _retriev 1153] My uuid: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
14:08:20 DEB [utils    _retriev 1159] Retrieving tree ID for tree name: 'Gault Family'...
14:08:20 DEB [utils    get_my_t 1604] Attempting to fetch tree ID for TREE_NAME='Gault Family'...
14:08:20 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/trees (Timeout: 60s, AllowRedirects: True)
14:08:20 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:08:20 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:08:20 DEB [utils    _api_req 2172] Header Trees API: Cookies synced (Attempt 1).
14:08:20 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.537s (CurrentDelay: 0.50s)
14:08:20 DEB [utils    _api_req 2245] Header Trees API: Rate limit wait: 0.54s (Attempt 1)
14:08:20 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Header Trees API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-aff6364...c4-01', 'tracestate': '2611750@nr...00425', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:08:20 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Header Trees API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:08:20 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Header Trees API'] >>> Calling requests.request...
14:08:21 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Header Trees API'] <<< requests.request returned.
14:08:21 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:08:21 DEB [utils    get_my_t 1628] Found tree ID '175946702' for tree 'Gault Family'.
14:08:21 INF [utils    _retriev 1169] My tree id: 175946702
14:08:21 DEB [utils    _retriev 1176] TRACE: Exiting _retrieve_identifiers
14:08:21 DEB [utils    _retriev 1182] TRACE: Entered _retrieve_tree_owner
14:08:21 DEB [utils    _retriev 1191] Retrieving tree owner name...
14:08:21 DEB [utils    get_tree 1668] Attempting to fetch tree owner name for tree ID: 175946702...
14:08:21 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/user/tree-info?tree_id=175946702 (Timeout: 60s, AllowRedirects: True)
14:08:21 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:08:21 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:08:21 DEB [utils    _api_req 2172] Tree Owner Name API: Cookies synced (Attempt 1).
14:08:21 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.449s (CurrentDelay: 0.50s)
14:08:21 DEB [utils    _api_req 2245] Tree Owner Name API: Rate limit wait: 0.45s (Attempt 1)
14:08:21 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'Browser:meexp-uhome', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-3e1d019...27-01', 'tracestate': '2611750@nr...01409', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:08:21 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:08:21 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Tree Owner Name API'] >>> Calling requests.request...
14:08:22 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Tree Owner Name API'] <<< requests.request returned.
14:08:22 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:08:22 DEB [utils    get_tree 1683] Found tree owner 'Wayne Gault' for tree ID 175946702.
14:08:22 INF [utils    _retriev 1203] Tree owner name: Wayne Gault
14:08:22 DEB [utils    _retriev 1205] TRACE: Exiting _retrieve_tree_owner (success)
14:08:22 DEB [utils    ensure_s 772 ] [Patch] Identifiers after fetch: profile_id=07BDD45E-0006-0000-0000-000000000000, uuid=FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7, tree_id=175946702
14:08:22 DEB [utils    ensure_s 773 ] [Patch] Tree owner name after fetch: Wayne Gault
14:08:22 DEB [utils    ensure_s 777 ] TRACE: Set self.session_ready to: True
14:08:22 DEB [utils    ensure_s 779 ] TRACE: Exiting ensure_session_ready (returning True)
14:08:22 INF [api_util log_msg  956 ] - SessionManager.ensure_session_ready(): PASSED
14:08:22 INF [api_util log_msg  956 ] 
                                      --- Phase 2: Get Target Info & Tree-Specific Person ID ---
14:08:22 INF [api_util log_msg  956 ] - Target Profile ID (TESTING_PROFILE_ID): 08FA6E79-0006-0000-0000-000000000000
14:08:22 INF [api_util log_msg  956 ] - Target Tree ID (MY_TREE_ID): 175946702
14:08:22 INF [api_util log_msg  956 ] - Target Owner Name: Wayne Gault
14:08:22 INF [api_util log_msg  956 ] - Getting target name from Profile API: https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000
14:08:22 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000 (Timeout: 60s, AllowRedirects: True)
14:08:22 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:08:22 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:08:22 DEB [utils    _api_req 2172] Get Target Name (Profile Details): Cookies synced (Attempt 1).
14:08:22 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.503s (CurrentDelay: 0.50s)
14:08:22 DEB [utils    _api_req 2245] Get Target Name (Profile Details): Rate limit wait: 0.50s (Attempt 1)
14:08:22 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-b01cb53...e2-01', 'tracestate': '2611750@nr...02224', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:08:22 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:08:22 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] >>> Calling requests.request...
14:08:23 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] <<< requests.request returned.
14:08:23 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:08:23 INF [api_util log_msg  956 ] - Target Name found: 'Frances Mc Hardy'
14:08:23 INF [api_util log_msg  956 ] - Searching for 'Frances Mc Hardy' in tree 175946702 via API: https://www.ancestry.co.uk/api/treesui-list/trees/175946702/persons?name=Frances+Mc+Hardy&limit=5&fields=NAMES
14:08:23 DEB [utils    _api_req 2130] Applied 1 explicit header overrides for Tree Person Search API (Self Check).
14:08:23 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/treesui-list/trees/175946702/persons?name=Frances+Mc+Hardy&limit=5&fields=NAMES (Timeout: 20s, AllowRedirects: True)
14:08:23 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:08:23 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:08:23 DEB [utils    _api_req 2172] Tree Person Search API (Self Check): Cookies synced (Attempt 1).
14:08:23 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.488s (CurrentDelay: 0.50s)
14:08:23 DEB [utils    _api_req 2245] Tree Person Search API (Self Check): Rate limit wait: 0.49s (Attempt 1)
14:08:23 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': '*/*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-00c901c...db-01', 'tracestate': '2611750@nr...03159', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:08:23 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:08:23 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] >>> Calling requests.request...
14:08:24 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] <<< requests.request returned.
14:08:24 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
14:08:24 ERR [api_util log_msg  952 ] - Tree Search API call: FAILED (Returned <class 'list'> or invalid structure)
14:08:24 ERR [api_util log_msg  952 ] Could not determine tree-specific Person ID. Subsequent tests requiring it will be skipped.
14:08:24 INF [api_util log_msg  956 ] 
                                      --- Phase 3: Test parse_ancestry_person_details (Profile Details API) ---
14:08:24 INF [api_util log_msg  956 ] - Using Profile Details API response from Phase 2.
14:08:24 DEB [api_util parse_an 413 ] Parsed API details for 'Frances Mc Hardy': ID=08FA6E79-0006-0000-0000-000000000000, Tree=175946702, Born='N/A' in 'None', Died='N/A' in 'None', Gender='None', Living=None
14:08:24 INF [api_util log_msg  956 ] - parse_ancestry_person_details call: SUCCESS
14:08:24 INF [api_util log_msg  956 ] - Parsed Details Validation: PASSED (Name: 'Frances Mc Hardy', Link: https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/08FA6E79-0006-0000-0000-000000000000/facts)
14:08:24 INF [api_util log_msg  956 ] 
                                      --- Phase 4: Test Relationship Ladder Parsing (using /getladder) ---
14:08:24 WAR [api_util log_msg  954 ] - Skipping Relationship Ladder test: Missing required info (Target Person ID).
14:08:24 INF [api_util log_msg  956 ] 
                                      --- Finalizing: Closing Session ---
14:08:24 DEB [utils    close_se 1889] Attempting to close WebDriver session...
14:08:24 DEB [utils    close_se 1892] WebDriver session quit successfully.
14:08:24 DEB [utils    close_se 1903] Closing database connection pool...
14:08:24 DEB [utils    cls_db_c 1509] SessionManager ID=111784304 cls_db_conn called (keep_db=False). Disposing Engine ID: 117094256
14:08:24 DEB [utils    cls_db_c 1514] Engine ID=117094256 disposed successfully.
14:08:24 ERR [api_util self_che 1525] api_utils self-check status: FAIL
14:08:24 DEB [cache    close_ca 261 ] Closing DiskCache connection...
14:08:24 DEB [cache    close_ca 263 ] DiskCache connection closed.
14:11:20 INF [api_util log_msg  956 ] 
                                      [api_utils.py self-check starting...]
14:11:20 INF [api_util log_msg  956 ] 
                                      --- Phase 0: Prerequisite Checks ---
14:11:20 INF [api_util log_msg  956 ] - BeautifulSoup Import: OK
14:11:20 INF [api_util log_msg  956 ] - format_name Import/Fallback: OK
14:11:20 INF [api_util log_msg  956 ] - ordinal_case Import/Fallback: OK
14:11:20 INF [api_util log_msg  956 ] - _parse_date Import/Fallback: OK
14:11:20 INF [api_util log_msg  956 ] - _clean_display_date Import/Fallback: OK
14:11:20 INF [api_util log_msg  956 ] - Config Check: Essential credentials/URLs/IDs present.
14:11:20 INF [api_util log_msg  956 ] 
                                      --- Phase 1: Session Setup & Login ---
14:11:20 DEB [utils    __init__ 619 ] Initialized shared requests.Session with HTTPAdapter.
14:11:20 DEB [utils    __init__ 634 ] Initialized shared cloudscraper instance with retry strategy.
14:11:20 DEB [utils    __init__ 474 ] RateLimiter Init: Capacity=10.0, FillRate=2.0/s, InitialDelay=0.50s, Backoff=1.80, Decrease=0.98
14:11:20 DEB [utils    __init__ 645 ] SessionManager instance created: ID=88131680
                                      
14:11:20 DEB [utils    start_se 649 ] --- SessionManager Phase 1: Starting Driver (api_utils Self Check Start) ---
                                      
14:11:20 DEB [utils    _initial 986 ] SessionManager ID=88131680 initializing SQLAlchemy Engine/Session...
14:11:20 DEB [utils    _initial 1001] DB Path: C:\Users\wayne\GitHub\Python\Projects\Ancestry\Data\ancestry.db
14:11:20 DEB [utils    _initial 1035] DB Pool Config: Size=10, MaxOverflow=5, Timeout=30
14:11:20 DEB [utils    _initial 1047] Created NEW SQLAlchemy engine: ID=117160128 for SM ID=88131680
14:11:20 DEB [utils    _initial 1064] Created Session factory for Engine ID=117160128
14:11:20 DEB [utils    enable_s 1057] SQLite PRAGMA settings applied (WAL, Foreign Keys).
14:11:20 DEB [database _create_ 310 ] Executing CREATE VIEW statement for 'messages' view...
14:11:20 DEB [database _create_ 313 ] Database view 'messages' created or already exists.
14:11:20 DEB [utils    _initial 1067] DB tables checked/created successfully.
14:11:20 DEB [utils    start_se 676 ] Initializing WebDriver instance (using init_webdvr)...
14:11:20 DEB [chromedr init_web 175 ] WebDriver initialization attempt 1/3...
14:11:20 INF [chromedr init_web 192 ] User data directory (no --profile-directory):
                                      C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
14:11:20 DEB [chromedr init_web 203 ] Using browser executable:
                                      C:\Program Files\Google\Chrome\Application\chrome.exe
14:11:20 DEB [chromedr init_web 220 ] Setting User-Agent:
                                      Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
14:11:20 DEB [chromedr init_web 229 ] Letting undetected_chromedriver auto-manage ChromeDriver version (self-patching mode).
14:11:20 INF [chromedr init_web 231 ] [init_webdvr] Attempting uc.Chrome() self-patching (attempt 1)...
14:11:23 INF [chromedr init_web 234 ] [init_webdvr] uc.Chrome() self-patching succeeded in 2.35s (attempt 1)
14:11:23 DEB [chromedr init_web 235 ] WebDriver instance object potentially created (attempt 1).
14:11:23 DEB [chromedr init_web 277 ] User-Agent override applied via CDP.
14:11:23 DEB [chromedr init_web 282 ] Attempting to minimize window (non-headless mode)...
14:11:23 DEB [chromedr init_web 285 ] Browser window minimized.
14:11:23 DEB [chromedr init_web 309 ] WebDriver instance fully configured successfully (attempt 1).
14:11:23 DEB [utils    start_se 684 ] WebDriver initialization successful.
14:11:23 DEB [utils    start_se 685 ] Navigating to Base URL (https://www.ancestry.co.uk/) to stabilize...
14:11:23 DEB [utils    nav_to_p 3516] Navigation Attempt 1/3 to: https://www.ancestry.co.uk/
14:11:23 DEB [utils    nav_to_p 3539] Executing driver.get('https://www.ancestry.co.uk/')...
14:11:25 DEB [utils    nav_to_p 3552] Landed on URL base: https://www.ancestry.co.uk
14:11:27 DEB [utils    nav_to_p 3647] On correct URL base. Waiting up to 20s for selector: 'body'
14:11:27 DEB [utils    nav_to_p 3654] Navigation successful and element 'body' found on:
                                      https://www.ancestry.co.uk/
14:11:27 DEB [utils    start_se 698 ] Initial navigation to Base URL successful.
14:11:27 DEB [utils    start_se 702 ] --- SessionManager Phase 1: Driver Start Successful ---
14:11:27 INF [api_util log_msg  956 ] - SessionManager.start_sess(): PASSED
14:11:27 DEB [utils    ensure_s 737 ] TRACE: Entered ensure_session_ready
14:11:27 DEB [utils    ensure_d 723 ] Driver already live (Action: api_utils Self Check Ready - Ensure Driver).
14:11:27 DEB [utils    ensure_s 746 ] TRACE: About to call _perform_readiness_checks
14:11:27 DEB [utils    ensure_s 749 ] TRACE: Calling _perform_readiness_checks
14:11:27 DEB [utils    _perform 795 ] Performing readiness checks (action=api_utils Self Check Ready - Readiness Checks)...
14:11:27 INF [utils    _perform 815 ] [Persistence] Chrome user data directory is present: C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
14:11:27 DEB [utils    login_st 3391] Checking login status (API prioritized)...
14:11:27 DEB [utils    login_st 3404] Attempting API login verification (_verify_api_login_status)...
14:11:27 DEB [utils    _verify_ 1730] Verifying login status via API endpoint: https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna...
14:11:27 DEB [utils    _verify_ 1737] Syncing cookies before API login check...
14:11:27 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:11:27 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:11:27 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
14:11:27 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:11:27 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:11:27 DEB [utils    _api_req 2172] API Login Verification (header/dna): Cookies synced (Attempt 1).
14:11:27 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.452s (CurrentDelay: 0.50s)
14:11:27 DEB [utils    _api_req 2245] API Login Verification (header/dna): Rate limit wait: 0.45s (Attempt 1)
14:11:27 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-dd1f9c5...4e-01', 'tracestate': '2611750@nr...87497', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:11:27 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:11:27 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] >>> Calling requests.request...
14:11:28 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] <<< requests.request returned.
14:11:28 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:11:28 DEB [utils    _verify_ 1769] API Login Verification (header/dna): API login check successful ('testId' found).
14:11:28 DEB [utils    login_st 3407] Login status confirmed TRUE via API check.
14:11:28 DEB [utils    _perform 892 ] Checking/Handling current URL...
14:11:28 DEB [utils    _check_a 1089] Current URL for check: https://www.ancestry.co.uk/
14:11:28 DEB [utils    _check_a 1126] Current URL is suitable, no extra navigation needed.
14:11:28 DEB [utils    _perform 896 ] URL check/handling OK.
14:11:28 DEB [utils    _perform 899 ] Verifying essential cookies...
14:11:28 DEB [utils    get_cook 1255] Waiting up to 5s for cookies: ['ANCSESSIONID', 'SecureATT']...
14:11:28 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
14:11:28 DEB [utils    _perform 908 ] Essential cookies OK.
14:11:28 DEB [utils    _perform 911 ] Syncing cookies to requests session...
14:11:28 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:11:28 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:11:28 DEB [utils    _perform 913 ] Cookies synced.
14:11:28 DEB [utils    _perform 916 ] Ensuring CSRF token...
14:11:28 DEB [utils    get_csrf 1215] Attempting to fetch fresh CSRF token from: https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken
14:11:28 DEB [utils    get_cook 1255] Waiting up to 10s for cookies: ['ANCSESSIONID', 'SecureATT']...
14:11:28 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
14:11:28 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken (Timeout: 60s, AllowRedirects: True)
14:11:28 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:11:28 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:11:28 DEB [utils    _api_req 2172] CSRF Token API: Cookies synced (Attempt 1).
14:11:28 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.573s (CurrentDelay: 0.50s)
14:11:29 DEB [utils    _api_req 2245] CSRF Token API: Rate limit wait: 0.57s (Attempt 1)
14:11:29 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'CSRF Token API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-9972c27...15-01', 'tracestate': '2611750@nr...88727', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:11:29 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'CSRF Token API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:11:29 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'CSRF Token API'] >>> Calling requests.request...
14:11:29 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'CSRF Token API'] <<< requests.request returned.
14:11:29 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
14:11:29 DEB [utils    get_csrf 1233] CSRF token successfully retrieved (Length: 144).
14:11:29 DEB [utils    _perform 924 ] CSRF token OK.
14:11:29 INF [utils    _perform 927 ] Readiness checks PASSED on attempt 1.
14:11:29 DEB [utils    ensure_s 752 ] TRACE: _perform_readiness_checks returned: True
14:11:29 DEB [utils    ensure_s 767 ] [Patch] Attempting to retrieve identifiers and tree owner after readiness checks...
14:11:29 DEB [utils    _retriev 1131] TRACE: Entered _retrieve_identifiers
14:11:29 DEB [utils    _retriev 1135] Retrieving profile ID (ucdmid)...
14:11:29 DEB [utils    get_my_p 1531] Attempting to fetch own profile ID (ucdmid)...
14:11:29 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/cdp-p13n/api/v1/users/me?attributes=ucdmid (Timeout: 60s, AllowRedirects: True)
14:11:29 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:11:29 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:11:29 DEB [utils    _api_req 2172] Get my profile_id: Cookies synced (Attempt 1).
14:11:29 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.535s (CurrentDelay: 0.50s)
14:11:30 DEB [utils    _api_req 2245] Get my profile_id: Rate limit wait: 0.54s (Attempt 1)
14:11:30 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get my profile_id'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'p13n-js', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-f22c05d...66-01', 'tracestate': '2611750@nr...89709', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:11:30 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get my profile_id'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:11:30 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get my profile_id'] >>> Calling requests.request...
14:11:30 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get my profile_id'] <<< requests.request returned.
14:11:30 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
14:11:30 DEB [utils    get_my_p 1552] Successfully retrieved profile_id: 07BDD45E-0006-0000-0000-000000000000
14:11:30 INF [utils    _retriev 1141] My profile id: 07BDD45E-0006-0000-0000-000000000000
14:11:30 DEB [utils    _retriev 1147] Retrieving UUID (testId)...
14:11:30 DEB [utils    get_my_u 1569] Attempting to fetch own UUID (testId) from header/dna API...
14:11:30 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
14:11:30 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:11:30 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:11:30 DEB [utils    _api_req 2172] Get UUID API: Cookies synced (Attempt 1).
14:11:30 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.515s (CurrentDelay: 0.50s)
14:11:31 DEB [utils    _api_req 2245] Get UUID API: Rate limit wait: 0.52s (Attempt 1)
14:11:31 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get UUID API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-3a1994a...ae-01', 'tracestate': '2611750@nr...90590', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:11:31 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get UUID API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:11:31 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get UUID API'] >>> Calling requests.request...
14:11:31 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get UUID API'] <<< requests.request returned.
14:11:31 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:11:31 DEB [utils    get_my_u 1581] Successfully retrieved UUID: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
14:11:31 INF [utils    _retriev 1153] My uuid: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
14:11:31 DEB [utils    _retriev 1159] Retrieving tree ID for tree name: 'Gault Family'...
14:11:31 DEB [utils    get_my_t 1604] Attempting to fetch tree ID for TREE_NAME='Gault Family'...
14:11:31 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/trees (Timeout: 60s, AllowRedirects: True)
14:11:31 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:11:31 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:11:31 DEB [utils    _api_req 2172] Header Trees API: Cookies synced (Attempt 1).
14:11:31 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.475s (CurrentDelay: 0.50s)
14:11:32 DEB [utils    _api_req 2245] Header Trees API: Rate limit wait: 0.48s (Attempt 1)
14:11:32 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Header Trees API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-8d882b9...a4-01', 'tracestate': '2611750@nr...91651', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:11:32 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Header Trees API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:11:32 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Header Trees API'] >>> Calling requests.request...
14:11:32 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Header Trees API'] <<< requests.request returned.
14:11:32 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:11:32 DEB [utils    get_my_t 1628] Found tree ID '175946702' for tree 'Gault Family'.
14:11:32 INF [utils    _retriev 1169] My tree id: 175946702
14:11:32 DEB [utils    _retriev 1176] TRACE: Exiting _retrieve_identifiers
14:11:32 DEB [utils    _retriev 1182] TRACE: Entered _retrieve_tree_owner
14:11:32 DEB [utils    _retriev 1191] Retrieving tree owner name...
14:11:32 DEB [utils    get_tree 1668] Attempting to fetch tree owner name for tree ID: 175946702...
14:11:32 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/user/tree-info?tree_id=175946702 (Timeout: 60s, AllowRedirects: True)
14:11:32 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:11:32 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:11:32 DEB [utils    _api_req 2172] Tree Owner Name API: Cookies synced (Attempt 1).
14:11:32 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.408s (CurrentDelay: 0.50s)
14:11:33 DEB [utils    _api_req 2245] Tree Owner Name API: Rate limit wait: 0.41s (Attempt 1)
14:11:33 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'Browser:meexp-uhome', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-3cd24c4...d2-01', 'tracestate': '2611750@nr...92691', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:11:33 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:11:33 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Tree Owner Name API'] >>> Calling requests.request...
14:11:33 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Tree Owner Name API'] <<< requests.request returned.
14:11:33 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:11:33 DEB [utils    get_tree 1683] Found tree owner 'Wayne Gault' for tree ID 175946702.
14:11:33 INF [utils    _retriev 1203] Tree owner name: Wayne Gault
14:11:33 DEB [utils    _retriev 1205] TRACE: Exiting _retrieve_tree_owner (success)
14:11:33 DEB [utils    ensure_s 772 ] [Patch] Identifiers after fetch: profile_id=07BDD45E-0006-0000-0000-000000000000, uuid=FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7, tree_id=175946702
14:11:33 DEB [utils    ensure_s 773 ] [Patch] Tree owner name after fetch: Wayne Gault
14:11:33 DEB [utils    ensure_s 777 ] TRACE: Set self.session_ready to: True
14:11:33 DEB [utils    ensure_s 779 ] TRACE: Exiting ensure_session_ready (returning True)
14:11:33 INF [api_util log_msg  956 ] - SessionManager.ensure_session_ready(): PASSED
14:11:33 INF [api_util log_msg  956 ] 
                                      --- Phase 2: Get Target Info & Tree-Specific Person ID ---
14:11:33 INF [api_util log_msg  956 ] - Target Profile ID (TESTING_PROFILE_ID): 08FA6E79-0006-0000-0000-000000000000
14:11:33 INF [api_util log_msg  956 ] - Target Tree ID (MY_TREE_ID): 175946702
14:11:33 INF [api_util log_msg  956 ] - Target Owner Name: Wayne Gault
14:11:33 INF [api_util log_msg  956 ] - Getting target name from Profile API: https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000
14:11:33 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000 (Timeout: 60s, AllowRedirects: True)
14:11:33 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:11:33 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:11:33 DEB [utils    _api_req 2172] Get Target Name (Profile Details): Cookies synced (Attempt 1).
14:11:33 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.515s (CurrentDelay: 0.50s)
14:11:33 DEB [utils    _api_req 2245] Get Target Name (Profile Details): Rate limit wait: 0.51s (Attempt 1)
14:11:33 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-5274306...6d-01', 'tracestate': '2611750@nr...93443', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:11:33 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:11:33 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] >>> Calling requests.request...
14:11:34 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] <<< requests.request returned.
14:11:34 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:11:34 INF [api_util log_msg  956 ] - Target Name found: 'Frances Mc Hardy'
14:11:34 INF [api_util log_msg  956 ] - Searching for 'Frances Mc Hardy' in tree 175946702 via API: https://www.ancestry.co.uk/api/treesui-list/trees/175946702/persons?name=Frances+Mc+Hardy&limit=5&fields=NAMES
14:11:34 DEB [utils    _api_req 2130] Applied 1 explicit header overrides for Tree Person Search API (Self Check).
14:11:34 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/treesui-list/trees/175946702/persons?name=Frances+Mc+Hardy&limit=5&fields=NAMES (Timeout: 20s, AllowRedirects: True)
14:11:34 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:11:34 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:11:34 DEB [utils    _api_req 2172] Tree Person Search API (Self Check): Cookies synced (Attempt 1).
14:11:34 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.451s (CurrentDelay: 0.50s)
14:11:34 DEB [utils    _api_req 2245] Tree Person Search API (Self Check): Rate limit wait: 0.45s (Attempt 1)
14:11:34 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': '*/*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-a4bb2eb...2d-01', 'tracestate': '2611750@nr...94223', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:11:34 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:11:34 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] >>> Calling requests.request...
14:11:35 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] <<< requests.request returned.
14:11:35 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
14:11:35 ERR [api_util log_msg  952 ] - Tree Search API call: FAILED (Returned <class 'list'> or invalid structure)
14:11:35 ERR [api_util log_msg  952 ] Could not determine tree-specific Person ID. Subsequent tests requiring it will be skipped.
14:11:35 INF [api_util log_msg  956 ] 
                                      --- Phase 3: Test parse_ancestry_person_details (Profile Details API) ---
14:11:35 INF [api_util log_msg  956 ] - Using Profile Details API response from Phase 2.
14:11:35 DEB [api_util parse_an 413 ] Parsed API details for 'Frances Mc Hardy': ID=08FA6E79-0006-0000-0000-000000000000, Tree=175946702, Born='N/A' in 'None', Died='N/A' in 'None', Gender='None', Living=None
14:11:35 INF [api_util log_msg  956 ] - parse_ancestry_person_details call: SUCCESS
14:11:35 INF [api_util log_msg  956 ] - Parsed Details Validation: PASSED (Name: 'Frances Mc Hardy', Link: https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/08FA6E79-0006-0000-0000-000000000000/facts)
14:11:35 INF [api_util log_msg  956 ] 
                                      --- Phase 4: Test Relationship Ladder Parsing (using /getladder) ---
14:11:35 WAR [api_util log_msg  954 ] - Skipping Relationship Ladder test: Missing required info (Target Person ID).
14:11:35 INF [api_util log_msg  956 ] 
                                      --- Finalizing: Closing Session ---
14:11:35 DEB [utils    close_se 1889] Attempting to close WebDriver session...
14:11:35 DEB [utils    close_se 1892] WebDriver session quit successfully.
14:11:35 DEB [utils    close_se 1903] Closing database connection pool...
14:11:35 DEB [utils    cls_db_c 1509] SessionManager ID=88131680 cls_db_conn called (keep_db=False). Disposing Engine ID: 117160128
14:11:35 DEB [utils    cls_db_c 1514] Engine ID=117160128 disposed successfully.
14:11:35 ERR [api_util self_che 1525] api_utils self-check status: FAIL
14:11:35 DEB [cache    close_ca 261 ] Closing DiskCache connection...
14:11:35 DEB [cache    close_ca 263 ] DiskCache connection closed.
14:19:39 INF [api_util log_msg  958 ] 
                                      [api_utils.py self-check starting...]
14:19:39 INF [api_util log_msg  958 ] 
                                      --- Phase 0: Prerequisite Checks ---
14:19:39 INF [api_util log_msg  958 ] - BeautifulSoup Import: OK
14:19:39 INF [api_util log_msg  958 ] - format_name Import/Fallback: OK
14:19:39 INF [api_util log_msg  958 ] - ordinal_case Import/Fallback: OK
14:19:39 INF [api_util log_msg  958 ] - _parse_date Import/Fallback: OK
14:19:39 INF [api_util log_msg  958 ] - _clean_display_date Import/Fallback: OK
14:19:39 INF [api_util log_msg  958 ] - Config Check: Essential credentials/URLs/IDs present.
14:19:39 INF [api_util log_msg  958 ] 
                                      --- Phase 1: Session Setup & Login ---
14:19:39 DEB [utils    __init__ 619 ] Initialized shared requests.Session with HTTPAdapter.
14:19:39 DEB [utils    __init__ 634 ] Initialized shared cloudscraper instance with retry strategy.
14:19:39 DEB [utils    __init__ 474 ] RateLimiter Init: Capacity=10.0, FillRate=2.0/s, InitialDelay=0.50s, Backoff=1.80, Decrease=0.98
14:19:39 DEB [utils    __init__ 645 ] SessionManager instance created: ID=115398688
                                      
14:19:39 DEB [utils    start_se 649 ] --- SessionManager Phase 1: Starting Driver (api_utils Self Check Start) ---
                                      
14:19:39 DEB [utils    _initial 986 ] SessionManager ID=115398688 initializing SQLAlchemy Engine/Session...
14:19:39 DEB [utils    _initial 1001] DB Path: C:\Users\wayne\GitHub\Python\Projects\Ancestry\Data\ancestry.db
14:19:39 DEB [utils    _initial 1035] DB Pool Config: Size=10, MaxOverflow=5, Timeout=30
14:19:39 DEB [utils    _initial 1047] Created NEW SQLAlchemy engine: ID=117225376 for SM ID=115398688
14:19:39 DEB [utils    _initial 1064] Created Session factory for Engine ID=117225376
14:19:39 DEB [utils    enable_s 1057] SQLite PRAGMA settings applied (WAL, Foreign Keys).
14:19:39 DEB [database _create_ 310 ] Executing CREATE VIEW statement for 'messages' view...
14:19:39 DEB [database _create_ 313 ] Database view 'messages' created or already exists.
14:19:39 DEB [utils    _initial 1067] DB tables checked/created successfully.
14:19:39 DEB [utils    start_se 676 ] Initializing WebDriver instance (using init_webdvr)...
14:19:39 DEB [chromedr init_web 175 ] WebDriver initialization attempt 1/3...
14:19:39 INF [chromedr init_web 192 ] User data directory (no --profile-directory):
                                      C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
14:19:39 DEB [chromedr init_web 203 ] Using browser executable:
                                      C:\Program Files\Google\Chrome\Application\chrome.exe
14:19:39 DEB [chromedr init_web 220 ] Setting User-Agent:
                                      Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36
14:19:39 DEB [chromedr init_web 229 ] Letting undetected_chromedriver auto-manage ChromeDriver version (self-patching mode).
14:19:39 INF [chromedr init_web 231 ] [init_webdvr] Attempting uc.Chrome() self-patching (attempt 1)...
14:19:42 INF [chromedr init_web 234 ] [init_webdvr] uc.Chrome() self-patching succeeded in 2.49s (attempt 1)
14:19:42 DEB [chromedr init_web 235 ] WebDriver instance object potentially created (attempt 1).
14:19:42 DEB [chromedr init_web 277 ] User-Agent override applied via CDP.
14:19:42 DEB [chromedr init_web 282 ] Attempting to minimize window (non-headless mode)...
14:19:42 DEB [chromedr init_web 285 ] Browser window minimized.
14:19:42 DEB [chromedr init_web 309 ] WebDriver instance fully configured successfully (attempt 1).
14:19:42 DEB [utils    start_se 684 ] WebDriver initialization successful.
14:19:42 DEB [utils    start_se 685 ] Navigating to Base URL (https://www.ancestry.co.uk/) to stabilize...
14:19:42 DEB [utils    nav_to_p 3516] Navigation Attempt 1/3 to: https://www.ancestry.co.uk/
14:19:42 DEB [utils    nav_to_p 3539] Executing driver.get('https://www.ancestry.co.uk/')...
14:19:45 DEB [utils    nav_to_p 3552] Landed on URL base: https://www.ancestry.co.uk
14:19:47 DEB [utils    nav_to_p 3647] On correct URL base. Waiting up to 20s for selector: 'body'
14:19:47 DEB [utils    nav_to_p 3654] Navigation successful and element 'body' found on:
                                      https://www.ancestry.co.uk/
14:19:47 DEB [utils    start_se 698 ] Initial navigation to Base URL successful.
14:19:47 DEB [utils    start_se 702 ] --- SessionManager Phase 1: Driver Start Successful ---
14:19:47 INF [api_util log_msg  958 ] - SessionManager.start_sess(): PASSED
14:19:47 DEB [utils    ensure_s 737 ] TRACE: Entered ensure_session_ready
14:19:47 DEB [utils    ensure_d 723 ] Driver already live (Action: api_utils Self Check Ready - Ensure Driver).
14:19:47 DEB [utils    ensure_s 746 ] TRACE: About to call _perform_readiness_checks
14:19:47 DEB [utils    ensure_s 749 ] TRACE: Calling _perform_readiness_checks
14:19:47 DEB [utils    _perform 795 ] Performing readiness checks (action=api_utils Self Check Ready - Readiness Checks)...
14:19:47 INF [utils    _perform 815 ] [Persistence] Chrome user data directory is present: C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
14:19:47 DEB [utils    login_st 3391] Checking login status (API prioritized)...
14:19:47 DEB [utils    login_st 3404] Attempting API login verification (_verify_api_login_status)...
14:19:47 DEB [utils    _verify_ 1730] Verifying login status via API endpoint: https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna...
14:19:47 DEB [utils    _verify_ 1737] Syncing cookies before API login check...
14:19:47 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:19:47 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:19:47 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
14:19:47 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:19:47 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:19:47 DEB [utils    _api_req 2172] API Login Verification (header/dna): Cookies synced (Attempt 1).
14:19:47 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.556s (CurrentDelay: 0.50s)
14:19:47 DEB [utils    _api_req 2245] API Login Verification (header/dna): Rate limit wait: 0.56s (Attempt 1)
14:19:47 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-bacb3c2...39-01', 'tracestate': '2611750@nr...87204', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:19:47 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:19:47 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] >>> Calling requests.request...
14:19:48 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] <<< requests.request returned.
14:19:48 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:19:48 DEB [utils    _verify_ 1769] API Login Verification (header/dna): API login check successful ('testId' found).
14:19:48 DEB [utils    login_st 3407] Login status confirmed TRUE via API check.
14:19:48 DEB [utils    _perform 892 ] Checking/Handling current URL...
14:19:48 DEB [utils    _check_a 1089] Current URL for check: https://www.ancestry.co.uk/
14:19:48 DEB [utils    _check_a 1126] Current URL is suitable, no extra navigation needed.
14:19:48 DEB [utils    _perform 896 ] URL check/handling OK.
14:19:48 DEB [utils    _perform 899 ] Verifying essential cookies...
14:19:48 DEB [utils    get_cook 1255] Waiting up to 5s for cookies: ['ANCSESSIONID', 'SecureATT']...
14:19:48 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
14:19:48 DEB [utils    _perform 908 ] Essential cookies OK.
14:19:48 DEB [utils    _perform 911 ] Syncing cookies to requests session...
14:19:48 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:19:48 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:19:48 DEB [utils    _perform 913 ] Cookies synced.
14:19:48 DEB [utils    _perform 916 ] Ensuring CSRF token...
14:19:48 DEB [utils    get_csrf 1215] Attempting to fetch fresh CSRF token from: https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken
14:19:48 DEB [utils    get_cook 1255] Waiting up to 10s for cookies: ['ANCSESSIONID', 'SecureATT']...
14:19:48 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
14:19:48 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken (Timeout: 60s, AllowRedirects: True)
14:19:48 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:19:48 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:19:48 DEB [utils    _api_req 2172] CSRF Token API: Cookies synced (Attempt 1).
14:19:48 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.472s (CurrentDelay: 0.50s)
14:19:49 DEB [utils    _api_req 2245] CSRF Token API: Rate limit wait: 0.47s (Attempt 1)
14:19:49 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'CSRF Token API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-712c1b3...93-01', 'tracestate': '2611750@nr...88711', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:19:49 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'CSRF Token API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:19:49 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'CSRF Token API'] >>> Calling requests.request...
14:19:49 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'CSRF Token API'] <<< requests.request returned.
14:19:49 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
14:19:49 DEB [utils    get_csrf 1233] CSRF token successfully retrieved (Length: 144).
14:19:49 DEB [utils    _perform 924 ] CSRF token OK.
14:19:49 INF [utils    _perform 927 ] Readiness checks PASSED on attempt 1.
14:19:49 DEB [utils    ensure_s 752 ] TRACE: _perform_readiness_checks returned: True
14:19:49 DEB [utils    ensure_s 767 ] [Patch] Attempting to retrieve identifiers and tree owner after readiness checks...
14:19:49 DEB [utils    _retriev 1131] TRACE: Entered _retrieve_identifiers
14:19:49 DEB [utils    _retriev 1135] Retrieving profile ID (ucdmid)...
14:19:49 DEB [utils    get_my_p 1531] Attempting to fetch own profile ID (ucdmid)...
14:19:49 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/cdp-p13n/api/v1/users/me?attributes=ucdmid (Timeout: 60s, AllowRedirects: True)
14:19:49 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:19:49 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:19:49 DEB [utils    _api_req 2172] Get my profile_id: Cookies synced (Attempt 1).
14:19:49 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.595s (CurrentDelay: 0.50s)
14:19:50 DEB [utils    _api_req 2245] Get my profile_id: Rate limit wait: 0.59s (Attempt 1)
14:19:50 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get my profile_id'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'p13n-js', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-02994bd...da-01', 'tracestate': '2611750@nr...89670', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:19:50 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get my profile_id'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:19:50 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get my profile_id'] >>> Calling requests.request...
14:19:50 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get my profile_id'] <<< requests.request returned.
14:19:50 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
14:19:50 DEB [utils    get_my_p 1552] Successfully retrieved profile_id: 07BDD45E-0006-0000-0000-000000000000
14:19:50 INF [utils    _retriev 1141] My profile id: 07BDD45E-0006-0000-0000-000000000000
14:19:50 DEB [utils    _retriev 1147] Retrieving UUID (testId)...
14:19:50 DEB [utils    get_my_u 1569] Attempting to fetch own UUID (testId) from header/dna API...
14:19:50 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
14:19:50 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:19:50 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:19:50 DEB [utils    _api_req 2172] Get UUID API: Cookies synced (Attempt 1).
14:19:50 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.584s (CurrentDelay: 0.50s)
14:19:51 DEB [utils    _api_req 2245] Get UUID API: Rate limit wait: 0.58s (Attempt 1)
14:19:51 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get UUID API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-1b55132...0d-01', 'tracestate': '2611750@nr...90575', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:19:51 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get UUID API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:19:51 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get UUID API'] >>> Calling requests.request...
14:19:51 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get UUID API'] <<< requests.request returned.
14:19:51 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:19:51 DEB [utils    get_my_u 1581] Successfully retrieved UUID: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
14:19:51 INF [utils    _retriev 1153] My uuid: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
14:19:51 DEB [utils    _retriev 1159] Retrieving tree ID for tree name: 'Gault Family'...
14:19:51 DEB [utils    get_my_t 1604] Attempting to fetch tree ID for TREE_NAME='Gault Family'...
14:19:51 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/trees (Timeout: 60s, AllowRedirects: True)
14:19:51 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:19:51 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:19:51 DEB [utils    _api_req 2172] Header Trees API: Cookies synced (Attempt 1).
14:19:51 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.583s (CurrentDelay: 0.50s)
14:19:52 DEB [utils    _api_req 2245] Header Trees API: Rate limit wait: 0.58s (Attempt 1)
14:19:52 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Header Trees API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-9069bd4...97-01', 'tracestate': '2611750@nr...91641', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:19:52 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Header Trees API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:19:52 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Header Trees API'] >>> Calling requests.request...
14:19:52 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Header Trees API'] <<< requests.request returned.
14:19:52 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:19:52 DEB [utils    get_my_t 1628] Found tree ID '175946702' for tree 'Gault Family'.
14:19:52 INF [utils    _retriev 1169] My tree id: 175946702
14:19:52 DEB [utils    _retriev 1176] TRACE: Exiting _retrieve_identifiers
14:19:52 DEB [utils    _retriev 1182] TRACE: Entered _retrieve_tree_owner
14:19:52 DEB [utils    _retriev 1191] Retrieving tree owner name...
14:19:52 DEB [utils    get_tree 1668] Attempting to fetch tree owner name for tree ID: 175946702...
14:19:52 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/user/tree-info?tree_id=175946702 (Timeout: 60s, AllowRedirects: True)
14:19:52 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:19:52 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:19:52 DEB [utils    _api_req 2172] Tree Owner Name API: Cookies synced (Attempt 1).
14:19:52 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.496s (CurrentDelay: 0.50s)
14:19:53 DEB [utils    _api_req 2245] Tree Owner Name API: Rate limit wait: 0.50s (Attempt 1)
14:19:53 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'Browser:meexp-uhome', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-9c7729a...34-01', 'tracestate': '2611750@nr...92788', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:19:53 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:19:53 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Tree Owner Name API'] >>> Calling requests.request...
14:19:53 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Tree Owner Name API'] <<< requests.request returned.
14:19:53 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:19:53 DEB [utils    get_tree 1683] Found tree owner 'Wayne Gault' for tree ID 175946702.
14:19:53 INF [utils    _retriev 1203] Tree owner name: Wayne Gault
14:19:53 DEB [utils    _retriev 1205] TRACE: Exiting _retrieve_tree_owner (success)
14:19:53 DEB [utils    ensure_s 772 ] [Patch] Identifiers after fetch: profile_id=07BDD45E-0006-0000-0000-000000000000, uuid=FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7, tree_id=175946702
14:19:53 DEB [utils    ensure_s 773 ] [Patch] Tree owner name after fetch: Wayne Gault
14:19:53 DEB [utils    ensure_s 777 ] TRACE: Set self.session_ready to: True
14:19:53 DEB [utils    ensure_s 779 ] TRACE: Exiting ensure_session_ready (returning True)
14:19:53 INF [api_util log_msg  958 ] - SessionManager.ensure_session_ready(): PASSED
14:19:53 INF [api_util log_msg  958 ] 
                                      --- Phase 2: Get Target Info & Tree-Specific Person ID ---
14:19:53 INF [api_util log_msg  958 ] - Target Profile ID (TESTING_PROFILE_ID): 08FA6E79-0006-0000-0000-000000000000
14:19:53 INF [api_util log_msg  958 ] - Target Tree ID (MY_TREE_ID): 175946702
14:19:53 INF [api_util log_msg  958 ] - Target Owner Name: Wayne Gault
14:19:53 INF [api_util log_msg  958 ] - Getting target name from Profile API: https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000
14:19:53 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000 (Timeout: 60s, AllowRedirects: True)
14:19:53 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:19:53 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:19:53 DEB [utils    _api_req 2172] Get Target Name (Profile Details): Cookies synced (Attempt 1).
14:19:53 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.496s (CurrentDelay: 0.50s)
14:19:54 DEB [utils    _api_req 2245] Get Target Name (Profile Details): Rate limit wait: 0.50s (Attempt 1)
14:19:54 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-14f84ea...6e-01', 'tracestate': '2611750@nr...93864', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:19:54 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:19:54 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] >>> Calling requests.request...
14:19:55 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] <<< requests.request returned.
14:19:55 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:19:55 INF [api_util log_msg  958 ] - Target Name found: 'Frances Mc Hardy'
14:19:55 INF [api_util log_msg  958 ] - Searching for 'Frances Mc Hardy' in tree 175946702 via API: https://www.ancestry.co.uk/api/treesui-list/trees/175946702/persons?name=Frances+Mc+Hardy&limit=5&fields=NAMES
14:19:55 DEB [utils    _api_req 2130] Applied 1 explicit header overrides for Tree Person Search API (Self Check).
14:19:55 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/treesui-list/trees/175946702/persons?name=Frances+Mc+Hardy&limit=5&fields=NAMES (Timeout: 20s, AllowRedirects: True)
14:19:55 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:19:55 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:19:55 DEB [utils    _api_req 2172] Tree Person Search API (Self Check): Cookies synced (Attempt 1).
14:19:55 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.590s (CurrentDelay: 0.50s)
14:19:55 DEB [utils    _api_req 2245] Tree Person Search API (Self Check): Rate limit wait: 0.59s (Attempt 1)
14:19:55 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36', 'Accept': '*/*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-cc48b95...7e-01', 'tracestate': '2611750@nr...95227', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:19:55 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:19:55 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] >>> Calling requests.request...
14:19:56 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] <<< requests.request returned.
14:19:56 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
14:19:56 INF [api_util log_msg  958 ] - Tree Search API call: SUCCESS (Received list)
14:19:56 ERR [api_util log_msg  954 ] - Tree Search FAILED: No persons found matching name 'Frances Mc Hardy'. Check name/tree.
14:19:56 ERR [api_util log_msg  954 ] Could not determine tree-specific Person ID. Subsequent tests requiring it will be skipped.
14:19:56 INF [api_util log_msg  958 ] 
                                      --- Phase 3: Test parse_ancestry_person_details (Profile Details API) ---
14:19:56 INF [api_util log_msg  958 ] - Using Profile Details API response from Phase 2.
14:19:56 DEB [api_util parse_an 415 ] Parsed API details for 'Frances Mc Hardy': ID=08FA6E79-0006-0000-0000-000000000000, Tree=175946702, Born='N/A' in 'None', Died='N/A' in 'None', Gender='None', Living=None
14:19:56 INF [api_util log_msg  958 ] - parse_ancestry_person_details call: SUCCESS
14:19:56 INF [api_util log_msg  958 ] - Parsed Details Validation: PASSED (Name: 'Frances Mc Hardy', Link: https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/08FA6E79-0006-0000-0000-000000000000/facts)
14:19:56 INF [api_util log_msg  958 ] 
                                      --- Phase 4: Test Relationship Ladder Parsing (using /getladder) ---
14:19:56 WAR [api_util log_msg  956 ] - Skipping Relationship Ladder test: Missing required info (Target Person ID).
14:19:56 INF [api_util log_msg  958 ] 
                                      --- Finalizing: Closing Session ---
14:19:56 DEB [utils    close_se 1889] Attempting to close WebDriver session...
14:19:56 DEB [utils    close_se 1892] WebDriver session quit successfully.
14:19:56 DEB [utils    close_se 1903] Closing database connection pool...
14:19:56 DEB [utils    cls_db_c 1509] SessionManager ID=115398688 cls_db_conn called (keep_db=False). Disposing Engine ID: 117225376
14:19:56 DEB [utils    cls_db_c 1514] Engine ID=117225376 disposed successfully.
14:19:56 ERR [api_util self_che 1541] api_utils self-check status: FAIL
14:19:56 DEB [cache    close_ca 261 ] Closing DiskCache connection...
14:19:56 DEB [cache    close_ca 263 ] DiskCache connection closed.
14:28:03 INF [api_util log_msg  960 ] 
                                      [api_utils.py self-check starting...]
14:28:03 INF [api_util log_msg  960 ] 
                                      --- Phase 0: Prerequisite Checks ---
14:28:03 INF [api_util log_msg  960 ] - BeautifulSoup Import: OK
14:28:03 INF [api_util log_msg  960 ] - format_name Import/Fallback: OK
14:28:03 INF [api_util log_msg  960 ] - ordinal_case Import/Fallback: OK
14:28:03 INF [api_util log_msg  960 ] - _parse_date Import/Fallback: OK
14:28:03 INF [api_util log_msg  960 ] - _clean_display_date Import/Fallback: OK
14:28:03 INF [api_util log_msg  960 ] - Config Check: Essential credentials/URLs/IDs present.
14:28:03 INF [api_util log_msg  960 ] 
                                      --- Phase 1: Session Setup & Login ---
14:28:03 DEB [utils    __init__ 619 ] Initialized shared requests.Session with HTTPAdapter.
14:28:03 DEB [utils    __init__ 634 ] Initialized shared cloudscraper instance with retry strategy.
14:28:03 DEB [utils    __init__ 474 ] RateLimiter Init: Capacity=10.0, FillRate=2.0/s, InitialDelay=0.50s, Backoff=1.80, Decrease=0.98
14:28:03 DEB [utils    __init__ 645 ] SessionManager instance created: ID=114834560
                                      
14:28:03 DEB [utils    start_se 649 ] --- SessionManager Phase 1: Starting Driver (api_utils Self Check Start) ---
                                      
14:28:03 DEB [utils    _initial 986 ] SessionManager ID=114834560 initializing SQLAlchemy Engine/Session...
14:28:03 DEB [utils    _initial 1001] DB Path: C:\Users\wayne\GitHub\Python\Projects\Ancestry\Data\ancestry.db
14:28:03 DEB [utils    _initial 1035] DB Pool Config: Size=10, MaxOverflow=5, Timeout=30
14:28:03 DEB [utils    _initial 1047] Created NEW SQLAlchemy engine: ID=116594336 for SM ID=114834560
14:28:03 DEB [utils    _initial 1064] Created Session factory for Engine ID=116594336
14:28:03 DEB [utils    enable_s 1057] SQLite PRAGMA settings applied (WAL, Foreign Keys).
14:28:03 DEB [database _create_ 310 ] Executing CREATE VIEW statement for 'messages' view...
14:28:03 DEB [database _create_ 313 ] Database view 'messages' created or already exists.
14:28:03 DEB [utils    _initial 1067] DB tables checked/created successfully.
14:28:03 DEB [utils    start_se 676 ] Initializing WebDriver instance (using init_webdvr)...
14:28:04 DEB [chromedr init_web 175 ] WebDriver initialization attempt 1/3...
14:28:04 INF [chromedr init_web 192 ] User data directory (no --profile-directory):
                                      C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
14:28:04 DEB [chromedr init_web 203 ] Using browser executable:
                                      C:\Program Files\Google\Chrome\Application\chrome.exe
14:28:04 DEB [chromedr init_web 220 ] Setting User-Agent:
                                      Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
14:28:04 DEB [chromedr init_web 229 ] Letting undetected_chromedriver auto-manage ChromeDriver version (self-patching mode).
14:28:04 INF [chromedr init_web 231 ] [init_webdvr] Attempting uc.Chrome() self-patching (attempt 1)...
14:28:06 INF [chromedr init_web 234 ] [init_webdvr] uc.Chrome() self-patching succeeded in 2.43s (attempt 1)
14:28:06 DEB [chromedr init_web 235 ] WebDriver instance object potentially created (attempt 1).
14:28:06 DEB [chromedr init_web 277 ] User-Agent override applied via CDP.
14:28:06 DEB [chromedr init_web 282 ] Attempting to minimize window (non-headless mode)...
14:28:06 DEB [chromedr init_web 285 ] Browser window minimized.
14:28:06 DEB [chromedr init_web 309 ] WebDriver instance fully configured successfully (attempt 1).
14:28:06 DEB [utils    start_se 684 ] WebDriver initialization successful.
14:28:06 DEB [utils    start_se 685 ] Navigating to Base URL (https://www.ancestry.co.uk/) to stabilize...
14:28:06 DEB [utils    nav_to_p 3516] Navigation Attempt 1/3 to: https://www.ancestry.co.uk/
14:28:06 DEB [utils    nav_to_p 3539] Executing driver.get('https://www.ancestry.co.uk/')...
14:28:09 DEB [utils    nav_to_p 3552] Landed on URL base: https://www.ancestry.co.uk
14:28:11 DEB [utils    nav_to_p 3647] On correct URL base. Waiting up to 20s for selector: 'body'
14:28:11 DEB [utils    nav_to_p 3654] Navigation successful and element 'body' found on:
                                      https://www.ancestry.co.uk/
14:28:11 DEB [utils    start_se 698 ] Initial navigation to Base URL successful.
14:28:11 DEB [utils    start_se 702 ] --- SessionManager Phase 1: Driver Start Successful ---
14:28:11 INF [api_util log_msg  960 ] - SessionManager.start_sess(): PASSED
14:28:11 DEB [utils    ensure_s 737 ] TRACE: Entered ensure_session_ready
14:28:11 DEB [utils    ensure_d 723 ] Driver already live (Action: api_utils Self Check Ready - Ensure Driver).
14:28:11 DEB [utils    ensure_s 746 ] TRACE: About to call _perform_readiness_checks
14:28:11 DEB [utils    ensure_s 749 ] TRACE: Calling _perform_readiness_checks
14:28:11 DEB [utils    _perform 795 ] Performing readiness checks (action=api_utils Self Check Ready - Readiness Checks)...
14:28:11 INF [utils    _perform 815 ] [Persistence] Chrome user data directory is present: C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
14:28:11 DEB [utils    login_st 3391] Checking login status (API prioritized)...
14:28:11 DEB [utils    login_st 3404] Attempting API login verification (_verify_api_login_status)...
14:28:11 DEB [utils    _verify_ 1730] Verifying login status via API endpoint: https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna...
14:28:11 DEB [utils    _verify_ 1737] Syncing cookies before API login check...
14:28:11 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:28:11 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:28:11 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
14:28:11 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:28:11 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:28:11 DEB [utils    _api_req 2172] API Login Verification (header/dna): Cookies synced (Attempt 1).
14:28:11 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.489s (CurrentDelay: 0.50s)
14:28:11 DEB [utils    _api_req 2245] API Login Verification (header/dna): Rate limit wait: 0.49s (Attempt 1)
14:28:11 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-847b51d...c3-01', 'tracestate': '2611750@nr...91143', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:28:11 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:28:11 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] >>> Calling requests.request...
14:28:12 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] <<< requests.request returned.
14:28:12 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:28:12 DEB [utils    _verify_ 1769] API Login Verification (header/dna): API login check successful ('testId' found).
14:28:12 DEB [utils    login_st 3407] Login status confirmed TRUE via API check.
14:28:12 DEB [utils    _perform 892 ] Checking/Handling current URL...
14:28:12 DEB [utils    _check_a 1089] Current URL for check: https://www.ancestry.co.uk/
14:28:12 DEB [utils    _check_a 1126] Current URL is suitable, no extra navigation needed.
14:28:12 DEB [utils    _perform 896 ] URL check/handling OK.
14:28:12 DEB [utils    _perform 899 ] Verifying essential cookies...
14:28:12 DEB [utils    get_cook 1255] Waiting up to 5s for cookies: ['ANCSESSIONID', 'SecureATT']...
14:28:12 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
14:28:12 DEB [utils    _perform 908 ] Essential cookies OK.
14:28:12 DEB [utils    _perform 911 ] Syncing cookies to requests session...
14:28:12 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:28:12 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:28:12 DEB [utils    _perform 913 ] Cookies synced.
14:28:12 DEB [utils    _perform 916 ] Ensuring CSRF token...
14:28:12 DEB [utils    get_csrf 1215] Attempting to fetch fresh CSRF token from: https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken
14:28:12 DEB [utils    get_cook 1255] Waiting up to 10s for cookies: ['ANCSESSIONID', 'SecureATT']...
14:28:12 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
14:28:12 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken (Timeout: 60s, AllowRedirects: True)
14:28:12 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:28:12 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:28:12 DEB [utils    _api_req 2172] CSRF Token API: Cookies synced (Attempt 1).
14:28:12 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.484s (CurrentDelay: 0.50s)
14:28:13 DEB [utils    _api_req 2245] CSRF Token API: Rate limit wait: 0.48s (Attempt 1)
14:28:13 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'CSRF Token API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-5632bd5...3d-01', 'tracestate': '2611750@nr...92605', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:28:13 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'CSRF Token API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:28:13 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'CSRF Token API'] >>> Calling requests.request...
14:28:13 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'CSRF Token API'] <<< requests.request returned.
14:28:13 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
14:28:13 DEB [utils    get_csrf 1233] CSRF token successfully retrieved (Length: 144).
14:28:13 DEB [utils    _perform 924 ] CSRF token OK.
14:28:13 INF [utils    _perform 927 ] Readiness checks PASSED on attempt 1.
14:28:13 DEB [utils    ensure_s 752 ] TRACE: _perform_readiness_checks returned: True
14:28:13 DEB [utils    ensure_s 767 ] [Patch] Attempting to retrieve identifiers and tree owner after readiness checks...
14:28:13 DEB [utils    _retriev 1131] TRACE: Entered _retrieve_identifiers
14:28:13 DEB [utils    _retriev 1135] Retrieving profile ID (ucdmid)...
14:28:13 DEB [utils    get_my_p 1531] Attempting to fetch own profile ID (ucdmid)...
14:28:13 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/cdp-p13n/api/v1/users/me?attributes=ucdmid (Timeout: 60s, AllowRedirects: True)
14:28:13 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:28:13 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:28:13 DEB [utils    _api_req 2172] Get my profile_id: Cookies synced (Attempt 1).
14:28:13 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.440s (CurrentDelay: 0.50s)
14:28:13 DEB [utils    _api_req 2245] Get my profile_id: Rate limit wait: 0.44s (Attempt 1)
14:28:13 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get my profile_id'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'p13n-js', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-32fc46a...30-01', 'tracestate': '2611750@nr...93525', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:28:13 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get my profile_id'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:28:13 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get my profile_id'] >>> Calling requests.request...
14:28:14 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get my profile_id'] <<< requests.request returned.
14:28:14 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
14:28:14 DEB [utils    get_my_p 1552] Successfully retrieved profile_id: 07BDD45E-0006-0000-0000-000000000000
14:28:14 INF [utils    _retriev 1141] My profile id: 07BDD45E-0006-0000-0000-000000000000
14:28:14 DEB [utils    _retriev 1147] Retrieving UUID (testId)...
14:28:14 DEB [utils    get_my_u 1569] Attempting to fetch own UUID (testId) from header/dna API...
14:28:14 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
14:28:14 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:28:14 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:28:14 DEB [utils    _api_req 2172] Get UUID API: Cookies synced (Attempt 1).
14:28:14 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.557s (CurrentDelay: 0.50s)
14:28:15 DEB [utils    _api_req 2245] Get UUID API: Rate limit wait: 0.56s (Attempt 1)
14:28:15 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get UUID API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-8eaddf8...e9-01', 'tracestate': '2611750@nr...94505', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:28:15 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get UUID API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:28:15 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get UUID API'] >>> Calling requests.request...
14:28:15 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get UUID API'] <<< requests.request returned.
14:28:15 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:28:15 DEB [utils    get_my_u 1581] Successfully retrieved UUID: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
14:28:15 INF [utils    _retriev 1153] My uuid: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
14:28:15 DEB [utils    _retriev 1159] Retrieving tree ID for tree name: 'Gault Family'...
14:28:15 DEB [utils    get_my_t 1604] Attempting to fetch tree ID for TREE_NAME='Gault Family'...
14:28:15 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/trees (Timeout: 60s, AllowRedirects: True)
14:28:15 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:28:15 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:28:15 DEB [utils    _api_req 2172] Header Trees API: Cookies synced (Attempt 1).
14:28:15 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.541s (CurrentDelay: 0.50s)
14:28:16 DEB [utils    _api_req 2245] Header Trees API: Rate limit wait: 0.54s (Attempt 1)
14:28:16 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Header Trees API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-588a11a...b4-01', 'tracestate': '2611750@nr...95528', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:28:16 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Header Trees API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:28:16 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Header Trees API'] >>> Calling requests.request...
14:28:16 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Header Trees API'] <<< requests.request returned.
14:28:16 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:28:16 DEB [utils    get_my_t 1628] Found tree ID '175946702' for tree 'Gault Family'.
14:28:16 INF [utils    _retriev 1169] My tree id: 175946702
14:28:16 DEB [utils    _retriev 1176] TRACE: Exiting _retrieve_identifiers
14:28:16 DEB [utils    _retriev 1182] TRACE: Entered _retrieve_tree_owner
14:28:16 DEB [utils    _retriev 1191] Retrieving tree owner name...
14:28:16 DEB [utils    get_tree 1668] Attempting to fetch tree owner name for tree ID: 175946702...
14:28:16 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/user/tree-info?tree_id=175946702 (Timeout: 60s, AllowRedirects: True)
14:28:16 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:28:16 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:28:16 DEB [utils    _api_req 2172] Tree Owner Name API: Cookies synced (Attempt 1).
14:28:16 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.500s (CurrentDelay: 0.50s)
14:28:17 DEB [utils    _api_req 2245] Tree Owner Name API: Rate limit wait: 0.50s (Attempt 1)
14:28:17 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'Browser:meexp-uhome', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-7f28cdf...81-01', 'tracestate': '2611750@nr...96627', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:28:17 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:28:17 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Tree Owner Name API'] >>> Calling requests.request...
14:28:17 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Tree Owner Name API'] <<< requests.request returned.
14:28:17 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:28:17 DEB [utils    get_tree 1683] Found tree owner 'Wayne Gault' for tree ID 175946702.
14:28:17 INF [utils    _retriev 1203] Tree owner name: Wayne Gault
14:28:17 DEB [utils    _retriev 1205] TRACE: Exiting _retrieve_tree_owner (success)
14:28:17 DEB [utils    ensure_s 772 ] [Patch] Identifiers after fetch: profile_id=07BDD45E-0006-0000-0000-000000000000, uuid=FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7, tree_id=175946702
14:28:17 DEB [utils    ensure_s 773 ] [Patch] Tree owner name after fetch: Wayne Gault
14:28:17 DEB [utils    ensure_s 777 ] TRACE: Set self.session_ready to: True
14:28:17 DEB [utils    ensure_s 779 ] TRACE: Exiting ensure_session_ready (returning True)
14:28:17 INF [api_util log_msg  960 ] - SessionManager.ensure_session_ready(): PASSED
14:28:17 INF [api_util log_msg  960 ] 
                                      --- Phase 2: Get Target Info & Tree-Specific Person ID ---
14:28:17 INF [api_util log_msg  960 ] - Target Profile ID (TESTING_PROFILE_ID): 08FA6E79-0006-0000-0000-000000000000
14:28:17 INF [api_util log_msg  960 ] - Target Tree ID (MY_TREE_ID): 175946702
14:28:17 INF [api_util log_msg  960 ] - Target Owner Name: Wayne Gault
14:28:17 INF [api_util log_msg  960 ] - Getting target name from Profile API: https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000
14:28:17 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000 (Timeout: 60s, AllowRedirects: True)
14:28:17 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:28:17 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:28:17 DEB [utils    _api_req 2172] Get Target Name (Profile Details): Cookies synced (Attempt 1).
14:28:17 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.502s (CurrentDelay: 0.50s)
14:28:18 DEB [utils    _api_req 2245] Get Target Name (Profile Details): Rate limit wait: 0.50s (Attempt 1)
14:28:18 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-04d0911...98-01', 'tracestate': '2611750@nr...97676', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:28:18 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:28:18 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] >>> Calling requests.request...
14:28:18 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] <<< requests.request returned.
14:28:18 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:28:18 INF [api_util log_msg  960 ] - Target Name found: 'Frances Mc Hardy' (FirstName: 'Frances')
14:28:18 INF [api_util log_msg  960 ] - Searching for 'Frances' in tree 175946702 via API: https://www.ancestry.co.uk/api/treesui-list/trees/175946702/persons?name=Frances&limit=5&fields=NAMES
14:28:18 DEB [utils    _api_req 2130] Applied 1 explicit header overrides for Tree Person Search API (Self Check).
14:28:18 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/treesui-list/trees/175946702/persons?name=Frances&limit=5&fields=NAMES (Timeout: 20s, AllowRedirects: True)
14:28:18 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:28:18 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:28:18 DEB [utils    _api_req 2172] Tree Person Search API (Self Check): Cookies synced (Attempt 1).
14:28:18 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.520s (CurrentDelay: 0.50s)
14:28:19 DEB [utils    _api_req 2245] Tree Person Search API (Self Check): Rate limit wait: 0.52s (Attempt 1)
14:28:19 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': '*/*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-343db4f...5d-01', 'tracestate': '2611750@nr...98623', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:28:19 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:28:19 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] >>> Calling requests.request...
14:28:19 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Tree Person Search API (Self Check)'] <<< requests.request returned.
14:28:19 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
14:28:19 INF [api_util log_msg  960 ] - Tree Search API call: SUCCESS (Received list)
14:28:19 ERR [api_util log_msg  956 ] - Tree Search FAILED: First person found has invalid format or missing personId.
14:28:19 ERR [api_util log_msg  956 ] Could not determine tree-specific Person ID. Subsequent tests requiring it will be skipped.
14:28:19 INF [api_util log_msg  960 ] 
                                      --- Phase 3: Test parse_ancestry_person_details (Profile Details API) ---
14:28:19 INF [api_util log_msg  960 ] - Using Profile Details API response from Phase 2.
14:28:19 DEB [api_util parse_an 416 ] Parsed API details for 'Frances Mc Hardy': ID=08FA6E79-0006-0000-0000-000000000000, Tree=175946702, Born='N/A' in 'None', Died='N/A' in 'None', Gender='None', Living=None
14:28:19 INF [api_util log_msg  960 ] - parse_ancestry_person_details call: SUCCESS
14:28:19 INF [api_util log_msg  960 ] - Parsed Details Validation: PASSED (Name: 'Frances Mc Hardy', Link: https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/08FA6E79-0006-0000-0000-000000000000/facts)
14:28:19 INF [api_util log_msg  960 ] 
                                      --- Phase 4: Test Relationship Ladder Parsing (using /getladder) ---
14:28:19 WAR [api_util log_msg  958 ] - Skipping Relationship Ladder test: Missing required info (Target Person ID).
14:28:19 INF [api_util log_msg  960 ] 
                                      --- Finalizing: Closing Session ---
14:28:19 DEB [utils    close_se 1889] Attempting to close WebDriver session...
14:28:19 DEB [utils    close_se 1892] WebDriver session quit successfully.
14:28:19 DEB [utils    close_se 1903] Closing database connection pool...
14:28:19 DEB [utils    cls_db_c 1509] SessionManager ID=114834560 cls_db_conn called (keep_db=False). Disposing Engine ID: 116594336
14:28:19 DEB [utils    cls_db_c 1514] Engine ID=116594336 disposed successfully.
14:28:19 ERR [api_util self_che 1549] api_utils self-check status: FAIL
14:28:19 DEB [cache    close_ca 261 ] Closing DiskCache connection...
14:28:19 DEB [cache    close_ca 263 ] DiskCache connection closed.
14:36:21 INF [api_util log_msg  967 ] 
                                      [api_utils.py self-check starting...]
14:36:21 INF [api_util log_msg  967 ] 
                                      --- Phase 0: Prerequisite Checks ---
14:36:21 INF [api_util log_msg  967 ] - BeautifulSoup Import: OK
14:36:21 INF [api_util log_msg  967 ] - format_name Import/Fallback: OK
14:36:21 INF [api_util log_msg  967 ] - ordinal_case Import/Fallback: OK
14:36:21 INF [api_util log_msg  967 ] - _parse_date Import/Fallback: OK
14:36:21 INF [api_util log_msg  967 ] - _clean_display_date Import/Fallback: OK
14:36:21 INF [api_util log_msg  967 ] - Config Check: Essential credentials/URLs/IDs present.
14:36:21 INF [api_util log_msg  967 ] 
                                      --- Phase 1: Session Setup & Login ---
14:36:21 DEB [utils    __init__ 619 ] Initialized shared requests.Session with HTTPAdapter.
14:36:21 DEB [utils    __init__ 634 ] Initialized shared cloudscraper instance with retry strategy.
14:36:21 DEB [utils    __init__ 474 ] RateLimiter Init: Capacity=10.0, FillRate=2.0/s, InitialDelay=0.50s, Backoff=1.80, Decrease=0.98
14:36:21 DEB [utils    __init__ 645 ] SessionManager instance created: ID=83533776
                                      
14:36:21 DEB [utils    start_se 649 ] --- SessionManager Phase 1: Starting Driver (api_utils Self Check Start) ---
                                      
14:36:21 DEB [utils    _initial 986 ] SessionManager ID=83533776 initializing SQLAlchemy Engine/Session...
14:36:21 DEB [utils    _initial 1001] DB Path: C:\Users\wayne\GitHub\Python\Projects\Ancestry\Data\ancestry.db
14:36:21 DEB [utils    _initial 1035] DB Pool Config: Size=10, MaxOverflow=5, Timeout=30
14:36:21 DEB [utils    _initial 1047] Created NEW SQLAlchemy engine: ID=116800784 for SM ID=83533776
14:36:21 DEB [utils    _initial 1064] Created Session factory for Engine ID=116800784
14:36:21 DEB [utils    enable_s 1057] SQLite PRAGMA settings applied (WAL, Foreign Keys).
14:36:21 DEB [database _create_ 310 ] Executing CREATE VIEW statement for 'messages' view...
14:36:21 DEB [database _create_ 313 ] Database view 'messages' created or already exists.
14:36:21 DEB [utils    _initial 1067] DB tables checked/created successfully.
14:36:21 DEB [utils    start_se 676 ] Initializing WebDriver instance (using init_webdvr)...
14:36:22 DEB [chromedr init_web 175 ] WebDriver initialization attempt 1/3...
14:36:22 INF [chromedr init_web 192 ] User data directory (no --profile-directory):
                                      C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
14:36:22 DEB [chromedr init_web 203 ] Using browser executable:
                                      C:\Program Files\Google\Chrome\Application\chrome.exe
14:36:22 DEB [chromedr init_web 220 ] Setting User-Agent:
                                      Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
14:36:22 DEB [chromedr init_web 229 ] Letting undetected_chromedriver auto-manage ChromeDriver version (self-patching mode).
14:36:22 INF [chromedr init_web 231 ] [init_webdvr] Attempting uc.Chrome() self-patching (attempt 1)...
14:36:24 INF [chromedr init_web 234 ] [init_webdvr] uc.Chrome() self-patching succeeded in 2.44s (attempt 1)
14:36:24 DEB [chromedr init_web 235 ] WebDriver instance object potentially created (attempt 1).
14:36:24 DEB [chromedr init_web 277 ] User-Agent override applied via CDP.
14:36:24 DEB [chromedr init_web 282 ] Attempting to minimize window (non-headless mode)...
14:36:24 DEB [chromedr init_web 285 ] Browser window minimized.
14:36:24 DEB [chromedr init_web 309 ] WebDriver instance fully configured successfully (attempt 1).
14:36:24 DEB [utils    start_se 684 ] WebDriver initialization successful.
14:36:24 DEB [utils    start_se 685 ] Navigating to Base URL (https://www.ancestry.co.uk/) to stabilize...
14:36:24 DEB [utils    nav_to_p 3516] Navigation Attempt 1/3 to: https://www.ancestry.co.uk/
14:36:24 DEB [utils    nav_to_p 3539] Executing driver.get('https://www.ancestry.co.uk/')...
14:36:27 DEB [utils    nav_to_p 3552] Landed on URL base: https://www.ancestry.co.uk
14:36:29 DEB [utils    nav_to_p 3647] On correct URL base. Waiting up to 20s for selector: 'body'
14:36:29 DEB [utils    nav_to_p 3654] Navigation successful and element 'body' found on:
                                      https://www.ancestry.co.uk/
14:36:29 DEB [utils    start_se 698 ] Initial navigation to Base URL successful.
14:36:29 DEB [utils    start_se 702 ] --- SessionManager Phase 1: Driver Start Successful ---
14:36:29 INF [api_util log_msg  967 ] - SessionManager.start_sess(): PASSED
14:36:29 DEB [utils    ensure_s 737 ] TRACE: Entered ensure_session_ready
14:36:29 DEB [utils    ensure_d 723 ] Driver already live (Action: api_utils Self Check Ready - Ensure Driver).
14:36:29 DEB [utils    ensure_s 746 ] TRACE: About to call _perform_readiness_checks
14:36:29 DEB [utils    ensure_s 749 ] TRACE: Calling _perform_readiness_checks
14:36:29 DEB [utils    _perform 795 ] Performing readiness checks (action=api_utils Self Check Ready - Readiness Checks)...
14:36:29 INF [utils    _perform 815 ] [Persistence] Chrome user data directory is present: C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
14:36:29 DEB [utils    login_st 3391] Checking login status (API prioritized)...
14:36:29 DEB [utils    login_st 3404] Attempting API login verification (_verify_api_login_status)...
14:36:29 DEB [utils    _verify_ 1730] Verifying login status via API endpoint: https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna...
14:36:29 DEB [utils    _verify_ 1737] Syncing cookies before API login check...
14:36:29 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:36:29 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:36:29 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
14:36:29 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:36:29 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:36:29 DEB [utils    _api_req 2172] API Login Verification (header/dna): Cookies synced (Attempt 1).
14:36:29 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.523s (CurrentDelay: 0.50s)
14:36:29 DEB [utils    _api_req 2245] API Login Verification (header/dna): Rate limit wait: 0.52s (Attempt 1)
14:36:29 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-1233cd2...c8-01', 'tracestate': '2611750@nr...89322', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:36:29 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:36:29 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] >>> Calling requests.request...
14:36:30 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] <<< requests.request returned.
14:36:30 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:36:30 DEB [utils    _verify_ 1769] API Login Verification (header/dna): API login check successful ('testId' found).
14:36:30 DEB [utils    login_st 3407] Login status confirmed TRUE via API check.
14:36:30 DEB [utils    _perform 892 ] Checking/Handling current URL...
14:36:30 DEB [utils    _check_a 1089] Current URL for check: https://www.ancestry.co.uk/
14:36:30 DEB [utils    _check_a 1126] Current URL is suitable, no extra navigation needed.
14:36:30 DEB [utils    _perform 896 ] URL check/handling OK.
14:36:30 DEB [utils    _perform 899 ] Verifying essential cookies...
14:36:30 DEB [utils    get_cook 1255] Waiting up to 5s for cookies: ['ANCSESSIONID', 'SecureATT']...
14:36:30 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
14:36:30 DEB [utils    _perform 908 ] Essential cookies OK.
14:36:30 DEB [utils    _perform 911 ] Syncing cookies to requests session...
14:36:30 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:36:30 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:36:30 DEB [utils    _perform 913 ] Cookies synced.
14:36:30 DEB [utils    _perform 916 ] Ensuring CSRF token...
14:36:30 DEB [utils    get_csrf 1215] Attempting to fetch fresh CSRF token from: https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken
14:36:30 DEB [utils    get_cook 1255] Waiting up to 10s for cookies: ['ANCSESSIONID', 'SecureATT']...
14:36:30 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
14:36:30 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken (Timeout: 60s, AllowRedirects: True)
14:36:30 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:36:30 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:36:30 DEB [utils    _api_req 2172] CSRF Token API: Cookies synced (Attempt 1).
14:36:30 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.491s (CurrentDelay: 0.50s)
14:36:31 DEB [utils    _api_req 2245] CSRF Token API: Rate limit wait: 0.49s (Attempt 1)
14:36:31 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'CSRF Token API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-0a719d2...52-01', 'tracestate': '2611750@nr...90766', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:36:31 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'CSRF Token API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:36:31 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'CSRF Token API'] >>> Calling requests.request...
14:36:31 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'CSRF Token API'] <<< requests.request returned.
14:36:31 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
14:36:31 DEB [utils    get_csrf 1233] CSRF token successfully retrieved (Length: 144).
14:36:31 DEB [utils    _perform 924 ] CSRF token OK.
14:36:31 INF [utils    _perform 927 ] Readiness checks PASSED on attempt 1.
14:36:31 DEB [utils    ensure_s 752 ] TRACE: _perform_readiness_checks returned: True
14:36:31 DEB [utils    ensure_s 767 ] [Patch] Attempting to retrieve identifiers and tree owner after readiness checks...
14:36:31 DEB [utils    _retriev 1131] TRACE: Entered _retrieve_identifiers
14:36:31 DEB [utils    _retriev 1135] Retrieving profile ID (ucdmid)...
14:36:31 DEB [utils    get_my_p 1531] Attempting to fetch own profile ID (ucdmid)...
14:36:31 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/cdp-p13n/api/v1/users/me?attributes=ucdmid (Timeout: 60s, AllowRedirects: True)
14:36:31 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:36:31 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:36:31 DEB [utils    _api_req 2172] Get my profile_id: Cookies synced (Attempt 1).
14:36:31 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.538s (CurrentDelay: 0.50s)
14:36:32 DEB [utils    _api_req 2245] Get my profile_id: Rate limit wait: 0.54s (Attempt 1)
14:36:32 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get my profile_id'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'p13n-js', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-ee7996c...17-01', 'tracestate': '2611750@nr...91802', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:36:32 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get my profile_id'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:36:32 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get my profile_id'] >>> Calling requests.request...
14:36:32 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get my profile_id'] <<< requests.request returned.
14:36:32 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
14:36:32 DEB [utils    get_my_p 1552] Successfully retrieved profile_id: 07BDD45E-0006-0000-0000-000000000000
14:36:32 INF [utils    _retriev 1141] My profile id: 07BDD45E-0006-0000-0000-000000000000
14:36:32 DEB [utils    _retriev 1147] Retrieving UUID (testId)...
14:36:32 DEB [utils    get_my_u 1569] Attempting to fetch own UUID (testId) from header/dna API...
14:36:32 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
14:36:32 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:36:32 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:36:32 DEB [utils    _api_req 2172] Get UUID API: Cookies synced (Attempt 1).
14:36:32 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.553s (CurrentDelay: 0.50s)
14:36:33 DEB [utils    _api_req 2245] Get UUID API: Rate limit wait: 0.55s (Attempt 1)
14:36:33 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get UUID API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-e349024...2c-01', 'tracestate': '2611750@nr...92811', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:36:33 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get UUID API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:36:33 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get UUID API'] >>> Calling requests.request...
14:36:34 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get UUID API'] <<< requests.request returned.
14:36:34 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:36:34 DEB [utils    get_my_u 1581] Successfully retrieved UUID: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
14:36:34 INF [utils    _retriev 1153] My uuid: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
14:36:34 DEB [utils    _retriev 1159] Retrieving tree ID for tree name: 'Gault Family'...
14:36:34 DEB [utils    get_my_t 1604] Attempting to fetch tree ID for TREE_NAME='Gault Family'...
14:36:34 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/trees (Timeout: 60s, AllowRedirects: True)
14:36:34 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:36:34 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:36:34 DEB [utils    _api_req 2172] Header Trees API: Cookies synced (Attempt 1).
14:36:34 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.573s (CurrentDelay: 0.50s)
14:36:34 DEB [utils    _api_req 2245] Header Trees API: Rate limit wait: 0.57s (Attempt 1)
14:36:34 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Header Trees API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-60aff10...3c-01', 'tracestate': '2611750@nr...94060', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:36:34 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Header Trees API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:36:34 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Header Trees API'] >>> Calling requests.request...
14:36:34 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Header Trees API'] <<< requests.request returned.
14:36:34 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:36:34 DEB [utils    get_my_t 1628] Found tree ID '175946702' for tree 'Gault Family'.
14:36:34 INF [utils    _retriev 1169] My tree id: 175946702
14:36:34 DEB [utils    _retriev 1176] TRACE: Exiting _retrieve_identifiers
14:36:34 DEB [utils    _retriev 1182] TRACE: Entered _retrieve_tree_owner
14:36:34 DEB [utils    _retriev 1191] Retrieving tree owner name...
14:36:34 DEB [utils    get_tree 1668] Attempting to fetch tree owner name for tree ID: 175946702...
14:36:34 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/user/tree-info?tree_id=175946702 (Timeout: 60s, AllowRedirects: True)
14:36:35 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:36:35 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:36:35 DEB [utils    _api_req 2172] Tree Owner Name API: Cookies synced (Attempt 1).
14:36:35 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.483s (CurrentDelay: 0.50s)
14:36:35 DEB [utils    _api_req 2245] Tree Owner Name API: Rate limit wait: 0.48s (Attempt 1)
14:36:35 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'Browser:meexp-uhome', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-32bd15d...f0-01', 'tracestate': '2611750@nr...95006', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:36:35 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:36:35 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Tree Owner Name API'] >>> Calling requests.request...
14:36:35 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Tree Owner Name API'] <<< requests.request returned.
14:36:35 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:36:35 DEB [utils    get_tree 1683] Found tree owner 'Wayne Gault' for tree ID 175946702.
14:36:35 INF [utils    _retriev 1203] Tree owner name: Wayne Gault
14:36:35 DEB [utils    _retriev 1205] TRACE: Exiting _retrieve_tree_owner (success)
14:36:35 DEB [utils    ensure_s 772 ] [Patch] Identifiers after fetch: profile_id=07BDD45E-0006-0000-0000-000000000000, uuid=FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7, tree_id=175946702
14:36:35 DEB [utils    ensure_s 773 ] [Patch] Tree owner name after fetch: Wayne Gault
14:36:35 DEB [utils    ensure_s 777 ] TRACE: Set self.session_ready to: True
14:36:35 DEB [utils    ensure_s 779 ] TRACE: Exiting ensure_session_ready (returning True)
14:36:35 INF [api_util log_msg  967 ] - SessionManager.ensure_session_ready(): PASSED
14:36:35 INF [api_util log_msg  967 ] 
                                      --- Phase 2: Get Target Info & Tree-Specific Person ID ---
14:36:35 INF [api_util log_msg  967 ] - Target Profile ID (TESTING_PROFILE_ID): 08FA6E79-0006-0000-0000-000000000000
14:36:35 INF [api_util log_msg  967 ] - Target Tree ID (MY_TREE_ID): 175946702
14:36:35 INF [api_util log_msg  967 ] - Target Owner Name: Wayne Gault
14:36:35 INF [api_util log_msg  967 ] - Getting target details from Profile API: https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000
14:36:35 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000 (Timeout: 60s, AllowRedirects: True)
14:36:35 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:36:35 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:36:35 DEB [utils    _api_req 2172] Get Target Name/Details: Cookies synced (Attempt 1).
14:36:35 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.512s (CurrentDelay: 0.50s)
14:36:36 DEB [utils    _api_req 2245] Get Target Name/Details: Rate limit wait: 0.51s (Attempt 1)
14:36:36 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get Target Name/Details'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-db30b79...23-01', 'tracestate': '2611750@nr...95839', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:36:36 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get Target Name/Details'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:36:36 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get Target Name/Details'] >>> Calling requests.request...
14:36:36 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get Target Name/Details'] <<< requests.request returned.
14:36:36 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:36:36 INF [api_util log_msg  967 ] - Target Details found: Name='Frances Mc Hardy', First='Frances', Last='Mc Hardy'
14:36:36 INF [api_util log_msg  967 ] - Searching for 'Frances Mc Hardy' in tree 175946702 via Person Picker API: https://www.ancestry.co.uk/api/person-picker/suggest/175946702?partialFirstName=Frances&partialLastName=Mc%20Hardy
14:36:36 DEB [utils    _api_req 2130] Applied 1 explicit header overrides for Person Picker Suggest API (Self Check).
14:36:36 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/person-picker/suggest/175946702?partialFirstName=Frances&partialLastName=Mc%20Hardy (Timeout: 20s, AllowRedirects: True)
14:36:36 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:36:36 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:36:36 DEB [utils    _api_req 2172] Person Picker Suggest API (Self Check): Cookies synced (Attempt 1).
14:36:36 DEB [utils    _api_req 2233] Person Picker Suggest API (Self Check): Added X-CSRF-Token header (Attempt 1).
14:36:36 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.529s (CurrentDelay: 0.50s)
14:36:37 DEB [utils    _api_req 2245] Person Picker Suggest API (Self Check): Rate limit wait: 0.53s (Attempt 1)
14:36:37 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Person Picker Suggest API (Self Check)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-a45e4eb...86-01', 'tracestate': '2611750@nr...96870', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000', 'X-CSRF-Token': 'b0542ea2d8...1568e'}
14:36:37 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Person Picker Suggest API (Self Check)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:36:37 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Person Picker Suggest API (Self Check)'] >>> Calling requests.request...
14:38:01 DEB [utils    _api_req 2381] [_api_req Attempt 1 for 'Person Picker Suggest API (Self Check)'] <<< requests.request raised ConnectionError
14:38:01 WAR [utils    _api_req 2398] Person Picker Suggest API (Self Check): ConnectionError (Attempt 1/3). Retrying in 0.64s... Error: HTTPSConnectionPool(host='www.ancestry.co.uk', port=443): Max retries exceeded with url: /api/person-picker/suggest/175946702?partialFirstName=Frances&partialLastName=Mc%20Hardy (Caused by ReadTimeoutError("HTTPSConnectionPool(host='www.ancestry.co.uk', port=443): Read timed out. (read timeout=20)"))
14:38:01 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:38:01 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:38:01 DEB [utils    _api_req 2172] Person Picker Suggest API (Self Check): Cookies synced (Attempt 2).
14:38:01 DEB [utils    _api_req 2233] Person Picker Suggest API (Self Check): Added X-CSRF-Token header (Attempt 2).
14:38:01 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.570s (CurrentDelay: 0.50s)
14:38:02 DEB [utils    _api_req 2245] Person Picker Suggest API (Self Check): Rate limit wait: 0.57s (Attempt 2)
14:38:02 DEB [utils    _api_req 2268] [_api_req Attempt 2 for 'Person Picker Suggest API (Self Check)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-b324cfa...75-01', 'tracestate': '2611750@nr...81809', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000', 'X-CSRF-Token': 'b0542ea2d8...1568e'}
14:38:02 DEB [utils    _api_req 2274] [_api_req Attempt 2 for 'Person Picker Suggest API (Self Check)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:38:02 DEB [utils    _api_req 2284] [_api_req Attempt 2 for 'Person Picker Suggest API (Self Check)'] >>> Calling requests.request...
14:39:26 DEB [utils    _api_req 2381] [_api_req Attempt 2 for 'Person Picker Suggest API (Self Check)'] <<< requests.request raised ConnectionError
14:39:26 WAR [utils    _api_req 2398] Person Picker Suggest API (Self Check): ConnectionError (Attempt 2/3). Retrying in 1.72s... Error: HTTPSConnectionPool(host='www.ancestry.co.uk', port=443): Max retries exceeded with url: /api/person-picker/suggest/175946702?partialFirstName=Frances&partialLastName=Mc%20Hardy (Caused by ReadTimeoutError("HTTPSConnectionPool(host='www.ancestry.co.uk', port=443): Read timed out. (read timeout=20)"))
14:39:28 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:39:28 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:39:28 DEB [utils    _api_req 2172] Person Picker Suggest API (Self Check): Cookies synced (Attempt 3).
14:39:28 DEB [utils    _api_req 2233] Person Picker Suggest API (Self Check): Added X-CSRF-Token header (Attempt 3).
14:39:28 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.479s (CurrentDelay: 0.50s)
14:39:28 DEB [utils    _api_req 2245] Person Picker Suggest API (Self Check): Rate limit wait: 0.48s (Attempt 3)
14:39:28 DEB [utils    _api_req 2268] [_api_req Attempt 3 for 'Person Picker Suggest API (Self Check)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-8676d0d...cf-01', 'tracestate': '2611750@nr...68064', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000', 'X-CSRF-Token': 'b0542ea2d8...1568e'}
14:39:28 DEB [utils    _api_req 2274] [_api_req Attempt 3 for 'Person Picker Suggest API (Self Check)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:39:28 DEB [utils    _api_req 2284] [_api_req Attempt 3 for 'Person Picker Suggest API (Self Check)'] >>> Calling requests.request...
14:40:52 DEB [utils    _api_req 2381] [_api_req Attempt 3 for 'Person Picker Suggest API (Self Check)'] <<< requests.request raised ConnectionError
14:40:52 ERR [utils    _api_req 2388] Person Picker Suggest API (Self Check): ConnectionError failed after 3 attempts. Error: HTTPSConnectionPool(host='www.ancestry.co.uk', port=443): Max retries exceeded with url: /api/person-picker/suggest/175946702?partialFirstName=Frances&partialLastName=Mc%20Hardy (Caused by ReadTimeoutError("HTTPSConnectionPool(host='www.ancestry.co.uk', port=443): Read timed out. (read timeout=20)"))
14:40:52 ERR [api_util log_msg  963 ] - Person Picker API call: FAILED (Returned None - likely timeout after 20s)
14:40:52 ERR [api_util log_msg  963 ] Could not determine tree-specific Person ID. Subsequent tests requiring it will be skipped.
14:40:52 INF [api_util log_msg  967 ] 
                                      --- Phase 3: Test parse_ancestry_person_details (Profile Details API) ---
14:40:52 INF [api_util log_msg  967 ] - Using Profile Details API response from Phase 2.
14:40:52 DEB [api_util parse_an 422 ] Parsed API details for 'Frances Mc Hardy': ID=08FA6E79-0006-0000-0000-000000000000, Tree=175946702, Born='N/A' in 'None', Died='N/A' in 'None', Gender='None', Living=None
14:40:52 INF [api_util log_msg  967 ] - parse_ancestry_person_details call: SUCCESS
14:40:52 INF [api_util log_msg  967 ] - Parsed Details Validation: PASSED (Name: 'Frances Mc Hardy', Link: https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/08FA6E79-0006-0000-0000-000000000000/facts)
14:40:52 INF [api_util log_msg  967 ] 
                                      --- Phase 4: Test Relationship Ladder Parsing (using /getladder) ---
14:40:52 WAR [api_util log_msg  965 ] - Skipping Relationship Ladder test: Missing required info (Target Person ID).
14:40:52 INF [api_util log_msg  967 ] 
                                      --- Finalizing: Closing Session ---
14:40:52 DEB [utils    close_se 1889] Attempting to close WebDriver session...
14:40:52 DEB [utils    close_se 1892] WebDriver session quit successfully.
14:40:52 DEB [utils    close_se 1903] Closing database connection pool...
14:40:52 DEB [utils    cls_db_c 1509] SessionManager ID=83533776 cls_db_conn called (keep_db=False). Disposing Engine ID: 116800784
14:40:52 DEB [utils    cls_db_c 1514] Engine ID=116800784 disposed successfully.
14:40:52 ERR [api_util self_che 1578] api_utils self-check status: FAIL
14:40:52 DEB [cache    close_ca 261 ] Closing DiskCache connection...
14:40:52 DEB [cache    close_ca 263 ] DiskCache connection closed.
14:45:38 INF [api_util log_msg  983 ] 
                                      [api_utils.py self-check starting...]
14:45:38 INF [api_util log_msg  983 ] 
                                      --- Phase 0: Prerequisite Checks ---
14:45:38 INF [api_util log_msg  983 ] - BeautifulSoup Import: OK
14:45:38 INF [api_util log_msg  983 ] - format_name Import/Fallback: OK
14:45:38 INF [api_util log_msg  983 ] - ordinal_case Import/Fallback: OK
14:45:38 INF [api_util log_msg  983 ] - _parse_date Import/Fallback: OK
14:45:38 INF [api_util log_msg  983 ] - _clean_display_date Import/Fallback: OK
14:45:38 ERR [api_util log_msg  979 ] - Config Check: TESTING_PERSON_ID missing or empty (Required for Ladder Test). FAILED
14:45:38 ERR [api_util log_msg  979 ] Prerequisite checks failed. Cannot proceed with live tests.
14:45:38 DEB [cache    close_ca 261 ] Closing DiskCache connection...
14:45:38 DEB [cache    close_ca 263 ] DiskCache connection closed.
14:56:15 INF [api_util log_msg  984 ] 
                                      [api_utils.py self-check starting...]
14:56:15 INF [api_util log_msg  984 ] 
                                      --- Phase 0: Prerequisite Checks ---
14:56:15 INF [api_util log_msg  984 ] - BeautifulSoup Import: OK
14:56:15 INF [api_util log_msg  984 ] - format_name Import/Fallback: OK
14:56:15 INF [api_util log_msg  984 ] - ordinal_case Import/Fallback: OK
14:56:15 INF [api_util log_msg  984 ] - _parse_date Import/Fallback: OK
14:56:15 INF [api_util log_msg  984 ] - _clean_display_date Import/Fallback: OK
14:56:15 INF [api_util log_msg  984 ] - Config Check: Essential credentials/URLs/IDs present.
14:56:15 INF [api_util log_msg  984 ] 
                                      --- Phase 1: Session Setup & Login ---
14:56:15 DEB [utils    __init__ 619 ] Initialized shared requests.Session with HTTPAdapter.
14:56:15 DEB [utils    __init__ 634 ] Initialized shared cloudscraper instance with retry strategy.
14:56:15 DEB [utils    __init__ 474 ] RateLimiter Init: Capacity=10.0, FillRate=2.0/s, InitialDelay=0.50s, Backoff=1.80, Decrease=0.98
14:56:15 DEB [utils    __init__ 645 ] SessionManager instance created: ID=110941952
                                      
14:56:15 DEB [utils    start_se 649 ] --- SessionManager Phase 1: Starting Driver (api_utils Self Check Start) ---
                                      
14:56:15 DEB [utils    _initial 986 ] SessionManager ID=110941952 initializing SQLAlchemy Engine/Session...
14:56:15 DEB [utils    _initial 1001] DB Path: C:\Users\wayne\GitHub\Python\Projects\Ancestry\Data\ancestry.db
14:56:15 DEB [utils    _initial 1035] DB Pool Config: Size=10, MaxOverflow=5, Timeout=30
14:56:15 DEB [utils    _initial 1047] Created NEW SQLAlchemy engine: ID=116662848 for SM ID=110941952
14:56:15 DEB [utils    _initial 1064] Created Session factory for Engine ID=116662848
14:56:15 DEB [utils    enable_s 1057] SQLite PRAGMA settings applied (WAL, Foreign Keys).
14:56:15 DEB [database _create_ 310 ] Executing CREATE VIEW statement for 'messages' view...
14:56:15 DEB [database _create_ 313 ] Database view 'messages' created or already exists.
14:56:15 DEB [utils    _initial 1067] DB tables checked/created successfully.
14:56:15 DEB [utils    start_se 676 ] Initializing WebDriver instance (using init_webdvr)...
14:56:15 DEB [chromedr init_web 175 ] WebDriver initialization attempt 1/3...
14:56:15 INF [chromedr init_web 192 ] User data directory (no --profile-directory):
                                      C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
14:56:15 DEB [chromedr init_web 203 ] Using browser executable:
                                      C:\Program Files\Google\Chrome\Application\chrome.exe
14:56:15 DEB [chromedr init_web 220 ] Setting User-Agent:
                                      Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
14:56:15 DEB [chromedr init_web 229 ] Letting undetected_chromedriver auto-manage ChromeDriver version (self-patching mode).
14:56:15 INF [chromedr init_web 231 ] [init_webdvr] Attempting uc.Chrome() self-patching (attempt 1)...
14:56:18 INF [chromedr init_web 234 ] [init_webdvr] uc.Chrome() self-patching succeeded in 2.54s (attempt 1)
14:56:18 DEB [chromedr init_web 235 ] WebDriver instance object potentially created (attempt 1).
14:56:18 DEB [chromedr init_web 277 ] User-Agent override applied via CDP.
14:56:18 DEB [chromedr init_web 282 ] Attempting to minimize window (non-headless mode)...
14:56:18 DEB [chromedr init_web 285 ] Browser window minimized.
14:56:18 DEB [chromedr init_web 309 ] WebDriver instance fully configured successfully (attempt 1).
14:56:18 DEB [utils    start_se 684 ] WebDriver initialization successful.
14:56:18 DEB [utils    start_se 685 ] Navigating to Base URL (https://www.ancestry.co.uk/) to stabilize...
14:56:18 DEB [utils    nav_to_p 3516] Navigation Attempt 1/3 to: https://www.ancestry.co.uk/
14:56:18 DEB [utils    nav_to_p 3539] Executing driver.get('https://www.ancestry.co.uk/')...
14:56:20 DEB [utils    nav_to_p 3552] Landed on URL base: https://www.ancestry.co.uk
14:56:22 DEB [utils    nav_to_p 3647] On correct URL base. Waiting up to 20s for selector: 'body'
14:56:22 DEB [utils    nav_to_p 3654] Navigation successful and element 'body' found on:
                                      https://www.ancestry.co.uk/
14:56:22 DEB [utils    start_se 698 ] Initial navigation to Base URL successful.
14:56:22 DEB [utils    start_se 702 ] --- SessionManager Phase 1: Driver Start Successful ---
14:56:22 INF [api_util log_msg  984 ] - SessionManager.start_sess(): PASSED
14:56:22 DEB [utils    ensure_s 737 ] TRACE: Entered ensure_session_ready
14:56:22 DEB [utils    ensure_d 723 ] Driver already live (Action: api_utils Self Check Ready - Ensure Driver).
14:56:22 DEB [utils    ensure_s 746 ] TRACE: About to call _perform_readiness_checks
14:56:22 DEB [utils    ensure_s 749 ] TRACE: Calling _perform_readiness_checks
14:56:22 DEB [utils    _perform 795 ] Performing readiness checks (action=api_utils Self Check Ready - Readiness Checks)...
14:56:22 INF [utils    _perform 815 ] [Persistence] Chrome user data directory is present: C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
14:56:22 DEB [utils    login_st 3391] Checking login status (API prioritized)...
14:56:22 DEB [utils    login_st 3404] Attempting API login verification (_verify_api_login_status)...
14:56:22 DEB [utils    _verify_ 1730] Verifying login status via API endpoint: https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna...
14:56:22 DEB [utils    _verify_ 1737] Syncing cookies before API login check...
14:56:22 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:56:22 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:56:22 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
14:56:22 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:56:22 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:56:22 DEB [utils    _api_req 2172] API Login Verification (header/dna): Cookies synced (Attempt 1).
14:56:22 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.540s (CurrentDelay: 0.50s)
14:56:23 DEB [utils    _api_req 2245] API Login Verification (header/dna): Rate limit wait: 0.54s (Attempt 1)
14:56:23 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-19647f8...48-01', 'tracestate': '2611750@nr...82782', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:56:23 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:56:23 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] >>> Calling requests.request...
14:56:24 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] <<< requests.request returned.
14:56:24 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:56:24 DEB [utils    _verify_ 1769] API Login Verification (header/dna): API login check successful ('testId' found).
14:56:24 DEB [utils    login_st 3407] Login status confirmed TRUE via API check.
14:56:24 DEB [utils    _perform 892 ] Checking/Handling current URL...
14:56:24 DEB [utils    _check_a 1089] Current URL for check: https://www.ancestry.co.uk/
14:56:24 DEB [utils    _check_a 1126] Current URL is suitable, no extra navigation needed.
14:56:24 DEB [utils    _perform 896 ] URL check/handling OK.
14:56:24 DEB [utils    _perform 899 ] Verifying essential cookies...
14:56:24 DEB [utils    get_cook 1255] Waiting up to 5s for cookies: ['ANCSESSIONID', 'SecureATT']...
14:56:24 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
14:56:24 DEB [utils    _perform 908 ] Essential cookies OK.
14:56:24 DEB [utils    _perform 911 ] Syncing cookies to requests session...
14:56:24 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:56:24 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:56:24 DEB [utils    _perform 913 ] Cookies synced.
14:56:24 DEB [utils    _perform 916 ] Ensuring CSRF token...
14:56:24 DEB [utils    get_csrf 1215] Attempting to fetch fresh CSRF token from: https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken
14:56:24 DEB [utils    get_cook 1255] Waiting up to 10s for cookies: ['ANCSESSIONID', 'SecureATT']...
14:56:24 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
14:56:24 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken (Timeout: 60s, AllowRedirects: True)
14:56:24 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:56:24 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:56:24 DEB [utils    _api_req 2172] CSRF Token API: Cookies synced (Attempt 1).
14:56:24 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.493s (CurrentDelay: 0.50s)
14:56:24 DEB [utils    _api_req 2245] CSRF Token API: Rate limit wait: 0.49s (Attempt 1)
14:56:24 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'CSRF Token API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-8036d85...18-01', 'tracestate': '2611750@nr...84098', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:56:24 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'CSRF Token API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:56:24 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'CSRF Token API'] >>> Calling requests.request...
14:56:25 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'CSRF Token API'] <<< requests.request returned.
14:56:25 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
14:56:25 DEB [utils    get_csrf 1233] CSRF token successfully retrieved (Length: 144).
14:56:25 DEB [utils    _perform 924 ] CSRF token OK.
14:56:25 INF [utils    _perform 927 ] Readiness checks PASSED on attempt 1.
14:56:25 DEB [utils    ensure_s 752 ] TRACE: _perform_readiness_checks returned: True
14:56:25 DEB [utils    ensure_s 767 ] [Patch] Attempting to retrieve identifiers and tree owner after readiness checks...
14:56:25 DEB [utils    _retriev 1131] TRACE: Entered _retrieve_identifiers
14:56:25 DEB [utils    _retriev 1135] Retrieving profile ID (ucdmid)...
14:56:25 DEB [utils    get_my_p 1531] Attempting to fetch own profile ID (ucdmid)...
14:56:25 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/cdp-p13n/api/v1/users/me?attributes=ucdmid (Timeout: 60s, AllowRedirects: True)
14:56:25 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:56:25 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:56:25 DEB [utils    _api_req 2172] Get my profile_id: Cookies synced (Attempt 1).
14:56:25 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.456s (CurrentDelay: 0.50s)
14:56:25 DEB [utils    _api_req 2245] Get my profile_id: Rate limit wait: 0.46s (Attempt 1)
14:56:25 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get my profile_id'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'p13n-js', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-5e336e8...95-01', 'tracestate': '2611750@nr...85023', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
14:56:25 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get my profile_id'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:56:25 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get my profile_id'] >>> Calling requests.request...
14:56:25 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get my profile_id'] <<< requests.request returned.
14:56:25 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
14:56:25 DEB [utils    get_my_p 1552] Successfully retrieved profile_id: 07BDD45E-0006-0000-0000-000000000000
14:56:25 INF [utils    _retriev 1141] My profile id: 07BDD45E-0006-0000-0000-000000000000
14:56:25 DEB [utils    _retriev 1147] Retrieving UUID (testId)...
14:56:25 DEB [utils    get_my_u 1569] Attempting to fetch own UUID (testId) from header/dna API...
14:56:25 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
14:56:25 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:56:25 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:56:25 DEB [utils    _api_req 2172] Get UUID API: Cookies synced (Attempt 1).
14:56:25 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.421s (CurrentDelay: 0.50s)
14:56:26 DEB [utils    _api_req 2245] Get UUID API: Rate limit wait: 0.42s (Attempt 1)
14:56:26 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get UUID API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-f8d09ee...af-01', 'tracestate': '2611750@nr...85950', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:56:26 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get UUID API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:56:26 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get UUID API'] >>> Calling requests.request...
14:56:26 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get UUID API'] <<< requests.request returned.
14:56:26 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:56:26 DEB [utils    get_my_u 1581] Successfully retrieved UUID: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
14:56:26 INF [utils    _retriev 1153] My uuid: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
14:56:26 DEB [utils    _retriev 1159] Retrieving tree ID for tree name: 'Gault Family'...
14:56:26 DEB [utils    get_my_t 1604] Attempting to fetch tree ID for TREE_NAME='Gault Family'...
14:56:26 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/trees (Timeout: 60s, AllowRedirects: True)
14:56:26 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:56:26 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:56:26 DEB [utils    _api_req 2172] Header Trees API: Cookies synced (Attempt 1).
14:56:26 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.515s (CurrentDelay: 0.50s)
14:56:27 DEB [utils    _api_req 2245] Header Trees API: Rate limit wait: 0.51s (Attempt 1)
14:56:27 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Header Trees API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-32cf48d...51-01', 'tracestate': '2611750@nr...86844', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:56:27 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Header Trees API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:56:27 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Header Trees API'] >>> Calling requests.request...
14:56:27 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Header Trees API'] <<< requests.request returned.
14:56:27 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:56:27 DEB [utils    get_my_t 1628] Found tree ID '175946702' for tree 'Gault Family'.
14:56:27 INF [utils    _retriev 1169] My tree id: 175946702
14:56:27 DEB [utils    _retriev 1176] TRACE: Exiting _retrieve_identifiers
14:56:27 DEB [utils    _retriev 1182] TRACE: Entered _retrieve_tree_owner
14:56:27 DEB [utils    _retriev 1191] Retrieving tree owner name...
14:56:27 DEB [utils    get_tree 1668] Attempting to fetch tree owner name for tree ID: 175946702...
14:56:27 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/user/tree-info?tree_id=175946702 (Timeout: 60s, AllowRedirects: True)
14:56:27 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:56:27 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:56:27 DEB [utils    _api_req 2172] Tree Owner Name API: Cookies synced (Attempt 1).
14:56:27 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.512s (CurrentDelay: 0.50s)
14:56:28 DEB [utils    _api_req 2245] Tree Owner Name API: Rate limit wait: 0.51s (Attempt 1)
14:56:28 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'Browser:meexp-uhome', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-8c9947b...72-01', 'tracestate': '2611750@nr...87733', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:56:28 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:56:28 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Tree Owner Name API'] >>> Calling requests.request...
14:56:28 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Tree Owner Name API'] <<< requests.request returned.
14:56:28 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:56:28 DEB [utils    get_tree 1683] Found tree owner 'Wayne Gault' for tree ID 175946702.
14:56:28 INF [utils    _retriev 1203] Tree owner name: Wayne Gault
14:56:28 DEB [utils    _retriev 1205] TRACE: Exiting _retrieve_tree_owner (success)
14:56:28 DEB [utils    ensure_s 772 ] [Patch] Identifiers after fetch: profile_id=07BDD45E-0006-0000-0000-000000000000, uuid=FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7, tree_id=175946702
14:56:28 DEB [utils    ensure_s 773 ] [Patch] Tree owner name after fetch: Wayne Gault
14:56:28 DEB [utils    ensure_s 777 ] TRACE: Set self.session_ready to: True
14:56:28 DEB [utils    ensure_s 779 ] TRACE: Exiting ensure_session_ready (returning True)
14:56:28 INF [api_util log_msg  984 ] - SessionManager.ensure_session_ready(): PASSED
14:56:28 INF [api_util log_msg  984 ] 
                                      --- Phase 2: Get Target Info & Validate Config ---
14:56:28 INF [api_util log_msg  984 ] - Target Profile ID (TESTING_PROFILE_ID): 08FA6E79-0006-0000-0000-000000000000
14:56:28 INF [api_util log_msg  984 ] - Target Person ID (TESTING_PERSON_TREE_ID): 102281560544
14:56:28 INF [api_util log_msg  984 ] - Target Tree ID (MY_TREE_ID): 175946702
14:56:28 INF [api_util log_msg  984 ] - Target Owner Name: Wayne Gault
14:56:28 INF [api_util log_msg  984 ] - Getting target display name from Profile API: https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000
14:56:28 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000 (Timeout: 60s, AllowRedirects: True)
14:56:28 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:56:28 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:56:28 DEB [utils    _api_req 2172] Get Target Name (Profile Details): Cookies synced (Attempt 1).
14:56:28 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.511s (CurrentDelay: 0.50s)
14:56:29 DEB [utils    _api_req 2245] Get Target Name (Profile Details): Rate limit wait: 0.51s (Attempt 1)
14:56:29 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'express-fe', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-37cead1...9f-01', 'tracestate': '2611750@nr...88615', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:56:29 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:56:29 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] >>> Calling requests.request...
14:56:29 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] <<< requests.request returned.
14:56:29 DEB [utils    _api_req 2304] <-- Response Status: 200 
14:56:29 INF [api_util log_msg  984 ] - Target Display Name found: 'Frances Mc Hardy'
14:56:29 INF [api_util log_msg  984 ] 
                                      --- Phase 3: Test parse_ancestry_person_details (Profile Details API) ---
14:56:29 INF [api_util log_msg  984 ] - Using Profile Details API response from Phase 2.
14:56:29 DEB [api_util parse_an 433 ] Parsed API details for 'Frances Mc Hardy': ID=08FA6E79-0006-0000-0000-000000000000, Tree=175946702, Born='N/A' in 'None', Died='N/A' in 'None', Gender='None', Living=None
14:56:29 INF [api_util log_msg  984 ] - parse_ancestry_person_details call: SUCCESS
14:56:29 INF [api_util log_msg  984 ] - Parsed Details Validation: PASSED (Name: 'Frances Mc Hardy', Link: https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/08FA6E79-0006-0000-0000-000000000000/facts)
14:56:29 INF [api_util log_msg  984 ] 
                                      --- Phase 4: Test Relationship Ladder Parsing (using /getladder) ---
14:56:29 INF [api_util log_msg  984 ] - Calling Tree Relationship Ladder API: https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/102281560544/getladder
14:56:29 DEB [utils    _api_req 2130] Applied 2 explicit header overrides for Get Tree Ladder API (Self Check).
14:56:29 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/102281560544/getladder (Timeout: 20s, AllowRedirects: True)
14:56:29 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
14:56:29 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
14:56:29 DEB [utils    _api_req 2172] Get Tree Ladder API (Self Check): Cookies synced (Attempt 1).
14:56:29 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.589s (CurrentDelay: 0.50s)
14:56:30 DEB [utils    _api_req 2245] Get Tree Ladder API (Self Check): Rate limit wait: 0.59s (Attempt 1)
14:56:30 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get Tree Ladder API (Self Check)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'text/javascript, application/javascript, application/ecmascript, application/x-ecmascript, */*; q=0.01', 'Referer': 'https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/102281560544/facts', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'X-Requested-With': 'XMLHttpRequest', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-a7ff2eb...85-01', 'tracestate': '2611750@nr...89521', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
14:56:30 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get Tree Ladder API (Self Check)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
14:56:30 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get Tree Ladder API (Self Check)'] >>> Calling requests.request...
14:56:31 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get Tree Ladder API (Self Check)'] <<< requests.request returned.
14:56:31 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
14:56:31 INF [api_util log_msg  984 ] - Tree Ladder API call: SUCCESS (Received string)
14:56:31 INF [api_util log_msg  984 ] - Testing display_raw_relationship_ladder (internal logic)...
14:56:31 INF [api_util display_ 785 ] 
                                      --- Relationship between Wayne Gault and Frances Mc Hardy (API Report) ---
14:56:31 DEB [api_util display_ 817 ] Standard HTML regex failed, trying JSONP extraction...
14:56:31 WAR [api_util display_ 844 ] JSONDecodeError during JSONP extraction attempt: Extra data: line 1 column 3 (char 2)
14:56:31 DEB [api_util display_ 845 ] Content snippet during JSONP error: <!DOCTYPE html>
                                      <html lang="en-GB">
                                      <head><script>window.ancestry=window.ancestry||{};Object.defineProperties(window.ancestry,{userId:{value:"07bdd45e-0006-0000-0000-000000000000",writable:!1},country:{value:"GB",writable:!1},culture:{value:"en-GB",writable:!1},marketId:{value:5538,writable:!1},siteId:{value:0,writable:!1},mainOrigin:{value:"https://www.ancestry.co.uk",writable:!1}})</script><script>(()=>{let e=window.ancestry=window.ancestry||{};const n={necessary:!0,preference:["c6"],perform...
14:56:31 ERR [api_util display_ 850 ] Could not extract relationship ladder HTML from the API response (checked standard JSON and JSONP).
14:56:31 DEB [api_util display_ 853 ] Raw content snippet: <!DOCTYPE html>
                                      <html lang="en-GB">
                                      <head><script>window.ancestry=window.ancestry||{};Object.defineProperties(window.ancestry,{userId:{value:"07bdd45e-0006-0000-0000-000000000000",writable:!1},country:{value:"GB",writable:!1},culture:{value:"en-GB",writable:!1},marketId:{value:5538,writable:!1},siteId:{value:0,writable:!1},mainOrigin:{value:"https://www.ancestry.co.uk",writable:!1}})</script><script>(()=>{let e=window.ancestry=window.ancestry||{};const n={necessary:!0,preference:["c6"],perform...
14:56:31 INF [api_util log_msg  984 ] - display_raw_relationship_ladder execution: PASSED (No exceptions)
14:56:31 WAR [api_util log_msg  982 ] - Error during JSONP processing for format test: Extra data: line 1 column 3 (char 2)
14:56:31 INF [api_util log_msg  984 ] - Trying direct regex for HTML extraction...
14:56:31 ERR [api_util log_msg  980 ] - Skipping format_api_relationship_path test: Could not extract/decode HTML from response
14:56:31 INF [api_util log_msg  984 ] 
                                      --- Finalizing: Closing Session ---
14:56:31 DEB [utils    close_se 1889] Attempting to close WebDriver session...
14:56:31 DEB [utils    close_se 1892] WebDriver session quit successfully.
14:56:31 DEB [utils    close_se 1903] Closing database connection pool...
14:56:31 DEB [utils    cls_db_c 1509] SessionManager ID=110941952 cls_db_conn called (keep_db=False). Disposing Engine ID: 116662848
14:56:31 DEB [utils    cls_db_c 1514] Engine ID=116662848 disposed successfully.
14:56:31 ERR [api_util self_che 1501] api_utils self-check status: FAIL
14:56:31 DEB [cache    close_ca 261 ] Closing DiskCache connection...
14:56:31 DEB [cache    close_ca 263 ] DiskCache connection closed.
15:03:12 INF [api_util log_msg  973 ] 
                                      [api_utils.py self-check starting...]
15:03:12 INF [api_util log_msg  973 ] 
                                      --- Phase 0: Prerequisite Checks ---
15:03:12 INF [api_util log_msg  973 ] - BeautifulSoup Import: OK
15:03:12 INF [api_util log_msg  973 ] - format_name Import/Fallback: OK
15:03:12 INF [api_util log_msg  973 ] - ordinal_case Import/Fallback: OK
15:03:12 INF [api_util log_msg  973 ] - _parse_date Import/Fallback: OK
15:03:12 INF [api_util log_msg  973 ] - _clean_display_date Import/Fallback: OK
15:03:12 INF [api_util log_msg  973 ] - Config Check: Essential credentials/URLs/IDs present.
15:03:12 INF [api_util log_msg  973 ] 
                                      --- Phase 1: Session Setup & Login ---
15:03:12 DEB [utils    __init__ 619 ] Initialized shared requests.Session with HTTPAdapter.
15:03:12 DEB [utils    __init__ 634 ] Initialized shared cloudscraper instance with retry strategy.
15:03:12 DEB [utils    __init__ 474 ] RateLimiter Init: Capacity=10.0, FillRate=2.0/s, InitialDelay=0.50s, Backoff=1.80, Decrease=0.98
15:03:12 DEB [utils    __init__ 645 ] SessionManager instance created: ID=115662992
                                      
15:03:12 DEB [utils    start_se 649 ] --- SessionManager Phase 1: Starting Driver (api_utils Self Check Start) ---
                                      
15:03:12 DEB [utils    _initial 986 ] SessionManager ID=115662992 initializing SQLAlchemy Engine/Session...
15:03:12 DEB [utils    _initial 1001] DB Path: C:\Users\wayne\GitHub\Python\Projects\Ancestry\Data\ancestry.db
15:03:12 DEB [utils    _initial 1035] DB Pool Config: Size=10, MaxOverflow=5, Timeout=30
15:03:12 DEB [utils    _initial 1047] Created NEW SQLAlchemy engine: ID=117578000 for SM ID=115662992
15:03:12 DEB [utils    _initial 1064] Created Session factory for Engine ID=117578000
15:03:12 DEB [utils    enable_s 1057] SQLite PRAGMA settings applied (WAL, Foreign Keys).
15:03:12 DEB [database _create_ 310 ] Executing CREATE VIEW statement for 'messages' view...
15:03:12 DEB [database _create_ 313 ] Database view 'messages' created or already exists.
15:03:12 DEB [utils    _initial 1067] DB tables checked/created successfully.
15:03:12 DEB [utils    start_se 676 ] Initializing WebDriver instance (using init_webdvr)...
15:03:12 DEB [chromedr init_web 175 ] WebDriver initialization attempt 1/3...
15:03:12 INF [chromedr init_web 192 ] User data directory (no --profile-directory):
                                      C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
15:03:12 DEB [chromedr init_web 203 ] Using browser executable:
                                      C:\Program Files\Google\Chrome\Application\chrome.exe
15:03:12 DEB [chromedr init_web 220 ] Setting User-Agent:
                                      Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
15:03:12 DEB [chromedr init_web 229 ] Letting undetected_chromedriver auto-manage ChromeDriver version (self-patching mode).
15:03:12 INF [chromedr init_web 231 ] [init_webdvr] Attempting uc.Chrome() self-patching (attempt 1)...
15:03:14 INF [chromedr init_web 234 ] [init_webdvr] uc.Chrome() self-patching succeeded in 2.37s (attempt 1)
15:03:14 DEB [chromedr init_web 235 ] WebDriver instance object potentially created (attempt 1).
15:03:14 DEB [chromedr init_web 277 ] User-Agent override applied via CDP.
15:03:14 DEB [chromedr init_web 282 ] Attempting to minimize window (non-headless mode)...
15:03:14 DEB [chromedr init_web 285 ] Browser window minimized.
15:03:14 DEB [chromedr init_web 309 ] WebDriver instance fully configured successfully (attempt 1).
15:03:14 DEB [utils    start_se 684 ] WebDriver initialization successful.
15:03:14 DEB [utils    start_se 685 ] Navigating to Base URL (https://www.ancestry.co.uk/) to stabilize...
15:03:14 DEB [utils    nav_to_p 3516] Navigation Attempt 1/3 to: https://www.ancestry.co.uk/
15:03:14 DEB [utils    nav_to_p 3539] Executing driver.get('https://www.ancestry.co.uk/')...
15:03:17 DEB [utils    nav_to_p 3552] Landed on URL base: https://www.ancestry.co.uk
15:03:20 DEB [utils    nav_to_p 3647] On correct URL base. Waiting up to 20s for selector: 'body'
15:03:20 DEB [utils    nav_to_p 3654] Navigation successful and element 'body' found on:
                                      https://www.ancestry.co.uk/
15:03:20 DEB [utils    start_se 698 ] Initial navigation to Base URL successful.
15:03:20 DEB [utils    start_se 702 ] --- SessionManager Phase 1: Driver Start Successful ---
15:03:20 INF [api_util log_msg  973 ] - SessionManager.start_sess(): PASSED
15:03:20 DEB [utils    ensure_s 737 ] TRACE: Entered ensure_session_ready
15:03:20 DEB [utils    ensure_d 723 ] Driver already live (Action: api_utils Self Check Ready - Ensure Driver).
15:03:20 DEB [utils    ensure_s 746 ] TRACE: About to call _perform_readiness_checks
15:03:20 DEB [utils    ensure_s 749 ] TRACE: Calling _perform_readiness_checks
15:03:20 DEB [utils    _perform 795 ] Performing readiness checks (action=api_utils Self Check Ready - Readiness Checks)...
15:03:20 INF [utils    _perform 815 ] [Persistence] Chrome user data directory is present: C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
15:03:20 DEB [utils    login_st 3391] Checking login status (API prioritized)...
15:03:20 DEB [utils    login_st 3404] Attempting API login verification (_verify_api_login_status)...
15:03:20 DEB [utils    _verify_ 1730] Verifying login status via API endpoint: https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna...
15:03:20 DEB [utils    _verify_ 1737] Syncing cookies before API login check...
15:03:20 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:03:20 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:03:20 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
15:03:20 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:03:20 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:03:20 DEB [utils    _api_req 2172] API Login Verification (header/dna): Cookies synced (Attempt 1).
15:03:20 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.455s (CurrentDelay: 0.50s)
15:03:20 DEB [utils    _api_req 2245] API Login Verification (header/dna): Rate limit wait: 0.46s (Attempt 1)
15:03:20 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-5a0bdd2...df-01', 'tracestate': '2611750@nr...00081', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
15:03:20 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:03:20 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] >>> Calling requests.request...
15:03:21 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] <<< requests.request returned.
15:03:21 DEB [utils    _api_req 2304] <-- Response Status: 200 
15:03:21 DEB [utils    _verify_ 1769] API Login Verification (header/dna): API login check successful ('testId' found).
15:03:21 DEB [utils    login_st 3407] Login status confirmed TRUE via API check.
15:03:21 DEB [utils    _perform 892 ] Checking/Handling current URL...
15:03:21 DEB [utils    _check_a 1089] Current URL for check: https://www.ancestry.co.uk/
15:03:21 DEB [utils    _check_a 1126] Current URL is suitable, no extra navigation needed.
15:03:21 DEB [utils    _perform 896 ] URL check/handling OK.
15:03:21 DEB [utils    _perform 899 ] Verifying essential cookies...
15:03:21 DEB [utils    get_cook 1255] Waiting up to 5s for cookies: ['ANCSESSIONID', 'SecureATT']...
15:03:21 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
15:03:21 DEB [utils    _perform 908 ] Essential cookies OK.
15:03:21 DEB [utils    _perform 911 ] Syncing cookies to requests session...
15:03:21 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:03:21 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:03:21 DEB [utils    _perform 913 ] Cookies synced.
15:03:21 DEB [utils    _perform 916 ] Ensuring CSRF token...
15:03:21 DEB [utils    get_csrf 1215] Attempting to fetch fresh CSRF token from: https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken
15:03:21 DEB [utils    get_cook 1255] Waiting up to 10s for cookies: ['ANCSESSIONID', 'SecureATT']...
15:03:21 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
15:03:21 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken (Timeout: 60s, AllowRedirects: True)
15:03:21 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:03:21 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:03:21 DEB [utils    _api_req 2172] CSRF Token API: Cookies synced (Attempt 1).
15:03:21 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.492s (CurrentDelay: 0.50s)
15:03:21 DEB [utils    _api_req 2245] CSRF Token API: Rate limit wait: 0.49s (Attempt 1)
15:03:21 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'CSRF Token API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-66b9e68...1c-01', 'tracestate': '2611750@nr...01258', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
15:03:21 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'CSRF Token API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:03:21 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'CSRF Token API'] >>> Calling requests.request...
15:03:22 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'CSRF Token API'] <<< requests.request returned.
15:03:22 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
15:03:22 DEB [utils    get_csrf 1233] CSRF token successfully retrieved (Length: 144).
15:03:22 DEB [utils    _perform 924 ] CSRF token OK.
15:03:22 INF [utils    _perform 927 ] Readiness checks PASSED on attempt 1.
15:03:22 DEB [utils    ensure_s 752 ] TRACE: _perform_readiness_checks returned: True
15:03:22 DEB [utils    ensure_s 767 ] [Patch] Attempting to retrieve identifiers and tree owner after readiness checks...
15:03:22 DEB [utils    _retriev 1131] TRACE: Entered _retrieve_identifiers
15:03:22 DEB [utils    _retriev 1135] Retrieving profile ID (ucdmid)...
15:03:22 DEB [utils    get_my_p 1531] Attempting to fetch own profile ID (ucdmid)...
15:03:22 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/cdp-p13n/api/v1/users/me?attributes=ucdmid (Timeout: 60s, AllowRedirects: True)
15:03:22 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:03:22 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:03:22 DEB [utils    _api_req 2172] Get my profile_id: Cookies synced (Attempt 1).
15:03:22 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.439s (CurrentDelay: 0.50s)
15:03:22 DEB [utils    _api_req 2245] Get my profile_id: Rate limit wait: 0.44s (Attempt 1)
15:03:22 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get my profile_id'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'p13n-js', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-da4589f...7b-01', 'tracestate': '2611750@nr...02344', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
15:03:22 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get my profile_id'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:03:22 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get my profile_id'] >>> Calling requests.request...
15:03:23 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get my profile_id'] <<< requests.request returned.
15:03:23 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
15:03:23 DEB [utils    get_my_p 1552] Successfully retrieved profile_id: 07BDD45E-0006-0000-0000-000000000000
15:03:23 INF [utils    _retriev 1141] My profile id: 07BDD45E-0006-0000-0000-000000000000
15:03:23 DEB [utils    _retriev 1147] Retrieving UUID (testId)...
15:03:23 DEB [utils    get_my_u 1569] Attempting to fetch own UUID (testId) from header/dna API...
15:03:23 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
15:03:23 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:03:23 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:03:23 DEB [utils    _api_req 2172] Get UUID API: Cookies synced (Attempt 1).
15:03:23 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.455s (CurrentDelay: 0.50s)
15:03:23 DEB [utils    _api_req 2245] Get UUID API: Rate limit wait: 0.46s (Attempt 1)
15:03:23 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get UUID API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-5efe61e...1a-01', 'tracestate': '2611750@nr...03274', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
15:03:23 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get UUID API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:03:23 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get UUID API'] >>> Calling requests.request...
15:03:24 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get UUID API'] <<< requests.request returned.
15:03:24 DEB [utils    _api_req 2304] <-- Response Status: 200 
15:03:24 DEB [utils    get_my_u 1581] Successfully retrieved UUID: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
15:03:24 INF [utils    _retriev 1153] My uuid: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
15:03:24 DEB [utils    _retriev 1159] Retrieving tree ID for tree name: 'Gault Family'...
15:03:24 DEB [utils    get_my_t 1604] Attempting to fetch tree ID for TREE_NAME='Gault Family'...
15:03:24 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/trees (Timeout: 60s, AllowRedirects: True)
15:03:24 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:03:24 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:03:24 DEB [utils    _api_req 2172] Header Trees API: Cookies synced (Attempt 1).
15:03:24 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.488s (CurrentDelay: 0.50s)
15:03:24 DEB [utils    _api_req 2245] Header Trees API: Rate limit wait: 0.49s (Attempt 1)
15:03:24 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Header Trees API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-eea7c8c...27-01', 'tracestate': '2611750@nr...04365', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
15:03:24 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Header Trees API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:03:24 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Header Trees API'] >>> Calling requests.request...
15:03:25 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Header Trees API'] <<< requests.request returned.
15:03:25 DEB [utils    _api_req 2304] <-- Response Status: 200 
15:03:25 DEB [utils    get_my_t 1628] Found tree ID '175946702' for tree 'Gault Family'.
15:03:25 INF [utils    _retriev 1169] My tree id: 175946702
15:03:25 DEB [utils    _retriev 1176] TRACE: Exiting _retrieve_identifiers
15:03:25 DEB [utils    _retriev 1182] TRACE: Entered _retrieve_tree_owner
15:03:25 DEB [utils    _retriev 1191] Retrieving tree owner name...
15:03:25 DEB [utils    get_tree 1668] Attempting to fetch tree owner name for tree ID: 175946702...
15:03:25 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/user/tree-info?tree_id=175946702 (Timeout: 60s, AllowRedirects: True)
15:03:25 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:03:25 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:03:25 DEB [utils    _api_req 2172] Tree Owner Name API: Cookies synced (Attempt 1).
15:03:25 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.567s (CurrentDelay: 0.50s)
15:03:25 DEB [utils    _api_req 2245] Tree Owner Name API: Rate limit wait: 0.57s (Attempt 1)
15:03:25 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'Browser:meexp-uhome', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-e12389f...d3-01', 'tracestate': '2611750@nr...05323', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
15:03:25 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:03:25 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Tree Owner Name API'] >>> Calling requests.request...
15:03:26 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Tree Owner Name API'] <<< requests.request returned.
15:03:26 DEB [utils    _api_req 2304] <-- Response Status: 200 
15:03:26 DEB [utils    get_tree 1683] Found tree owner 'Wayne Gault' for tree ID 175946702.
15:03:26 INF [utils    _retriev 1203] Tree owner name: Wayne Gault
15:03:26 DEB [utils    _retriev 1205] TRACE: Exiting _retrieve_tree_owner (success)
15:03:26 DEB [utils    ensure_s 772 ] [Patch] Identifiers after fetch: profile_id=07BDD45E-0006-0000-0000-000000000000, uuid=FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7, tree_id=175946702
15:03:26 DEB [utils    ensure_s 773 ] [Patch] Tree owner name after fetch: Wayne Gault
15:03:26 DEB [utils    ensure_s 777 ] TRACE: Set self.session_ready to: True
15:03:26 DEB [utils    ensure_s 779 ] TRACE: Exiting ensure_session_ready (returning True)
15:03:26 INF [api_util log_msg  973 ] - SessionManager.ensure_session_ready(): PASSED
15:03:26 INF [api_util log_msg  973 ] 
                                      --- Phase 2: Get Target Info & Validate Config ---
15:03:26 INF [api_util log_msg  973 ] - Target Profile ID (TESTING_PROFILE_ID): 08FA6E79-0006-0000-0000-000000000000
15:03:26 INF [api_util log_msg  973 ] - Target Tree ID (MY_TREE_ID): 175946702
15:03:26 INF [api_util log_msg  973 ] - Target Owner Name: Wayne Gault
15:03:26 INF [api_util log_msg  973 ] - Getting target display name from Profile API: https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000
15:03:26 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000 (Timeout: 60s, AllowRedirects: True)
15:03:26 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:03:26 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:03:26 DEB [utils    _api_req 2172] Get Target Name (Profile Details): Cookies synced (Attempt 1).
15:03:26 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.405s (CurrentDelay: 0.50s)
15:03:26 DEB [utils    _api_req 2245] Get Target Name (Profile Details): Rate limit wait: 0.41s (Attempt 1)
15:03:26 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'express-fe', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-9b8c7fe...87-01', 'tracestate': '2611750@nr...06393', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
15:03:26 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:03:26 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] >>> Calling requests.request...
15:03:27 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] <<< requests.request returned.
15:03:27 DEB [utils    _api_req 2304] <-- Response Status: 200 
15:03:27 INF [api_util log_msg  973 ] - Target Display Name found: 'Frances Mc Hardy'
15:03:27 INF [api_util log_msg  973 ] 
                                      --- Phase 3: Test parse_ancestry_person_details (Profile Details API) ---
15:03:27 INF [api_util log_msg  973 ] - Using Profile Details API response from Phase 2.
15:03:27 DEB [api_util parse_an 429 ] Parsed API details for 'Frances Mc Hardy': ID=08FA6E79-0006-0000-0000-000000000000, Tree=175946702, Born='N/A' in 'None', Died='N/A' in 'None', Gender='None', Living=None
15:03:27 INF [api_util log_msg  973 ] - parse_ancestry_person_details call: SUCCESS
15:03:27 INF [api_util log_msg  973 ] - Parsed Details Validation: PASSED (Name: 'Frances Mc Hardy', Link: https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/08FA6E79-0006-0000-0000-000000000000/facts)
15:03:27 INF [api_util log_msg  973 ] 
                                      --- Phase 4: Test Relationship Ladder Parsing (using DiscoveryUI) ---
15:03:27 INF [api_util log_msg  973 ] - Calling DiscoveryUI Relationship Ladder API: https://www.ancestry.co.uk/discoveryui-matches/ancestryrelationship/api/v1/relationship/ladder/08FA6E79-0006-0000-0000-000000000000
15:03:27 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/ancestryrelationship/api/v1/relationship/ladder/08FA6E79-0006-0000-0000-000000000000 (Timeout: 20s, AllowRedirects: True)
15:03:27 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:03:27 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:03:27 DEB [utils    _api_req 2172] Get Ladder API (Self Check): Cookies synced (Attempt 1).
15:03:27 DEB [utils    _api_req 2233] Get Ladder API (Self Check): Added X-CSRF-Token header (Attempt 1).
15:03:27 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.530s (CurrentDelay: 0.50s)
15:03:27 DEB [utils    _api_req 2245] Get Ladder API (Self Check): Rate limit wait: 0.53s (Attempt 1)
15:03:27 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get Ladder API (Self Check)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-1fbb73e...8f-01', 'tracestate': '2611750@nr...07278', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000', 'X-CSRF-Token': '717619b78f...78bdb'}
15:03:27 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get Ladder API (Self Check)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:03:27 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get Ladder API (Self Check)'] >>> Calling requests.request...
15:04:51 DEB [utils    _api_req 2381] [_api_req Attempt 1 for 'Get Ladder API (Self Check)'] <<< requests.request raised ConnectionError
15:04:51 WAR [utils    _api_req 2398] Get Ladder API (Self Check): ConnectionError (Attempt 1/3). Retrying in 0.67s... Error: HTTPSConnectionPool(host='www.ancestry.co.uk', port=443): Max retries exceeded with url: /discoveryui-matches/ancestryrelationship/api/v1/relationship/ladder/08FA6E79-0006-0000-0000-000000000000 (Caused by ReadTimeoutError("HTTPSConnectionPool(host='www.ancestry.co.uk', port=443): Read timed out. (read timeout=20)"))
15:04:52 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:04:52 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:04:52 DEB [utils    _api_req 2172] Get Ladder API (Self Check): Cookies synced (Attempt 2).
15:04:52 DEB [utils    _api_req 2233] Get Ladder API (Self Check): Added X-CSRF-Token header (Attempt 2).
15:04:52 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.459s (CurrentDelay: 0.50s)
15:04:52 DEB [utils    _api_req 2245] Get Ladder API (Self Check): Rate limit wait: 0.46s (Attempt 2)
15:04:52 DEB [utils    _api_req 2268] [_api_req Attempt 2 for 'Get Ladder API (Self Check)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-b718cb3...15-01', 'tracestate': '2611750@nr...92193', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000', 'X-CSRF-Token': '717619b78f...78bdb'}
15:04:52 DEB [utils    _api_req 2274] [_api_req Attempt 2 for 'Get Ladder API (Self Check)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:04:52 DEB [utils    _api_req 2284] [_api_req Attempt 2 for 'Get Ladder API (Self Check)'] >>> Calling requests.request...
15:06:16 DEB [utils    _api_req 2381] [_api_req Attempt 2 for 'Get Ladder API (Self Check)'] <<< requests.request raised ConnectionError
15:06:16 WAR [utils    _api_req 2398] Get Ladder API (Self Check): ConnectionError (Attempt 2/3). Retrying in 1.71s... Error: HTTPSConnectionPool(host='www.ancestry.co.uk', port=443): Max retries exceeded with url: /discoveryui-matches/ancestryrelationship/api/v1/relationship/ladder/08FA6E79-0006-0000-0000-000000000000 (Caused by ReadTimeoutError("HTTPSConnectionPool(host='www.ancestry.co.uk', port=443): Read timed out. (read timeout=20)"))
15:06:18 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:06:18 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:06:18 DEB [utils    _api_req 2172] Get Ladder API (Self Check): Cookies synced (Attempt 3).
15:06:18 DEB [utils    _api_req 2233] Get Ladder API (Self Check): Added X-CSRF-Token header (Attempt 3).
15:06:18 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.569s (CurrentDelay: 0.50s)
15:06:18 DEB [utils    _api_req 2245] Get Ladder API (Self Check): Rate limit wait: 0.57s (Attempt 3)
15:06:18 DEB [utils    _api_req 2268] [_api_req Attempt 3 for 'Get Ladder API (Self Check)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-6dd9788...6f-01', 'tracestate': '2611750@nr...78343', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000', 'X-CSRF-Token': '717619b78f...78bdb'}
15:06:18 DEB [utils    _api_req 2274] [_api_req Attempt 3 for 'Get Ladder API (Self Check)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:06:18 DEB [utils    _api_req 2284] [_api_req Attempt 3 for 'Get Ladder API (Self Check)'] >>> Calling requests.request...
15:07:42 DEB [utils    _api_req 2381] [_api_req Attempt 3 for 'Get Ladder API (Self Check)'] <<< requests.request raised ConnectionError
15:07:42 ERR [utils    _api_req 2388] Get Ladder API (Self Check): ConnectionError failed after 3 attempts. Error: HTTPSConnectionPool(host='www.ancestry.co.uk', port=443): Max retries exceeded with url: /discoveryui-matches/ancestryrelationship/api/v1/relationship/ladder/08FA6E79-0006-0000-0000-000000000000 (Caused by ReadTimeoutError("HTTPSConnectionPool(host='www.ancestry.co.uk', port=443): Read timed out. (read timeout=20)"))
15:07:42 ERR [api_util log_msg  969 ] - DiscoveryUI Ladder API call: FAILED (Returned None - likely timeout after 20s)
15:07:42 INF [api_util log_msg  973 ] 
                                      --- Finalizing: Closing Session ---
15:07:42 DEB [utils    close_se 1889] Attempting to close WebDriver session...
15:07:42 DEB [utils    close_se 1892] WebDriver session quit successfully.
15:07:42 DEB [utils    close_se 1903] Closing database connection pool...
15:07:42 DEB [utils    cls_db_c 1509] SessionManager ID=115662992 cls_db_conn called (keep_db=False). Disposing Engine ID: 117578000
15:07:42 DEB [utils    cls_db_c 1514] Engine ID=117578000 disposed successfully.
15:07:42 ERR [api_util self_che 1448] api_utils self-check status: FAIL
15:07:42 DEB [cache    close_ca 261 ] Closing DiskCache connection...
15:07:42 DEB [cache    close_ca 263 ] DiskCache connection closed.
15:14:27 INF [api_util log_msg  992 ] 
                                      [api_utils.py self-check starting...]
15:14:27 INF [api_util log_msg  992 ] 
                                      --- Phase 0: Prerequisite Checks ---
15:14:27 INF [api_util log_msg  992 ] - BeautifulSoup Import: OK
15:14:27 INF [api_util log_msg  992 ] - format_name Import/Fallback: OK
15:14:27 INF [api_util log_msg  992 ] - ordinal_case Import/Fallback: OK
15:14:27 INF [api_util log_msg  992 ] - _parse_date Import/Fallback: OK
15:14:27 INF [api_util log_msg  992 ] - _clean_display_date Import/Fallback: OK
15:14:27 INF [api_util log_msg  992 ] - Config Check: Essential credentials/URLs/IDs present.
15:14:27 INF [api_util log_msg  992 ] 
                                      --- Phase 1: Session Setup & Login ---
15:14:27 DEB [utils    __init__ 619 ] Initialized shared requests.Session with HTTPAdapter.
15:14:27 DEB [utils    __init__ 634 ] Initialized shared cloudscraper instance with retry strategy.
15:14:27 DEB [utils    __init__ 474 ] RateLimiter Init: Capacity=10.0, FillRate=2.0/s, InitialDelay=0.50s, Backoff=1.80, Decrease=0.98
15:14:27 DEB [utils    __init__ 645 ] SessionManager instance created: ID=115262624
                                      
15:14:27 DEB [utils    start_se 649 ] --- SessionManager Phase 1: Starting Driver (api_utils Self Check Start) ---
                                      
15:14:27 DEB [utils    _initial 986 ] SessionManager ID=115262624 initializing SQLAlchemy Engine/Session...
15:14:27 DEB [utils    _initial 1001] DB Path: C:\Users\wayne\GitHub\Python\Projects\Ancestry\Data\ancestry.db
15:14:27 DEB [utils    _initial 1035] DB Pool Config: Size=10, MaxOverflow=5, Timeout=30
15:14:27 DEB [utils    _initial 1047] Created NEW SQLAlchemy engine: ID=111692784 for SM ID=115262624
15:14:27 DEB [utils    _initial 1064] Created Session factory for Engine ID=111692784
15:14:27 DEB [utils    enable_s 1057] SQLite PRAGMA settings applied (WAL, Foreign Keys).
15:14:27 DEB [database _create_ 310 ] Executing CREATE VIEW statement for 'messages' view...
15:14:27 DEB [database _create_ 313 ] Database view 'messages' created or already exists.
15:14:27 DEB [utils    _initial 1067] DB tables checked/created successfully.
15:14:27 DEB [utils    start_se 676 ] Initializing WebDriver instance (using init_webdvr)...
15:14:28 DEB [chromedr cleanup_ 394 ] Cleaned 12 chrome processes.
15:14:28 DEB [chromedr init_web 175 ] WebDriver initialization attempt 1/3...
15:14:28 INF [chromedr init_web 192 ] User data directory (no --profile-directory):
                                      C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
15:14:28 DEB [chromedr init_web 203 ] Using browser executable:
                                      C:\Program Files\Google\Chrome\Application\chrome.exe
15:14:28 DEB [chromedr init_web 220 ] Setting User-Agent:
                                      Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
15:14:28 DEB [chromedr init_web 229 ] Letting undetected_chromedriver auto-manage ChromeDriver version (self-patching mode).
15:14:28 INF [chromedr init_web 231 ] [init_webdvr] Attempting uc.Chrome() self-patching (attempt 1)...
15:14:30 INF [chromedr init_web 234 ] [init_webdvr] uc.Chrome() self-patching succeeded in 2.49s (attempt 1)
15:14:30 DEB [chromedr init_web 235 ] WebDriver instance object potentially created (attempt 1).
15:14:30 DEB [chromedr init_web 277 ] User-Agent override applied via CDP.
15:14:30 DEB [chromedr init_web 282 ] Attempting to minimize window (non-headless mode)...
15:14:30 DEB [chromedr init_web 285 ] Browser window minimized.
15:14:30 DEB [chromedr init_web 309 ] WebDriver instance fully configured successfully (attempt 1).
15:14:30 DEB [utils    start_se 684 ] WebDriver initialization successful.
15:14:30 DEB [utils    start_se 685 ] Navigating to Base URL (https://www.ancestry.co.uk/) to stabilize...
15:14:30 DEB [utils    nav_to_p 3516] Navigation Attempt 1/3 to: https://www.ancestry.co.uk/
15:14:30 DEB [utils    nav_to_p 3539] Executing driver.get('https://www.ancestry.co.uk/')...
15:14:33 DEB [utils    nav_to_p 3552] Landed on URL base: https://www.ancestry.co.uk
15:14:35 DEB [utils    nav_to_p 3647] On correct URL base. Waiting up to 20s for selector: 'body'
15:14:35 DEB [utils    nav_to_p 3654] Navigation successful and element 'body' found on:
                                      https://www.ancestry.co.uk/
15:14:35 DEB [utils    start_se 698 ] Initial navigation to Base URL successful.
15:14:35 DEB [utils    start_se 702 ] --- SessionManager Phase 1: Driver Start Successful ---
15:14:35 INF [api_util log_msg  992 ] - SessionManager.start_sess(): PASSED
15:14:35 DEB [utils    ensure_s 737 ] TRACE: Entered ensure_session_ready
15:14:35 DEB [utils    ensure_d 723 ] Driver already live (Action: api_utils Self Check Ready - Ensure Driver).
15:14:35 DEB [utils    ensure_s 746 ] TRACE: About to call _perform_readiness_checks
15:14:35 DEB [utils    ensure_s 749 ] TRACE: Calling _perform_readiness_checks
15:14:35 DEB [utils    _perform 795 ] Performing readiness checks (action=api_utils Self Check Ready - Readiness Checks)...
15:14:35 INF [utils    _perform 815 ] [Persistence] Chrome user data directory is present: C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
15:14:35 DEB [utils    login_st 3391] Checking login status (API prioritized)...
15:14:35 DEB [utils    login_st 3404] Attempting API login verification (_verify_api_login_status)...
15:14:35 DEB [utils    _verify_ 1730] Verifying login status via API endpoint: https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna...
15:14:35 DEB [utils    _verify_ 1737] Syncing cookies before API login check...
15:14:35 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:14:35 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:14:35 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
15:14:35 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:14:35 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:14:35 DEB [utils    _api_req 2172] API Login Verification (header/dna): Cookies synced (Attempt 1).
15:14:35 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.522s (CurrentDelay: 0.50s)
15:14:36 DEB [utils    _api_req 2245] API Login Verification (header/dna): Rate limit wait: 0.52s (Attempt 1)
15:14:36 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-0141b38...a6-01', 'tracestate': '2611750@nr...75943', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
15:14:36 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:14:36 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] >>> Calling requests.request...
15:14:37 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] <<< requests.request returned.
15:14:37 DEB [utils    _api_req 2304] <-- Response Status: 200 
15:14:37 DEB [utils    _verify_ 1769] API Login Verification (header/dna): API login check successful ('testId' found).
15:14:37 DEB [utils    login_st 3407] Login status confirmed TRUE via API check.
15:14:37 DEB [utils    _perform 892 ] Checking/Handling current URL...
15:14:37 DEB [utils    _check_a 1089] Current URL for check: https://www.ancestry.co.uk/
15:14:37 DEB [utils    _check_a 1126] Current URL is suitable, no extra navigation needed.
15:14:37 DEB [utils    _perform 896 ] URL check/handling OK.
15:14:37 DEB [utils    _perform 899 ] Verifying essential cookies...
15:14:37 DEB [utils    get_cook 1255] Waiting up to 5s for cookies: ['ANCSESSIONID', 'SecureATT']...
15:14:37 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
15:14:37 DEB [utils    _perform 908 ] Essential cookies OK.
15:14:37 DEB [utils    _perform 911 ] Syncing cookies to requests session...
15:14:37 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:14:37 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:14:37 DEB [utils    _perform 913 ] Cookies synced.
15:14:37 DEB [utils    _perform 916 ] Ensuring CSRF token...
15:14:37 DEB [utils    get_csrf 1215] Attempting to fetch fresh CSRF token from: https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken
15:14:37 DEB [utils    get_cook 1255] Waiting up to 10s for cookies: ['ANCSESSIONID', 'SecureATT']...
15:14:37 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
15:14:37 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken (Timeout: 60s, AllowRedirects: True)
15:14:37 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:14:37 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:14:37 DEB [utils    _api_req 2172] CSRF Token API: Cookies synced (Attempt 1).
15:14:37 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.505s (CurrentDelay: 0.50s)
15:14:37 DEB [utils    _api_req 2245] CSRF Token API: Rate limit wait: 0.50s (Attempt 1)
15:14:37 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'CSRF Token API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-625518d...47-01', 'tracestate': '2611750@nr...77378', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
15:14:37 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'CSRF Token API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:14:37 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'CSRF Token API'] >>> Calling requests.request...
15:14:38 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'CSRF Token API'] <<< requests.request returned.
15:14:38 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
15:14:38 DEB [utils    get_csrf 1233] CSRF token successfully retrieved (Length: 144).
15:14:38 DEB [utils    _perform 924 ] CSRF token OK.
15:14:38 INF [utils    _perform 927 ] Readiness checks PASSED on attempt 1.
15:14:38 DEB [utils    ensure_s 752 ] TRACE: _perform_readiness_checks returned: True
15:14:38 DEB [utils    ensure_s 767 ] [Patch] Attempting to retrieve identifiers and tree owner after readiness checks...
15:14:38 DEB [utils    _retriev 1131] TRACE: Entered _retrieve_identifiers
15:14:38 DEB [utils    _retriev 1135] Retrieving profile ID (ucdmid)...
15:14:38 DEB [utils    get_my_p 1531] Attempting to fetch own profile ID (ucdmid)...
15:14:38 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/cdp-p13n/api/v1/users/me?attributes=ucdmid (Timeout: 60s, AllowRedirects: True)
15:14:38 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:14:38 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:14:38 DEB [utils    _api_req 2172] Get my profile_id: Cookies synced (Attempt 1).
15:14:38 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.530s (CurrentDelay: 0.50s)
15:14:38 DEB [utils    _api_req 2245] Get my profile_id: Rate limit wait: 0.53s (Attempt 1)
15:14:38 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get my profile_id'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'p13n-js', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-3ce2a24...4a-01', 'tracestate': '2611750@nr...78363', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
15:14:38 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get my profile_id'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:14:38 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get my profile_id'] >>> Calling requests.request...
15:14:39 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get my profile_id'] <<< requests.request returned.
15:14:39 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
15:14:39 DEB [utils    get_my_p 1552] Successfully retrieved profile_id: 07BDD45E-0006-0000-0000-000000000000
15:14:39 INF [utils    _retriev 1141] My profile id: 07BDD45E-0006-0000-0000-000000000000
15:14:39 DEB [utils    _retriev 1147] Retrieving UUID (testId)...
15:14:39 DEB [utils    get_my_u 1569] Attempting to fetch own UUID (testId) from header/dna API...
15:14:39 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
15:14:39 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:14:39 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:14:39 DEB [utils    _api_req 2172] Get UUID API: Cookies synced (Attempt 1).
15:14:39 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.401s (CurrentDelay: 0.50s)
15:14:39 DEB [utils    _api_req 2245] Get UUID API: Rate limit wait: 0.40s (Attempt 1)
15:14:39 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get UUID API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-08a9b6a...25-01', 'tracestate': '2611750@nr...79314', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
15:14:39 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get UUID API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:14:39 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get UUID API'] >>> Calling requests.request...
15:14:40 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get UUID API'] <<< requests.request returned.
15:14:40 DEB [utils    _api_req 2304] <-- Response Status: 200 
15:14:40 DEB [utils    get_my_u 1581] Successfully retrieved UUID: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
15:14:40 INF [utils    _retriev 1153] My uuid: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
15:14:40 DEB [utils    _retriev 1159] Retrieving tree ID for tree name: 'Gault Family'...
15:14:40 DEB [utils    get_my_t 1604] Attempting to fetch tree ID for TREE_NAME='Gault Family'...
15:14:40 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/trees (Timeout: 60s, AllowRedirects: True)
15:14:40 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:14:40 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:14:40 DEB [utils    _api_req 2172] Header Trees API: Cookies synced (Attempt 1).
15:14:40 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.453s (CurrentDelay: 0.50s)
15:14:40 DEB [utils    _api_req 2245] Header Trees API: Rate limit wait: 0.45s (Attempt 1)
15:14:40 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Header Trees API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-545122d...f4-01', 'tracestate': '2611750@nr...80281', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
15:14:40 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Header Trees API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:14:40 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Header Trees API'] >>> Calling requests.request...
15:14:41 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Header Trees API'] <<< requests.request returned.
15:14:41 DEB [utils    _api_req 2304] <-- Response Status: 200 
15:14:41 DEB [utils    get_my_t 1628] Found tree ID '175946702' for tree 'Gault Family'.
15:14:41 INF [utils    _retriev 1169] My tree id: 175946702
15:14:41 DEB [utils    _retriev 1176] TRACE: Exiting _retrieve_identifiers
15:14:41 DEB [utils    _retriev 1182] TRACE: Entered _retrieve_tree_owner
15:14:41 DEB [utils    _retriev 1191] Retrieving tree owner name...
15:14:41 DEB [utils    get_tree 1668] Attempting to fetch tree owner name for tree ID: 175946702...
15:14:41 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/user/tree-info?tree_id=175946702 (Timeout: 60s, AllowRedirects: True)
15:14:41 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:14:41 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:14:41 DEB [utils    _api_req 2172] Tree Owner Name API: Cookies synced (Attempt 1).
15:14:41 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.505s (CurrentDelay: 0.50s)
15:14:41 DEB [utils    _api_req 2245] Tree Owner Name API: Rate limit wait: 0.50s (Attempt 1)
15:14:41 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'Browser:meexp-uhome', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-062f0e5...25-01', 'tracestate': '2611750@nr...81196', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
15:14:41 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:14:41 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Tree Owner Name API'] >>> Calling requests.request...
15:14:42 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Tree Owner Name API'] <<< requests.request returned.
15:14:42 DEB [utils    _api_req 2304] <-- Response Status: 200 
15:14:42 DEB [utils    get_tree 1683] Found tree owner 'Wayne Gault' for tree ID 175946702.
15:14:42 INF [utils    _retriev 1203] Tree owner name: Wayne Gault
15:14:42 DEB [utils    _retriev 1205] TRACE: Exiting _retrieve_tree_owner (success)
15:14:42 DEB [utils    ensure_s 772 ] [Patch] Identifiers after fetch: profile_id=07BDD45E-0006-0000-0000-000000000000, uuid=FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7, tree_id=175946702
15:14:42 DEB [utils    ensure_s 773 ] [Patch] Tree owner name after fetch: Wayne Gault
15:14:42 DEB [utils    ensure_s 777 ] TRACE: Set self.session_ready to: True
15:14:42 DEB [utils    ensure_s 779 ] TRACE: Exiting ensure_session_ready (returning True)
15:14:42 INF [api_util log_msg  992 ] - SessionManager.ensure_session_ready(): PASSED
15:14:42 INF [api_util log_msg  992 ] 
                                      --- Phase 2: Get Target Info & Validate Config ---
15:14:42 INF [api_util log_msg  992 ] - Target Profile ID (TESTING_PROFILE_ID): 08FA6E79-0006-0000-0000-000000000000
15:14:42 INF [api_util log_msg  992 ] - Target Person ID (TESTING_PERSON_TREE_ID): 102281560544
15:14:42 INF [api_util log_msg  992 ] - Target Tree ID (MY_TREE_ID): 175946702
15:14:42 INF [api_util log_msg  992 ] - Target Owner Name: Wayne Gault
15:14:42 INF [api_util log_msg  992 ] - Getting target display name from Profile API: https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000
15:14:42 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000 (Timeout: 60s, AllowRedirects: True)
15:14:42 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:14:42 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:14:42 DEB [utils    _api_req 2172] Get Target Name (Profile Details): Cookies synced (Attempt 1).
15:14:42 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.465s (CurrentDelay: 0.50s)
15:14:42 DEB [utils    _api_req 2245] Get Target Name (Profile Details): Rate limit wait: 0.46s (Attempt 1)
15:14:42 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'express-fe', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-1daed08...bf-01', 'tracestate': '2611750@nr...82056', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
15:14:42 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:14:42 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] >>> Calling requests.request...
15:14:42 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] <<< requests.request returned.
15:14:42 DEB [utils    _api_req 2304] <-- Response Status: 200 
15:14:42 INF [api_util log_msg  992 ] - Target Display Name found: 'Frances Mc Hardy'
15:14:42 INF [api_util log_msg  992 ] 
                                      --- Phase 3: Test parse_ancestry_person_details (Profile Details API) ---
15:14:42 INF [api_util log_msg  992 ] - Using Profile Details API response from Phase 2.
15:14:42 DEB [api_util parse_an 435 ] Parsed API details for 'Frances Mc Hardy': ID=08FA6E79-0006-0000-0000-000000000000, Tree=175946702, Born='N/A' in 'None', Died='N/A' in 'None', Gender='None', Living=None
15:14:42 INF [api_util log_msg  992 ] - parse_ancestry_person_details call: SUCCESS
15:14:42 INF [api_util log_msg  992 ] - Parsed Details Validation: PASSED (Name: 'Frances Mc Hardy', Link: https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/08FA6E79-0006-0000-0000-000000000000/facts)
15:14:42 INF [api_util log_msg  992 ] 
                                      --- Phase 4: Test Relationship Ladder Parsing (using /getladder) ---
15:14:42 INF [api_util log_msg  992 ] - Calling Tree Relationship Ladder API: https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/102281560544/getladder?callback=__ancestry_jsonp_test&_=1746022482903
15:14:42 DEB [utils    _api_req 2130] Applied 2 explicit header overrides for Get Tree Ladder API (Self Check).
15:14:42 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/102281560544/getladder?callback=__ancestry_jsonp_test&_=1746022482903 (Timeout: 20s, AllowRedirects: True)
15:14:42 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:14:42 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:14:42 DEB [utils    _api_req 2172] Get Tree Ladder API (Self Check): Cookies synced (Attempt 1).
15:14:42 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.585s (CurrentDelay: 0.50s)
15:14:43 DEB [utils    _api_req 2245] Get Tree Ladder API (Self Check): Rate limit wait: 0.58s (Attempt 1)
15:14:43 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get Tree Ladder API (Self Check)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'text/javascript, application/javascript, application/ecmascript, application/x-ecmascript, */*; q=0.01', 'Referer': 'https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/102281560544/facts', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'X-Requested-With': 'XMLHttpRequest', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-9cc3456...c7-01', 'tracestate': '2611750@nr...82914', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
15:14:43 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get Tree Ladder API (Self Check)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:14:43 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get Tree Ladder API (Self Check)'] >>> Calling requests.request...
15:14:44 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get Tree Ladder API (Self Check)'] <<< requests.request returned.
15:14:44 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
15:14:44 INF [api_util log_msg  992 ] - Tree Ladder API call: SUCCESS (Received string)
15:14:44 INF [api_util log_msg  992 ] - Testing display_raw_relationship_ladder (internal logic)...
15:14:44 INF [api_util display_ 787 ] 
                                      --- Relationship between Wayne Gault and Frances Mc Hardy (API Report) ---
15:14:44 DEB [api_util display_ 814 ] Successfully extracted 'html' field using standard regex. Length: 590
15:14:44 DEB [api_util display_ 888 ] Successfully unescaped HTML content.
15:14:44 DEB [api_util format_a 640 ] Path item 1 (last): Removed prefix, using description: 'Son of Frances Margaret Milne'
15:14:44 INF [api_util log_msg  992 ] - display_raw_relationship_ladder execution: PASSED (No exceptions)
15:14:44 INF [api_util log_msg  992 ] - Successfully extracted HTML via JSONP parsing for format test.
15:14:44 INF [api_util log_msg  992 ] - Testing format_api_relationship_path...
15:14:44 DEB [api_util format_a 640 ] Path item 1 (last): Removed prefix, using description: 'Son of Frances Margaret Milne'
15:14:44 ERR [api_util log_msg  988 ] - format_api_relationship_path call: FAILED (Output invalid, empty, or missing names)
15:14:44 INF [api_util log_msg  992 ] - Actual Output: Frances Margaret Milne
                                      -> Frances Margaret Milne is the Mother of Wayne Gault
15:14:44 INF [api_util log_msg  992 ] 
                                      --- Finalizing: Closing Session ---
15:14:44 DEB [utils    close_se 1889] Attempting to close WebDriver session...
15:14:44 DEB [utils    close_se 1892] WebDriver session quit successfully.
15:14:44 DEB [utils    close_se 1903] Closing database connection pool...
15:14:44 DEB [utils    cls_db_c 1509] SessionManager ID=115262624 cls_db_conn called (keep_db=False). Disposing Engine ID: 111692784
15:14:44 DEB [utils    cls_db_c 1514] Engine ID=111692784 disposed successfully.
15:14:44 ERR [api_util self_che 1524] api_utils self-check status: FAIL
15:14:44 DEB [cache    close_ca 261 ] Closing DiskCache connection...
15:14:44 DEB [cache    close_ca 263 ] DiskCache connection closed.
15:23:43 INF [api_util log_msg  996 ] 
                                      [api_utils.py self-check starting...]
15:23:43 INF [api_util log_msg  996 ] 
                                      --- Phase 0: Prerequisite Checks ---
15:23:43 INF [api_util log_msg  996 ] - BeautifulSoup Import: OK
15:23:43 INF [api_util log_msg  996 ] - format_name Import/Fallback: OK
15:23:43 INF [api_util log_msg  996 ] - ordinal_case Import/Fallback: OK
15:23:43 INF [api_util log_msg  996 ] - _parse_date Import/Fallback: OK
15:23:43 INF [api_util log_msg  996 ] - _clean_display_date Import/Fallback: OK
15:23:43 INF [api_util log_msg  996 ] - Config Check: Essential credentials/URLs/IDs present.
15:23:43 INF [api_util log_msg  996 ] 
                                      --- Phase 1: Session Setup & Login ---
15:23:43 DEB [utils    __init__ 619 ] Initialized shared requests.Session with HTTPAdapter.
15:23:43 DEB [utils    __init__ 634 ] Initialized shared cloudscraper instance with retry strategy.
15:23:43 DEB [utils    __init__ 474 ] RateLimiter Init: Capacity=10.0, FillRate=2.0/s, InitialDelay=0.50s, Backoff=1.80, Decrease=0.98
15:23:43 DEB [utils    __init__ 645 ] SessionManager instance created: ID=110843504
                                      
15:23:43 DEB [utils    start_se 649 ] --- SessionManager Phase 1: Starting Driver (api_utils Self Check Start) ---
                                      
15:23:43 DEB [utils    _initial 986 ] SessionManager ID=110843504 initializing SQLAlchemy Engine/Session...
15:23:43 DEB [utils    _initial 1001] DB Path: C:\Users\wayne\GitHub\Python\Projects\Ancestry\Data\ancestry.db
15:23:43 DEB [utils    _initial 1035] DB Pool Config: Size=10, MaxOverflow=5, Timeout=30
15:23:43 DEB [utils    _initial 1047] Created NEW SQLAlchemy engine: ID=110298656 for SM ID=110843504
15:23:43 DEB [utils    _initial 1064] Created Session factory for Engine ID=110298656
15:23:43 DEB [utils    enable_s 1057] SQLite PRAGMA settings applied (WAL, Foreign Keys).
15:23:43 DEB [database _create_ 310 ] Executing CREATE VIEW statement for 'messages' view...
15:23:43 DEB [database _create_ 313 ] Database view 'messages' created or already exists.
15:23:43 DEB [utils    _initial 1067] DB tables checked/created successfully.
15:23:43 DEB [utils    start_se 676 ] Initializing WebDriver instance (using init_webdvr)...
15:23:43 DEB [chromedr init_web 175 ] WebDriver initialization attempt 1/3...
15:23:43 INF [chromedr init_web 192 ] User data directory (no --profile-directory):
                                      C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
15:23:43 DEB [chromedr init_web 203 ] Using browser executable:
                                      C:\Program Files\Google\Chrome\Application\chrome.exe
15:23:43 DEB [chromedr init_web 220 ] Setting User-Agent:
                                      Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36
15:23:43 DEB [chromedr init_web 229 ] Letting undetected_chromedriver auto-manage ChromeDriver version (self-patching mode).
15:23:43 INF [chromedr init_web 231 ] [init_webdvr] Attempting uc.Chrome() self-patching (attempt 1)...
15:23:46 INF [chromedr init_web 234 ] [init_webdvr] uc.Chrome() self-patching succeeded in 2.38s (attempt 1)
15:23:46 DEB [chromedr init_web 235 ] WebDriver instance object potentially created (attempt 1).
15:23:46 DEB [chromedr init_web 277 ] User-Agent override applied via CDP.
15:23:46 DEB [chromedr init_web 282 ] Attempting to minimize window (non-headless mode)...
15:23:46 DEB [chromedr init_web 285 ] Browser window minimized.
15:23:46 DEB [chromedr init_web 309 ] WebDriver instance fully configured successfully (attempt 1).
15:23:46 DEB [utils    start_se 684 ] WebDriver initialization successful.
15:23:46 DEB [utils    start_se 685 ] Navigating to Base URL (https://www.ancestry.co.uk/) to stabilize...
15:23:46 DEB [utils    nav_to_p 3516] Navigation Attempt 1/3 to: https://www.ancestry.co.uk/
15:23:46 DEB [utils    nav_to_p 3539] Executing driver.get('https://www.ancestry.co.uk/')...
15:23:49 DEB [utils    nav_to_p 3552] Landed on URL base: https://www.ancestry.co.uk
15:23:51 DEB [utils    nav_to_p 3647] On correct URL base. Waiting up to 20s for selector: 'body'
15:23:51 DEB [utils    nav_to_p 3654] Navigation successful and element 'body' found on:
                                      https://www.ancestry.co.uk/
15:23:51 DEB [utils    start_se 698 ] Initial navigation to Base URL successful.
15:23:51 DEB [utils    start_se 702 ] --- SessionManager Phase 1: Driver Start Successful ---
15:23:51 INF [api_util log_msg  996 ] - SessionManager.start_sess(): PASSED
15:23:51 DEB [utils    ensure_s 737 ] TRACE: Entered ensure_session_ready
15:23:51 DEB [utils    ensure_d 723 ] Driver already live (Action: api_utils Self Check Ready - Ensure Driver).
15:23:51 DEB [utils    ensure_s 746 ] TRACE: About to call _perform_readiness_checks
15:23:51 DEB [utils    ensure_s 749 ] TRACE: Calling _perform_readiness_checks
15:23:51 DEB [utils    _perform 795 ] Performing readiness checks (action=api_utils Self Check Ready - Readiness Checks)...
15:23:51 INF [utils    _perform 815 ] [Persistence] Chrome user data directory is present: C:\Users\wayne\AppData\Local\Google\Chrome\chrome_automation_profile
15:23:51 DEB [utils    login_st 3391] Checking login status (API prioritized)...
15:23:51 DEB [utils    login_st 3404] Attempting API login verification (_verify_api_login_status)...
15:23:51 DEB [utils    _verify_ 1730] Verifying login status via API endpoint: https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna...
15:23:51 DEB [utils    _verify_ 1737] Syncing cookies before API login check...
15:23:51 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:23:51 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:23:51 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
15:23:51 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:23:51 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:23:51 DEB [utils    _api_req 2172] API Login Verification (header/dna): Cookies synced (Attempt 1).
15:23:51 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.544s (CurrentDelay: 0.50s)
15:23:51 DEB [utils    _api_req 2245] API Login Verification (header/dna): Rate limit wait: 0.54s (Attempt 1)
15:23:51 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-e977e27...e5-01', 'tracestate': '2611750@nr...31283', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
15:23:51 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:23:51 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] >>> Calling requests.request...
15:23:52 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'API Login Verification (header/dna)'] <<< requests.request returned.
15:23:52 DEB [utils    _api_req 2304] <-- Response Status: 200 
15:23:52 DEB [utils    _verify_ 1769] API Login Verification (header/dna): API login check successful ('testId' found).
15:23:52 DEB [utils    login_st 3407] Login status confirmed TRUE via API check.
15:23:52 DEB [utils    _perform 892 ] Checking/Handling current URL...
15:23:52 DEB [utils    _check_a 1089] Current URL for check: https://www.ancestry.co.uk/
15:23:52 DEB [utils    _check_a 1126] Current URL is suitable, no extra navigation needed.
15:23:52 DEB [utils    _perform 896 ] URL check/handling OK.
15:23:52 DEB [utils    _perform 899 ] Verifying essential cookies...
15:23:52 DEB [utils    get_cook 1255] Waiting up to 5s for cookies: ['ANCSESSIONID', 'SecureATT']...
15:23:52 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
15:23:52 DEB [utils    _perform 908 ] Essential cookies OK.
15:23:52 DEB [utils    _perform 911 ] Syncing cookies to requests session...
15:23:52 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:23:52 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:23:52 DEB [utils    _perform 913 ] Cookies synced.
15:23:52 DEB [utils    _perform 916 ] Ensuring CSRF token...
15:23:52 DEB [utils    get_csrf 1215] Attempting to fetch fresh CSRF token from: https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken
15:23:52 DEB [utils    get_cook 1255] Waiting up to 10s for cookies: ['ANCSESSIONID', 'SecureATT']...
15:23:52 DEB [utils    get_cook 1270] All required cookies found: ['ANCSESSIONID', 'SecureATT'].
15:23:52 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/discoveryui-matches/parents/api/csrfToken (Timeout: 60s, AllowRedirects: True)
15:23:52 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:23:52 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:23:52 DEB [utils    _api_req 2172] CSRF Token API: Cookies synced (Attempt 1).
15:23:52 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.487s (CurrentDelay: 0.50s)
15:23:53 DEB [utils    _api_req 2245] CSRF Token API: Rate limit wait: 0.49s (Attempt 1)
15:23:53 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'CSRF Token API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-79b8c40...04-01', 'tracestate': '2611750@nr...32715', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
15:23:53 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'CSRF Token API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:23:53 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'CSRF Token API'] >>> Calling requests.request...
15:23:53 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'CSRF Token API'] <<< requests.request returned.
15:23:53 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
15:23:53 DEB [utils    get_csrf 1233] CSRF token successfully retrieved (Length: 144).
15:23:53 DEB [utils    _perform 924 ] CSRF token OK.
15:23:53 INF [utils    _perform 927 ] Readiness checks PASSED on attempt 1.
15:23:53 DEB [utils    ensure_s 752 ] TRACE: _perform_readiness_checks returned: True
15:23:53 DEB [utils    ensure_s 767 ] [Patch] Attempting to retrieve identifiers and tree owner after readiness checks...
15:23:53 DEB [utils    _retriev 1131] TRACE: Entered _retrieve_identifiers
15:23:53 DEB [utils    _retriev 1135] Retrieving profile ID (ucdmid)...
15:23:53 DEB [utils    get_my_p 1531] Attempting to fetch own profile ID (ucdmid)...
15:23:53 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/cdp-p13n/api/v1/users/me?attributes=ucdmid (Timeout: 60s, AllowRedirects: True)
15:23:53 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:23:53 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:23:53 DEB [utils    _api_req 2172] Get my profile_id: Cookies synced (Attempt 1).
15:23:53 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.595s (CurrentDelay: 0.50s)
15:23:54 DEB [utils    _api_req 2245] Get my profile_id: Rate limit wait: 0.59s (Attempt 1)
15:23:54 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get my profile_id'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'p13n-js', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-c7b5c83...aa-01', 'tracestate': '2611750@nr...33667', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9'}
15:23:54 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get my profile_id'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:23:54 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get my profile_id'] >>> Calling requests.request...
15:23:54 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get my profile_id'] <<< requests.request returned.
15:23:54 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
15:23:54 DEB [utils    get_my_p 1552] Successfully retrieved profile_id: 07BDD45E-0006-0000-0000-000000000000
15:23:54 INF [utils    _retriev 1141] My profile id: 07BDD45E-0006-0000-0000-000000000000
15:23:54 DEB [utils    _retriev 1147] Retrieving UUID (testId)...
15:23:54 DEB [utils    get_my_u 1569] Attempting to fetch own UUID (testId) from header/dna API...
15:23:54 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/dna (Timeout: 60s, AllowRedirects: True)
15:23:54 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:23:54 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:23:54 DEB [utils    _api_req 2172] Get UUID API: Cookies synced (Attempt 1).
15:23:54 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.525s (CurrentDelay: 0.50s)
15:23:55 DEB [utils    _api_req 2245] Get UUID API: Rate limit wait: 0.52s (Attempt 1)
15:23:55 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get UUID API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-fcc4eed...32-01', 'tracestate': '2611750@nr...34624', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
15:23:55 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get UUID API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:23:55 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get UUID API'] >>> Calling requests.request...
15:23:55 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get UUID API'] <<< requests.request returned.
15:23:55 DEB [utils    _api_req 2304] <-- Response Status: 200 
15:23:55 DEB [utils    get_my_u 1581] Successfully retrieved UUID: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
15:23:55 INF [utils    _retriev 1153] My uuid: FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7
15:23:55 DEB [utils    _retriev 1159] Retrieving tree ID for tree name: 'Gault Family'...
15:23:55 DEB [utils    get_my_t 1604] Attempting to fetch tree ID for TREE_NAME='Gault Family'...
15:23:55 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/header/trees (Timeout: 60s, AllowRedirects: True)
15:23:55 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:23:55 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:23:55 DEB [utils    _api_req 2172] Header Trees API: Cookies synced (Attempt 1).
15:23:55 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.540s (CurrentDelay: 0.50s)
15:23:56 DEB [utils    _api_req 2245] Header Trees API: Rate limit wait: 0.54s (Attempt 1)
15:23:56 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Header Trees API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-4aca5d2...de-01', 'tracestate': '2611750@nr...35830', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
15:23:56 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Header Trees API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:23:56 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Header Trees API'] >>> Calling requests.request...
15:23:57 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Header Trees API'] <<< requests.request returned.
15:23:57 DEB [utils    _api_req 2304] <-- Response Status: 200 
15:23:57 DEB [utils    get_my_t 1628] Found tree ID '175946702' for tree 'Gault Family'.
15:23:57 INF [utils    _retriev 1169] My tree id: 175946702
15:23:57 DEB [utils    _retriev 1176] TRACE: Exiting _retrieve_identifiers
15:23:57 DEB [utils    _retriev 1182] TRACE: Entered _retrieve_tree_owner
15:23:57 DEB [utils    _retriev 1191] Retrieving tree owner name...
15:23:57 DEB [utils    get_tree 1668] Attempting to fetch tree owner name for tree ID: 175946702...
15:23:57 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/api/uhome/secure/rest/user/tree-info?tree_id=175946702 (Timeout: 60s, AllowRedirects: True)
15:23:57 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:23:57 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:23:57 DEB [utils    _api_req 2172] Tree Owner Name API: Cookies synced (Attempt 1).
15:23:57 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.563s (CurrentDelay: 0.50s)
15:23:57 DEB [utils    _api_req 2245] Tree Owner Name API: Rate limit wait: 0.56s (Attempt 1)
15:23:57 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'Browser:meexp-uhome', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-e639486...9e-01', 'tracestate': '2611750@nr...37052', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
15:23:57 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Tree Owner Name API'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:23:57 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Tree Owner Name API'] >>> Calling requests.request...
15:23:58 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Tree Owner Name API'] <<< requests.request returned.
15:23:58 DEB [utils    _api_req 2304] <-- Response Status: 200 
15:23:58 DEB [utils    get_tree 1683] Found tree owner 'Wayne Gault' for tree ID 175946702.
15:23:58 INF [utils    _retriev 1203] Tree owner name: Wayne Gault
15:23:58 DEB [utils    _retriev 1205] TRACE: Exiting _retrieve_tree_owner (success)
15:23:58 DEB [utils    ensure_s 772 ] [Patch] Identifiers after fetch: profile_id=07BDD45E-0006-0000-0000-000000000000, uuid=FB609BA5-5A0D-46EE-BF18-C300D8DE5AB7, tree_id=175946702
15:23:58 DEB [utils    ensure_s 773 ] [Patch] Tree owner name after fetch: Wayne Gault
15:23:58 DEB [utils    ensure_s 777 ] TRACE: Set self.session_ready to: True
15:23:58 DEB [utils    ensure_s 779 ] TRACE: Exiting ensure_session_ready (returning True)
15:23:58 INF [api_util log_msg  996 ] - SessionManager.ensure_session_ready(): PASSED
15:23:58 INF [api_util log_msg  996 ] 
                                      --- Phase 2: Get Target Info & Validate Config ---
15:23:58 INF [api_util log_msg  996 ] - Target Profile ID (TESTING_PROFILE_ID): 08FA6E79-0006-0000-0000-000000000000
15:23:58 INF [api_util log_msg  996 ] - Target Person ID (TESTING_PERSON_TREE_ID): 102281560544
15:23:58 INF [api_util log_msg  996 ] - Target Tree ID (MY_TREE_ID): 175946702
15:23:58 INF [api_util log_msg  996 ] - Target Owner Name: Wayne Gault
15:23:58 INF [api_util log_msg  996 ] - Getting target display name from Profile API: https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000
15:23:58 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/app-api/express/v1/profiles/details?userId=08FA6E79-0006-0000-0000-000000000000 (Timeout: 60s, AllowRedirects: True)
15:23:58 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:23:58 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:23:58 DEB [utils    _api_req 2172] Get Target Name (Profile Details): Cookies synced (Attempt 1).
15:23:58 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.467s (CurrentDelay: 0.50s)
15:23:58 DEB [utils    _api_req 2245] Get Target Name (Profile Details): Rate limit wait: 0.47s (Attempt 1)
15:23:58 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'application/json, text/plain, */*', 'Referer': 'https://www.ancestry.co.uk/', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'ancestry-clientpath': 'express-fe', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-2ad3ea7...cc-01', 'tracestate': '2611750@nr...38096', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
15:23:58 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:23:58 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] >>> Calling requests.request...
15:23:58 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get Target Name (Profile Details)'] <<< requests.request returned.
15:23:58 DEB [utils    _api_req 2304] <-- Response Status: 200 
15:23:58 INF [api_util log_msg  996 ] - Target Display Name found: 'Frances Mc Hardy'
15:23:58 INF [api_util log_msg  996 ] 
                                      --- Phase 3: Test parse_ancestry_person_details (Profile Details API) ---
15:23:58 INF [api_util log_msg  996 ] - Using Profile Details API response from Phase 2.
15:23:58 DEB [api_util parse_an 436 ] Parsed API details for 'Frances Mc Hardy': ID=08FA6E79-0006-0000-0000-000000000000, Tree=175946702, Born='N/A' in 'None', Died='N/A' in 'None', Gender='None', Living=None
15:23:58 INF [api_util log_msg  996 ] - parse_ancestry_person_details call: SUCCESS
15:23:58 INF [api_util log_msg  996 ] - Parsed Details Validation: PASSED (Name: 'Frances Mc Hardy', Link: https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/08FA6E79-0006-0000-0000-000000000000/facts)
15:23:58 INF [api_util log_msg  996 ] 
                                      --- Phase 4: Test Relationship Ladder Parsing (using /getladder) ---
15:23:58 INF [api_util log_msg  996 ] - Calling Tree Relationship Ladder API: https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/102281560544/getladder?callback=__ancestry_jsonp_1746023038928&_=1746023038928
15:23:58 DEB [utils    _api_req 2130] Applied 2 explicit header overrides for Get Tree Ladder API (Self Check).
15:23:58 DEB [utils    _api_req 2144] API Req: GET https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/102281560544/getladder?callback=__ancestry_jsonp_1746023038928&_=1746023038928 (Timeout: 20s, AllowRedirects: True)
15:23:58 DEB [utils    _sync_co 1314] Retrieved 42 cookies from WebDriver for sync.
15:23:58 DEB [utils    _sync_co 1376] Successfully synced 42 cookies to requests session.
15:23:58 DEB [utils    _api_req 2172] Get Tree Ladder API (Self Check): Cookies synced (Attempt 1).
15:23:58 DEB [utils    wait     497 ] Token available (9.00 left). Applying base delay: 0.535s (CurrentDelay: 0.50s)
15:23:59 DEB [utils    _api_req 2245] Get Tree Ladder API (Self Check): Rate limit wait: 0.53s (Attempt 1)
15:23:59 DEB [utils    _api_req 2268] [_api_req Attempt 1 for 'Get Tree Ladder API (Self Check)'] Sending Headers: {'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36', 'Accept': 'text/javascript, application/javascript, application/ecmascript, application/x-ecmascript, */*; q=0.01', 'Referer': 'https://www.ancestry.co.uk/family-tree/person/tree/175946702/person/102281560544/facts', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache', 'X-Requested-With': 'XMLHttpRequest', 'newrelic': 'eyJ2IjpbMC...wIn19', 'traceparent': '00-801c57d...32-01', 'tracestate': '2611750@nr...38939', 'ancestry-context-ube': 'eyJldmVudE...7fSJ9', 'ancestry-userid': '07BDD45E-0006-0000-0000-000000000000'}
15:23:59 DEB [utils    _api_req 2274] [_api_req Attempt 1 for 'Get Tree Ladder API (Self Check)'] Sending Cookies: ['_uetvid', '_uetsid', 'mbox', '_ga_6R6RRSB9ZD', 'ANCSESSIONID', 'ATT', '__adal_id', 'RMEATT', '__adal_ses', 'ttcsid', '_tt_enable_cookie', 'ANCATT', 'LAU', '_ttp', '_ga_4QT8FMEX30', '__cf_bm', 'OPTOUTMULTI', '_fbp', '__adal_cw', 'an_s_split', 'ttcsid_CN1QODBC77UELPL12JV0', 'an_split', '__adal_ca', 'AMCV_ED3301AC512D2A290A490D4C%40AdobeOrg', 'BAIT', 'mboxEdgeCluster', '_gcl_au', '_pin_unauth', '_cfuvid', 'TI.SI', 'VARS', '_derived_epik', '_ga', 'at_check', 'OMNITURE', 'ANCUUID', 'cf_clearance', 'TI', 'UAUTH_DEVICE', 'Cache-Key', 'SecureATT', '__spdt']
15:23:59 DEB [utils    _api_req 2284] [_api_req Attempt 1 for 'Get Tree Ladder API (Self Check)'] >>> Calling requests.request...
15:24:00 DEB [utils    _api_req 2298] [_api_req Attempt 1 for 'Get Tree Ladder API (Self Check)'] <<< requests.request returned.
15:24:00 DEB [utils    _api_req 2304] <-- Response Status: 200 OK
15:24:00 INF [api_util log_msg  996 ] - Tree Ladder API call: SUCCESS (Received string)
15:24:00 INF [api_util log_msg  996 ] - Testing display_raw_relationship_ladder (internal logic)...
15:24:00 INF [api_util display_ 788 ] 
                                      --- Relationship between Wayne Gault and Frances Mc Hardy (API Report) ---
15:24:00 DEB [api_util display_ 808 ] Attempting JSONP extraction for ladder HTML...
15:24:00 DEB [api_util display_ 820 ] Successfully extracted 'html' field via JSONP parsing. Length: 360
15:24:00 DEB [api_util display_ 892 ] Successfully unescaped HTML content.
15:24:00 DEB [api_util format_a 641 ] Path item 1 (last): Removed prefix, using description: 'Son of Frances Margaret Milne'
15:24:00 INF [api_util log_msg  996 ] - display_raw_relationship_ladder execution: PASSED (No exceptions)
15:24:00 INF [api_util log_msg  996 ] - Successfully extracted HTML via JSONP parsing for format test.
15:24:00 INF [api_util log_msg  996 ] - Testing format_api_relationship_path...
15:24:00 DEB [api_util format_a 641 ] Path item 1 (last): Removed prefix, using description: 'Son of Frances Margaret Milne'
15:24:00 INF [api_util log_msg  996 ] - format_api_relationship_path call: PASSED
15:24:00 INF [api_util log_msg  996 ] - Formatted Output (Preview):
                                      Frances Margaret Milne
                                      -> Frances Margaret Milne is the Mother of Wayne Gault...
                                      
15:24:00 INF [api_util log_msg  996 ] 
                                      --- Finalizing: Closing Session ---
15:24:00 DEB [utils    close_se 1889] Attempting to close WebDriver session...
15:24:00 DEB [utils    close_se 1892] WebDriver session quit successfully.
15:24:00 DEB [utils    close_se 1903] Closing database connection pool...
15:24:00 DEB [utils    cls_db_c 1509] SessionManager ID=110843504 cls_db_conn called (keep_db=False). Disposing Engine ID: 110298656
15:24:00 DEB [utils    cls_db_c 1514] Engine ID=110298656 disposed successfully.
15:24:00 INF [api_util self_che 1570] api_utils self-check status: PASS
15:24:00 DEB [cache    close_ca 261 ] Closing DiskCache connection...
15:24:00 DEB [cache    close_ca 263 ] DiskCache connection closed.
