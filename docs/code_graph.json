{
  "metadata": {
    "schemaVersion": "1.0",
    "generatedAt": "2025-11-17T00:00:00Z",
    "description": "Code structure knowledge graph for Ancestry research automation platform. Documents classes, functions, modules, and their relationships (defines, calls, uses, instantiates).",
    "scope": "Complete project codebase analysis including core/*, actions, utilities, and AI integration layers.",
    "recentUpdates": "2025-11-17: Documentation quality improvement - 10 modules simplified (400+ lines of verbose jargon removed), all Pylance errors resolved (genealogical_normalization.py, ms_graph_utils.py type safety improvements). Previous: Test infrastructure standardization (22/22 modules), temp file helpers consolidated (4 modules migrated), Grafana setup automation, code quality improvements.",
    "documentation": {
      "primary": "README.md - Comprehensive project documentation with Phase 2 docstring improvements",
      "codebase": "visualize_code_graph.html - Interactive code visualization",
      "testing": "test_examples/README.md - Test patterns and best practices",
      "monitoring": "docs/grafana/ - Grafana dashboards and setup scripts",
      "development": ".github/copilot-instructions.md - AI development guidelines",
      "tasks": "docs/review_todo.md - Technical debt tracking",
      "audit": "docs/DOCUMENTATION_AUDIT.md - Documentation quality analysis and best practices"
    }
  },
  "nodes": [
    {
      "id": "file:main.py",
      "type": "file",
      "name": "main.py",
      "path": "main.py",
      "summary": "Primary CLI entry point providing menu-driven orchestration for all automation actions.",
      "mechanism": "Initializes configuration, session manager, and dispatches actions via exec_actn with adaptive rate limiter summaries.",
      "quality": "stable",
      "concerns": [
        "Menu logic still spreads action metadata across multiple helper lists, making updates error-prone."
      ],
      "opportunities": [
        "Confirm all menu items documented and linked to tests during full review."
      ],
      "tests": "main.py internal tests",
      "notes": "Initial pass complete through exec_actn and Action 0 helpers; continue deep dive for remaining actions."
    },
    {
      "id": "class:main._CachingState",
      "type": "class",
      "name": "_CachingState",
      "path": "main.py",
      "summary": "Tracks whether aggressive caching subsystems have already been initialized.",
      "mechanism": "Holds a module-level boolean flag toggled after warm_system_caches succeeds to prevent redundant initialization.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Persist cache status across restarts if warm-up becomes expensive."
      ],
      "tests": null,
      "notes": "Instantiated once as _caching_state."
    },
    {
      "id": "function:main.initialize_aggressive_caching",
      "type": "function",
      "name": "initialize_aggressive_caching",
      "path": "main.py",
      "summary": "Warms optional system caches to speed up subsequent automation workflows.",
      "mechanism": "Imports core.system_cache.warm_system_caches when available, logging debug output on missing module or failures and returning the helper result.",
      "quality": "stable",
        "concerns": [
          "Import-time failures are swallowed with False result; consider surfacing to telemetry."
        ],
        "opportunities": [
          "Record initialization duration for performance tracking."
        ],
        "tests": null,
        "notes": "Supports ensure_caching_initialized on-demand warming."
    },
    {
      "id": "function:main.ensure_caching_initialized",
      "type": "function",
      "name": "ensure_caching_initialized",
      "path": "main.py",
      "summary": "Ensures aggressive caching is initialized once, invoking warm-up lazily when first required.",
      "mechanism": "Checks _caching_state.initialized, calls initialize_aggressive_caching as needed, updates the flag, and returns boolean success.",
      "quality": "stable",
      "concerns": [
        "Return annotation claims None yet boolean values are produced."
      ],
      "opportunities": [
        "Align return typing with actual boolean contract."
      ],
      "tests": null,
      "notes": "Called by menu actions before expensive workflows."
    },
    {
      "id": "function:main._determine_browser_requirement",
      "type": "function",
      "name": "_determine_browser_requirement",
      "path": "main.py",
      "summary": "Infers whether a menu selection requires live browser automation.",
      "mechanism": "Maintains allowlist of browserless actions and returns False for those choices, True otherwise.",
      "quality": "stable",
      "concerns": [
        "List must be updated when new browserless actions are added."
      ],
      "opportunities": [
        "Centralize action metadata instead of hardcoded lists."
      ],
      "tests": null,
      "notes": "Used within exec_actn to configure SessionManager expectations."
    },
    {
      "id": "function:main._determine_required_state",
      "type": "function",
      "name": "_determine_required_state",
      "path": "main.py",
      "summary": "Maps menu choices to the minimum SessionManager readiness level.",
      "mechanism": "Returns db_ready for browserless actions, driver_ready for login checks, and session_ready otherwise with special handling for Action 10.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Share metadata table with browser requirement helper to avoid duplication."
      ],
      "tests": null,
      "notes": "Exec_actn uses the output to gate session preparation."
    },
    {
      "id": "function:main._ensure_required_state",
      "type": "function",
      "name": "_ensure_required_state",
      "path": "main.py",
      "summary": "Drives SessionManager to the readiness level demanded by the action.",
      "mechanism": "Calls ensure_db_ready, browser_manager.ensure_driver_live, or ensure_session_ready with optional CSRF skip based on requested state.",
      "quality": "stable",
      "concerns": [
        "Branch logic mirrors determine helper; consider consolidating metadata."
      ],
      "opportunities": [
        "Return richer error diagnostics for menu messaging."
      ],
      "tests": null,
      "notes": "Returns False when preparation fails so exec_actn can abort."
    },
    {
      "id": "function:main._prepare_action_arguments",
      "type": "function",
      "name": "_prepare_action_arguments",
      "path": "main.py",
      "summary": "Builds positional and keyword arguments for action invocation.",
      "mechanism": "Inspects action signature to decide whether to inject SessionManager, handles coord/gather special cases to derive start page and pass config.",
      "quality": "stable",
      "concerns": [
        "Special-case handling could drift as new actions evolve."
      ],
      "opportunities": [
        "Cache signature metadata to reduce introspection overhead."
      ],
      "tests": null,
      "notes": "Feeds prepared call into _execute_action_function."
    },
    {
      "id": "function:main._execute_action_function",
      "type": "function",
      "name": "_execute_action_function",
      "path": "main.py",
      "summary": "Invokes the action callable with prepared args and kwargs.",
      "mechanism": "Calls action_func using positional arguments only or combined with kwargs when provided.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Wrap in standardized error handling if invocation patterns diversify."
      ],
      "tests": null,
      "notes": "Keeps exec_actn invocation logic simple."
    },
    {
      "id": "function:main._should_close_session",
      "type": "function",
      "name": "_should_close_session",
      "path": "main.py",
      "summary": "Decides whether to close SessionManager resources after an action.",
      "mechanism": "Avoids closing on failure, honors close_sess_after flag, and logs intent for debugging.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Consider extending to partial cleanup modes (browser vs db)."
      ],
      "tests": null,
      "notes": "Result feeds _perform_session_cleanup."
    },
    {
      "id": "function:main._log_performance_metrics",
      "type": "function",
      "name": "_log_performance_metrics",
      "path": "main.py",
      "summary": "Logs duration and memory usage for a completed action and returns the measurements.",
      "mechanism": "Computes elapsed time, attempts to derive RSS delta via psutil, logs formatted output, and returns duration seconds plus memory delta.",
      "quality": "stable",
      "concerns": [
        "Memory delta can be None when psutil access fails, downstream consumers should handle gracefully."
      ],
      "opportunities": [
        "Include CPU metrics for richer analytics."
      ],
      "tests": null,
      "notes": "Return values feed analytics.log_event payload."
    },
    {
      "id": "function:main._perform_session_cleanup",
      "type": "function",
      "name": "_perform_session_cleanup",
      "path": "main.py",
      "summary": "Handles SessionManager cleanup according to should_close decision.",
      "mechanism": "Closes browser or entire session based on flags and action name, otherwise keeps driver live while logging intent.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Centralize repeated logging with session manager cleanup utilities."
      ],
      "tests": null,
      "notes": "Called at end of exec_actn."
    },
    {
      "id": "function:main.exec_actn",
      "type": "function",
      "name": "exec_actn",
      "path": "main.py",
      "summary": "Unified action dispatcher ensuring required session state, logging, and cleanup around action functions.",
      "mechanism": "Determines browser requirement, prepares arguments via introspection, executes action, logs performance, records analytics, and cleans up sessions.",
      "quality": "stable",
      "concerns": [
        "Large function with many responsibilities; consider decomposing if future changes increase complexity."
      ],
      "opportunities": [
        "Potential to formalize return typing for action functions to simplify orchestration."
      ],
      "tests": "test main internal harness",
      "notes": "Covers state checks, analytics logging, and cleanup branches."
    },
    {
      "id": "function:main.all_but_first_actn",
      "type": "function",
      "name": "all_but_first_actn",
      "path": "main.py",
      "summary": "Deletes all database records except the configured test profile (Action 0).",
      "mechanism": "Closes primary DB pool, spawns temporary SessionManager, executes deletes within transaction, and restores pool.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Evaluate if informational CLI prints should transition to unified console helper."
      ],
      "tests": null,
      "notes": "Handles empty DB and missing test profile gracefully."
    },
    {
      "id": "function:main.run_core_workflow_action",
      "type": "function",
      "name": "run_core_workflow_action",
      "path": "main.py",
      "summary": "Executes combined workflow of Actions 6, 7, 9, and 8 depending on configuration.",
      "mechanism": "Uses helper wrappers for each action to ensure navigation, retries, and user messaging; returns success only when entire chain passes.",
      "quality": "stable",
      "concerns": [
        "Relies on sequential try/except; consider more granular error reporting for analytics."
      ],
      "opportunities": [
        "Add telemetry event summarizing workflow composition to analytics."
      ],
      "tests": null,
      "notes": "Depends on config.include_action6_in_workflow flag."
    },
    {
      "id": "function:main.reset_db_actn",
      "type": "function",
      "name": "reset_db_actn",
      "path": "main.py",
      "summary": "Resets SQLite database by truncating tables, recreating schema, and seeding defaults (Action 2).",
      "mechanism": "Closes primary connections, spins temporary SessionManager, truncates, recreates schema, seeds message templates, loads ethnicity metadata.",
      "quality": "stable",
      "concerns": [
        "Multiple nested try/except blocks could make failure modes harder to trace."
      ],
      "opportunities": [
        "Explore extracting reset steps into dedicated database utility module for reusability."
      ],
      "tests": null,
      "notes": "Ensures ethnicity columns rehydrated when metadata available."
    },
    {
      "id": "function:main.backup_db_actn",
      "type": "function",
      "name": "backup_db_actn",
      "path": "main.py",
      "summary": "Backs up SQLite database using helper in database module (Action 3).",
      "mechanism": "Invokes backup_database utility and logs outcome; browserless via exec_actn wrapper.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Consider surfacing backup target path to user output."
      ],
      "tests": null,
      "notes": "Depends on database.backup_database returning truthy state."
    },
    {
      "id": "function:main.restore_db_actn",
      "type": "function",
      "name": "restore_db_actn",
      "path": "main.py",
      "summary": "Restores SQLite database from backup file (Action 4).",
      "mechanism": "Closes pools, copies backup file into primary location, reports table counts.",
      "quality": "stable",
      "concerns": [
        "Fails silently if backup missing; consider more explicit user guidance."
      ],
      "opportunities": [
        "Maybe add checksum verification for copied file."
      ],
      "tests": null,
      "notes": "Prints table statistics post-restore via SQLAlchemy inspection."
    },
    {
      "id": "function:main.check_login_actn",
      "type": "function",
      "name": "check_login_actn",
      "path": "main.py",
      "summary": "Verifies browser login status, attempts credential-based login, and surfaces session identifiers (Action 5).",
      "mechanism": "Uses session_manager login_status/log_in helpers with UI fallback; prints identifiers via _display_session_info.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Could route user-facing strings through centralized messaging util."
      ],
      "tests": null,
      "notes": "Relies on exec_actn to ensure driver live before invocation."
    },
    {
      "id": "function:main.gather_dna_matches",
      "type": "function",
      "name": "gather_dna_matches",
      "path": "main.py",
      "summary": "Wrapper around Action 6 coordinator enforcing session readiness and configuration injection.",
      "mechanism": "Validates session state then delegates to action6.coord with optional start page.",
      "quality": "stable",
      "concerns": [
        "Has informational print; align messaging style during broader UX pass."
      ],
      "opportunities": [
        "Expose detailed failure reasons from coord when available."
      ],
      "tests": null,
      "notes": "Used by both menu and composite workflow."
    },
    {
      "id": "function:main.srch_inbox_actn",
      "type": "function",
      "name": "srch_inbox_actn",
      "path": "main.py",
      "summary": "Executes inbox scraping workflow via InboxProcessor (Action 7).",
      "mechanism": "Normalizes session_ready flag, instantiates InboxProcessor, triggers search_inbox pipeline.",
      "quality": "stable",
      "concerns": [
        "Repeated session_ready normalization identical across Actions 7-9; opportunity for helper."
      ],
      "opportunities": [
        "Extract guard pattern into reusable function to reduce duplication."
      ],
      "tests": null,
      "notes": "Logs initialization fallback when session_ready missing."
    },
    {
      "id": "function:main.send_messages_action",
      "type": "function",
      "name": "send_messages_action",
      "path": "main.py",
      "summary": "Dispatches Action 8 messaging workflow after ensuring navigation to base URL.",
      "mechanism": "Performs session_ready guard, navigates via nav_to_page, then calls send_messages_to_matches.",
      "quality": "stable",
      "concerns": [
        "Shares identical guard pattern with Action 7 and 9 wrappers; deduplicate."
      ],
      "opportunities": [
        "Surface counts of sent messages upon completion."
      ],
      "tests": null,
      "notes": "Relies on WAIT_FOR_PAGE_SELECTOR constant for navigation readiness."
    },
    {
      "id": "function:main.process_productive_messages_action",
      "type": "function",
      "name": "process_productive_messages_action",
      "path": "main.py",
      "summary": "Runs Action 9 productive message processing pipeline via process_productive_messages().",
      "mechanism": "Ensures session_ready flag, invokes processing routine, logs result.",
      "quality": "stable",
      "concerns": [
        "Duplicate guard logic shared with other action wrappers."
      ],
      "opportunities": [
        "Emit analytics summary for number of tasks generated."
      ],
      "tests": null,
      "notes": "Returns True/False to exec_actn for cleanup decisions."
    },
    {
      "id": "function:main.run_gedcom_then_api_fallback",
      "type": "function",
      "name": "run_gedcom_then_api_fallback",
      "path": "main.py",
      "summary": "Executes Action 10 combined GEDCOM search with API fallback and consolidated output.",
      "mechanism": "Collects criteria, runs GEDCOM filters, optionally performs API lookup, displays summary tables, and logs analytics extras.",
      "quality": "stable",
      "concerns": [
        "Large function with many inline helper imports; consider modularizing display logic."
      ],
      "opportunities": [
        "Support showing more than top candidate in CLI output based on configuration."
      ],
      "tests": null,
      "notes": "Depends on action10 and api_search_core helpers; ensures cookies synced before API fallback."
    },
    {
      "id": "function:main._load_and_validate_config_schema",
      "type": "function",
      "name": "_load_and_validate_config_schema",
      "path": "main.py",
      "summary": "Imports configuration schema module and verifies it is initialized before use.",
      "mechanism": "Attempts to import config.config_schema, logging success or detailed failures, and returns the schema object when available.",
      "quality": "stable",
      "concerns": [
        "Returns None on failure leaving callers to interpret errors."
      ],
      "opportunities": [
        "Provide remediation tips for missing configuration packages."
      ],
      "tests": null,
      "notes": "Consumed by validate_action_config prior to action gating."
    },
    {
      "id": "function:main._check_processing_limits",
      "type": "function",
      "name": "_check_processing_limits",
      "path": "main.py",
      "summary": "Guards critical numeric processing limits and emits warnings when unset or invalid.",
      "mechanism": "Inspects config batch_size and related limits, logging warnings for non-positive values that could trigger oversized workloads.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Extend to validate additional numeric thresholds as configuration evolves."
      ],
      "tests": null,
      "notes": "Executed during validate_action_config run."
    },
    {
      "id": "function:main._check_rate_limiting_settings",
      "type": "function",
      "name": "_check_rate_limiting_settings",
      "path": "main.py",
      "summary": "Placeholder hook for future validation of adaptive rate limiting preferences.",
      "mechanism": "Currently accepts the config object and exits without action to maintain API compatibility with earlier validation pipelines.",
      "quality": "stable",
      "concerns": [
        "No-op implementation may conceal misconfiguration until runtime."
      ],
      "opportunities": [
        "Implement sanity checks for REQUESTS_PER_SECOND and related fields."
      ],
      "tests": null,
      "notes": "Retained to avoid breaking existing validators."
    },
    {
      "id": "function:main._log_basic_configuration_values",
      "type": "function",
      "name": "_log_basic_configuration_values",
      "path": "main.py",
      "summary": "Prints core runtime configuration values for user visibility at startup.",
      "mechanism": "Logs batch sizes, rate limiting parameters, throughput targets, and pacing delays via the configured logger.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Include derived metrics such as estimated processing time."
      ],
      "tests": null,
      "notes": "Called from _log_configuration_summary."
    },
    {
      "id": "function:main._should_suppress_config_warnings",
      "type": "function",
      "name": "_should_suppress_config_warnings",
      "path": "main.py",
      "summary": "Determines whether configuration warnings should be muted based on environment or CLI context.",
      "mechanism": "Checks SUPPRESS_CONFIG_WARNINGS env var, pytest flag, or command-line arguments containing 'test'.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Support explicit CLI override for forced warnings."
      ],
      "tests": null,
      "notes": "Feeds suppression decision into warning helper."
    },
    {
      "id": "function:main._warn_if_unsafe_profile",
      "type": "function",
      "name": "_warn_if_unsafe_profile",
      "path": "main.py",
      "summary": "Emits warning when aggressive API speed profiles are active without explicit opt-in.",
      "mechanism": "Evaluates speed profile and allow_unsafe flags, logging cautionary message unless suppression requested.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Tie warning to telemetry events for monitoring unsafe usage."
      ],
      "tests": null,
      "notes": "Invoked by _log_configuration_summary."
    },
    {
      "id": "function:main._log_persisted_rate_state",
      "type": "function",
      "name": "_log_persisted_rate_state",
      "path": "main.py",
      "summary": "Summarizes stored rate limiter statistics from prior runs for operator awareness.",
      "mechanism": "Formats fill rate, timestamp, and request counts from persisted state dictionary and logs via the module logger.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Highlight staleness when persisted timestamp exceeds threshold."
      ],
      "tests": null,
      "notes": "Used inside _log_rate_limiter_summary."
    },
    {
      "id": "function:main._log_rate_limiter_summary",
      "type": "function",
      "name": "_log_rate_limiter_summary",
      "path": "main.py",
      "summary": "Reports adaptive rate limiter configuration, persisted hints, and endpoint summaries.",
      "mechanism": "Fetches persisted state and limiter instance from rate_limiter/utils helpers, computes desired fill rates, logs summary, and delegates to _log_persisted_rate_state.",
      "quality": "stable",
      "concerns": [
        "Imports rate_limiter dynamically; failures downgrade logging silently."
      ],
      "opportunities": [
        "Include current adaptive thresholds in configuration section."
      ],
      "tests": null,
      "notes": "Called from _log_configuration_summary."
    },
    {
      "id": "function:main._log_configuration_summary",
      "type": "function",
      "name": "_log_configuration_summary",
      "path": "main.py",
      "summary": "Outputs startup configuration banner with rate limiting and warning context.",
      "mechanism": "Prints header, logs base configuration values, determines suppression state, warns on unsafe profiles, and delegates to _log_rate_limiter_summary.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Support non-interactive output formatting for CI runs."
      ],
      "tests": null,
      "notes": "Executed as part of validate_action_config."
    },
    {
      "id": "function:main.validate_action_config",
      "type": "function",
      "name": "validate_action_config",
      "path": "main.py",
      "summary": "Primary configuration gate ensuring action workflows respect safe limits before proceeding.",
      "mechanism": "Loads config schema, performs limit checks, validates rate settings, and prints configuration summary; returns False on failure.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Integrate per-action validation results into analytics telemetry."
      ],
      "tests": null,
      "notes": "Invoked during application initialization before session setup."
    },
    {
      "id": "function:main._initialize_application",
      "type": "function",
      "name": "_initialize_application",
      "path": "main.py",
      "summary": "Bootstraps logging, diagnostics, and SessionManager prior to menu loop.",
      "mechanism": "Clears log file, configures logging, enforces sleep prevention, runs Chrome diagnostics, instantiates SessionManager, registers global session.",
      "quality": "stable",
      "concerns": [
        "Clearing log file may erase history; confirm acceptable for production."
      ],
      "opportunities": [
        "Expose diagnostic results in startup summary section of README."
      ],
      "tests": null,
      "notes": "Returns SessionManager and sleep prevention state for cleanup."
    },
    {
      "id": "function:main.main",
      "type": "function",
      "name": "main",
      "path": "main.py",
      "summary": "Top-level entry executing initialization, pre-authentication, and menu loop with graceful shutdown.",
      "mechanism": "Initializes application, preps services, loops on menu dispatch, handles confirmations, restores sleep, cleans resources on exit.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Consider extracting menu loop into separate controller for testability."
      ],
      "tests": "main_module_tests",
      "notes": "Ensures cleanup even on KeyboardInterrupt via finally block."
    },
    {
      "id": "class:core.session_manager.SessionManager",
      "type": "class",
      "name": "SessionManager",
      "path": "core/session_manager.py",
      "summary": "Central coordinator for browser, database, and API resources with cached component managers.",
      "mechanism": "Reuses cached DatabaseManager, BrowserManager, APIManager, and SessionValidator instances; exposes readiness, health monitoring, and rate limiting orchestration.",
      "quality": "monitor",
      "concerns": [
        "Complexity high; multiple responsibilities including cookie sync and health monitoring in single class.",
        "Error-handling branches span browser/API/DB recovery making test coverage difficult."
      ],
      "opportunities": [
        "Evaluate splitting cookie management and health monitoring into dedicated helpers once review finishes.",
        "Document watchdog integration and cascade safeguards in README architecture section."
      ],
      "tests": null,
      "notes": "Full review complete through watchdog helpers; capture recovery patterns and cached identifier logic."
    },
    {
      "id": "class:core.api_manager.APIManager",
      "type": "class",
      "name": "APIManager",
      "path": "core/api_manager.py",
      "summary": "Encapsulates HTTP session management, CSRF handling, and retrieval of core user identifiers.",
      "mechanism": "Configures a pooled requests.Session, syncs cookies from BrowserManager, executes API calls with optional CSRF headers, and caches identifiers for SessionManager usage.",
      "quality": "stable",
      "concerns": [
        "Identifier helpers assume legacy response schemas; brittle if upstream APIs change fields.",
        "Session recovery path relies on SessionManager injection, so misuse outside orchestrated flow may fail silently."
      ],
      "opportunities": [
        "Add schema validation or typed responses to detect API contract drift early.",
        "Emit telemetry on identifier retrieval failures to aid login troubleshooting."
      ],
      "tests": "api_manager_module_tests",
      "notes": "Handles cookie deduplication and optional cookie-file bootstrap for headless runs."
    },
    {
      "id": "module:analytics",
      "type": "module",
      "name": "analytics",
      "path": "analytics.py",
      "summary": "Collects operational telemetry events for actions and workflows.",
      "mechanism": "Exposes log_event interface with transient context support.",
      "quality": "needs-review",
      "concerns": [],
      "opportunities": [
        "Assess coverage and retention strategy during module review."
      ],
      "tests": null,
      "notes": "Placeholder entry pending detailed analysis."
    },
    {
      "id": "class:core.browser_manager.BrowserManager",
      "type": "class",
      "name": "BrowserManager",
      "path": "core/browser_manager.py",
      "summary": "Owns Selenium WebDriver lifecycle, cookie readiness checks, and tab management for browser-required actions.",
      "mechanism": "Initializes Chrome via init_webdvr, navigates to base URL, loads stored cookies, minimizes window, tracks driver state, and exposes helpers for validation and cookie checks.",
      "quality": "stable",
      "concerns": [
        "Cookie loader builds faux SessionManager object; future refactors could break attribute expectations.",
        "Minimize fallback moves window off-screen, which may confuse remote desktop users."
      ],
      "opportunities": [
        "Expose structured status when start_browser fails to aid diagnostics integration.",
        "Consider consolidating duplicate session-valid checks shared with SessionManager."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Handles Chrome 142 minimization quirk and ensures safe teardown of driver handles."
    },
    {
      "id": "method:BrowserManager.start_browser",
      "type": "method",
      "name": "BrowserManager.start_browser",
      "path": "core/browser_manager.py",
      "summary": "Bootstraps WebDriver instance, navigates to base URL, loads saved cookies, and minimizes window before marking session live.",
      "mechanism": "Calls init_webdvr, verifies window, navigates using nav_to_page, loads cookies via utils._load_login_cookies shim, and updates timing flags.",
      "quality": "stable",
      "concerns": [
        "Swallows detailed nav_to_page failure reasons; only logs generic error then closes browser."
      ],
      "opportunities": [
        "Return result object capturing navigation failure details for SessionManager telemetry."
      ],
      "tests": null,
      "notes": "Minimizes Chrome to avoid visual noise on operator desktops."
    },
    {
      "id": "method:BrowserManager._load_saved_cookies",
      "type": "method",
      "name": "BrowserManager._load_saved_cookies",
      "path": "core/browser_manager.py",
      "summary": "Restores persisted login cookies into a freshly launched WebDriver session before backgrounding the window.",
      "mechanism": "Constructs lightweight cookie loader wrapper, imports utils._load_login_cookies lazily, invokes it against the active driver, and logs whether cookies were applied.",
      "quality": "stable",
      "concerns": [
        "Broad exception handler downgrades all failures to warning-level message, masking root causes like file permissions."
      ],
      "opportunities": [
        "Surface loaded/failed counts to SessionManager for telemetry and potential retry decisions."
      ],
      "tests": null,
      "notes": "Called during browser startup to reuse prior authentication state when available."
    },
    {
      "id": "method:BrowserManager.close_browser",
      "type": "method",
      "name": "BrowserManager.close_browser",
      "path": "core/browser_manager.py",
      "summary": "Closes WebDriver safely, suppressing Windows handle errors and resetting state flags.",
      "mechanism": "Redirects stderr, quits driver, waits briefly for handle release, clears driver reference, and resets browser_needed/driver_live flags.",
      "quality": "stable",
      "concerns": [
        "Multiple driver = None assignments exist; ensure future edits don\u2019t reintroduce GC issues."
      ],
      "opportunities": [
        "Emit analytics event summarizing closure reason when called from SessionManager restarts."
      ],
      "tests": null,
      "notes": "Ensures driver reference cleared even if quit raises."
    },
    {
      "id": "method:BrowserManager.is_session_valid",
      "type": "method",
      "name": "BrowserManager.is_session_valid",
      "path": "core/browser_manager.py",
      "summary": "Checks driver health by probing current_url and resets flags on known WebDriver exceptions.",
      "mechanism": "Returns False when driver missing or not live, catches InvalidSessionId/NoSuchWindow/WebDriverException to flag invalid session.",
      "quality": "stable",
      "concerns": [
        "Logs unexpected exceptions at error level, which may spam logs on transient issues."
      ],
      "opportunities": [
        "Differentiate recoverable vs fatal exceptions for better logging severity control."
      ],
      "tests": null,
      "notes": "Used by SessionManager to decide if restart needed."
    },
    {
      "id": "method:BrowserManager.ensure_driver_live",
      "type": "method",
      "name": "BrowserManager.ensure_driver_live",
      "path": "core/browser_manager.py",
      "summary": "Ensures browser is started when browser_needed=True, otherwise short-circuits.",
      "mechanism": "Returns True immediately if browser not required or session valid; otherwise delegates to start_browser.",
      "quality": "stable",
      "concerns": [
        "Relies on browser_needed flag managed externally; incorrect flag could skip required restart."
      ],
      "opportunities": [
        "Expose optional force flag to bypass browser_needed when higher layers detect stale session."
      ],
      "tests": null,
      "notes": "Primary entry point for SessionManager readiness checks."
    },
    {
      "id": "method:BrowserManager.get_cookies",
      "type": "method",
      "name": "BrowserManager.get_cookies",
      "path": "core/browser_manager.py",
      "summary": "Waits for required browser cookies within timeout, logging missing sets before failing.",
      "mechanism": "Validates session, polls driver.get_cookies, compares case-insensitive names, and waits up to timeout with 0.5s polling interval.",
      "quality": "stable",
      "concerns": [
        "Returns False for any exception, losing specific error context (e.g., driver None mid-loop)."
      ],
      "opportunities": [
        "Return tuple with missing cookie list to aid troubleshooting in SessionManager."
      ],
      "tests": null,
      "notes": "Ensures sequential cookie availability ahead of API sync."
    },
    {
      "id": "method:BrowserManager.create_new_tab",
      "type": "method",
      "name": "BrowserManager.create_new_tab",
      "path": "core/browser_manager.py",
      "summary": "Opens a new tab via JavaScript and switches focus, returning the new handle.",
      "mechanism": "Stores original handle, executes window.open script, iterates handles to find new one, switches context, returns handle.",
      "quality": "stable",
      "concerns": [
        "No timeout protection; long-running JS execution could hang call."
      ],
      "opportunities": [
        "Add optional timeout/exception handling for scenarios with pop-up blockers."
      ],
      "tests": null,
      "notes": "Currently unused in most flows but available for multi-tab automation."
    },
    {
      "id": "module:core.database_manager",
      "type": "module",
      "name": "core.database_manager",
      "path": "core/database_manager.py",
      "summary": "Centralizes SQLAlchemy engine lifecycle, pooling policies, and database session helpers.",
      "mechanism": "Builds configurable SQLite engine, applies PRAGMA listeners, tracks pool metrics, and exposes sync/async session management contexts.",
      "quality": "monitor",
      "concerns": [
        "Feature set has grown across enhancement phases, raising maintenance and testing surface area.",
        "Thread-pool bridging for async helpers adds complexity relative to mostly synchronous workloads."
      ],
      "opportunities": [
        "Audit which telemetry fields are consumed and retire unused counters to simplify state.",
        "Document recommended pool sizing for sequential action flow to guide config edits."
      ],
      "tests": "database_manager_module_tests",
      "notes": "Assumes SQLite backend; migration to pooled Postgres would require revisiting pragmas and connect args."
    },
    {
      "id": "class:core.database_manager.DatabaseManager",
      "type": "class",
      "name": "DatabaseManager",
      "path": "core/database_manager.py",
      "summary": "Encapsulates database file discovery, engine creation, pooling telemetry, and session orchestration.",
      "mechanism": "Resolves DB path from config, lazily initializes engine and sessionmaker, records performance stats, and offers context wrappers for batch and async work.",
      "quality": "monitor",
      "concerns": [
        "Duplicate logger setup hints at legacy refactors still in progress.",
        "Adaptive pooling heuristics may be overkill for single-threaded actions and lack regression coverage."
      ],
      "opportunities": [
        "Consider injecting config manager to ease unit testing and reduce global state reliance.",
        "Expose a pared-down interface for callers that just need ensure_ready/get_session to clarify supported usage."
      ],
      "tests": "database_manager_module_tests",
      "notes": "Designed to replace SessionManager's embedded DB logic during modularization efforts."
    },
    {
      "id": "method:DatabaseManager.ensure_ready",
      "type": "method",
      "name": "DatabaseManager.ensure_ready",
      "path": "core/database_manager.py",
      "summary": "Guarantees engine and session factory exist before work proceeds, toggling readiness flag.",
      "mechanism": "Checks cached engine/session, lazily triggers initialization, records readiness state, and logs failures.",
      "quality": "stable",
      "concerns": [
        "Sets _db_ready even if initialization later fails elsewhere; state can drift if exceptions escape callers."
      ],
      "opportunities": [
        "Return richer status info (error details, init timings) to aid upstream diagnostics."
      ],
      "tests": "database_manager_module_tests",
      "notes": "Primary entry point accessed via SessionManager.ensure_db_ready()."
    },
    {
      "id": "method:DatabaseManager._initialize_engine_and_session",
      "type": "method",
      "name": "DatabaseManager._initialize_engine_and_session",
      "path": "core/database_manager.py",
      "summary": "Constructs SQLAlchemy engine with tuned pooling config and prepares session factory.",
      "mechanism": "Disposes stale engines, computes pool sizing, builds engine with pragmas, attaches listeners, and issues metadata create_all on first run.",
      "quality": "monitor",
      "concerns": [
        "Large try/except spans complicate pinpointing which step failed without deep logs."
      ],
      "opportunities": [
        "Split configuration, engine creation, and metadata bootstrap into dedicated helpers for clarity and testing."
      ],
      "tests": null,
      "notes": "Logs critical on failure and resets init flags to allow retry."
    },
    {
      "id": "method:DatabaseManager.get_session",
      "type": "method",
      "name": "DatabaseManager.get_session",
      "path": "core/database_manager.py",
      "summary": "Obtains SQLAlchemy Session from pool with lazy engine bootstrap and telemetry updates.",
      "mechanism": "Initializes engine if needed, creates session via sessionmaker, increments active counts, and tracks connection timing.",
      "quality": "monitor",
      "concerns": [
        "Resets engine on any exception, potentially discarding healthy pool during transient issues."
      ],
      "opportunities": [
        "Differentiate recoverable errors to avoid full engine dispose when unnecessary."
      ],
      "tests": "database_manager_module_tests",
      "notes": "SessionManager and batch helpers rely on this as their acquisition path."
    },
    {
      "id": "method:DatabaseManager.return_session",
      "type": "method",
      "name": "DatabaseManager.return_session",
      "path": "core/database_manager.py",
      "summary": "Closes a Session and updates active connection counters, tracking leaks on failure.",
      "mechanism": "Calls session.close(), decrements active count safely, increments leak counter when close raises.",
      "quality": "stable",
      "concerns": [
        "Only logs when session is None; callers repeatedly passing None could hide logic issues."
      ],
      "opportunities": [
        "Emit telemetry when leak counter increments to correlate with caller context."
      ],
      "tests": null,
      "notes": "Used by both sync and async context managers for cleanup."
    },
    {
      "id": "method:DatabaseManager.get_session_context",
      "type": "method",
      "name": "DatabaseManager.get_session_context",
      "path": "core/database_manager.py",
      "summary": "Context manager yielding session with automatic commit/rollback and cleanup.",
      "mechanism": "Acquires session, yields to caller, commits on success, rolls back on errors, always returns session to pool.",
      "quality": "stable",
      "concerns": [
        "Nested context usage may double-close sessions if callers also call return_session manually."
      ],
      "opportunities": [
        "Document idempotency expectations to prevent redundant cleanup."
      ],
      "tests": "database_manager_module_tests",
      "notes": "Wraps core CRUD operations invoked by action modules."
    },
    {
      "id": "method:DatabaseManager.batch_operation_context",
      "type": "method",
      "name": "DatabaseManager.batch_operation_context",
      "path": "core/database_manager.py",
      "summary": "Provides commit batching helpers for high-volume insert/update loops.",
      "mechanism": "Yields session alongside add_to_batch/commit_batch closures, committing when batch thresholds reached and handling rollback on failure.",
      "quality": "stable",
      "concerns": [
        "Closures maintain implicit state; misuse outside context could leave transactions open."
      ],
      "opportunities": [
        "Return lightweight helper object instead of closures to clarify lifecycle."
      ],
      "tests": null,
      "notes": "Action 6 leverage point for bulk DNA match persistence."
    },
    {
      "id": "method:DatabaseManager.async_session_context",
      "type": "method",
      "name": "DatabaseManager.async_session_context",
      "path": "core/database_manager.py",
      "summary": "Async context manager bridging synchronous SQLAlchemy sessions into asyncio workflows.",
      "mechanism": "Runs get_session/commit/rollback/return_session inside executor to avoid blocking event loop and logs lifecycle events.",
      "quality": "monitor",
      "concerns": [
        "Executor hopping adds overhead; unclear which callers depend on async integration."
      ],
      "opportunities": [
        "Evaluate replacing with async-capable database driver if async usage increases."
      ],
      "tests": null,
      "notes": "Supports experimental async telemetry/report generation routines."
    },
    {
      "id": "method:DatabaseManager.async_execute_query",
      "type": "method",
      "name": "DatabaseManager.async_execute_query",
      "path": "core/database_manager.py",
      "summary": "Executes SQL statement in executor, optionally returning list of row dicts for async callers.",
      "mechanism": "Wraps session.execute inside run_in_executor, converts rows to dicts when fetch_results True, logs failures.",
      "quality": "monitor",
      "concerns": [
        "No circuit breaker; repeated failures could spam logs without backoff."
      ],
      "opportunities": [
        "Share timing metrics with sync path for unified performance reporting."
      ],
      "tests": null,
      "notes": "Pairs with async_session_context to enable lightweight async jobs."
    },
    {
      "id": "method:DatabaseManager.get_performance_stats",
      "type": "method",
      "name": "DatabaseManager.get_performance_stats",
      "path": "core/database_manager.py",
      "summary": "Exposes collected pool/query counters with derived health indicators.",
      "mechanism": "Copies internal stats dict, computes success and overflow rates, adds pool metadata and health labels before returning.",
      "quality": "stable",
      "concerns": [
        "Success rate assumes total_connections>0; initial zero-state still reports 'good' health even if engine absent."
      ],
      "opportunities": [
        "Include timestamp of last reset so operators know freshness of metrics."
      ],
      "tests": null,
      "notes": "Useful for telemetry dashboards and manual diagnostics."
    },
    {
      "id": "method:DatabaseManager.close_connections",
      "type": "method",
      "name": "DatabaseManager.close_connections",
      "path": "core/database_manager.py",
      "summary": "Closes sessions and optionally disposes engine, resetting initialization flags.",
      "mechanism": "On dispose_engine=True, calls engine.dispose(), clears engine/session references, and flips _db_init_attempted; otherwise logs no-op.",
      "quality": "stable",
      "concerns": [
        "Non-dispose path currently only logs; callers expecting idle pool shrinkage may misinterpret behavior."
      ],
      "opportunities": [
        "Clarify semantics in docstring or return status to reduce misuse."
      ],
      "tests": null,
      "notes": "Invoked by SessionManager restarts and shutdown routines."
    },
    {
      "id": "module:core.error_handling",
      "type": "module",
      "name": "core.error_handling",
      "path": "core/error_handling.py",
      "summary": "Shared error resilience utilities supplying retry decorators, circuit breaker tracking, and user guidance helpers.",
      "mechanism": "Defines EnhancedErrorRecovery singleton with stats/circuit store, ErrorContext dataclass, and decorator factory producing retry wrappers with backoff and partial success handling.",
      "quality": "stable",
      "concerns": [
        "Module duplicates sys.path injection/bootstrap pattern found across core files; cleanup opportunity.",
        "Global singleton plus module-level helpers complicate dependency injection during testing."
      ],
      "opportunities": [
        "Surface metrics via analytics or telemetry to quantify recovery efficacy.",
        "Extract shared retry config presets (API/DB/File) into config schema for centralized tuning."
      ],
      "tests": "error_handling_module_tests",
      "notes": "Imported by action modules to wrap API/database interactions with structured retry logic."
    },
    {
      "id": "class:core.error_handling.ErrorSeverity",
      "type": "class",
      "name": "ErrorSeverity",
      "path": "core/error_handling.py",
      "summary": "Enum categorizing error gravity levels from low to critical.",
      "mechanism": "Provides four severity designations used for messaging or future policy decisions.",
      "quality": "stable",
      "concerns": [
        "Currently unused outside module tests; risk of drift if not referenced elsewhere."
      ],
      "opportunities": [
        "Integrate with logging or telemetry payloads to standardize severity reporting."
      ],
      "tests": "error_handling_module_tests",
      "notes": "Enum values align with structured logging taxonomy used in ops dashboards."
    },
    {
      "id": "class:core.error_handling.RecoveryStrategy",
      "type": "class",
      "name": "RecoveryStrategy",
      "path": "core/error_handling.py",
      "summary": "Enum describing available recovery patterns such as retries, backoff, and circuit breaker.",
      "mechanism": "Enumerates strategy names consumed by ErrorContext and decorator logic to select behavior.",
      "quality": "stable",
      "concerns": [
        "Strategy enum values beyond EXPONENTIAL_BACKOFF are not fully leveraged yet."
      ],
      "opportunities": [
        "Implement circuit breaker and graceful degradation branches to honor enum intent."
      ],
      "tests": "error_handling_module_tests",
      "notes": "Supports future expansion toward per-operation policy configuration."
    },
    {
      "id": "class:core.error_handling.ErrorContext",
      "type": "class",
      "name": "ErrorContext",
      "path": "core/error_handling.py",
      "summary": "Dataclass capturing retry attempt metadata, error history, and strategy configuration.",
      "mechanism": "Tracks attempt counts, computes exponential backoff delay with jitter, and stores partial results for fallback handlers.",
      "quality": "stable",
      "concerns": [
        "Context growth with partial results or error history could impact memory for very long retries."
      ],
      "opportunities": [
        "Expose serialization helper to persist context when long operations span process restarts."
      ],
      "tests": "error_handling_module_tests",
      "notes": "Instances created by with_enhanced_recovery decorator to orchestrate retries."
    },
    {
      "id": "class:core.error_handling.EnhancedErrorRecovery",
      "type": "class",
      "name": "EnhancedErrorRecovery",
      "path": "core/error_handling.py",
      "summary": "Manages retry statistics and circuit breaker state for operations using enhanced recovery wrappers.",
      "mechanism": "Maintains per-operation counters, success/failure tracking, and circuit breaker timers to throttle repeated failures.",
      "quality": "stable",
      "concerns": [
        "Stats dictionary grows without pruning; long-running processes could accumulate stale operation keys."
      ],
      "opportunities": [
        "Add reset/prune API so long-lived sessions can clear obsolete stats."
      ],
      "tests": null,
      "notes": "Global instance exported as error_recovery for module consumers."
    },
    {
      "id": "function:core.error_handling.with_enhanced_recovery",
      "type": "function",
      "name": "with_enhanced_recovery",
      "path": "core/error_handling.py",
      "summary": "Decorator factory applying retries with backoff, circuit checks, and optional partial success handling.",
      "mechanism": "Builds wrapper using ErrorContext, consults EnhancedErrorRecovery for circuit status, logs attempts, sleeps based on jittered backoff, and delegates to optional handlers.",
      "quality": "stable",
      "concerns": [
        "Wrapper captures broad Exception by default; callers must supply narrower retryable_exceptions for safety."
      ],
      "opportunities": [
        "Expose async-compatible variant to avoid blocking sleep in coroutine contexts."
      ],
      "tests": null,
      "notes": "Used across action modules to shield API and messaging workflows."
    },
    {
      "id": "function:core.error_handling.with_api_recovery",
      "type": "function",
      "name": "with_api_recovery",
      "path": "core/error_handling.py",
      "summary": "Convenience decorator preset tuned for API IO with higher attempt counts and network exceptions.",
      "mechanism": "Calls with_enhanced_recovery with API-specific retry parameters and default user guidance mapping.",
      "quality": "stable",
      "concerns": [
        "Static retryable exception list may miss library-specific network errors."
      ],
      "opportunities": [
        "Allow config overrides so rate limiting studies can adjust max_attempts/backoff without code edits."
      ],
      "tests": null,
      "notes": "Adopted by inbox and messaging actions to harden API calls."
    },
    {
      "id": "function:core.error_handling.with_database_recovery",
      "type": "function",
      "name": "with_database_recovery",
      "path": "core/error_handling.py",
      "summary": "Decorator preset for database operations with modest backoff and connection-focused exceptions.",
      "mechanism": "Delegates to with_enhanced_recovery using ConnectionError/TimeoutError handling and shared guidance text.",
      "quality": "stable",
      "concerns": [
        "TimeoutError may not surface for SQLite interactions; coverage limited to networked DBs."
      ],
      "opportunities": [
        "Integrate with DatabaseManager metrics to adjust behavior based on pool health."
      ],
      "tests": null,
      "notes": "Currently unused but available for future DB resilience needs."
    },
    {
      "id": "function:core.error_handling.with_file_recovery",
      "type": "function",
      "name": "with_file_recovery",
      "path": "core/error_handling.py",
      "summary": "Decorator preset guarding file IO against transient permission/path issues.",
      "mechanism": "Invokes with_enhanced_recovery with file-centric exceptions and shorter delays for quick retries.",
      "quality": "stable",
      "concerns": [
        "May mask persistent permission issues if max_attempts left at default."
      ],
      "opportunities": [
        "Hook into partial success handler to return successfully processed files in batch jobs."
      ],
      "tests": null,
      "notes": "Intended for backup/restore workflows interacting with local filesystem."
    },
    {
      "id": "function:core.error_handling.create_user_guidance",
      "type": "function",
      "name": "create_user_guidance",
      "path": "core/error_handling.py",
      "summary": "Builds default mapping of exception types to user-facing remediation tips.",
      "mechanism": "Returns dictionary for common IO, permission, and configuration failures consumed by retry decorators.",
      "quality": "stable",
      "concerns": [
        "Guidance text duplicates emoji-rich logging style; may need localization strategy later."
      ],
      "opportunities": [
        "Externalize guidance content to configuration for easier updates."
      ],
      "tests": null,
      "notes": "Helps provide actionable hints during retry logging."
    },
    {
      "id": "function:core.error_handling.handle_partial_success",
      "type": "function",
      "name": "handle_partial_success",
      "path": "core/error_handling.py",
      "summary": "Default partial success handler returning accumulated results or re-raising error.",
      "mechanism": "If partial results exist, logs warning and returns them; otherwise propagates original exception.",
      "quality": "stable",
      "concerns": [
        "Function only used internally; callers needing custom logic must pass handler into decorator."
      ],
      "opportunities": [
        "Extend to include metadata about incomplete work for post-processing."
      ],
      "tests": null,
      "notes": "Invoked by _handle_partial_success when recovery falls back to partial completion."
    },
    {
      "id": "module:core.error_handling",
      "type": "module",
      "name": "core.error_handling",
      "path": "core/error_handling.py",
      "summary": "Provides unified exception taxonomy, error handlers, circuit breakers, and decorator-based resilience utilities.",
      "mechanism": "Defines AppError hierarchy, registers handler registry, wraps retry/circuit breaker logic, and offers safe_execute plus context/degradation helpers.",
      "quality": "monitor",
      "concerns": [
        "Module is large with overlapping legacy and new patterns; harder to ensure consistent usage across actions.",
        "Imports via sys.path manipulation persist from legacy structure and could be centralized."
      ],
      "opportunities": [
        "Split decorators, handlers, and exception definitions into focused modules for maintainability.",
        "Document which patterns are recommended versus legacy to aid future refactors."
      ],
      "tests": "error_handling_module_tests",
      "notes": "Backs SessionManager readiness decorators and wider action retry/timeout strategies."
    },
    {
      "id": "class:core.error_handling.CircuitBreakerConfig",
      "type": "class",
      "name": "CircuitBreakerConfig",
      "path": "core/error_handling.py",
      "summary": "Dataclass holding circuit breaker thresholds, recovery timeout, and success requirement tuning.",
      "mechanism": "Stores failure threshold, recovery cooldown, success threshold, and request timeout consumed by CircuitBreaker and presets.",
      "quality": "stable",
      "concerns": [
        "Timeout attribute unused by current call wrapper; risk of drift between config and behavior."
      ],
      "opportunities": [
        "Enforce type validation or integrate timeout field with timeout_protection to honor configuration."
      ],
      "tests": "error_handling_module_tests",
      "notes": "Default configs instantiated for API, session, and database breaker presets."
    },
    {
      "id": "class:core.error_handling.CircuitBreaker",
      "type": "class",
      "name": "CircuitBreaker",
      "path": "core/error_handling.py",
      "summary": "Thread-safe circuit breaker enforcing failure thresholds with half-open recovery checks.",
      "mechanism": "Wraps call attempts inside lock, tracks failure timestamps, transitions OPEN/HALF_OPEN/CLOSED based on configuration, and raises when breaker open.",
      "quality": "stable",
      "concerns": [
        "call() re-raises raw exception without additional context; callers must add diagnostics separately."
      ],
      "opportunities": [
        "Emit analytics events on state transitions to observe breaker activity in production."
      ],
      "tests": "error_handling_module_tests",
      "notes": "Used by decorators and ErrorRecoveryManager to protect external services."
    },
    {
      "id": "class:core.error_handling.RetryConfig",
      "type": "class",
      "name": "RetryConfig",
      "path": "core/error_handling.py",
      "summary": "Configures retry attempts, backoff strategy, and exception filters for retry_on_failure helper.",
      "mechanism": "Captures attempt limits, delay parameters, jitter, and stop/retry exception lists consumed by decorator logic.",
      "quality": "monitor",
      "concerns": [
        "RetryConfig instances seldom used directly; keep in sync with retry_on_failure defaults."
      ],
      "opportunities": [
        "Allow serialization into config files so runtime can adjust retry policy without code changes."
      ],
      "tests": null,
      "notes": "Paired with RetryStrategy enum though most code paths rely on decorator parameters."
    },
    {
      "id": "class:core.error_handling.AppError",
      "type": "class",
      "name": "AppError",
      "path": "core/error_handling.py",
      "summary": "Base structured exception carrying category, severity, user message, and contextual metadata.",
      "mechanism": "Initializes with ErrorCategory/Severity, auto-generates user guidance per category, and exposes to_dict for telemetry.",
      "quality": "stable",
      "concerns": [
        "Instances hold arbitrary context dicts; callers must avoid sensitive data leaks."
      ],
      "opportunities": [
        "Add redaction helper for telemetry to prevent PII leakage."
      ],
      "tests": "error_handling_module_tests",
      "notes": "Base class for specialized errors (DatabaseError, NetworkError, etc.)."
    },
    {
      "id": "class:core.error_handling.ErrorHandlerRegistry",
      "type": "class",
      "name": "ErrorHandlerRegistry",
      "path": "core/error_handling.py",
      "summary": "Maintains handler list and dispatches exceptions to database/network/browser adapters before falling back to AppError.",
      "mechanism": "Registers default handlers, iterates to find capable handler, catches handler failures, and provides fallback AppError conversion.",
      "quality": "stable",
      "concerns": [
        "Handler detection relies on keyword heuristics which may misclassify errors."
      ],
      "opportunities": [
        "Introduce structured mapping by exception type to reduce reliance on string contains checks."
      ],
      "tests": "error_handling_module_tests",
      "notes": "Backs global handle_error() helper via module-level singleton."
    },
    {
      "id": "class:core.error_handling.ErrorRecoveryManager",
      "type": "class",
      "name": "ErrorRecoveryManager",
      "path": "core/error_handling.py",
      "summary": "Coordinates circuit breakers and registered recovery strategies across services.",
      "mechanism": "Caches CircuitBreaker instances by name, stores recovery callbacks, exposes health status, and can reset breakers.",
      "quality": "stable",
      "concerns": [
        "Recovery strategies currently placeholders; unclear how consumers should supply implementations."
      ],
      "opportunities": [
        "Integrate with session manager to trigger actual browser/API recovery routines when breakers trip."
      ],
      "tests": null,
      "notes": "Singleton error_recovery_manager exports this for decorators and health reporting."
    },
    {
      "id": "function:core.error_handling.handle_error",
      "type": "function",
      "name": "handle_error",
      "path": "core/error_handling.py",
      "summary": "Global helper routing exceptions through ErrorHandlerRegistry to produce AppError instances.",
      "mechanism": "Delegates to registry singleton, returning AppError when provided error type matches specialized handler or fallback path.",
      "quality": "stable",
      "concerns": [
        "Relies on global registry state; thread-safety assumptions hinge on handler implementations."
      ],
      "opportunities": [
        "Expose async variant or contextvar-based registry override for tests."
      ],
      "tests": "error_handling_module_tests",
      "notes": "Used by safe_execute and ErrorContext to standardize failures."
    },
    {
      "id": "function:core.error_handling.safe_execute",
      "type": "function",
      "name": "safe_execute",
      "path": "core/error_handling.py",
      "summary": "Executes callable with blanket exception handling, logging, and fallback return value.",
      "mechanism": "Wraps function call in try/except, converts exception via handle_error, logs warning, and returns default value when failure occurs.",
      "quality": "stable",
      "concerns": [
        "Suppresses exceptions silently unless default return inspected; ensure callers monitor logs."
      ],
      "opportunities": [
        "Allow optional callback hook to observe AppError objects for telemetry."
      ],
      "tests": "error_handling_module_tests",
      "notes": "Legacy compatibility helper still used in background maintenance scripts."
    },
    {
      "id": "function:core.error_handling.retry_on_failure",
      "type": "function",
      "name": "retry_on_failure",
      "path": "core/error_handling.py",
      "summary": "Decorator factory wrapping functions with retry/backoff logic and stop conditions.",
      "mechanism": "Iterates attempts, checks stop/retry exception filters, applies exponential backoff with optional jitter, re-raises last error on exhaustion.",
      "quality": "stable",
      "concerns": [
        "Sleeps inside decorator; long-running retries may block event loops if misused."
      ],
      "opportunities": [
        "Expose async version or integrate with EnhancedErrorRecovery to unify retry reporting."
      ],
      "tests": "error_handling_module_tests",
      "notes": "Applied to SessionManager identifier fetchers and multiple action workflows."
    },
    {
      "id": "function:core.error_handling.circuit_breaker",
      "type": "function",
      "name": "circuit_breaker",
      "path": "core/error_handling.py",
      "summary": "Decorator adding per-function circuit breaker protection using module-level manager.",
      "mechanism": "Creates CircuitBreakerConfig, retrieves breaker from ErrorRecoveryManager, and delegates call through breaker state machine.",
      "quality": "stable",
      "concerns": [
        "Shares breaker per function name; collisions possible if multiple functions share identifier."
      ],
      "opportunities": [
        "Support namespacing parameter to avoid collisions and ease telemetry filtering."
      ],
      "tests": "error_handling_module_tests",
      "notes": "Used selectively for high-risk external integrations."
    },
    {
      "id": "function:core.error_handling.timeout_protection",
      "type": "function",
      "name": "timeout_protection",
      "path": "core/error_handling.py",
      "summary": "Cross-platform timeout decorator supporting Windows thread join fallback and Unix signals.",
      "mechanism": "Wraps callable execution, launching thread join on Windows or SIGALRM on Unix, raising TimeoutError when duration exceeded.",
      "quality": "monitor",
      "concerns": [
        "Thread-based timeout leaves worker thread alive post-timeout; repeated timeouts could accumulate stray threads."
      ],
      "opportunities": [
        "Explore multiprocessing or cooperative cancellation to prevent orphaned threads on Windows."
      ],
      "tests": "error_handling_module_tests",
      "notes": "Decorates long-running actions like DNA match gather and message processing."
    },
    {
      "id": "function:core.error_handling.graceful_degradation",
      "type": "function",
      "name": "graceful_degradation",
      "path": "core/error_handling.py",
      "summary": "Decorator returning fallback value or callable when wrapped function raises an exception.",
      "mechanism": "Catches exceptions, logs warning, and either invokes fallback_func or returns static fallback value.",
      "quality": "stable",
      "concerns": [
        "Fallback function executed with same args as original; ensure idempotency to avoid side effects."
      ],
      "opportunities": [
        "Emit telemetry when fallback path triggered to surface degradation frequency."
      ],
      "tests": null,
      "notes": "Often paired with timeout_protection for long-running orchestration flows."
    },
    {
      "id": "function:core.error_handling.error_context",
      "type": "function",
      "name": "error_context",
      "path": "core/error_handling.py",
      "summary": "Decorator annotating AppError context dictionaries with supplied metadata label/value pairs.",
      "mechanism": "On exception, checks for AppError, merges context data, and re-raises to caller.",
      "quality": "stable",
      "concerns": [
        "Non-AppError exceptions pass through unchanged; ensure upstream converts to AppError when needed."
      ],
      "opportunities": [
        "Allow callback hook to transform non-AppError exceptions before propagation."
      ],
      "tests": null,
      "notes": "Used across actions to tag telemetry with operation names."
    },
    {
      "id": "function:core.error_handling.error_handler",
      "type": "function",
      "name": "error_handler",
      "path": "core/error_handling.py",
      "summary": "Decorator factory that converts exceptions to AppError via registry, logs based on severity, and optionally re-raises.",
      "mechanism": "Builds wrapper capturing function metadata, invokes handle_error on exceptions, logs at severity-driven level, and re-raises when requested.",
      "quality": "stable",
      "concerns": [
        "Logging uses global logger; ensure caller modules configure handlers to avoid duplicate output."
      ],
      "opportunities": [
        "Add configuration to emit structured JSON logs for automated parsing."
      ],
      "tests": null,
      "notes": "Applies on high-level workflows needing automated error conversion."
    },
    {
      "id": "function:core.error_handling.with_circuit_breaker",
      "type": "function",
      "name": "with_circuit_breaker",
      "path": "core/error_handling.py",
      "summary": "Decorator binding functions to named circuit breakers managed by ErrorRecoveryManager.",
      "mechanism": "Retrieves breaker for service_name and routes calls through CircuitBreaker.call for stateful protection.",
      "quality": "stable",
      "concerns": [
        "No auto-registration of recovery strategies; service_name must be coordinated externally."
      ],
      "opportunities": [
        "Augment to automatically register default recovery strategy when absent."
      ],
      "tests": null,
      "notes": "Used for fine-grained breaker control beyond simple function-name binding."
    },
    {
      "id": "function:core.error_handling.with_recovery",
      "type": "function",
      "name": "with_recovery",
      "path": "core/error_handling.py",
      "summary": "Decorator invoking caller-supplied recovery strategy when wrapped function raises an exception.",
      "mechanism": "On failure logs warning and calls recovery_strategy with original args/kwargs before returning its result.",
      "quality": "stable",
      "concerns": [
        "Recovery strategy receives same arguments as failing function; must be resilient to original error context."
      ],
      "opportunities": [
        "Allow recovery strategy to receive raised exception for richer handling decisions."
      ],
      "tests": null,
      "notes": "Scaffold for custom remediation steps in action modules."
    },
    {
      "id": "module:core.session_validator",
      "type": "module",
      "name": "core.session_validator",
      "path": "core/session_validator.py",
      "summary": "Coordinates login checks, cookie validation, and CSRF readiness to certify shared session health.",
      "mechanism": "Sequences login_status verification, URL correction, essential cookie checks, cookie sync, and CSRF retrieval with skip heuristics per action and retry envelope.",
      "quality": "monitor",
      "concerns": [
        "Skip map relies on hard-coded substrings; new action names can bypass required cookie validation.",
        "Multiple utils imports performed inside methods due to circular references, making dependencies implicit."
      ],
      "opportunities": [
        "Extract skip patterns into configuration or constants co-owned with action menu definitions.",
        "Emit structured telemetry for each readiness stage to expose chronic failure points."
      ],
      "tests": "session_validator_module_tests",
      "notes": "SessionManager delegates ensure_session_ready flow here for centralized gating logic."
    },
    {
      "id": "class:core.session_validator.SessionValidator",
      "type": "class",
      "name": "SessionValidator",
      "path": "core/session_validator.py",
      "summary": "Encapsulates readiness workflow composed of login, navigation, cookie, and CSRF validation steps.",
      "mechanism": "Maintains timestamp for JS error sweep, exposes perform_readiness_checks with retry loop, and offers helper methods for cookie validation plus login verification.",
      "quality": "monitor",
      "concerns": [
        "Coupling to BrowserManager/APIManager/SessionManager is implicit through duck-typed arguments, complicating type checking.",
        "Retry loop only sleeps 5s regardless of failure reason, which can waste time on fatal conditions."
      ],
      "opportunities": [
        "Annotate parameters with Protocols to clarify required interface methods for injected managers.",
        "Surface per-attempt diagnostics object so callers can escalate when specific stages fail repeatedly."
      ],
      "tests": "session_validator_module_tests",
      "notes": "Constructed without dependencies; relies on injected managers at call time."
    },
    {
      "id": "method:SessionValidator.perform_readiness_checks",
      "type": "method",
      "name": "SessionValidator.perform_readiness_checks",
      "path": "core/session_validator.py",
      "summary": "Runs readiness stages with bounded retry attempts before declaring the shared session unhealthy.",
      "mechanism": "Loops up to max_attempts invoking _perform_all_checks, handles exceptions via _handle_check_exception, sleeps 5 seconds between tries, and logs final error message when all attempts fail.",
      "quality": "monitor",
      "concerns": [
        "Returns only boolean outcome; caller loses context on which stage failed last.",
        "Catches broad Exception, potentially masking programmer errors during readiness path."
      ],
      "opportunities": [
        "Return dataclass containing status per check and final failure reason for richer recovery decisions.",
        "Differentiate fatal vs. retryable exceptions to avoid wasting attempts on fatal states."
      ],
      "tests": "session_validator_module_tests",
      "notes": "Default max_attempts=3 with fixed 5s delay; skip_csrf flag bypasses CSRF retrieval for file-based workflows."
    },
    {
      "id": "method:SessionValidator._perform_all_checks",
      "type": "method",
      "name": "SessionValidator._perform_all_checks",
      "path": "core/session_validator.py",
      "summary": "Executes ordered readiness steps covering login, navigation, cookies, sync, and CSRF token acquisition.",
      "mechanism": "Calls _check_login_and_attempt_relogin, _check_and_handle_url, _check_essential_cookies, _sync_cookies_to_requests, and optionally _check_csrf_token, short-circuiting on failure.",
      "quality": "stable",
      "concerns": [
        "Action_name skip heuristics baked into cookie check reduce reuse outside current action set."
      ],
      "opportunities": [
        "Allow dependency injection for each stage to facilitate targeted testing or customization."
      ],
      "tests": "session_validator_module_tests",
      "notes": "Returns tuple of success flag and message consumed by outer retry loop."
    },
    {
      "id": "method:SessionValidator._handle_check_exception",
      "type": "method",
      "name": "SessionValidator._handle_check_exception",
      "path": "core/session_validator.py",
      "summary": "Normalizes exceptions encountered during readiness attempts, signaling when to abort retries.",
      "mechanism": "If WebDriverException occurs, logs and checks driver health to decide abort; otherwise logs unexpected exception with traceback and advises retry.",
      "quality": "stable",
      "concerns": [
        "Relies on BrowserManager.is_session_valid side effects; return value alone may miss partial driver corruption."
      ],
      "opportunities": [
        "Attach structured error codes to differentiate WebDriver failures vs. logic errors for analytics."
      ],
      "tests": "session_validator_module_tests",
      "notes": "Returns tuple (should_abort, message) consumed by perform_readiness_checks."
    },
    {
      "id": "method:SessionValidator._check_login_and_attempt_relogin",
      "type": "method",
      "name": "SessionValidator._check_login_and_attempt_relogin",
      "path": "core/session_validator.py",
      "summary": "Confirms Ancestry login and triggers relogin via utils when session expired.",
      "mechanism": "Imports utils.login_status lazily, checks API login with disable_ui_fallback, and if false calls _attempt_relogin to reauthenticate before proceeding.",
      "quality": "monitor",
      "concerns": [
        "Hard dependency on utils.login_status and log_in while avoiding circular imports hides coupling.",
        "Relogin failure returns generic message without reason from login flow, challenging troubleshooting."
      ],
      "opportunities": [
        "Refactor login helpers into dedicated auth module to remove late imports and clarify responsibilities.",
        "Bubble up LoginResult enums so callers can handle MFA, captcha, or outage scenarios differently."
      ],
      "tests": "session_validator_module_tests",
      "notes": "Returns (success, message) to outer coordination method."
    },
    {
      "id": "method:SessionValidator._attempt_relogin",
      "type": "method",
      "name": "SessionValidator._attempt_relogin",
      "path": "core/session_validator.py",
      "summary": "Delegates to utils.log_in to re-establish browser-authenticated session when needed.",
      "mechanism": "Imports log_in lazily, invokes with session_manager, and interprets LOGIN_SUCCEEDED string response as success.",
      "quality": "monitor",
      "concerns": [
        "Return contract tied to magic string responses; upstream changes could silently break relogin detection."
      ],
      "opportunities": [
        "Adopt structured LoginResult enum to avoid string comparisons and convey detailed failure causes."
      ],
      "tests": "session_validator_module_tests",
      "notes": "Logs failures at error level to surface multi-attempt relogin issues."
    },
    {
      "id": "method:SessionValidator._check_and_handle_url",
      "type": "method",
      "name": "SessionValidator._check_and_handle_url",
      "path": "core/session_validator.py",
      "summary": "Validates current browser URL is within configured Ancestry domain and navigates home when off-track.",
      "mechanism": "Inspects driver.current_url, compares to config_schema.api.base_url, and uses utils.nav_to_page to redirect when necessary.",
      "quality": "stable",
      "concerns": [
        "Assumes browser_manager.driver is available and responsive; no fallback if driver attribute missing."
      ],
      "opportunities": [
        "Accept expected URL prefix parameter to support regional domains or staging environments."
      ],
      "tests": "session_validator_module_tests",
      "notes": "Treats navigation failure as readiness failure, prompting outer retry loop."
    },
    {
      "id": "method:SessionValidator._should_skip_cookie_check",
      "type": "method",
      "name": "SessionValidator._should_skip_cookie_check",
      "path": "core/session_validator.py",
      "summary": "Determines whether essential cookie validation can be bypassed for given action names.",
      "mechanism": "Compares lowercased action_name against predefined substring map returning skip flag and justification string.",
      "quality": "monitor",
      "concerns": [
        "String containment rules risk false positives/negatives when action labels change or overlap."
      ],
      "opportunities": [
        "Share action identifiers via central registry so skip conditions stay synchronized with menu definitions."
      ],
      "tests": "session_validator_module_tests",
      "notes": "Supports legacy aliases (coord, srch_inbox) to bridge historical command variants."
    },
    {
      "id": "method:SessionValidator._check_essential_cookies",
      "type": "method",
      "name": "SessionValidator._check_essential_cookies",
      "path": "core/session_validator.py",
      "summary": "Verifies presence of OptanonConsent and trees cookies unless heuristics skip the check.",
      "mechanism": "Invokes _should_skip_cookie_check, then relies on BrowserManager.get_cookies to confirm required names and logs warning when missing.",
      "quality": "stable",
      "concerns": [
        "Essential cookie list hard-coded; future platform changes may require additional cookie checks."
      ],
      "opportunities": [
        "Read essential cookie names from configuration to adapt across regions or product updates."
      ],
      "tests": "session_validator_module_tests",
      "notes": "Returns (success, reason) tuple so caller can log skip justification."
    },
    {
      "id": "method:SessionValidator._sync_cookies_to_requests",
      "type": "method",
      "name": "SessionValidator._sync_cookies_to_requests",
      "path": "core/session_validator.py",
      "summary": "Bridges BrowserManager cookies into APIManager's pooled requests session with recovery awareness.",
      "mechanism": "Calls APIManager.sync_cookies_from_browser passing through session_manager for retry support and surfaces success flag with error message.",
      "quality": "stable",
      "concerns": [
        "Returns False on failure without capturing which cookie caused issues or whether recovery ran."
      ],
      "opportunities": [
        "Emit structured event including cookie counts and recovery path to aid monitoring."
      ],
      "tests": "session_validator_module_tests",
      "notes": "Central fix ensures session_manager forwarded so APIManager can trigger recovery."
    },
    {
      "id": "method:SessionValidator._check_csrf_token",
      "type": "method",
      "name": "SessionValidator._check_csrf_token",
      "path": "core/session_validator.py",
      "summary": "Ensures APIManager caches CSRF token while tolerating retrieval failures for non-critical actions.",
      "mechanism": "Requests new CSRF token when missing, logs warnings on failure, and treats errors as non-blocking by returning True with None message.",
      "quality": "stable",
      "concerns": [
        "Suppressing CSRF fetch failures may hide genuine authentication regressions."
      ],
      "opportunities": [
        "Track failure counts separately so repeated CSRF issues trigger proactive session refresh."
      ],
      "tests": "session_validator_module_tests",
      "notes": "Pairs with SessionManager._precache_csrf_token for pre-fetch optimization."
    },
    {
      "id": "method:SessionValidator.validate_session_cookies",
      "type": "method",
      "name": "SessionValidator.validate_session_cookies",
      "path": "core/session_validator.py",
      "summary": "Utility wrapper verifying required cookie names exist when browser session is valid.",
      "mechanism": "Checks BrowserManager.is_session_valid before delegating to get_cookies, returning False on exceptions.",
      "quality": "stable",
      "concerns": [
        "Swallows detailed cookie lookup errors, emitting only generic exception message in logs."
      ],
      "opportunities": [
        "Return missing cookie names for faster diagnosis of partial cookie sets."
      ],
      "tests": "session_validator_module_tests",
      "notes": "Used by integration tests to assert essential cookies present."
    },
    {
      "id": "method:SessionValidator.verify_login_status",
      "type": "method",
      "name": "SessionValidator.verify_login_status",
      "path": "core/session_validator.py",
      "summary": "Confirms login via APIManager with optional cookie sync support from SessionManager.",
      "mechanism": "Calls APIManager.verify_api_login_status, interprets tri-state response, and logs unexpected exceptions as failures.",
      "quality": "stable",
      "concerns": [
        "Returns False for both explicit logout and unexpected errors; caller must inspect logs to differentiate."
      ],
      "opportunities": [
        "Return enum capturing success/failure/critical to clarify upstream handling."
      ],
      "tests": "session_validator_module_tests",
      "notes": "Complements readiness checks by offering standalone login verification helper."
    },
    {
      "id": "module:utils",
      "type": "module",
      "name": "utils",
      "path": "utils.py",
      "summary": "Monolithic utility module spanning login automation, navigation helpers, rate limiting, and general cross-cutting support.",
      "mechanism": "Central helper hub providing logging helpers, cookie/name formatting, decorators (retry, ensure_browser_open, time_wait), circuit breaker, AdaptiveRateLimiter proxy (get_rate_limiter), API header prep plus _api_req/_api_req_impl with ApiRequestConfig, and session guard/availability checks consumed by SessionManager-driven actions.",
      "quality": "production",
      "concerns": [
        "Monolithic 4k-line module mixes unrelated concerns (logging, HTTP, sleep prevention) making maintenance risky.",
        "run_comprehensive_tests stub lacks body/return, so __main__ TestSuite only runs via script execution and cannot be invoked programmatically.",
        "Direct session_manager.rate_limiter usage assumes SessionManager always injects AdaptiveRateLimiter; misuse in isolation will throw."
      ],
      "opportunities": [
        "Split into focused packages (logging_utils, api_requests, decorators) to ease type-checking and testing.",
        "Expose first-class ApiRequestConfig-based public API and deprecate legacy positional _api_req signature.",
        "Wire the TestSuite into create_standard_test_runner so run_all_tests can execute without spawning __main__ block."
      ],
      "tests": "Manual TestSuite under __main__ (no exported runner)",
      "notes": "Relies on config.config_schema, rate_limiter.get_adaptive_rate_limiter, session_utils, and multiple SQL/selenium modules; nearly every action imports pieces from here."
    },
    {
      "id": "function:utils.log_action_configuration",
      "type": "function",
      "name": "log_action_configuration",
      "path": "utils.py",
      "summary": "Formats and logs configuration dictionaries as a single standardized line for operator visibility.",
      "mechanism": "Iterates key/value pairs, normalizes booleans to Yes/No, joins with pipes, and emits info-level log entry prefixed by provided section title.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Consider enforcing deterministic key ordering for reproducible output across runs."
      ],
      "tests": null,
      "notes": "Used by multiple actions to snapshot effective runtime configuration."
    },
    {
      "id": "function:utils.log_starting_position",
      "type": "function",
      "name": "log_starting_position",
      "path": "utils.py",
      "summary": "Reports initial work scope and optional detail map prior to batch processing.",
      "mechanism": "Writes primary description line and, when details provided, emits individual key/value lines using info-level logging.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Could emit structured telemetry alongside logs for analytics parity."
      ],
      "tests": null,
      "notes": "Keeps operator context aligned with resume checkpoints and dry-run modes."
    },
    {
      "id": "function:utils.log_cumulative_counts",
      "type": "function",
      "name": "log_cumulative_counts",
      "path": "utils.py",
      "summary": "Outputs comma-separated cumulative counters with optional prefix label.",
      "mechanism": "Joins supplied dictionary into key=value pairs and logs a single info-level line prefixed by configurable label.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Can extend to pad numeric fields for easier visual comparison among runs."
      ],
      "tests": null,
      "notes": "Pairs with per-page summaries to show running totals during long actions."
    },
    {
      "id": "function:utils.log_batch_indicator",
      "type": "function",
      "name": "log_batch_indicator",
      "path": "utils.py",
      "summary": "Announces current batch/page position and optional item ranges before processing.",
      "mechanism": "Logs an empty line for spacing, prints page position when provided, and formats batch range or ordinal count.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Could accept logger instance override to support structured progress channels."
      ],
      "tests": null,
      "notes": "Used across Actions 6-9 to keep CLI output consistent."
    },
    {
      "id": "function:utils.create_standard_progress_bar",
      "type": "function",
      "name": "create_standard_progress_bar",
      "path": "utils.py",
      "summary": "Provides a preconfigured tqdm progress bar with shared formatting.",
      "mechanism": "Imports tqdm lazily, instantiates bar with unified description, units, and percent/ETA formatting.",
      "quality": "stable",
      "concerns": [
        "Function depends on tqdm being available; missing package raises ImportError at runtime."
      ],
      "opportunities": [
        "Expose ability to override bar format for specialized actions without duplicating code."
      ],
      "tests": null,
      "notes": "Callers wrap iteration with context manager to ensure automatic cleanup."
    },
    {
      "id": "function:utils.log_page_complete",
      "type": "function",
      "name": "log_page_complete",
      "path": "utils.py",
      "summary": "Logs per-page completion statistics and delegates to cumulative counter output.",
      "mechanism": "Formats given per-page counts into key=value string, logs page completion line, then invokes log_cumulative_counts with running totals.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Could add elapsed time per page for richer throughput diagnostics."
      ],
      "tests": null,
      "notes": "Ensures each page finish message is paired with cumulative totals."
    },
    {
      "id": "function:utils.log_final_summary",
      "type": "function",
      "name": "log_final_summary",
      "path": "utils.py",
      "summary": "Prints and logs end-of-run summary with aligned labels and total runtime.",
      "mechanism": "Outputs blank spacing, draws ASCII separators, aligns dictionary keys based on longest label, and formats run duration into hours/minutes/seconds.",
      "quality": "stable",
      "concerns": [
        "Direct stdout print introduces dual output streams; consider routing through logger for consistency."
      ],
      "opportunities": [
        "Emit structured summary payload for machine consumption alongside human-readable log."
      ],
      "tests": null,
      "notes": "Commonly used after batch actions to present consolidated metrics."
    },
    {
      "id": "function:utils.log_action_status",
      "type": "function",
      "name": "log_action_status",
      "path": "utils.py",
      "summary": "Emits success/failure message with visual indicator for high-level action results.",
      "mechanism": "Checks boolean success flag, logs error with \u2717 marker and message when failure occurs, otherwise remains silent to avoid duplicate messaging.",
      "quality": "stable",
      "concerns": [
        "Success path produces no log entry; operators must rely on preceding context for confirmation."
      ],
      "opportunities": [
        "Optionally log positive confirmation when verbose logging enabled."
      ],
      "tests": null,
      "notes": "Provides consistent operator feedback across menu-driven actions."
    },
    {
      "id": "function:utils.fast_json_loads",
      "type": "function",
      "name": "fast_json_loads",
      "path": "utils.py",
      "summary": "Parses JSON using orjson when available with graceful fallback to standard library.",
      "mechanism": "Attempts dynamic import of orjson and decodes payload, otherwise defers to json.loads when package missing.",
      "quality": "stable",
      "concerns": [
        "Does not surface import failure telemetry, making it harder to detect missing optional dependency."
      ],
      "opportunities": [
        "Cache import result to avoid repeated module lookups on tight loops."
      ],
      "tests": null,
      "notes": "Used wherever fast JSON deserialization is desired without hard dependency."
    },
    {
      "id": "function:utils.fast_json_dumps",
      "type": "function",
      "name": "fast_json_dumps",
      "path": "utils.py",
      "summary": "Serializes objects to JSON preferring orjson for speed while respecting indent/ASCII options.",
      "mechanism": "Tries orjson.dumps for compact encoding, falls back to json.dumps when indentation requested or package absent.",
      "quality": "stable",
      "concerns": [
        "Repeated import attempts may incur slight overhead in tight loops; caching would help."
      ],
      "opportunities": [
        "Expose separators override for callers needing alternate compact formatting."
      ],
      "tests": null,
      "notes": "Maintains compatibility with downstream persistence utilities expecting strings."
    },
    {
      "id": "function:utils.parse_cookie",
      "type": "function",
      "name": "parse_cookie",
      "path": "utils.py",
      "summary": "Splits raw Set-Cookie style strings into a dictionary while ignoring malformed components.",
      "mechanism": "Splits on semicolons, trims whitespace, separates on first equals sign, and logs debug message when component lacks delimiter.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Could normalize attribute casing or decode percent-encoding for richer analysis."
      ],
      "tests": null,
      "notes": "Underpins cookie persistence validation and telemetry utilities."
    },
    {
      "id": "function:utils._get_cookie_file_path",
      "type": "function",
      "name": "_get_cookie_file_path",
      "path": "utils.py",
      "summary": "Returns repository-relative Path for persisted login cookies.",
      "mechanism": "Builds pathlib.Path pointing to ancestry_cookies.json in project root.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Allow overriding via configuration to support multi-profile runs."
      ],
      "tests": null,
      "notes": "Used by save/load helpers to centralize location management."
    },
    {
      "id": "function:utils._save_login_cookies",
      "type": "function",
      "name": "_save_login_cookies",
      "path": "utils.py",
      "summary": "Persists current Selenium cookies to ancestry_cookies.json for browserless API usage.",
      "mechanism": "Validates driver presence, dumps driver cookies via json.dump to cookie file, and logs counts with emoji marker.",
      "quality": "monitor",
      "concerns": [
        "Swallows broad exceptions with warning, so repeated failures may not surface root cause quickly."
      ],
      "opportunities": [
        "Capture failure reason telemetry (e.g., permission denied) to aid troubleshooting."
      ],
      "tests": null,
      "notes": "Reusable helper invoked after successful login or 2FA completion."
    },
    {
      "id": "function:utils._load_login_cookies",
      "type": "function",
      "name": "_load_login_cookies",
      "path": "utils.py",
      "summary": "Reads persisted login cookies and injects them into the active WebDriver session.",
      "mechanism": "Ensures driver exists, loads JSON cookie list, strips expired entries, and adds each cookie while logging successes and failures.",
      "quality": "monitor",
      "concerns": [
        "Expired or incompatible cookies quietly skip with debug logging; consumers must inspect logs to detect partial loads."
      ],
      "opportunities": [
        "Return detailed status containing loaded/failed counts for upstream handling."
      ],
      "tests": null,
      "notes": "Support function for browserless API bootstrap and session restore flows."
    },
    {
      "id": "function:utils._get_ordinal_suffix",
      "type": "function",
      "name": "_get_ordinal_suffix",
      "path": "utils.py",
      "summary": "Determines appropriate ordinal suffix for integer values with special-case handling for teens.",
      "mechanism": "Evaluates modulo 100 and modulo 10 to select st/nd/rd/th endings while guarding 11-13 as th.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Extend to support locale-specific suffixes if internationalization required."
      ],
      "tests": null,
      "notes": "Utility used by ordinal formatting helpers and reporting output."
    },
    {
      "id": "function:utils._format_number_as_ordinal",
      "type": "function",
      "name": "_format_number_as_ordinal",
      "path": "utils.py",
      "summary": "Converts integer to ordinal string by appending suffix returned from helper.",
      "mechanism": "Calls _get_ordinal_suffix and concatenates with integer converted to string.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Could cache common suffix results for micro-optimizations though unnecessary currently."
      ],
      "tests": null,
      "notes": "Supports ordinal_case when numeric input provided."
    },
    {
      "id": "function:utils._title_case_with_lowercase_particles",
      "type": "function",
      "name": "_title_case_with_lowercase_particles",
      "path": "utils.py",
      "summary": "Applies title casing while keeping select particles (of, the, etc.) lowercase except at beginning.",
      "mechanism": "Title-cases string, splits into words, downgrades matching particles after first word, then rejoins.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Allow callers to customize particle set for locale-specific rules."
      ],
      "tests": null,
      "notes": "Used for human-friendly formatting of ordinal text inputs."
    },
    {
      "id": "function:utils.ordinal_case",
      "type": "function",
      "name": "ordinal_case",
      "path": "utils.py",
      "summary": "Normalizes ordinals or title cases arbitrary text depending on input type.",
      "mechanism": "Attempts to coerce value to int and delegates to _format_number_as_ordinal; on failure, applies _title_case_with_lowercase_particles or returns string fallback.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Could expose flag to skip title casing when dealing with already formatted strings."
      ],
      "tests": null,
      "notes": "Shared across message generation and reporting utilities."
    },
    {
      "id": "function:utils._remove_gedcom_slashes",
      "type": "function",
      "name": "_remove_gedcom_slashes",
      "path": "utils.py",
      "summary": "Cleans GEDCOM-formatted surnames by stripping slash delimiters and collapsing whitespace.",
      "mechanism": "Uses regex substitutions to remove leading, trailing, and embedded /surname/ markers, then normalizes spaces.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add logging when unusual patterns encountered to help maintain data hygiene."
      ],
      "tests": null,
      "notes": "First step in name normalization pipeline."
    },
    {
      "id": "function:utils._format_quoted_nickname",
      "type": "function",
      "name": "_format_quoted_nickname",
      "path": "utils.py",
      "summary": "Capitalizes nicknames enclosed in single quotes while retaining quoting.",
      "mechanism": "Checks boundary quotes and minimum length, slices inner text, capitalizes, and rejoins with apostrophes.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Could support double-quoted nicknames encountered in alternate formats."
      ],
      "tests": null,
      "notes": "Helper used within _format_name_part when encountering quoted tokens."
    },
    {
      "id": "function:utils._format_hyphenated_name",
      "type": "function",
      "name": "_format_hyphenated_name",
      "path": "utils.py",
      "summary": "Title-cases hyphenated name sections while preserving lowercase particles mid-name.",
      "mechanism": "Splits token on hyphen, applies lowercase particle rule to subsequent segments, capitalizes remaining parts, and rejoins with hyphen.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Provide ability to keep custom casing for locales with unique hyphenation rules."
      ],
      "tests": null,
      "notes": "Integrated into _format_name_part for complex surnames."
    },
    {
      "id": "function:utils._format_apostrophe_name",
      "type": "function",
      "name": "_format_apostrophe_name",
      "path": "utils.py",
      "summary": "Handles capitalization for names containing internal apostrophes such as O'Malley.",
      "mechanism": "Splits token on apostrophes, capitalizes segments, rejoins with apostrophe when boundaries permit.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Account for rare leading/trailing apostrophes with more nuanced formatting."
      ],
      "tests": null,
      "notes": "Subroutine for _format_name_part to cover Irish/Scottish surnames."
    },
    {
      "id": "function:utils._format_mc_mac_prefix",
      "type": "function",
      "name": "_format_mc_mac_prefix",
      "path": "utils.py",
      "summary": "Normalizes Mc/Mac prefixes ensuring subsequent characters are capitalized appropriately.",
      "mechanism": "Lowercases token, checks for mc/mac prefixes, and constructs capitalized variants while preserving standalone 'Mac'.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Extend to handle other Gaelic prefixes such as 'M\u2019'."
      ],
      "tests": null,
      "notes": "Executed within _format_name_part before generic capitalization."
    },
    {
      "id": "function:utils._format_initial",
      "type": "function",
      "name": "_format_initial",
      "path": "utils.py",
      "summary": "Standardizes single-letter initials with optional trailing period.",
      "mechanism": "Detects one- or two-character tokens ending with period, uppercases alpha characters, and returns normalized form.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Could support multi-character initials such as 'Ph.' via configuration if needed."
      ],
      "tests": null,
      "notes": "Applied by _format_name_part when encountering abbreviated name pieces."
    },
    {
      "id": "function:utils._format_name_part",
      "type": "function",
      "name": "_format_name_part",
      "path": "utils.py",
      "summary": "Composes formatting logic for individual name tokens handling particles, nicknames, prefixes, and initials.",
      "mechanism": "Evaluates token against lowercase particle set, uppercase exceptions, nickname, hyphen, apostrophe, Mc/Mac, and initial handlers before default capitalization.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Refactor into strategy map to ease maintenance as new cases arise."
      ],
      "tests": null,
      "notes": "Central decision point for format_name pipeline."
    },
    {
      "id": "function:utils.format_name",
      "type": "function",
      "name": "format_name",
      "path": "utils.py",
      "summary": "Normalizes raw ancestor names into polished title case while honoring particles, prefixes, and nicknames.",
      "mechanism": "Validates input, removes GEDCOM slashes, splits tokens, maps each through _format_name_part, rejoins, and falls back gracefully on errors.",
      "quality": "stable",
      "concerns": [
        "Logs errors but still relies on fallback .title() for exceptions; may hide systemic formatting drift."
      ],
      "opportunities": [
        "Emit telemetry when falling back to default formatting to flag data anomalies."
      ],
      "tests": null,
      "notes": "Used extensively across messaging, reporting, and UI presentation layers."
    },
    {
      "id": "function:utils._validate_driver_session",
      "type": "function",
      "name": "_validate_driver_session",
      "path": "utils.py",
      "summary": "Quick health check ensuring Selenium driver session remains valid before generating headers.",
      "mechanism": "Returns False when driver missing; otherwise touches driver.title to trigger WebDriverException when session stale and logs warning.",
      "quality": "stable",
      "concerns": [
        "Relying on driver.title may incur latency on certain drivers; consider lighter heartbeat probe."
      ],
      "opportunities": [
        "Surface reason codes distinguishable by caller to improve retry handling."
      ],
      "tests": null,
      "notes": "First guard in make_ube because UBE header generation requires live session."
    },
    {
      "id": "function:utils._get_ancsessionid_cookie",
      "type": "function",
      "name": "_get_ancsessionid_cookie",
      "path": "utils.py",
      "summary": "Retrieves ANCSESSIONID cookie value via targeted lookup with fallback enumeration.",
      "mechanism": "Queries driver.get_cookie for specific name, falls back to building name\u2192value map from all cookies, and logs warnings when not found or on WebDriver errors.",
      "quality": "monitor",
      "concerns": [
        "Broad exception handling may hide driver misconfiguration unless logs monitored closely."
      ],
      "opportunities": [
        "Return structured status detailing failure mode (missing vs error) for telemetry."
      ],
      "tests": null,
      "notes": "Essential for UBE header generation to align with marketing analytics requirements."
    },
    {
      "id": "function:utils._build_ube_payload",
      "type": "function",
      "name": "_build_ube_payload",
      "path": "utils.py",
      "summary": "Constructs dictionary payload representing UBE analytics metadata for DNA match pages.",
      "mechanism": "Sets constant event identifiers, generates correlated UUID, inserts ANCSESSIONID, and defines consent/vendor strings expected by downstream service.",
      "quality": "stable",
      "concerns": [
        "Hard-coded screen names may drift if product taxonomy changes; needs monitoring."
      ],
      "opportunities": [
        "Centralize constants alongside analytics configuration for easier updates."
      ],
      "tests": null,
      "notes": "Intermediate step in make_ube before encoding to base64."
    },
    {
      "id": "function:utils._encode_ube_payload",
      "type": "function",
      "name": "_encode_ube_payload",
      "path": "utils.py",
      "summary": "Serializes UBE payload to compact base64 string handling encoding errors defensively.",
      "mechanism": "Dumps dict to JSON with separators, encodes UTF-8 bytes, base64-encodes result, and logs detailed errors on exceptions.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Return error details alongside None to assist upstream retries or fallbacks."
      ],
      "tests": null,
      "notes": "Final transformation step prior to returning header string."
    },
    {
      "id": "function:utils.make_ube",
      "type": "function",
      "name": "make_ube",
      "path": "utils.py",
      "summary": "Generates encoded UBE header string required for certain Ancestry API requests.",
      "mechanism": "Validates driver session, obtains ANCSESSIONID cookie, builds analytics payload, encodes to base64, and returns header-compatible string or None on failure.",
      "quality": "monitor",
      "concerns": [
        "Fails silently by returning None; callers must handle absence carefully to avoid analytics regressions."
      ],
      "opportunities": [
        "Expose detailed failure enumeration so upstream logic can distinguish session vs encoding issues."
      ],
      "tests": null,
      "notes": "Used when constructing authenticated API requests requiring enhanced telemetry headers."
    },
    {
      "id": "function:utils.main",
      "type": "function",
      "name": "main",
      "path": "utils.py",
      "summary": "Entry point executing the module test suite when utils.py run as script.",
      "mechanism": "Prints banner, invokes run_comprehensive_tests, and exits with status code reflecting suite success.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Could support selective test filters via CLI arguments if suite grows further."
      ],
      "tests": null,
      "notes": "Aligns with repository convention for modules embedding self-tests."
    },
    {
      "id": "function:utils._create_stubbed_session_manager",
      "type": "function",
      "name": "_create_stubbed_session_manager",
      "path": "utils.py",
      "summary": "Builds SessionManager with patched dependencies for isolated utility testing.",
      "mechanism": "Uses unittest.mock patches to supply stubbed DatabaseManager, BrowserManager, APIManager, and SessionValidator instances while returning constructed SessionManager and mocks.",
      "quality": "stable",
      "concerns": [
        "Stub relies on internal SessionManager methods; refactors may require synchronized updates to keep tests valid."
      ],
      "opportunities": [
        "Move helper to dedicated test utilities module for reuse across other suites."
      ],
      "tests": null,
      "notes": "Called by utils_module_tests and comprehensive suite to validate session scaffolding."
    },
    {
      "id": "function:utils.utils_module_tests",
      "type": "function",
      "name": "utils_module_tests",
      "path": "utils.py",
      "summary": "Quick smoke-test wrapper validating core utility availability and basic behaviors.",
      "mechanism": "Executes assertions covering format_name defaults, rate limiter instantiation, SessionManager stubbing, and log utility registration, returning boolean success state.",
      "quality": "stable",
      "concerns": [
        "Provides limited coverage; primarily ensures functions import without raising but not exhaustive correctness."
      ],
      "opportunities": [
        "Expand to include targeted regression checks for cookie persistence when issues arise."
      ],
      "tests": null,
      "notes": "Used by run_comprehensive_tests as part of module health verification."
    },
    {
      "id": "function:utils.run_comprehensive_tests",
      "type": "function",
      "name": "run_comprehensive_tests",
      "path": "utils.py",
      "summary": "Standardized TestSuite runner executing extensive unit checks for utilities, formatting, rate limiting, and session scaffolding.",
      "mechanism": "Registers multiple inline test functions with TestSuite covering cookie parsing, ordinals, names, decorators, circuit breaker, rate limiter, session manager, API helpers, login status, module registration, unavailability detection, performance, and sleep prevention before generating summary report.",
      "quality": "stable",
      "concerns": [
        "Inline tests rely on side-effect heavy mocks; failing patches may produce verbose console output requiring manual triage."
      ],
      "opportunities": [
        "Consider extracting reusable test cases to dedicated modules for reuse in CI contexts."
      ],
      "tests": null,
      "notes": "Returned boolean consumed by module main() for exit status."
    },
    {
      "id": "function:utils.log_in",
      "type": "function",
      "name": "log_in",
      "path": "utils.py",
      "summary": "Drives full Ancestry login flow including consent handling, credential entry, and optional 2FA processing.",
      "mechanism": "Navigates to signin, dismisses consent, submits credentials, inspects for login errors, detects MFA, and verifies final login status returning status strings.",
      "quality": "monitor",
      "concerns": [
        "Returns string status codes rather than structured results; downstream string comparisons are brittle.",
        "Leans on numerous private helpers that perform side effects on global driver state, making isolation testing hard."
      ],
      "opportunities": [
        "Refactor return contract to typed enum/datastructure conveying failure reasons and next steps.",
        "Extract credential submission and MFA handling into reusable components for other auth flows."
      ],
      "tests": null,
      "notes": "SessionValidator._attempt_relogin imports this lazily to restart sessions during readiness checks."
    },
    {
      "id": "function:utils.login_status",
      "type": "function",
      "name": "login_status",
      "path": "utils.py",
      "summary": "Determines login state by prioritizing API verification with optional UI fallback heuristics.",
      "mechanism": "Validates SessionManager inputs, syncs cookies, queries APIManager.verify_api_login_status, and if ambiguous optionally inspects DOM indicators via Selenium.",
      "quality": "monitor",
      "concerns": [
        "Decorated with retry yet still returns None on ambiguous outcomes, requiring callers to interpret meaning.",
        "UI fallback relies on CSS selectors that may change without notice, risking false negatives."
      ],
      "opportunities": [
        "Return structured result enumerating API vs UI findings so callers understand uncertainty.",
        "Centralize selectors/config in a definition file to reduce maintenance burden."
      ],
      "tests": null,
      "notes": "SessionValidator._check_login_and_attempt_relogin uses this for readiness gating and relogin logic."
    },
    {
      "id": "function:utils._validate_login_status_inputs",
      "type": "function",
      "name": "_validate_login_status_inputs",
      "path": "utils.py",
      "summary": "Ensures SessionManager prerequisites are satisfied before running login checks.",
      "mechanism": "Confirms the object exposes driver/is_sess_valid attributes, verifies the session remains valid, and returns tri-state values reflecting readiness.",
      "quality": "stable",
      "concerns": [
        "Returns None on missing driver, forcing callers to infer whether the check failed or status is unknown."
      ],
      "opportunities": [
        "Replace None with a structured error type so callers can log precise remediation guidance."
      ],
      "tests": null,
      "notes": "First guard invoked by login_status before API or UI probes."
    },
    {
      "id": "function:utils._perform_api_login_check",
      "type": "function",
      "name": "_perform_api_login_check",
      "path": "utils.py",
      "summary": "Attempts to determine login status using API calls before falling back to UI heuristics.",
      "mechanism": "Syncs cookies into the requests session, invokes APIManager.verify_api_login_status, and propagates boolean results or None on failure.",
      "quality": "monitor",
      "concerns": [
        "Catches broad exceptions and returns None, hiding whether the failure was network, auth, or coding error."
      ],
      "opportunities": [
        "Return structured data capturing exception type so upstream callers can differentiate transient vs fatal states."
      ],
      "tests": null,
      "notes": "Primary branch used by login_status; drives overall result when API is reliable."
    },
    {
      "id": "function:utils._check_ui_login_indicators",
      "type": "function",
      "name": "_check_ui_login_indicators",
      "path": "utils.py",
      "summary": "Inspects the DOM for elements that imply the user is logged in or logged out.",
      "mechanism": "Calls is_elem_there for both the confirmed-login selector and the login button selector, returning tri-state results based on presence.",
      "quality": "monitor",
      "concerns": [
        "Relies on hard-coded Ancestry selectors and fixed waits that may become stale if the UI changes."
      ],
      "opportunities": [
        "Move selector definitions into configuration so tests can validate them independently of code changes."
      ],
      "tests": null,
      "notes": "Used by the UI fallback path inside login_status."
    },
    {
      "id": "function:utils._perform_ui_login_check_with_navigation",
      "type": "function",
      "name": "_perform_ui_login_check_with_navigation",
      "path": "utils.py",
      "summary": "Provides a UI-based login verification path with an optional navigation retry.",
      "mechanism": "Evaluates _check_ui_login_indicators, navigates to the base URL when inconclusive, re-runs the indicator checks, and defaults to False for safety.",
      "quality": "monitor",
      "concerns": [
        "Defaults to False even when indicators remain inconclusive after navigation, risking false negatives."
      ],
      "opportunities": [
        "Return an explicit tri-state enum to distinguish true failures from inconclusive UI checks."
      ],
      "tests": null,
      "notes": "Final fallback used by login_status when API verification returns None."
    },
    {
      "id": "function:utils.nav_to_page",
      "type": "function",
      "name": "nav_to_page",
      "path": "utils.py",
      "summary": "Robust navigation helper that retries Selenium get() calls with session restarts and unavailability heuristics.",
      "mechanism": "Validates inputs, normalizes URLs, attempts navigation with configurable timeouts, checks URL mismatches, handles MFA/login redirects, and waits for target selectors before success.",
      "quality": "monitor",
      "concerns": [
        "Complex 200+ line flow mixes retry logic, DOM checks, and session restarts, making reasoning about states challenging.",
        "Depends on global config_schema values; difficult to reuse with alternate settings (e.g., staging)."
      ],
      "opportunities": [
        "Extract navigation attempt state machine into dedicated class for improved testability.",
        "Emit structured telemetry covering retry counts, redirect causes, and alert handling outcomes."
      ],
      "tests": null,
      "notes": "SessionValidator._check_and_handle_url and numerous action workflows rely on this for deterministic navigation."
    },
    {
      "id": "function:utils._validate_nav_inputs",
      "type": "function",
      "name": "_validate_nav_inputs",
      "path": "utils.py",
      "summary": "Sanity-checks navigation arguments before attempting browser actions.",
      "mechanism": "Confirms the target URL string is present and logs an error when validation fails, returning a boolean gate to the caller.",
      "quality": "stable",
      "concerns": [
        "Only reports a generic error message, offering little context about malformed inputs."
      ],
      "opportunities": [
        "Return descriptive failure reasons so callers can surface actionable telemetry."
      ],
      "tests": null,
      "notes": "Initial guard within nav_to_page prior to URL normalization."
    },
    {
      "id": "function:utils._parse_and_normalize_url",
      "type": "function",
      "name": "_parse_and_normalize_url",
      "path": "utils.py",
      "summary": "Parses a target URL and normalizes it for redirect comparisons.",
      "mechanism": "Uses urlparse/urlunparse to strip query fragments and trailing slashes, returning a comparable base path string or None on failure.",
      "quality": "stable",
      "concerns": [
        "Swallows ValueError by returning None, requiring the caller to infer exact parsing issues."
      ],
      "opportunities": [
        "Log the offending URL and exception details to simplify debugging of malformed input."
      ],
      "tests": null,
      "notes": "Provides the canonical form used throughout nav_to_page retry logic."
    },
    {
      "id": "function:utils._check_browser_session",
      "type": "function",
      "name": "_check_browser_session",
      "path": "utils.py",
      "summary": "Validates that the WebDriver session is alive before each navigation attempt.",
      "mechanism": "Calls is_browser_open to inspect driver health and uses SessionManager.restart_sess to recover when the browser is dead, returning a usable driver instance or None.",
      "quality": "monitor",
      "concerns": [
        "Assumes a successful restart always yields a driver instance, but does not expose diagnostics when restart_sess silently fails."
      ],
      "opportunities": [
        "Return a structured result including restart outcome and reason codes for observability."
      ],
      "tests": null,
      "notes": "First step inside each _perform_navigation_attempt iteration."
    },
    {
      "id": "function:utils._execute_navigation",
      "type": "function",
      "name": "_execute_navigation",
      "path": "utils.py",
      "summary": "Performs the actual driver.get call and waits for document readiness.",
      "mechanism": "Invokes driver.get with the target URL, waits for document.readyState via WebDriverWait, and adds a short random sleep before returning.",
      "quality": "stable",
      "concerns": [
        "Randomized sleep introduces nondeterministic delays that complicate performance tuning."
      ],
      "opportunities": [
        "Replace random sleep with an explicit configurable delay or additional ready-state checks."
      ],
      "tests": null,
      "notes": "Called during every navigation attempt once pre-checks pass."
    },
    {
      "id": "function:utils._get_landed_url_base",
      "type": "function",
      "name": "_get_landed_url_base",
      "path": "utils.py",
      "summary": "Derives a normalized URL for the page currently loaded in the browser.",
      "mechanism": "Reads driver.current_url, parses it, trims the path, and returns a normalized base string suitable for redirect comparisons.",
      "quality": "stable",
      "concerns": [
        "Returns None on WebDriver exceptions, offering limited visibility into why navigation failed."
      ],
      "opportunities": [
        "Capture diagnostic details (e.g., last known URL) before returning None to aid log analysis."
      ],
      "tests": null,
      "notes": "Feeds redirect logic inside _perform_navigation_attempt."
    },
    {
      "id": "function:utils._check_for_mfa_page",
      "type": "function",
      "name": "_check_for_mfa_page",
      "path": "utils.py",
      "summary": "Detects whether the navigation flow landed on the two-factor authentication page.",
      "mechanism": "Waits briefly for the TWO_STEP_VERIFICATION_HEADER selector and returns True when visible.",
      "quality": "stable",
      "concerns": [
        "Relies on a one-second timeout that may miss slower MFA page loads during network congestion."
      ],
      "opportunities": [
        "Share timeout configuration with login flows so both paths remain consistent."
      ],
      "tests": null,
      "notes": "Used within _validate_post_navigation to detect login interruptions."
    },
    {
      "id": "function:utils._check_for_login_page",
      "type": "function",
      "name": "_check_for_login_page",
      "path": "utils.py",
      "summary": "Determines if navigation unexpectedly arrived at the login page instead of the target destination.",
      "mechanism": "Skips checks when navigating directly to the sign-in URL, otherwise waits for the username input to infer a login redirect.",
      "quality": "stable",
      "concerns": [
        "One-second wait may be insufficient when the login page loads slowly, producing false negatives."
      ],
      "opportunities": [
        "Parameterize wait durations or leverage multiple selectors to improve detection reliability."
      ],
      "tests": null,
      "notes": "Feeds redirect handling logic in _validate_post_navigation."
    },
    {
      "id": "function:utils._handle_login_redirect",
      "type": "function",
      "name": "_handle_login_redirect",
      "path": "utils.py",
      "summary": "Responds to unexpected login redirects encountered during navigation.",
      "mechanism": "Checks current login_status via API, attempts a full log_in when necessary, and returns string tokens instructing the caller to retry or fail.",
      "quality": "monitor",
      "concerns": [
        "Invoking log_in mid-navigation can significantly delay the original workflow and may mask root causes."
      ],
      "opportunities": [
        "Provide hooks for callers to limit relogin attempts or surface richer telemetry about redirect causes."
      ],
      "tests": null,
      "notes": "Used by _validate_post_navigation after detecting the login page."
    },
    {
      "id": "function:utils._check_signin_redirect",
      "type": "function",
      "name": "_check_signin_redirect",
      "path": "utils.py",
      "summary": "Determines whether a post-signin redirect should be treated as successful navigation.",
      "mechanism": "Compares normalized target and landed URLs and re-validates login status to confirm the redirect completed authentication.",
      "quality": "stable",
      "concerns": [
        "Assumes the base URL path represents a successful landing; site redesigns could break the heuristic."
      ],
      "opportunities": [
        "Expose configurable success URLs to keep the redirect check flexible across locales."
      ],
      "tests": null,
      "notes": "Used within _check_url_mismatch_and_handle when signin redirects occur."
    },
    {
      "id": "function:utils._handle_url_mismatch",
      "type": "function",
      "name": "_handle_url_mismatch",
      "path": "utils.py",
      "summary": "Handles cases where the landed URL does not match the intended destination.",
      "mechanism": "Logs mismatch details, checks for unavailability banners via _check_for_unavailability, and returns guidance such as continue, refresh, or fail.",
      "quality": "monitor",
      "concerns": [
        "Returns 'continue' for many cases, potentially leading to repeated retries without escalating diagnostics."
      ],
      "opportunities": [
        "Track mismatch counts and escalate to failure after repeated occurrences."
      ],
      "tests": null,
      "notes": "Called by _check_url_mismatch_and_handle when redirects deviate from expectations."
    },
    {
      "id": "function:utils._wait_for_element",
      "type": "function",
      "name": "_wait_for_element",
      "path": "utils.py",
      "summary": "Waits for a target DOM selector to appear after successful navigation.",
      "mechanism": "Uses WebDriverWait on the provided selector, falls back to unavailability checks when timeouts occur, and advises whether to retry or fail.",
      "quality": "stable",
      "concerns": [
        "Only supports CSS selectors, limiting reuse for XPath-based checks in legacy pages."
      ],
      "opportunities": [
        "Accept locator tuples so callers can supply different strategies without rewriting helpers."
      ],
      "tests": null,
      "notes": "Final verification step inside _validate_post_navigation once URL checks pass."
    },
    {
      "id": "function:utils._handle_navigation_alert",
      "type": "function",
      "name": "_handle_navigation_alert",
      "path": "utils.py",
      "summary": "Attempts to close unexpected browser alerts that block navigation.",
      "mechanism": "Reads the alert text when available, tries to accept it, and signals whether to continue retries or fail.",
      "quality": "stable",
      "concerns": [
        "Alert handling lacks differentiation between transient popups and fatal dialogs, so callers cannot easily prioritize remediation."
      ],
      "opportunities": [
        "Return structured metadata (alert text, exception) for logging pipelines."
      ],
      "tests": null,
      "notes": "Used when UnexpectedAlertPresentException is raised during navigation attempts."
    },
    {
      "id": "function:utils._handle_webdriver_exception",
      "type": "function",
      "name": "_handle_webdriver_exception",
      "path": "utils.py",
      "summary": "Provides recovery logic when Selenium raises WebDriverException during navigation.",
      "mechanism": "Checks browser health, restarts the session via SessionManager when necessary, and applies a short randomized delay before retrying.",
      "quality": "monitor",
      "concerns": [
        "Random sleep complicates deterministic retry timing and the helper does not cap the number of recovery attempts."
      ],
      "opportunities": [
        "Expose retry budgets and structured outcomes (restarted, reused driver) to upstream callers."
      ],
      "tests": null,
      "notes": "Invoked by _perform_navigation_attempt after driver errors."
    },
    {
      "id": "function:utils._check_url_mismatch_and_handle",
      "type": "function",
      "name": "_check_url_mismatch_and_handle",
      "path": "utils.py",
      "summary": "Evaluates mismatched URLs and decides the next action for navigation retries.",
      "mechanism": "Identifies acceptable signin redirects, otherwise delegates to _handle_url_mismatch to decide between success, fail, or continue tokens.",
      "quality": "stable",
      "concerns": [
        "Returns None for the no-mismatch case, which callers must interpret carefully alongside the companion driver value."
      ],
      "opportunities": [
        "Introduce a small result object with explicit fields for action and driver to reduce branching complexity."
      ],
      "tests": null,
      "notes": "Called within _validate_post_navigation before waiting on page elements."
    },
    {
      "id": "function:utils._validate_post_navigation",
      "type": "function",
      "name": "_validate_post_navigation",
      "path": "utils.py",
      "summary": "Assesses navigation results to determine whether to succeed, retry, or fail.",
      "mechanism": "Checks for MFA or login redirects, evaluates URL mismatches, and finally waits for the target selector to appear before returning control tokens.",
      "quality": "monitor",
      "concerns": [
        "Nested branching over multiple conditions is difficult to reason about and increases maintenance burden."
      ],
      "opportunities": [
        "Refactor into a state machine or strategy pattern so each condition is testable in isolation."
      ],
      "tests": null,
      "notes": "Core decision engine for nav_to_page after each Selenium get()."
    },
    {
      "id": "function:utils._perform_navigation_attempt",
      "type": "function",
      "name": "_perform_navigation_attempt",
      "path": "utils.py",
      "summary": "Executes one navigation attempt including pre-checks, browser actions, and error handling.",
      "mechanism": "Validates browser state, performs driver.get, derives landed URL, invokes _validate_post_navigation, and handles alerts or WebDriver exceptions by returning control tokens and updated driver references.",
      "quality": "monitor",
      "concerns": [
        "Returns multiple string tokens ('success', 'fail', 'continue', 'retry'), making caller control flow verbose and error-prone."
      ],
      "opportunities": [
        "Encapsulate results in a dataclass with action, driver, and reason fields to simplify loop logic."
      ],
      "tests": null,
      "notes": "Used by nav_to_page for each retry cycle."
    },
    {
      "id": "function:utils._check_for_unavailability",
      "type": "function",
      "name": "_check_for_unavailability",
      "path": "utils.py",
      "summary": "Detects common 'page unavailable' banners to guide navigation recovery steps.",
      "mechanism": "Confirms the driver session is alive, iterates known CSS selectors using is_elem_there, and returns action tokens with optional wait durations.",
      "quality": "stable",
      "concerns": [
        "Selector list lives within the function, making it easy for updates to be overlooked or duplicated elsewhere."
      ],
      "opportunities": [
        "Centralize unavailability selector definitions to a shared config file for reuse across modules."
      ],
      "tests": null,
      "notes": "Supports both URL mismatch and element timeout handling paths."
    },
    {
      "id": "class:common_params.NavigationConfig",
      "type": "class",
      "name": "NavigationConfig",
      "path": "common_params.py",
      "summary": "Dataclass encapsulating parameters required for resilient navigation attempts.",
      "mechanism": "Stores target URL, selector waits, normalized URL bases, unavailability selector mapping, and timeout configuration for nav_to_page retries.",
      "quality": "stable",
      "concerns": [
        "Instances are constructed ad-hoc; refactoring navigation to a class could allow richer validation at creation time."
      ],
      "opportunities": [
        "Add default factory methods (e.g., from_config) to ensure consistent timeout sourcing and selector formatting."
      ],
      "tests": null,
      "notes": "Consumed primarily by utils.nav_to_page and helper routines that evaluate navigation outcomes."
    },
    {
      "id": "function:utils.get_rate_limiter",
      "type": "function",
      "name": "get_rate_limiter",
      "path": "utils.py",
      "summary": "Provides access to the shared AdaptiveRateLimiter singleton with optional configuration overrides.",
      "mechanism": "Delegates to rate_limiter.get_adaptive_rate_limiter, forwarding fill-rate, capacity, and endpoint profile parameters supplied by callers such as SessionManager.",
      "quality": "stable",
      "concerns": [
        "Wrapper hides dependency on rate_limiter module, making discovery of full capabilities harder.",
        "Parameter typing is lax, so malformed endpoint_profiles dicts can flow through without validation."
      ],
      "opportunities": [
        "Document accepted profile schema or enforce TypedDict to prevent misconfiguration.",
        "Allow dependency injection for alternative limiter implementations during testing."
      ],
      "tests": null,
      "notes": "SessionManager._initialize_rate_limiter invokes this to bind adaptive throttling settings."
    },
    {
      "id": "function:utils.prevent_system_sleep",
      "type": "function",
      "name": "prevent_system_sleep",
      "path": "utils.py",
      "summary": "Attempts to keep the host machine awake during long-running operations across supported platforms.",
      "mechanism": "Detects OS via platform.system, invokes Windows SetThreadExecutionState or spawns macOS caffeinate process, otherwise logs informational message for Linux/others.",
      "quality": "stable",
      "concerns": [
        "Linux path is a no-op, leaving batch runs unprotected on that platform.",
        "Return type varies by platform (bool vs subprocess), requiring callers to handle loosely typed values."
      ],
      "opportunities": [
        "Introduce structured return object to clarify cleanup expectations per platform.",
        "Consider integrating with power management APIs on Linux to close feature gap."
      ],
      "tests": null,
      "notes": "Main entrypoint acquires this before long sessions to prevent system sleep mid-run."
    },
    {
      "id": "function:utils.restore_system_sleep",
      "type": "function",
      "name": "restore_system_sleep",
      "path": "utils.py",
      "summary": "Reverses the effects of prevent_system_sleep by resetting platform-specific power settings.",
      "mechanism": "On Windows calls SetThreadExecutionState with ES_CONTINUOUS, on macOS terminates caffeinate process, and otherwise performs no action.",
      "quality": "stable",
      "concerns": [
        "Assumes callers pass the exact handle returned by prevent_system_sleep; misuse may raise unexpected exceptions.",
        "No validation for already-terminated caffeinate processes, which can produce warnings on repeated calls."
      ],
      "opportunities": [
        "Wrap platform behaviors in dedicated helper objects to encapsulate lifecycle cleanly.",
        "Emit telemetry when restoration fails so operators notice lingering sleep locks."
      ],
      "tests": null,
      "notes": "Typically invoked in finally blocks after prevent_system_sleep wrapping long tasks."
    },
    {
      "id": "function:utils._prepare_base_headers",
      "type": "function",
      "name": "_prepare_base_headers",
      "path": "utils.py",
      "summary": "Constructs baseline HTTP headers and applies contextual overrides for API calls.",
      "mechanism": "Starts with default JSON-friendly headers, merges config-defined contextual headers, and applies caller overrides while retaining method metadata.",
      "quality": "stable",
      "concerns": [
        "Stores HTTP method in a temporary _method key that downstream helpers must remember to strip."
      ],
      "opportunities": [
        "Return structured header objects to avoid relying on sentinel keys like _method."
      ],
      "tests": null,
      "notes": "Feeds directly into _prepare_api_headers before request execution."
    },
    {
      "id": "function:utils._prepare_api_headers",
      "type": "function",
      "name": "_prepare_api_headers",
      "path": "utils.py",
      "summary": "Finalizes HTTP headers by adding user agent, origin, CSRF, and ancestry-userid values when appropriate.",
      "mechanism": "Consults browser for live User-Agent, falls back to config rotations, optionally appends Origin header, injects CSRF token, and conditionally includes profile ID header.",
      "quality": "monitor",
      "concerns": [
        "Relies on SessionManager globals and WebDriver availability, making it hard to reuse in non-browser contexts."
      ],
      "opportunities": [
        "Allow dependency injection of user agent providers and token fetchers to improve testability."
      ],
      "tests": null,
      "notes": "Executed on every API request attempt prior to hitting the network."
    },
    {
      "id": "function:utils._get_user_agent_from_browser",
      "type": "function",
      "name": "_get_user_agent_from_browser",
      "path": "utils.py",
      "summary": "Fetches the current WebDriver user agent string using JavaScript execution.",
      "mechanism": "Runs navigator.userAgent via execute_script and falls back to defaults when driver unavailable or errors occur.",
      "quality": "stable",
      "concerns": [
        "Swallows generic exceptions with debug logs, so persistent failures may go unnoticed in production."
      ],
      "opportunities": [
        "Capture metrics on fallback frequency to identify stale driver contexts."
      ],
      "tests": null,
      "notes": "Used by _prepare_api_headers to align requests with browser fingerprint."
    },
    {
      "id": "function:utils._add_origin_header",
      "type": "function",
      "name": "_add_origin_header",
      "path": "utils.py",
      "summary": "Adds an Origin header for non-GET methods based on configured API base URL.",
      "mechanism": "Parses config_schema.api.base_url and populates Origin when HTTP method warrants CORS context.",
      "quality": "stable",
      "concerns": [
        "Assumes base_url parse succeeds; misconfiguration degrades quietly with a warning."
      ],
      "opportunities": [
        "Validate base_url during startup to avoid runtime parsing failures."
      ],
      "tests": null,
      "notes": "Helps satisfy CORS requirements for POST/PUT API calls."
    },
    {
      "id": "function:utils._parse_csrf_token",
      "type": "function",
      "name": "_parse_csrf_token",
      "path": "utils.py",
      "summary": "Normalizes CSRF token strings, accommodating JSON-wrapped payloads returned by some endpoints.",
      "mechanism": "Detects JSON-like strings, attempts to load csrfToken field, and falls back to raw string on parse failure.",
      "quality": "stable",
      "concerns": [
        "Treats any JSON object with csrfToken as valid without verifying token format."
      ],
      "opportunities": [
        "Add schema validation or length checks to catch malformed tokens early."
      ],
      "tests": null,
      "notes": "Invoked by _add_csrf_token_header before inserting header."
    },
    {
      "id": "function:utils._add_csrf_token_header",
      "type": "function",
      "name": "_add_csrf_token_header",
      "path": "utils.py",
      "summary": "Injects the X-CSRF-Token header when SessionManager holds a cached token.",
      "mechanism": "Retrieves csrf_token from SessionManager, parses it, and attaches to outgoing headers while logging when absent.",
      "quality": "monitor",
      "concerns": [
        "Logs warnings every time CSRF missing, which can be noisy for endpoints that legitimately skip CSRF."
      ],
      "opportunities": [
        "Respect endpoint-level configuration to suppress expected-no-CSRF warnings."
      ],
      "tests": null,
      "notes": "Part of header preparation pipeline for POST-style requests."
    },
    {
      "id": "function:utils._add_user_id_header",
      "type": "function",
      "name": "_add_user_id_header",
      "path": "utils.py",
      "summary": "Optionally adds the ancestry-userid header when profile ID is available and not excluded.",
      "mechanism": "Checks SessionManager.my_profile_id, compares API description against exclusion list, and uppercases the ID before insertion.",
      "quality": "stable",
      "concerns": [
        "Maintains exclusion rules as hardcoded strings; drifting API names may bypass intended behavior."
      ],
      "opportunities": [
        "Move exclusion logic to configuration for easier maintenance and discoverability."
      ],
      "tests": null,
      "notes": "Ensures downstream services attribute requests to authenticated profile."
    },
    {
      "id": "function:utils._should_skip_cookie_sync",
      "type": "function",
      "name": "_should_skip_cookie_sync",
      "path": "utils.py",
      "summary": "Decides whether browser-to-requests cookie synchronization can be skipped based on cache timers.",
      "mechanism": "Compares elapsed time since last sync against configured interval unless forced by caller.",
      "quality": "stable",
      "concerns": [
        "Relies on module-level cache without thread safety; concurrent actions could race."
      ],
      "opportunities": [
        "Guard cache with threading lock or move state into SessionManager for better encapsulation."
      ],
      "tests": null,
      "notes": "Called from _sync_cookies_for_request before performing expensive sync."
    },
    {
      "id": "function:utils._validate_driver_for_sync",
      "type": "function",
      "name": "_validate_driver_for_sync",
      "path": "utils.py",
      "summary": "Confirms driver availability prior to syncing cookies to avoid noisy errors.",
      "mechanism": "Checks both driver argument and SessionManager driver reference, logging warnings on first attempt when missing.",
      "quality": "stable",
      "concerns": [
        "Only issues warning once; subsequent attempts silently proceed despite missing drivers."
      ],
      "opportunities": [
        "Escalate severity or abort retries definitively when driver absent for multiple attempts."
      ],
      "tests": null,
      "notes": "Supports graceful degradation when browser restarts mid-request."
    },
    {
      "id": "function:utils._perform_cookie_sync",
      "type": "function",
      "name": "_perform_cookie_sync",
      "path": "utils.py",
      "summary": "Carries out cookie synchronization by delegating to APIManager and updating the local cache.",
      "mechanism": "Calls APIManager.sync_cookies_from_browser with SessionManager context, updates last_sync_time on success, and logs outcome based on attempt number.",
      "quality": "monitor",
      "concerns": [
        "Returns False without exposing failure details, which makes diagnosing cookie sync issues harder."
      ],
      "opportunities": [
        "Return structured result including error reason and whether retry should continue."
      ],
      "tests": null,
      "notes": "Central choke point for keeping requests session cookies fresh."
    },
    {
      "id": "function:utils._sync_cookies_for_request",
      "type": "function",
      "name": "_sync_cookies_for_request",
      "path": "utils.py",
      "summary": "Coordinates cookie synchronization prior to each API request attempt with caching heuristics.",
      "mechanism": "Checks skip conditions, validates driver presence, and invokes _perform_cookie_sync while updating module cache.",
      "quality": "monitor",
      "concerns": [
        "Shared cache may become stale in multi-threaded scenarios; lacks explicit locking."
      ],
      "opportunities": [
        "Consider migrating cache into SessionManager scoped state for better concurrency control."
      ],
      "tests": null,
      "notes": "Called by _prepare_api_request before header construction."
    },
    {
      "id": "function:utils._apply_rate_limiting",
      "type": "function",
      "name": "_apply_rate_limiting",
      "path": "utils.py",
      "summary": "Invokes the shared AdaptiveRateLimiter to throttle outgoing API calls and logs notable waits.",
      "mechanism": "If SessionManager has a rate limiter, calls wait() and logs debug output for significant delays, returning the wait duration.",
      "quality": "stable",
      "concerns": [
        "Hardcodes 0.1s threshold for logging which may hide frequent short delays important for tuning."
      ],
      "opportunities": [
        "Expose recent wait durations via telemetry to validate adaptive behavior over time."
      ],
      "tests": null,
      "notes": "Executed during request preparation ahead of network call."
    },
    {
      "id": "function:utils._calculate_retry_sleep_time",
      "type": "function",
      "name": "_calculate_retry_sleep_time",
      "path": "utils.py",
      "summary": "Computes exponential backoff delay with jitter for the dedicated API retry loop.",
      "mechanism": "Multiplies current delay by backoff factor, caps at max delay, adds small random jitter, and enforces minimum wait.",
      "quality": "stable",
      "concerns": [
        "Random jitter range is fixed (0-0.2s); may be insufficient for wide variance scenarios."
      ],
      "opportunities": [
        "Parameterize jitter range via configuration to tune behavior without code changes."
      ],
      "tests": null,
      "notes": "Used by retry helpers handling network exceptions and missing responses."
    },
    {
      "id": "function:utils._calculate_sleep_time",
      "type": "function",
      "name": "_calculate_sleep_time",
      "path": "utils.py",
      "summary": "Shared exponential backoff calculator used by the generic retry decorator utilities.",
      "mechanism": "Combines exponential growth with max cap and jitter, returning at least 0.1 seconds to avoid zero waits.",
      "quality": "stable",
      "concerns": [
        "Lives alongside retry decorator helpers yet duplicated logic exists in _calculate_retry_sleep_time."
      ],
      "opportunities": [
        "Unify the sleep calculators to reduce divergence between retry implementations."
      ],
      "tests": null,
      "notes": "Invoked by retry_api helper utilities and the API retry path for 3xx/429 handling."
    },
    {
      "id": "function:utils.retry",
      "type": "function",
      "name": "retry",
      "path": "utils.py",
      "summary": "Decorator factory providing simple exponential-backoff retries for arbitrary callables.",
      "mechanism": "Reads defaults from config_schema, executes wrapped function, sleeps with doubling delay plus jitter after failures, and re-raises on final attempt.",
      "quality": "stable",
      "concerns": [
        "Uses module-level sleep/time which can block event loops or async contexts if misapplied."
      ],
      "opportunities": [
        "Expose hook for custom sleep implementation to enable async-compatible retries."
      ],
      "tests": null,
      "notes": "Legacy decorator used in various utilities before enhanced recovery framework was introduced."
    },
    {
      "id": "function:utils._get_retry_config",
      "type": "function",
      "name": "_get_retry_config",
      "path": "utils.py",
      "summary": "Normalizes retry configuration for retry_api by merging overrides with config defaults.",
      "mechanism": "Returns a dictionary containing retry counts, initial delay, backoff factor, retryable status codes, and max delay derived from parameters or config_schema.",
      "quality": "stable",
      "concerns": [
        "Returns mutable dict with set-valued retry codes, so callers must avoid accidental mutation across wrappers."
      ],
      "opportunities": [
        "Return typed dataclass or frozen mapping to improve clarity and immutability."
      ],
      "tests": null,
      "notes": "First step inside retry_api decorators."
    },
    {
      "id": "function:utils._should_retry_status_code",
      "type": "function",
      "name": "_should_retry_status_code",
      "path": "utils.py",
      "summary": "Checks whether an HTTP response status is included in the configured retry set.",
      "mechanism": "Inspects requests.Response objects, returning tuple of (should_retry, status_code) for downstream handling.",
      "quality": "stable",
      "concerns": [
        "Only works for requests.Response; callers passing other response types need their own adapters."
      ],
      "opportunities": [
        "Support duck-typed response interfaces or add validation when an unsupported type is encountered."
      ],
      "tests": null,
      "notes": "Used by retry_api to decide between immediate return or initiating retry logic."
    },
    {
      "id": "function:utils._handle_status_code_retry",
      "type": "function",
      "name": "_handle_status_code_retry",
      "path": "utils.py",
      "summary": "Coordinates backoff behavior when retry_api encounters retryable HTTP status codes.",
      "mechanism": "Logs retry attempt, computes exponential delay via _calculate_sleep_time, sleeps, and returns whether loop should continue along with updated delay.",
      "quality": "monitor",
      "concerns": [
        "Blocks synchronously on time.sleep, which can stack delays for repeated API failures."
      ],
      "opportunities": [
        "Record metrics about repeated status code retries to inform rate-limiter tuning."
      ],
      "tests": null,
      "notes": "Shared by retry_api when responses return 429/5xx codes."
    },
    {
      "id": "function:utils._handle_exception_retry",
      "type": "function",
      "name": "_handle_exception_retry",
      "path": "utils.py",
      "summary": "Handles exception-based retries within retry_api, applying exponential backoff and re-raising when exhausted.",
      "mechanism": "Logs exception details, leverages _calculate_sleep_time for delay, sleeps, and either continues or raises when attempts depleted.",
      "quality": "monitor",
      "concerns": [
        "Re-raises original exception without additional context once retries exhausted; downstream may need more detail."
      ],
      "opportunities": [
        "Augment with structured telemetry about exception classes and retry counts."
      ],
      "tests": null,
      "notes": "Complements status code path by handling network/timeout exceptions."
    },
    {
      "id": "function:utils.retry_api",
      "type": "function",
      "name": "retry_api",
      "path": "utils.py",
      "summary": "Decorator factory wrapping API callables with configurable retry logic across status codes and exceptions.",
      "mechanism": "Builds retry state from _get_retry_config, evaluates responses via _should_retry_status_code, and uses _handle_status_code_retry/_handle_exception_retry to control looping before returning response or raising error.",
      "quality": "stable",
      "concerns": [
        "Synchronous implementation unsuitable for async functions; also assumes responses expose status_code attribute."
      ],
      "opportunities": [
        "Provide async-friendly variant or allow pluggable sleep/response adapters."
      ],
      "tests": null,
      "notes": "Widely used for resilient API operations outside the newer SessionManager pipeline."
    },
    {
      "id": "function:utils._extract_driver_from_args",
      "type": "function",
      "name": "_extract_driver_from_args",
      "path": "utils.py",
      "summary": "Searches positional arguments for a Selenium WebDriver or SessionManager-provided driver instance.",
      "mechanism": "Iterates through *args returning the first object matching DriverType or SessionManager then dereferences the driver attribute when needed.",
      "quality": "stable",
      "concerns": [
        "Relies on duck typing for DriverType detection and assumes SessionManager exposes a .driver attribute."
      ],
      "opportunities": [
        "Expand recognition to cover LazySession wrappers or other orchestration types."
      ],
      "tests": null,
      "notes": "Helper used by ensure_browser_open to gather browser context without forcing explicit parameters."
    },
    {
      "id": "function:utils._extract_driver_from_kwargs",
      "type": "function",
      "name": "_extract_driver_from_kwargs",
      "path": "utils.py",
      "summary": "Retrieves a WebDriver instance from keyword arguments, supporting direct driver or SessionManager injection.",
      "mechanism": "Checks for driver-like keyword values, falling back to a session_manager kwarg whose driver attribute satisfies the contract.",
      "quality": "stable",
      "concerns": [
        "Hard codes keyword expectations (e.g., session_manager) and will miss unconventional parameter names."
      ],
      "opportunities": [
        "Accept explicit kwarg overrides so call sites can register custom driver argument keys."
      ],
      "tests": null,
      "notes": "Pairs with _extract_driver_from_args as part of decorator-friendly driver discovery."
    },
    {
      "id": "function:utils._find_driver_instance",
      "type": "function",
      "name": "_find_driver_instance",
      "path": "utils.py",
      "summary": "Combines positional and keyword extraction helpers to return the active WebDriver instance.",
      "mechanism": "Delegates to _extract_driver_from_args then _extract_driver_from_kwargs, returning the first non-null match.",
      "quality": "stable",
      "concerns": [
        "Stops at the first match without validating that the driver session is usable; relies on downstream checks."
      ],
      "opportunities": [
        "Could expose diagnostics about which argument supplied the driver to aid debugging decorator usage."
      ],
      "tests": null,
      "notes": "Primary lookup routine invoked by ensure_browser_open prior to browser validation."
    },
    {
      "id": "function:utils._validate_driver_instance",
      "type": "function",
      "name": "_validate_driver_instance",
      "path": "utils.py",
      "summary": "Guards decorated calls by ensuring a driver object exists and the browser session remains open.",
      "mechanism": "Raises TypeError when no driver is located and delegates to is_browser_open to detect closed sessions, promoting WebDriverException on failure.",
      "quality": "stable",
      "concerns": [
        "Depends on selenium_utils.is_browser_open without additional context, making triage harder when the helper misfires."
      ],
      "opportunities": [
        "Augment with optional heartbeat checks or reconnection hooks for stale sessions."
      ],
      "tests": null,
      "notes": "Central validation step in ensure_browser_open with error messaging tailored for decorator usage."
    },
    {
      "id": "function:utils.ensure_browser_open",
      "type": "function",
      "name": "ensure_browser_open",
      "path": "utils.py",
      "summary": "Decorator ensuring Selenium-dependent helpers only run when an active browser session is present.",
      "mechanism": "Wrapper resolves the driver via _find_driver_instance, validates it with _validate_driver_instance, then invokes the original callable.",
      "quality": "stable",
      "concerns": [
        "Assumes call sites supply positional/keyword access to SessionManager or WebDriver, so silent failures surface as TypeError at runtime."
      ],
      "opportunities": [
        "Could integrate with SessionManager.ensure_session_ready to self-heal closed browsers before raising."
      ],
      "tests": null,
      "notes": "Applied to Selenium waits and navigation helpers to fail fast when automation lost the browser session."
    },
    {
      "id": "function:utils.time_wait",
      "type": "function",
      "name": "time_wait",
      "path": "utils.py",
      "summary": "Decorator factory providing timing telemetry around WebDriverWait-style operations.",
      "mechanism": "Captures start/stop timestamps, logs success durations at debug level, and reports warnings on TimeoutException while re-raising errors.",
      "quality": "stable",
      "concerns": [
        "Synchronous timing wrapper cannot capture async waits and duplicates timing logic across install points."
      ],
      "opportunities": [
        "Emit structured metrics or integrate with performance_monitor to centralize wait observability."
      ],
      "tests": null,
      "notes": "Used to instrument Selenium waits with consistent logging without modifying each call site manually."
    },
    {
      "id": "class:utils.CircuitBreaker",
      "type": "class",
      "name": "CircuitBreaker",
      "path": "utils.py",
      "summary": "Thread-safe circuit breaker guarding API calls after repeated 429 responses.",
      "mechanism": "Tracks consecutive failures, toggles between CLOSED/OPEN/HALF_OPEN states with timers, and blocks requests until recovery thresholds are met.",
      "quality": "monitor",
      "concerns": [
        "Current implementation only inspects exception strings for '429', risking false positives/negatives."
      ],
      "opportunities": [
        "Integrate with structured error types so rate-limit detection does not rely on message parsing."
      ],
      "tests": null,
      "notes": "Designed to complement AdaptiveRateLimiter by cutting off traffic during prolonged throttling events."
    },
    {
      "id": "method:CircuitBreaker.__init__",
      "type": "method",
      "name": "CircuitBreaker.__init__",
      "path": "utils.py",
      "summary": "Initializes thresholds, state tracking, and metrics for the circuit breaker.",
      "mechanism": "Stores failure thresholds, configures threading.Lock for thread safety, and seeds metrics counters used for observability.",
      "quality": "stable",
      "concerns": [
        "Metrics dictionary grows only through counters; external visibility limited to get_metrics copies."
      ],
      "opportunities": [
        "Allow callers to inject monitoring hooks instead of relying solely on log statements."
      ],
      "tests": null,
      "notes": "Called whenever a new CircuitBreaker instance is created, typically at SessionManager startup."
    },
    {
      "id": "method:CircuitBreaker.call",
      "type": "method",
      "name": "CircuitBreaker.call",
      "path": "utils.py",
      "summary": "Executes a callable under circuit breaker control, blocking when state is OPEN or HALF_OPEN limits reached.",
      "mechanism": "Guards execution with lock-protected state checks, transitions OPEN\u2192HALF_OPEN after timeout, executes function outside lock, and records success or failure results.",
      "quality": "monitor",
      "concerns": [
        "Uses generic Exception for OPEN state blocking, which may be indistinguishable from underlying failures to callers."
      ],
      "opportunities": [
        "Raise custom exception type so callers can react differently to circuit-blocked requests."
      ],
      "tests": null,
      "notes": "Key entry point that counts total and blocked requests while coordinating state transitions."
    },
    {
      "id": "method:CircuitBreaker.record_success",
      "type": "method",
      "name": "CircuitBreaker.record_success",
      "path": "utils.py",
      "summary": "Updates breaker state after a successful request and closes HALF_OPEN circuits when thresholds met.",
      "mechanism": "Resets failure counter, increments success metrics, and triggers _transition_to_closed when enough HALF_OPEN successes occur.",
      "quality": "stable",
      "concerns": [
        "Success threshold equals half_open_max_requests; lacks adaptive logic for differing recovery strategies."
      ],
      "opportunities": [
        "Expose configurable policy for closing criteria separate from HALF_OPEN request allowance."
      ],
      "tests": null,
      "notes": "Called from call() on successful function execution."
    },
    {
      "id": "method:CircuitBreaker.record_failure",
      "type": "method",
      "name": "CircuitBreaker.record_failure",
      "path": "utils.py",
      "summary": "Records throttling failures, transitions to OPEN, and resets success counters.",
      "mechanism": "Increments failure count inside lock, captures timestamp, and invokes _transition_to_open when thresholds exceeded or in HALF_OPEN state.",
      "quality": "monitor",
      "concerns": [
        "Relies on time.time() without monotonic clock, which can jump backward if system clock adjusts."
      ],
      "opportunities": [
        "Switch to time.monotonic() for resilience against clock skew during long runs."
      ],
      "tests": null,
      "notes": "Triggered when call() catches errors containing 429 indicators."
    },
    {
      "id": "method:CircuitBreaker._transition_to_open",
      "type": "method",
      "name": "CircuitBreaker._transition_to_open",
      "path": "utils.py",
      "summary": "Switches breaker to OPEN state and logs circuit-open event.",
      "mechanism": "Updates state flag, increments metrics, and emits warning log including configured recovery timeout.",
      "quality": "stable",
      "concerns": [
        "OPEN transition does not reset last_failure_time, relying on caller to set it before invocation."
      ],
      "opportunities": [
        "Capture invoking failure context for diagnostics when circuit repeatedly opens."
      ],
      "tests": null,
      "notes": "Invoked by record_failure when thresholds crossed."
    },
    {
      "id": "method:CircuitBreaker._transition_to_half_open",
      "type": "method",
      "name": "CircuitBreaker._transition_to_half_open",
      "path": "utils.py",
      "summary": "Moves breaker from OPEN to HALF_OPEN to probe service recovery.",
      "mechanism": "Resets success counters, allows limited test requests, and logs state change at info level.",
      "quality": "stable",
      "concerns": [
        "HALF_OPEN request allowance fixed at construction, lacking dynamic tuning based on recent failure patterns."
      ],
      "opportunities": [
        "Feed rate limiter metrics to adjust half_open_max_requests automatically."
      ],
      "tests": null,
      "notes": "Called by call() when recovery timeout elapses while breaker is OPEN."
    },
    {
      "id": "method:CircuitBreaker._transition_to_closed",
      "type": "method",
      "name": "CircuitBreaker._transition_to_closed",
      "path": "utils.py",
      "summary": "Restores breaker to CLOSED (normal) state and resets counters.",
      "mechanism": "Sets state flag, increments circuit_closes metric, zeroes failure counts, and logs recovery message.",
      "quality": "stable",
      "concerns": [
        "Only triggered from HALF_OPEN success path; manual reset must be called if stuck OPEN for other reasons."
      ],
      "opportunities": [
        "Add guard to ensure circuit_closes metric increments only once per transition."
      ],
      "tests": null,
      "notes": "Completes recovery once successive requests succeed."
    },
    {
      "id": "method:CircuitBreaker.get_state",
      "type": "method",
      "name": "CircuitBreaker.get_state",
      "path": "utils.py",
      "summary": "Returns current circuit breaker state string.",
      "mechanism": "Simple accessor exposing state value without acquiring lock, assuming atomic string reads.",
      "quality": "stable",
      "concerns": [
        "Lack of locking may reveal transient state while transitions occur."
      ],
      "opportunities": [
        "Acquire lock when reading state to guarantee consistency with metrics snapshots."
      ],
      "tests": null,
      "notes": "Used primarily for diagnostics and telemetry exports."
    },
    {
      "id": "method:CircuitBreaker.get_metrics",
      "type": "method",
      "name": "CircuitBreaker.get_metrics",
      "path": "utils.py",
      "summary": "Provides snapshot of breaker metrics including totals, blocks, and transition counters.",
      "mechanism": "Acquires lock then returns a shallow copy of the metrics dictionary to prevent external mutation.",
      "quality": "stable",
      "concerns": [
        "Metrics copy is shallow; nested structures would still be mutable if added later."
      ],
      "opportunities": [
        "Return immutable Mapping proxy or dataclass to discourage accidental modification by callers."
      ],
      "tests": null,
      "notes": "Supports status reporting commands inspecting breaker health."
    },
    {
      "id": "method:CircuitBreaker.reset",
      "type": "method",
      "name": "CircuitBreaker.reset",
      "path": "utils.py",
      "summary": "Resets breaker to CLOSED state, clearing counters and timers.",
      "mechanism": "Within lock, sets state to CLOSED, zeroes counters, clears last failure time, and logs reset message.",
      "quality": "stable",
      "concerns": [
        "Reset does not affect metrics history, so monitoring may misinterpret repeated resets as continuous operation."
      ],
      "opportunities": [
        "Optionally reset metrics or expose reset count for clearer observability."
      ],
      "tests": null,
      "notes": "Used when manual recovery is performed or during automated health checks."
    },
    {
      "id": "function:utils._wait_for_2fa_header",
      "type": "function",
      "name": "_wait_for_2fa_header",
      "path": "utils.py",
      "summary": "Waits for the 2FA header to appear before progressing through the verification flow.",
      "mechanism": "Applies WebDriverWait to a selector and falls back to login_status to decide whether the header absence still implies authentication success.",
      "quality": "monitor",
      "concerns": [
        "Treats any missing header coupled with ambiguous login status as success, which can mask selector drift."
      ],
      "opportunities": [
        "Record detection outcome telemetry so QA can spot increases in header misses."
      ],
      "tests": null,
      "notes": "First guard used by handle_two_fa to confirm the challenge page rendered."
    },
    {
      "id": "function:utils._find_sms_button_with_selectors",
      "type": "function",
      "name": "_find_sms_button_with_selectors",
      "path": "utils.py",
      "summary": "Searches the 2FA UI for the SMS option using multiple selectors.",
      "mechanism": "Iterates through CSS and XPath selectors with WebDriverWait to locate a clickable SMS button.",
      "quality": "stable",
      "concerns": [
        "Selector list is static and may lag behind UI changes without telemetry on failure frequency."
      ],
      "opportunities": [
        "Persist selector success metrics to guide pruning or additions over time."
      ],
      "tests": null,
      "notes": "Feeds _click_sms_button; failure triggers manual intervention messaging."
    },
    {
      "id": "function:utils._debug_log_page_buttons",
      "type": "function",
      "name": "_debug_log_page_buttons",
      "path": "utils.py",
      "summary": "Logs button metadata on the current page to aid selector troubleshooting.",
      "mechanism": "Retrieves up to ten button elements, emitting their text, classes, and data-method attributes at debug level.",
      "quality": "stable",
      "concerns": [
        "Silent pass-on exceptions may hide issues when WebDriver calls fail repeatedly."
      ],
      "opportunities": [
        "Consider capturing output to telemetry artifacts when run in production for later analysis."
      ],
      "tests": null,
      "notes": "Called when SMS button cannot be found to provide context for manual review."
    },
    {
      "id": "function:utils._perform_sms_button_click",
      "type": "function",
      "name": "_perform_sms_button_click",
      "path": "utils.py",
      "summary": "Attempts to trigger the 2FA SMS flow via JavaScript or standard clicks.",
      "mechanism": "Executes JS click first, falls back to native click, then waits for the code input field to confirm success.",
      "quality": "monitor",
      "concerns": [
        "Uses generic exceptions; repeated failures lack structured classification for analytics."
      ],
      "opportunities": [
        "Expose explicit result codes to differentiate between JS failure and DOM change."
      ],
      "tests": null,
      "notes": "Returns user-facing prompts when automation cannot interact with the button."
    },
    {
      "id": "function:utils._click_sms_button",
      "type": "function",
      "name": "_click_sms_button",
      "path": "utils.py",
      "summary": "Wrapper encouraging the SMS verification path and guiding the user if automation fails.",
      "mechanism": "Logs progress, uses _find_sms_button_with_selectors, logs fallback buttons, and calls _perform_sms_button_click when possible.",
      "quality": "stable",
      "concerns": [
        "Relies on stdout messaging for operator feedback, which may be missed in non-interactive runs."
      ],
      "opportunities": [
        "Surface success/failure counters to session telemetry for better observability."
      ],
      "tests": null,
      "notes": "Non-blocking helper used inside handle_two_fa to speed SMS handling."
    },
    {
      "id": "function:utils._wait_for_code_input_field",
      "type": "function",
      "name": "_wait_for_code_input_field",
      "path": "utils.py",
      "summary": "Watches for the 2FA code input field after requesting a code.",
      "mechanism": "Employs WebDriverWait on the configured selector, logging failures to aid selector maintenance.",
      "quality": "stable",
      "concerns": [
        "Fixed 10-second timeout may be insufficient during slow network events."
      ],
      "opportunities": [
        "Parameterize timeout via config_schema to align with product requirements."
      ],
      "tests": null,
      "notes": "Used by _perform_sms_button_click after initiating the SMS request."
    },
    {
      "id": "function:utils._wait_for_user_2fa_action",
      "type": "function",
      "name": "_wait_for_user_2fa_action",
      "path": "utils.py",
      "summary": "Polls for user completion of the 2FA challenge within a configurable timeout.",
      "mechanism": "Loops with short waits, checking for disappearance of the 2FA header to infer submission success.",
      "quality": "monitor",
      "concerns": [
        "Relies solely on header disappearance, which may not correlate with backend verification success."
      ],
      "opportunities": [
        "Integrate heartbeat to detect form errors vs. completed submissions."
      ],
      "tests": null,
      "notes": "Provides boolean signal guiding handle_two_fa to verify final status."
    },
    {
      "id": "function:utils._verify_2fa_completion",
      "type": "function",
      "name": "_verify_2fa_completion",
      "path": "utils.py",
      "summary": "Confirms 2FA completion by re-checking login status and persisting cookies.",
      "mechanism": "Calls login_status with UI fallback, saves cookies on success, and logs failures otherwise.",
      "quality": "stable",
      "concerns": [
        "Sleep prior to login_status introduces fixed delay even when page ready sooner."
      ],
      "opportunities": [
        "Leverage WebDriver expected conditions instead of fixed sleep before verification."
      ],
      "tests": null,
      "notes": "Gateway before handle_two_fa declares success."
    },
    {
      "id": "function:utils.handle_two_fa",
      "type": "function",
      "name": "handle_two_fa",
      "path": "utils.py",
      "summary": "Coordinates the interactive two-factor authentication workflow during login.",
      "mechanism": "Validates driver, waits for header, handles consent, nudges SMS flow, waits for user completion, then verifies success.",
      "quality": "monitor",
      "concerns": [
        "Limited error taxonomy makes it hard to differentiate automation vs. user failures."
      ],
      "opportunities": [
        "Return structured status enum to downstream callers for better incident reporting."
      ],
      "tests": null,
      "notes": "Decorated with time_wait to capture execution timing in logs."
    },
    {
      "id": "function:utils._clear_input_field",
      "type": "function",
      "name": "_clear_input_field",
      "path": "utils.py",
      "summary": "Provides robust clearing of text inputs by mixing native and JavaScript techniques.",
      "mechanism": "Attempts click, clear, JS value reset, and handles common Selenium exceptions gracefully.",
      "quality": "stable",
      "concerns": [
        "Returns True even when partial failures occur, masking issues with certain field states."
      ],
      "opportunities": [
        "Return richer status codes to inform caller when JavaScript fallback was required."
      ],
      "tests": null,
      "notes": "Prerequisite helper for _enter_username and _enter_password."
    },
    {
      "id": "function:utils._enter_username",
      "type": "function",
      "name": "_enter_username",
      "path": "utils.py",
      "summary": "Populates the username field within the Ancestry login form.",
      "mechanism": "Waits for visibility, clears the field, pulls credentials from config_schema, and logs masked entry.",
      "quality": "stable",
      "concerns": [
        "Raises ValueError when username missing, which callers must remember to catch."
      ],
      "opportunities": [
        "Consider validating config earlier to avoid runtime ValueError paths."
      ],
      "tests": null,
      "notes": "Feeds into enter_creds before advancing to password entry."
    },
    {
      "id": "function:utils._find_next_button_with_selectors",
      "type": "function",
      "name": "_find_next_button_with_selectors",
      "path": "utils.py",
      "summary": "Locates the Next/Continue button supporting multi-step login flows.",
      "mechanism": "Iterates through prioritized selectors, returning the first element clickable by WebDriverWait.",
      "quality": "stable",
      "concerns": [
        "Selector ordering is hard-coded and may lag behind UI updates without instrumentation."
      ],
      "opportunities": [
        "Log selector successes to evaluate removal of stale entries."
      ],
      "tests": null,
      "notes": "Used by _click_next_button when username step completes."
    },
    {
      "id": "function:utils._debug_log_page_state_after_next_click",
      "type": "function",
      "name": "_debug_log_page_state_after_next_click",
      "path": "utils.py",
      "summary": "Captures URL and title info immediately after advancing the login form.",
      "mechanism": "Reads driver.current_url and driver.title, logging them for troubleshooting.",
      "quality": "stable",
      "concerns": [
        "Only logs at debug level; no structured telemetry for automated diagnosis."
      ],
      "opportunities": [
        "Emit breadcrumb events forward to analytics to reconstruct login sequences."
      ],
      "tests": null,
      "notes": "Helps triage cases where Next button navigation stalls or redirects unexpectedly."
    },
    {
      "id": "function:utils._debug_log_signin_page_buttons",
      "type": "function",
      "name": "_debug_log_signin_page_buttons",
      "path": "utils.py",
      "summary": "Enumerates visible sign-in buttons to aid selector maintenance.",
      "mechanism": "Loops through up to five button elements, logging text and id/class metadata.",
      "quality": "stable",
      "concerns": [
        "Suppresses exceptions silently, potentially hiding locator-breaking issues."
      ],
      "opportunities": [
        "Surface summary metrics or capture screenshot when significant changes detected."
      ],
      "tests": null,
      "notes": "Invoked when Next button cannot be located using known selectors."
    },
    {
      "id": "function:utils._perform_next_button_click",
      "type": "function",
      "name": "_perform_next_button_click",
      "path": "utils.py",
      "summary": "Attempts to advance the login form after username entry.",
      "mechanism": "Executes JavaScript click with fallback to native click and logs page state afterwards.",
      "quality": "stable",
      "concerns": [
        "Returns True even after ElementClickInterceptedException fallback success, erasing nuance about which strategy worked."
      ],
      "opportunities": [
        "Return structured result enumerating which click path succeeded."
      ],
      "tests": null,
      "notes": "Used by _click_next_button; ensures page has time to react before continuing."
    },
    {
      "id": "function:utils._click_next_button",
      "type": "function",
      "name": "_click_next_button",
      "path": "utils.py",
      "summary": "Orchestrates discovery and activation of the Next/Continue button during login.",
      "mechanism": "Combines selector scanning, click execution, and fallback logging when selectors fail.",
      "quality": "stable",
      "concerns": [
        "Error messaging references SIGN_IN_BUTTON_SELECTOR literal string rather than evaluated value."
      ],
      "opportunities": [
        "Improve logging to include actual selector details on failure."
      ],
      "tests": null,
      "notes": "Called by enter_creds after username entry completes."
    },
    {
      "id": "function:utils._enter_password",
      "type": "function",
      "name": "_enter_password",
      "path": "utils.py",
      "summary": "Populates the password field with configured credentials.",
      "mechanism": "Waits for visibility, clears the field, reads password from config_schema, and returns the input element for later actions.",
      "quality": "stable",
      "concerns": [
        "Hard-coded fallback wait of 30 seconds may extend login attempts unnecessarily."
      ],
      "opportunities": [
        "Expose fallback wait duration in config to align with environment latency."
      ],
      "tests": null,
      "notes": "Feeds password element to _click_sign_in_button for fallback interactions."
    },
    {
      "id": "function:utils._try_standard_click",
      "type": "function",
      "name": "_try_standard_click",
      "path": "utils.py",
      "summary": "Attempts a normal Selenium click on the sign-in button, handling common exceptions.",
      "mechanism": "Invokes element.click() catching interaction exceptions and returning boolean success.",
      "quality": "stable",
      "concerns": [
        "No logging differentiates between intercept and stale element beyond warning message."
      ],
      "opportunities": [
        "Return enum or context to inform upstream which fallback should run next."
      ],
      "tests": null,
      "notes": "First attempt within _click_sign_in_button."
    },
    {
      "id": "function:utils._try_javascript_click",
      "type": "function",
      "name": "_try_javascript_click",
      "path": "utils.py",
      "summary": "Executes a JavaScript click on the sign-in button as a fallback strategy.",
      "mechanism": "Runs driver.execute_script to click element and logs outcome.",
      "quality": "stable",
      "concerns": [
        "Does not retry or verify DOM state after execution beyond log messages."
      ],
      "opportunities": [
        "Check button enabled state before attempting JS click to avoid redundant operations."
      ],
      "tests": null,
      "notes": "Second fallback path when standard click fails."
    },
    {
      "id": "function:utils._try_return_key_fallback",
      "type": "function",
      "name": "_try_return_key_fallback",
      "path": "utils.py",
      "summary": "Sends a RETURN keypress to the password field when click strategies fail.",
      "mechanism": "Invokes send_keys(Keys.RETURN) on provided element, logging warnings on failure.",
      "quality": "stable",
      "concerns": [
        "Assumes password_input is still attached to DOM; stale references lead to logged errors only."
      ],
      "opportunities": [
        "Validate element.is_displayed() before attempting fallback to reduce exception noise."
      ],
      "tests": null,
      "notes": "Final fallback within _click_sign_in_button."
    },
    {
      "id": "function:utils._click_sign_in_button",
      "type": "function",
      "name": "_click_sign_in_button",
      "path": "utils.py",
      "summary": "Coordinates click attempts on the sign-in button with multiple fallbacks.",
      "mechanism": "Waits for button readiness, tries standard click, JavaScript click, then RETURN key, logging each path.",
      "quality": "monitor",
      "concerns": [
        "Returns True even when fallback methods fail but password field submission might succeed, reducing clarity of actual outcome."
      ],
      "opportunities": [
        "Return structured result to indicate which path executed and whether manual intervention required."
      ],
      "tests": null,
      "notes": "Invoked by enter_creds after password entry."
    },
    {
      "id": "function:utils.enter_creds",
      "type": "function",
      "name": "enter_creds",
      "path": "utils.py",
      "summary": "Automates username/password entry on the login form.",
      "mechanism": "Creates waits, enters username, clicks Next, enters password, and triggers sign-in button sequence.",
      "quality": "monitor",
      "concerns": [
        "Mixes control flow and logging; failure modes rely on broad exception handling leading to limited diagnostics."
      ],
      "opportunities": [
        "Refactor into smaller composable steps returning structured results to differentiate credential vs navigation issues."
      ],
      "tests": null,
      "notes": "Returns boolean success to higher-level login flow."
    },
    {
      "id": "function:utils._find_consent_banner",
      "type": "function",
      "name": "_find_consent_banner",
      "path": "utils.py",
      "summary": "Detects the cookie consent overlay when present.",
      "mechanism": "Performs short WebDriverWait on the consent selector, logging detection or absence.",
      "quality": "stable",
      "concerns": [
        "Reraises WebDriverException, relying on caller to decide whether to continue."
      ],
      "opportunities": [
        "Return error context with selector details to speed debugging."
      ],
      "tests": null,
      "notes": "Feeds consent() to decide whether acceptance workflow required."
    },
    {
      "id": "function:utils._click_accept_button_standard",
      "type": "function",
      "name": "_click_accept_button_standard",
      "path": "utils.py",
      "summary": "Attempts a normal click on the consent accept button and verifies overlay removal.",
      "mechanism": "Clicks element, waits briefly for overlay removal, and logs any intercept exceptions.",
      "quality": "stable",
      "concerns": [
        "Assumes overlay removal within one second, which may fail under slow network conditions."
      ],
      "opportunities": [
        "Adjust wait duration via config to better align with UI response times."
      ],
      "tests": null,
      "notes": "Primary strategy in consent acceptance flow."
    },
    {
      "id": "function:utils._click_accept_button_js",
      "type": "function",
      "name": "_click_accept_button_js",
      "path": "utils.py",
      "summary": "Executes a JavaScript click on the consent button as a fallback.",
      "mechanism": "Runs execute_script to click element and waits for overlay disappearance similar to the standard path.",
      "quality": "stable",
      "concerns": [
        "Assumes button reference remains valid; stale elements result in logged errors only."
      ],
      "opportunities": [
        "Perform stale element check before executing JS to reduce exception noise."
      ],
      "tests": null,
      "notes": "Fallback for consent acceptance when standard click fails."
    },
    {
      "id": "function:utils._handle_consent_button",
      "type": "function",
      "name": "_handle_consent_button",
      "path": "utils.py",
      "summary": "Coordinates consent acceptance by locating the accept button and invoking click helpers.",
      "mechanism": "Waits briefly for a clickable button, tries standard click, then JS fallback, returning success flag.",
      "quality": "stable",
      "concerns": [
        "Returns False when selector not found, leaving overlay resolution to external manual steps."
      ],
      "opportunities": [
        "Capture screenshot when button not found to accelerate debugging."
      ],
      "tests": null,
      "notes": "Used by consent() before logging errors on failure."
    },
    {
      "id": "function:utils.consent",
      "type": "function",
      "name": "consent",
      "path": "utils.py",
      "summary": "Handles cookie consent overlays to ensure login automation can proceed.",
      "mechanism": "Uses _find_consent_banner to detect overlays and _handle_consent_button to dismiss them, reporting failure otherwise.",
      "quality": "stable",
      "concerns": [
        "Returns True when banner absent but cannot differentiate between absence and detection failure."
      ],
      "opportunities": [
        "Return structured status to distinguish 'not needed' vs 'dismissed'."
      ],
      "tests": null,
      "notes": "Invoked before credential entry and during 2FA handling."
    },
    {
      "id": "function:utils._check_initial_login_status",
      "type": "function",
      "name": "_check_initial_login_status",
      "path": "utils.py",
      "summary": "Performs a quick login_status check before initiating a full login flow.",
      "mechanism": "Calls login_status with UI fallback disabled and short-circuits the login process when already authenticated.",
      "quality": "stable",
      "concerns": [
        "Prints to stdout from within utility layer, coupling logic to CLI presentation."
      ],
      "opportunities": [
        "Return status flag and let caller handle messaging to keep utilities silent."
      ],
      "tests": null,
      "notes": "First step within log_in prior to navigation."
    },
    {
      "id": "function:utils._navigate_to_signin",
      "type": "function",
      "name": "_navigate_to_signin",
      "path": "utils.py",
      "summary": "Ensures the browser is on the Ancestry sign-in page before entering credentials.",
      "mechanism": "Uses nav_to_page to reach the sign-in URL, re-checks login status, and returns status codes when redirects indicate existing authentication.",
      "quality": "stable",
      "concerns": [
        "Return values mix success token strings and error codes, requiring caller knowledge to interpret."
      ],
      "opportunities": [
        "Standardize return type (enum or dataclass) to improve clarity."
      ],
      "tests": null,
      "notes": "Called by _execute_login_flow before dealing with consent and credentials."
    },
    {
      "id": "function:utils._check_for_login_errors",
      "type": "function",
      "name": "_check_for_login_errors",
      "path": "utils.py",
      "summary": "Scans the login page for known error banners following credential submission.",
      "mechanism": "Waits briefly for specific failure selectors, logging which alert type triggered and returning corresponding status codes.",
      "quality": "stable",
      "concerns": [
        "Nested waits create sequential 1s + 0.5s delays even when errors absent."
      ],
      "opportunities": [
        "Use simultaneous search strategies or shorter waits to reduce latency."
      ],
      "tests": null,
      "notes": "Referenced by credential handling and verification flows to categorize failures."
    },
    {
      "id": "function:utils._try_2fa_selectors",
      "type": "function",
      "name": "_try_2fa_selectors",
      "path": "utils.py",
      "summary": "Attempts to detect the presence of the 2FA page using multiple selector heuristics.",
      "mechanism": "Iterates through CSS/XPath patterns with short waits, logging each attempt for troubleshooting.",
      "quality": "stable",
      "concerns": [
        "No telemetry on selector success rates to inform maintenance cadence."
      ],
      "opportunities": [
        "Persist selector hit statistics to refine the list proactively."
      ],
      "tests": null,
      "notes": "Primary detection routine used by _detect_2fa_page."
    },
    {
      "id": "function:utils._debug_log_page_headers",
      "type": "function",
      "name": "_debug_log_page_headers",
      "path": "utils.py",
      "summary": "Logs body classes and header text for diagnosing unexpected page content.",
      "mechanism": "Queries for body class and up to three heading elements, logging their text.",
      "quality": "stable",
      "concerns": [
        "Only runs when _detect_2fa_page fails, so data is limited to failure cases."
      ],
      "opportunities": [
        "Capture screenshot as well to accelerate remote debugging."
      ],
      "tests": null,
      "notes": "Called when 2FA detection heuristics do not match expected elements."
    },
    {
      "id": "function:utils._detect_2fa_page",
      "type": "function",
      "name": "_detect_2fa_page",
      "path": "utils.py",
      "summary": "Determines whether the two-factor authentication page is currently displayed.",
      "mechanism": "Uses _try_2fa_selectors to locate UI elements, logs diagnostics when not found, and returns tuple of detection flag and early result string.",
      "quality": "stable",
      "concerns": [
        "Returns (False, None) for most failure cases, requiring callers to perform additional checks to differentiate scenarios."
      ],
      "opportunities": [
        "Expand return tuple with diagnostic message to aid upstream decision-making."
      ],
      "tests": null,
      "notes": "Used within _execute_login_flow to branch into 2FA handling."
    },
    {
      "id": "function:utils._handle_2fa_flow",
      "type": "function",
      "name": "_handle_2fa_flow",
      "path": "utils.py",
      "summary": "Invokes the 2FA automation and interprets its outcome for the login flow.",
      "mechanism": "Calls handle_two_fa and then login_status to ensure authentication succeeded before returning status strings.",
      "quality": "stable",
      "concerns": [
        "Returns string codes rather than structured objects, perpetuating string comparisons in callers."
      ],
      "opportunities": [
        "Introduce enum-based status to harmonize with broader login result handling."
      ],
      "tests": null,
      "notes": "Used when _execute_login_flow detects active 2FA page."
    },
    {
      "id": "function:utils._verify_login_no_2fa",
      "type": "function",
      "name": "_verify_login_no_2fa",
      "path": "utils.py",
      "summary": "Handles post-credential verification when no 2FA challenge is present.",
      "mechanism": "Checks login_status, saves cookies on success, inspects errors or URL state when failure occurs.",
      "quality": "stable",
      "concerns": [
        "Repeated UI polling may slow down login on slow pages."
      ],
      "opportunities": [
        "Record exact failure reasons to telemetry for aggregate reporting."
      ],
      "tests": null,
      "notes": "Completes login flow when 2FA not required."
    },
    {
      "id": "function:utils._debug_log_page_errors",
      "type": "function",
      "name": "_debug_log_page_errors",
      "path": "utils.py",
      "summary": "Logs visible alert elements after credential submission to aid debugging.",
      "mechanism": "Finds up to three alert-like elements and logs their text content.",
      "quality": "stable",
      "concerns": [
        "Logs at warning level even for benign warnings, potentially adding noise."
      ],
      "opportunities": [
        "Differentiate severity between known benign and critical alerts."
      ],
      "tests": null,
      "notes": "Invoked by _debug_log_post_credentials_state."
    },
    {
      "id": "function:utils._debug_log_post_credentials_state",
      "type": "function",
      "name": "_debug_log_post_credentials_state",
      "path": "utils.py",
      "summary": "Captures URL and title after credential submission for diagnostics.",
      "mechanism": "Logs driver URL/title and delegates to _debug_log_page_errors for visible alerts.",
      "quality": "stable",
      "concerns": [
        "Only called after credential submission; if an earlier failure occurs, state is not captured."
      ],
      "opportunities": [
        "Trigger on both success and failure paths to broaden coverage."
      ],
      "tests": null,
      "notes": "Used within _execute_login_flow before evaluating 2FA state."
    },
    {
      "id": "function:utils._handle_credentials_entry",
      "type": "function",
      "name": "_handle_credentials_entry",
      "path": "utils.py",
      "summary": "Runs credential entry logic and maps failures to login status codes.",
      "mechanism": "Calls enter_creds and, on failure, consults _check_for_login_errors to return a descriptive error string.",
      "quality": "stable",
      "concerns": [
        "Returns generic LOGIN_FAILED_CREDS_ENTRY when errors absent, which may hide root causes."
      ],
      "opportunities": [
        "Add more granular logging to differentiate between username/password submission issues."
      ],
      "tests": null,
      "notes": "Breaks down credential handling for _execute_login_flow."
    },
    {
      "id": "function:utils._execute_login_flow",
      "type": "function",
      "name": "_execute_login_flow",
      "path": "utils.py",
      "summary": "Primary login workflow orchestrator managing navigation, consent, credentials, and 2FA.",
      "mechanism": "Sequentially navigates to sign-in, handles consent, submits credentials, logs state, branches on 2FA detection, and returns status strings.",
      "quality": "monitor",
      "concerns": [
        "String-based status codes create fragile comparisons across the codebase."
      ],
      "opportunities": [
        "Introduce typed result object capturing status, message, and remediation hints."
      ],
      "tests": null,
      "notes": "Core implementation called by log_in after preliminary checks."
    },
    {
      "id": "function:utils._handle_login_exception",
      "type": "function",
      "name": "_handle_login_exception",
      "path": "utils.py",
      "summary": "Maps exceptions encountered during login to standardized status codes.",
      "mechanism": "Inspects exception type (Timeout vs WebDriver vs other), logs appropriately, and returns descriptive status strings while checking browser state.",
      "quality": "stable",
      "concerns": [
        "Uses is_browser_open to detect driver death without documenting dependency in knowledge graph."
      ],
      "opportunities": [
        "Return structured object containing exception details for downstream logging aggregation."
      ],
      "tests": null,
      "notes": "Called by log_in when any unexpected exception bubbles up from _execute_login_flow."
    },
    {
      "id": "class:utils.ApiRequestConfig",
      "type": "class",
      "name": "ApiRequestConfig",
      "path": "utils.py",
      "summary": "Dataclass consolidating HTTP request inputs for the unified API helper pipeline.",
      "mechanism": "Stores URL, payload, header, retry, and metadata fields mutated by _api_req_impl during retry execution.",
      "quality": "stable",
      "concerns": [
        "Mutable attributes like attempt and delay are updated in-place, making reuse across concurrent requests unsafe."
      ],
      "opportunities": [
        "Consider copying or freezing config objects per attempt to simplify reasoning about state transitions."
      ],
      "tests": null,
      "notes": "Supports backward-compatible _api_req signature while enabling typed configuration usage."
    },
    {
      "id": "function:utils._api_req",
      "type": "function",
      "name": "_api_req",
      "path": "utils.py",
      "summary": "Legacy-friendly wrapper converting positional arguments into ApiRequestConfig before invoking the internal request pipeline.",
      "mechanism": "Normalizes call parameters, constructs ApiRequestConfig with provided values, and delegates to _api_req_impl.",
      "quality": "monitor",
      "concerns": [
        "Retains a 16-parameter signature that invites inconsistent caller usage and complicates refactoring efforts."
      ],
      "opportunities": [
        "Migrate call sites to supply ApiRequestConfig directly so the legacy wrapper can be deprecated."
      ],
      "tests": null,
      "notes": "Kept for backwards compatibility with older action modules during the 2025 API helper refactor."
    },
    {
      "id": "function:utils._api_req_impl",
      "type": "function",
      "name": "_api_req_impl",
      "path": "utils.py",
      "summary": "Core API helper coordinating prerequisite validation, retry configuration hydration, and execution loop dispatch.",
      "mechanism": "Validates SessionManager readiness, hydrates retry settings from config_schema.api, then executes _execute_request_with_retries with the populated config.",
      "quality": "monitor",
      "concerns": [
        "Mutates ApiRequestConfig state and pulls globals from config_schema, which makes isolated testing harder."
      ],
      "opportunities": [
        "Allow dependency injection of retry parameters or session validators to decouple from global configuration."
      ],
      "tests": null,
      "notes": "Primary entry point for API calls after the request pipeline overhaul."
    },
    {
      "id": "function:utils._execute_request_with_retries",
      "type": "function",
      "name": "_execute_request_with_retries",
      "path": "utils.py",
      "summary": "Controls the exponential backoff retry loop for API requests using ApiRequestConfig state.",
      "mechanism": "Iterates while retries remain, updates attempt counters, handles exceptions surfaced by _process_request_attempt, and returns the first terminal result.",
      "quality": "stable",
      "concerns": [
        "Updates config.attempt in-place, which prevents sharing a config across concurrent requests."
      ],
      "opportunities": [
        "Emit structured telemetry about retry counts and final outcome to aid production monitoring."
      ],
      "tests": null,
      "notes": "Relies on helper functions to decide whether to continue looping or bubble result."
    },
    {
      "id": "function:utils._process_request_attempt",
      "type": "function",
      "name": "_process_request_attempt",
      "path": "utils.py",
      "summary": "Executes a single HTTP attempt, handling preparation, execution, and response classification for the retry loop.",
      "mechanism": "Builds request parameters, issues the request, constructs a RetryContext, and delegates to response or exception handlers to decide on retry continuation.",
      "quality": "monitor",
      "concerns": [
        "Broad try/except block mixes preparation, network I/O, and retry bookkeeping, raising cyclomatic complexity."
      ],
      "opportunities": [
        "Extract strategy objects for preparation and response evaluation to simplify targeted testing."
      ],
      "tests": null,
      "notes": "Central decision point for whether retries should continue after each attempt."
    },
    {
      "id": "function:utils._prepare_api_request",
      "type": "function",
      "name": "_prepare_api_request",
      "path": "utils.py",
      "summary": "Assembles headers, cookies, timeout, and rate limiting prior to executing a request attempt.",
      "mechanism": "Derives base headers, syncs cookies, applies AdaptiveRateLimiter waits, and returns a requests.request() parameter dict.",
      "quality": "monitor",
      "concerns": [
        "Performs side effects such as cookie sync and sleeps during preparation, complicating pure unit tests."
      ],
      "opportunities": [
        "Split pure request construction from side-effectful synchronization to improve observability and reusability."
      ],
      "tests": null,
      "notes": "Relies on config_schema.selenium defaults for timeout behavior."
    },
    {
      "id": "function:utils._execute_api_request",
      "type": "function",
      "name": "_execute_api_request",
      "path": "utils.py",
      "summary": "Thin wrapper around requests.Session.request providing consistent logging for network exceptions.",
      "mechanism": "Uses SessionManager._requests_session to issue the HTTP call and catches RequestException to record retryable failures.",
      "quality": "stable",
      "concerns": [
        "Touches the SessionManager's protected _requests_session attribute directly, reinforcing tight coupling."
      ],
      "opportunities": [
        "Expose a public accessor on SessionManager to decouple this helper from private attributes."
      ],
      "tests": null,
      "notes": "Returns None when RequestException is raised so the retry loop can handle backoff."
    },
    {
      "id": "function:utils._validate_api_req_prerequisites",
      "type": "function",
      "name": "_validate_api_req_prerequisites",
      "path": "utils.py",
      "summary": "Pre-flight guard confirming SessionManager and configuration prerequisites before issuing API calls.",
      "mechanism": "Checks for an active SessionManager requests session and that config_schema is loaded, logging errors when missing.",
      "quality": "stable",
      "concerns": [
        "Only returns False on failure without conveying the specific missing dependency to upstream callers."
      ],
      "opportunities": [
        "Return structured errors or raise dedicated exceptions to aid diagnostics and automated recovery."
      ],
      "tests": null,
      "notes": "Prevents the retry loop from running when core dependencies are absent."
    },
    {
      "id": "function:utils._get_retry_configuration",
      "type": "function",
      "name": "_get_retry_configuration",
      "path": "utils.py",
      "summary": "Retrieves retry parameters from the typed configuration schema for use by the API helper.",
      "mechanism": "Reads max retries, delays, and retryable status codes from config_schema.api and returns them as a tuple.",
      "quality": "stable",
      "concerns": [
        "Couples retry behavior tightly to global configuration, limiting function-level overrides."
      ],
      "opportunities": [
        "Allow call sites to supply override values for experiments without mutating global config."
      ],
      "tests": null,
      "notes": "Ensures runtime retry behavior follows validated .env-derived settings."
    },
    {
      "id": "function:utils._handle_response_status",
      "type": "function",
      "name": "_handle_response_status",
      "path": "utils.py",
      "summary": "Central response classifier routing retryable statuses, redirects, errors, and successes to appropriate handlers.",
      "mechanism": "Evaluates HTTP status codes against retry configuration, delegates to specialized helpers, updates rate limiter feedback, and returns processed payloads or Response objects.",
      "quality": "monitor",
      "concerns": [
        "Combines multiple responsibilities and side effects, making reasoning about returned types and session state changes non-trivial."
      ],
      "opportunities": [
        "Refactor into discrete strategy functions or objects for retry, redirect, and error paths to reduce branching complexity."
      ],
      "tests": null,
      "notes": "Invoked once per attempt to determine whether retries should continue."
    },
    {
      "id": "function:utils._handle_retryable_status",
      "type": "function",
      "name": "_handle_retryable_status",
      "path": "utils.py",
      "summary": "Handles HTTP responses deemed retryable, coordinating adaptive backoff and limiter feedback.",
      "mechanism": "Logs retryable statuses, decrements retry counters, triggers adaptive rate limiter callbacks on 429, sleeps with exponential backoff, and signals whether to continue retrying.",
      "quality": "monitor",
      "concerns": [
        "Performs blocking sleep directly, limiting responsiveness on long-running pipelines."
      ],
      "opportunities": [
        "Capture retry telemetry (wait duration, status) to feed into rate limiter tuning or async scheduling."
      ],
      "tests": null,
      "notes": "Distinguishes 429 handling with explicit logging to highlight rate limiting events."
    },
    {
      "id": "function:utils._handle_redirect_response",
      "type": "function",
      "name": "_handle_redirect_response",
      "path": "utils.py",
      "summary": "Interprets redirect responses at the end of the retry pipeline respecting allow_redirects settings.",
      "mechanism": "Logs redirect outcomes, surfaces Location header when available, and returns the Response when redirects should not be followed.",
      "quality": "stable",
      "concerns": [
        "Returns None when redirects are acceptable, leaving upstream logic to interpret implicit success."
      ],
      "opportunities": [
        "Expand to support custom redirect handlers for APIs that signal state via 3xx responses."
      ],
      "tests": null,
      "notes": "Ensures callers can inspect redirect responses without auto-following when disabled."
    },
    {
      "id": "function:utils._handle_error_status",
      "type": "function",
      "name": "_handle_error_status",
      "path": "utils.py",
      "summary": "Processes non-retryable error statuses, logging diagnostics and updating session readiness flags.",
      "mechanism": "Adjusts logging level based on API description, toggles session_manager.session_ready on auth failures, and emits truncated response bodies for troubleshooting.",
      "quality": "monitor",
      "concerns": [
        "Mutates global session state without surfacing error semantics to the caller beyond log messages."
      ],
      "opportunities": [
        "Return structured error objects to allow upstream workflows to differentiate auth expiry vs other failures."
      ],
      "tests": null,
      "notes": "Commonly encountered during login verification and expired session handling."
    },
    {
      "id": "function:utils._process_api_response",
      "type": "function",
      "name": "_process_api_response",
      "path": "utils.py",
      "summary": "Normalizes successful HTTP responses into JSON or text based on content-type and caller flags.",
      "mechanism": "Inspects content-type headers, conditionally parses JSON, supports force_text overrides, and logs parse failures with truncated payloads.",
      "quality": "stable",
      "concerns": [
        "Returns None when JSON decoding fails, requiring callers to inspect logs for the underlying parse issue."
      ],
      "opportunities": [
        "Include parse status metadata alongside payloads to make downstream error handling explicit."
      ],
      "tests": null,
      "notes": "Supports legacy text/plain CSRF token responses in addition to JSON APIs."
    },
    {
      "id": "function:utils._handle_request_exception",
      "type": "function",
      "name": "_handle_request_exception",
      "path": "utils.py",
      "summary": "Handles network-level exceptions during request attempts, updating retry counters and delays.",
      "mechanism": "Logs exception details, decrements retries, computes the next wait using _calculate_retry_sleep_time, and sleeps before retrying.",
      "quality": "monitor",
      "concerns": [
        "Uses synchronous sleep which can accumulate significant wall-clock time during repeated failures."
      ],
      "opportunities": [
        "Surface exception metrics or allow pluggable wait strategies for better observability under failure."
      ],
      "tests": null,
      "notes": "Returns updated retry state to the caller but does not re-raise the exception."
    },
    {
      "id": "function:utils._handle_failed_request_response",
      "type": "function",
      "name": "_handle_failed_request_response",
      "path": "utils.py",
      "summary": "Determines retry behavior when the HTTP call returned no response object (e.g., network exception).",
      "mechanism": "Decrements retries, logs failure state, computes exponential backoff delay, sleeps, and returns updated retry metadata.",
      "quality": "monitor",
      "concerns": [
        "Blocking sleep introduces pauses even when higher-level timeout handling might prefer aborting rapidly."
      ],
      "opportunities": [
        "Record metrics about repeated None responses to highlight systemic connectivity issues."
      ],
      "tests": null,
      "notes": "Called when _execute_api_request returns None before response status handling."
    },
    {
      "id": "module:common_params",
      "type": "module",
      "name": "common_params",
      "path": "common_params.py",
      "summary": "Shared dataclass definitions bundling frequently co-occurring parameters across actions and utilities.",
      "mechanism": "Defines lightweight containers such as RetryContext, MatchIdentifiers, and BatchConfig to reduce long argument lists.",
      "quality": "stable",
      "concerns": [
        "Adds sys.path mutation at import time, which could hide packaging issues in other environments."
      ],
      "opportunities": [
        "Refactor into a proper package module to eliminate manual path manipulation and enable typed exports."
      ],
      "tests": "common_params_module_tests",
      "notes": "Referenced by multiple action modules for consistent configuration semantics."
    },
    {
      "id": "class:common_params.RetryContext",
      "type": "class",
      "name": "RetryContext",
      "path": "common_params.py",
      "summary": "Dataclass capturing retry bookkeeping including attempts, delays, and status-code filters.",
      "mechanism": "Stores attempt counters, backoff factors, and retryable status codes which helpers mutate while coordinating retries.",
      "quality": "stable",
      "concerns": [
        "Mutable defaults rely on callers to set retries_left to avoid None checks throughout retry logic."
      ],
      "opportunities": [
        "Add helper constructors to pre-populate retries_left and derived fields for common scenarios."
      ],
      "tests": "common_params_module_tests",
      "notes": "Instantiated by utils._process_request_attempt to drive response handling decisions."
    },
    {
      "id": "method:SessionManager.ensure_session_ready",
      "type": "method",
      "name": "SessionManager.ensure_session_ready",
      "path": "core/session_manager.py",
      "summary": "Validates browser/db readiness with cached results and identifier retrieval before actions run.",
      "mechanism": "Checks cached readiness, ensures driver live, delegates to SessionValidator.perform_readiness_checks, retrieves identifiers, precaches CSRF tokens.",
      "quality": "stable",
      "concerns": [
        "Depends on side effects in SessionValidator and cookie caches; difficult to unit test in isolation."
      ],
      "opportunities": [
        "Could expose structured status object instead of boolean for richer analytics."
      ],
      "tests": null,
      "notes": "Caching interval of 60s; skip_csrf flag used by Action 10."
    },
    {
      "id": "method:SessionManager._check_cached_readiness",
      "type": "method",
      "name": "SessionManager._check_cached_readiness",
      "path": "core/session_manager.py",
      "summary": "Applies timeout-guarded cache validation to reuse recent readiness checks when safe.",
      "mechanism": "Decorators enforce timeout and graceful degradation while method compares last readiness timestamp, validates driver health when browser needed, and returns cached boolean when valid.",
      "quality": "stable",
      "concerns": [
        "Fixed 60-second cache window may be too lenient for volatile sessions, allowing stale readiness state."
      ],
      "opportunities": [
        "Expose configurable cache duration or action-specific overrides before reusing readiness state."
      ],
      "tests": null,
      "notes": "Returns None when cache unusable so caller proceeds with full validation path."
    },
    {
      "id": "method:APIManager.sync_cookies_from_browser",
      "type": "method",
      "name": "APIManager.sync_cookies_from_browser",
      "path": "core/api_manager.py",
      "summary": "Transfers cookies from BrowserManager into the pooled requests session with recovery retry.",
      "mechanism": "Validates browser session, clears existing cookies, deduplicates by name/path, and injects into requests.Session; on invalid session attempts recovery via SessionManager.",
      "quality": "stable",
      "concerns": [
        "Recursion guard depends on passing session_manager=None after recovery; fragile if callers change signature.",
        "Swallows exceptions into False, limiting insight into underlying Selenium failures."
      ],
      "opportunities": [
        "Return structured result capturing counts and failure reason for analytics."
      ],
      "tests": null,
      "notes": "Deduplicates cookies preferring more specific domains before sync."
    },
    {
      "id": "method:APIManager.load_cookies_from_file",
      "type": "method",
      "name": "APIManager.load_cookies_from_file",
      "path": "core/api_manager.py",
      "summary": "Loads cookies from JSON file into requests session to enable browserless API calls.",
      "mechanism": "Reads cookie list, clears session cookies, then adds each name/value with stored domain/path metadata.",
      "quality": "stable",
      "concerns": [
        "Silently skips malformed cookie entries; difficult to debug incorrect formats."
      ],
      "opportunities": [
        "Log summary of skipped cookies or provide validation utility."
      ],
      "tests": null,
      "notes": "Uses repo-root ancestry_cookies.json when path unspecified."
    },
    {
      "id": "method:APIManager.make_api_request",
      "type": "method",
      "name": "APIManager.make_api_request",
      "path": "core/api_manager.py",
      "summary": "Executes HTTP requests through the shared session with optional CSRF injection and response parsing.",
      "mechanism": "Builds default headers, attaches CSRF token when requested, performs requests.Session.request, raises for status, and parses JSON/text fallback.",
      "quality": "stable",
      "concerns": [
        "Logs 401s at debug level but treats other failures as generic errors; may need richer error taxonomy."
      ],
      "opportunities": [
        "Surface response metadata (status, duration) to analytics for rate-limit monitoring."
      ],
      "tests": null,
      "notes": "Centralizes timeout and redirect handling for API calls."
    },
    {
      "id": "method:APIManager.get_csrf_token",
      "type": "method",
      "name": "APIManager.get_csrf_token",
      "path": "core/api_manager.py",
      "summary": "Fetches CSRF token via configured endpoint and stores it for subsequent requests.",
      "mechanism": "Calls make_api_request without CSRF header, inspects multiple key names in JSON response, caches value if found.",
      "quality": "stable",
      "concerns": [
        "Lacks validation on token length/format; may accept malformed strings."
      ],
      "opportunities": [
        "Add sanity checks or expiration handling aligned with SessionManager caching."
      ],
      "tests": null,
      "notes": "Non-critical if token missing; logs at debug level."
    },
    {
      "id": "method:APIManager.get_profile_id",
      "type": "method",
      "name": "APIManager.get_profile_id",
      "path": "core/api_manager.py",
      "summary": "Retrieves profile ID (ucdmid) from personalization endpoint and caches it.",
      "mechanism": "Uses make_api_request, fetches ucdmid from nested data payload, stores in my_profile_id, and rate-limits logging.",
      "quality": "stable",
      "concerns": [
        "Assumes ucdmid present either at root or under data; API contract changes could break silently."
      ],
      "opportunities": [
        "Consider enforcing uppercase normalization like SessionManager does for UUIDs."
      ],
      "tests": null,
      "notes": "Acts as source for SessionManager identifier cache."
    },
    {
      "id": "method:APIManager.retrieve_all_identifiers",
      "type": "method",
      "name": "APIManager.retrieve_all_identifiers",
      "path": "core/api_manager.py",
      "summary": "Ensures profile ID, UUID, and CSRF token are populated through helper checks.",
      "mechanism": "Calls _ensure_profile_id, _ensure_uuid, and _ensure_csrf, aggregating success state for essential identifiers.",
      "quality": "monitor",
      "concerns": [
        "Returns True even if CSRF retrieval fails; caller must inspect warnings separately.",
        "_ensure_uuid merely logs error because SessionManager owns UUID fetch, leading to confusing control flow."
      ],
      "opportunities": [
        "Refactor identifier ownership so UUID retrieval resides entirely within APIManager."
      ],
      "tests": null,
      "notes": "Used by SessionManager readiness checks to populate API-side identifiers."
    },
    {
      "id": "method:APIManager.verify_api_login_status",
      "type": "method",
      "name": "APIManager.verify_api_login_status",
      "path": "core/api_manager.py",
      "summary": "Determines if user is authenticated by probing profile endpoint without re-syncing cookies.",
      "mechanism": "Skips cookie sync to avoid recursion, requests profile ID, and interprets failure as not logged in.",
      "quality": "stable",
      "concerns": [
        "Only checks profile endpoint; lacks fallback heuristics for partial login states."
      ],
      "opportunities": [
        "Augment with secondary probe or analytics events to differentiate network vs auth failure."
      ],
      "tests": null,
      "notes": "Returns None only when unable to determine status; otherwise boolean."
    },
    {
      "id": "method:SessionManager._initialize_rate_limiter",
      "type": "method",
      "name": "SessionManager._initialize_rate_limiter",
      "path": "core/session_manager.py",
      "summary": "Configures and attaches the AdaptiveRateLimiter instance based on runtime configuration and endpoint profiles.",
      "mechanism": "Imports utils.get_rate_limiter lazily, derives batch and fill-rate thresholds from config_schema, applies endpoint caps, and logs when limiter bound to session.",
      "quality": "monitor",
      "concerns": [
        "Performs multiple getattr lookups without validation; typos in config can silently fall back to defaults.",
        "Swallows ImportError by returning None, leaving callers without explicit warning that rate limiting is disabled."
      ],
      "opportunities": [
        "Emit warning when limiter cannot be created so operators know rate limiting is inactive.",
        "Expose resulting configuration object for telemetry to confirm expected thresholds."
      ],
      "tests": null,
      "notes": "Called once during SessionManager init to honor REQUESTS_PER_SECOND and endpoint throttles."
    },
    {
      "id": "method:SessionManager._build_endpoint_profile_config",
      "type": "method",
      "name": "SessionManager._build_endpoint_profile_config",
      "path": "core/session_manager.py",
      "summary": "Normalizes endpoint-specific throttle configuration into a sanitized dict for the rate limiter.",
      "mechanism": "Reads config_schema.api.endpoint_throttle_profiles, filters to dict entries, and clones values to avoid mutating shared config objects.",
      "quality": "stable",
      "concerns": [
        "Silently ignores non-dict entries instead of alerting configuration authors to mistakes."
      ],
      "opportunities": [
        "Log discarded entries with context so misconfigurations are surfaced during testing."
      ],
      "tests": null,
      "notes": "Feeding sanitized profiles to _calculate_endpoint_rate_cap and get_rate_limiter."
    },
    {
      "id": "method:SessionManager._calculate_endpoint_rate_cap",
      "type": "method",
      "name": "SessionManager._calculate_endpoint_rate_cap",
      "path": "core/session_manager.py",
      "summary": "Derives the tightest allowable rate from endpoint throttle definitions to cap global limiter settings.",
      "mechanism": "Iterates provided profiles, collects max_rate and min_interval values, converts to candidate rates, and returns lowest positive rate when present.",
      "quality": "stable",
      "concerns": [
        "Does not validate units or ensure min_interval > 0 beyond simple numeric check, risking ZeroDivision exceptions if misconfigured."
      ],
      "opportunities": [
        "Introduce dataclass validation or schema enforcement for throttle profiles before computation."
      ],
      "tests": null,
      "notes": "Helps enforce conservative RPS when specific endpoints require tighter throttles."
    },
    {
      "id": "method:SessionManager.start_sess",
      "type": "method",
      "name": "SessionManager.start_sess",
      "path": "core/session_manager.py",
      "summary": "Bootstraps DB and browser based on browser_needed flag and records session start time.",
      "mechanism": "Ensures DB ready via DatabaseManager, optionally starts BrowserManager, resets logging flags.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Consider returning diagnostic details on failure (e.g., DB vs browser)."
      ],
      "tests": null,
      "notes": "Called indirectly through exec_actn during action setup."
    },
    {
      "id": "method:SessionManager.get_cookies",
      "type": "method",
      "name": "SessionManager.get_cookies",
      "path": "core/session_manager.py",
      "summary": "Waits for required cookies with retry and final validation to support API sync flows.",
      "mechanism": "Polls WebDriver cookies, logs missing sets, handles WebDriverExceptions, performs final check before timeout.",
      "quality": "stable",
      "concerns": [
        "Timeout handling duplicates logging in _perform_final_cookie_check; could be simplified."
      ],
      "opportunities": [
        "Expose metrics on retry counts for troubleshooting auth issues."
      ],
      "tests": null,
      "notes": "Feeds into cookie sync pipeline for API requests session."
    },
    {
      "id": "method:SessionManager._sync_cookies_to_requests",
      "type": "method",
      "name": "SessionManager._sync_cookies_to_requests",
      "path": "core/session_manager.py",
      "summary": "Transfers cookies from Selenium driver to requests session with cooldown and recursion guard.",
      "mechanism": "Checks skip rules, reads cookies, delegates to _sync_driver_cookies_to_requests, tracks sync timestamps.",
      "quality": "stable",
      "concerns": [
        "Directly manipulates api_manager._requests_session; hidden coupling."
      ],
      "opportunities": [
        "Wrap cookie sync into APIManager method to encapsulate private attributes."
      ],
      "tests": null,
      "notes": "Cooldown fixed at 60 seconds; forced resync clears session flag."
    },
    {
      "id": "method:SessionManager.check_session_health",
      "type": "method",
      "name": "SessionManager.check_session_health",
      "path": "core/session_manager.py",
      "summary": "Global session heartbeat that flags session death cascades during long operations.",
      "mechanism": "Uses is_sess_valid(), updates threading.Event flags and timestamps, logs critical alerts on failure.",
      "quality": "monitor",
      "concerns": [
        "Relies on global logging side effects; ensure callers respect halt signals."
      ],
      "opportunities": [
        "Potential to integrate with analytics for proactive alerting."
      ],
      "tests": null,
      "notes": "Replaced action6-specific monitor; works for all actions."
    },
    {
      "id": "method:SessionManager.restart_sess",
      "type": "method",
      "name": "SessionManager.restart_sess",
      "path": "core/session_manager.py",
      "summary": "Restarts session resources and optionally navigates to provided URL for recovery flows.",
      "mechanism": "Closes session, restarts via start_sess/ensure_session_ready, optionally uses nav_to_page to reach target URL.",
      "quality": "stable",
      "concerns": [
        "Multiple nested try blocks across nav attempt; consider more granular error categories."
      ],
      "opportunities": [
        "Return structured result with navigation status for caller decisions."
      ],
      "tests": null,
      "notes": "Used for manual recovery operations."
    },
    {
      "id": "method:SessionManager.validate_system_health",
      "type": "method",
      "name": "SessionManager.validate_system_health",
      "path": "core/session_manager.py",
      "summary": "Runs consolidated preflight checks across session cascade monitor, database availability, and browser validity.",
      "mechanism": "Inspects session_health_monitor, exercises DB connectivity via lightweight SELECT, and warns on browser invalidity without failing API-only callers.",
      "quality": "stable",
      "concerns": [
        "Database probe executes raw SQL text; ensure future migrations keep compatibility."
      ],
      "opportunities": [
        "Consider surfacing structured status object for callers needing detailed diagnostics."
      ],
      "tests": null,
      "notes": "Pulled together from disparate action-level health checks to avoid duplication."
    },
    {
      "id": "method:SessionManager.check_cascade_before_operation",
      "type": "method",
      "name": "SessionManager.check_cascade_before_operation",
      "path": "core/session_manager.py",
      "summary": "Guards operations by aborting if session death cascade flag is raised.",
      "mechanism": "Consults session_health_monitor metrics and raises exception with contextual logging when cascades detected.",
      "quality": "stable",
      "concerns": [
        "Raises generic Exception; callers should migrate to project-specific error type."
      ],
      "opportunities": [
        "Introduce custom FatalError subclass to preserve typed control flow."
      ],
      "tests": null,
      "notes": "Designed for long-running actions to fail fast when cascades repeat."
    },
    {
      "id": "method:SessionManager.close_sess",
      "type": "method",
      "name": "SessionManager.close_sess",
      "path": "core/session_manager.py",
      "summary": "Closes browser, database, and API state while resetting session flags.",
      "mechanism": "Invokes BrowserManager.close_browser, disposes DB connections when requested, clears API identifiers, and resets readiness flags.",
      "quality": "stable",
      "concerns": [
        "Depends on callers to pass keep_db correctly; consider clarifying semantics in README."
      ],
      "opportunities": [
        "Expose granular result to indicate which components actually closed."
      ],
      "tests": null,
      "notes": "Used heavily by restart paths and emergency recovery routines."
    },
    {
      "id": "method:SessionManager._force_session_restart",
      "type": "method",
      "name": "SessionManager._force_session_restart",
      "path": "core/session_manager.py",
      "summary": "Emergency restart routine invoked by APICallWatchdog when operations hang beyond timeout.",
      "mechanism": "Performs aggressive cleanup of browser, database connections, API caches, CSRF tokens, and session flags before marking session invalid.",
      "quality": "monitor",
      "concerns": [
        "Returns False unconditionally; callers must rely on side effects to detect restart."
      ],
      "opportunities": [
        "Consider emitting analytics event summarizing restart reason for telemetry."
      ],
      "tests": null,
      "notes": "Backed by regression tests to guard against 7-hour hang recurrence."
    },
    {
      "id": "method:SessionManager.get_csrf",
      "type": "method",
      "name": "SessionManager.get_csrf",
      "path": "core/session_manager.py",
      "summary": "Fetches CSRF token via discovery API when cached token absent or stale.",
      "mechanism": "Validates session, ensures essential cookies present, then delegates to utils._api_req to retrieve token string and update API manager cache.",
      "quality": "stable",
      "concerns": [
        "Relies on _api_req side effects; consider migrating logic into APIManager for cohesion."
      ],
      "opportunities": [
        "Instrument retries to understand failure frequency and latency."
      ],
      "tests": null,
      "notes": "Retry protected; logs once per failure path to reduce noise."
    },
    {
      "id": "method:SessionManager.get_my_profileId",
      "type": "method",
      "name": "SessionManager.get_my_profileId",
      "path": "core/session_manager.py",
      "summary": "Retrieves authenticated user's profile ID and stores it within APIManager cache.",
      "mechanism": "Calls personalization API endpoint via utils._api_req, parses response for ucdmid, uppercases, and logs once.",
      "quality": "stable",
      "concerns": [
        "Expects response shape {data: {ucdmid}}; brittle if API evolves."
      ],
      "opportunities": [
        "Add schema validation to detect upstream contract changes sooner."
      ],
      "tests": null,
      "notes": "Mirrors naming case of upstream field; property wrapper ensures lazy fetch."
    },
    {
      "id": "method:SessionManager.get_my_uuid",
      "type": "method",
      "name": "SessionManager.get_my_uuid",
      "path": "core/session_manager.py",
      "summary": "Obtains user's DNA test UUID and caches uppercase form for reuse.",
      "mechanism": "Hits navheader API, extracts testId, handles invalid session noise with rate-limited logging, and persists to APIManager.",
      "quality": "stable",
      "concerns": [
        "Rate-limited error logging relies on instance attribute _last_uuid_error_time; ensure thread safety if multi-thread scope returns."
      ],
      "opportunities": [
        "Could centralize identifier retrieval with profile ID to minimize separate HTTP calls."
      ],
      "tests": null,
      "notes": "Property accessor returns cached value before hitting API."
    },
    {
      "id": "method:SessionManager.get_my_tree_id",
      "type": "method",
      "name": "SessionManager.get_my_tree_id",
      "path": "core/session_manager.py",
      "summary": "Delegates to api_utils to resolve tree ID based on configured tree name.",
      "mechanism": "Validates config, session state, then calls helper to fetch ID and caches result on APIManager.",
      "quality": "stable",
      "concerns": [
        "Raises ImportError when api_utils missing; ensure calling context handles fatal failure."
      ],
      "opportunities": [
        "Add telemetry for missing tree name to help configuration troubleshooting."
      ],
      "tests": null,
      "notes": "No-ops when TREE_NAME unset to avoid unnecessary API traffic."
    },
    {
      "id": "method:SessionManager.get_tree_owner",
      "type": "method",
      "name": "SessionManager.get_tree_owner",
      "path": "core/session_manager.py",
      "summary": "Fetches tree owner display name using api_utils wrapper and caches result.",
      "mechanism": "Validates input, session state, then delegates to api_utils.call_tree_owner_api and stores name for reuse.",
      "quality": "stable",
      "concerns": [
        "Returns None on invalid input types; consider raising validation error instead."
      ],
      "opportunities": [
        "Surface owner name to analytics during startup for context."
      ],
      "tests": null,
      "notes": "Used primarily during startup diagnostics to confirm tree context."
    },
    {
      "id": "class:core.session_manager.APICallWatchdog",
      "type": "class",
      "name": "APICallWatchdog",
      "path": "core/session_manager.py",
      "summary": "Timeout watchdog guarding API calls with forced session restart callbacks.",
      "mechanism": "Maintains timer-backed callbacks to trigger emergency restarts when API calls exceed configured duration; supports context manager usage.",
      "quality": "stable",
      "concerns": [
        "Relies on threading.Timer which may delay shutdown in heavy load scenarios."
      ],
      "opportunities": [
        "Evaluate integrating with asyncio loop or analytics event logging for timeout frequency."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Added after 7-hour hang incident; multiple regression tests cover edge cases."
    },
    {
      "id": "file:action6_gather.py",
      "type": "file",
      "name": "action6_gather.py",
      "path": "action6_gather.py",
      "summary": "Implements Action 6 DNA match gathering, coordinating page fetch, enrichment, and database synchronization.",
      "mechanism": "Combines SessionManager-driven pagination with sequential rate-limited API calls, caching, and bulk SQLAlchemy operations to upsert DNA matches while logging telemetry.",
      "quality": "monitor",
      "concerns": [
        "Spans over 9k lines with deeply nested helpers, making comprehension and targeted testing difficult.",
        "Relies on shared mutable globals (e.g., CRITICAL_API_FAILURE_THRESHOLD) adjusted at runtime."
      ],
      "opportunities": [
        "Extract page processing, batching, and telemetry helpers into dedicated modules to reduce scope.",
        "Add integration tests exercising real-world pagination scenarios beyond module smoke tests."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Primary automation entry for DNA match harvesting; leverages extensive utils and core resilience decorators."
    },
    {
      "id": "class:action6_gather.PageProcessingMetrics",
      "type": "class",
      "name": "PageProcessingMetrics",
      "path": "action6_gather.py",
      "summary": "Dataclass accumulator tracking per-page counts and timing telemetry for Action 6 processing.",
      "mechanism": "Aggregates totals for matches, timings, and endpoint breakdowns, exposing merge() to combine batch metrics across the run.",
      "quality": "stable",
      "concerns": [
        "prefetch_breakdown and call count dictionaries can grow with new API endpoints, increasing memory footprint slightly."
      ],
      "opportunities": [
        "Consider capping tracked endpoints or emitting metrics directly to telemetry sinks instead of retaining in memory."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Supports progress logging and final timing breakdown; consumed by _accumulate_page_metrics."
    },
    {
      "id": "workflow:action6_gather.coord",
      "type": "workflow",
      "name": "coord",
      "path": "action6_gather.py",
      "summary": "Top-level Action 6 coordinator controlling pagination, error handling, and final reporting.",
      "mechanism": "Validates session readiness, performs initial fetch to determine page range, iterates via _main_page_processing_loop, and emits final metrics and status logs.",
      "quality": "monitor",
      "concerns": [
        "Broad exception handling wraps numerous failure modes, making root-cause diagnosis dependent on log inspection.",
        "Returns bool while mutating shared state dict, complicating deterministic unit testing."
      ],
      "opportunities": [
        "Refactor to return structured results separating outcome, counts, and failure reasons.",
        "Introduce granular analytics events for key failure branches (initial fetch, batching, rate limiter exhaustion)."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Relies on SessionManager rate limiter and health monitoring callbacks to remain within safe API limits."
    },
    {
      "id": "function:action6_gather._validate_session_state",
      "type": "function",
      "name": "_validate_session_state",
      "path": "action6_gather.py",
      "summary": "Guard ensuring SessionManager has live browser, ready session flag, and authenticated UUID before Action 6 runs.",
      "mechanism": "Stacks enhanced recovery, retry, circuit breaker, and timeout decorators around direct checks of SessionManager driver state and my_uuid, raising custom exceptions when invalid.",
      "quality": "stable",
      "concerns": [
        "Heavy decorator stack increases call overhead and can obscure exception provenance during debugging."
      ],
      "opportunities": [
        "Document decorator ordering rationale and trim redundant layers if resilience overlap is detected."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Invoked at the start of coord to short-circuit runs when session state degrades."
    },
    {
      "id": "function:action6_gather._handle_initial_fetch",
      "type": "function",
      "name": "_handle_initial_fetch",
      "path": "action6_gather.py",
      "summary": "Performs initial navigation, resolves total page counts, and logs starting scope for Action 6 runs.",
      "mechanism": "Calls _navigate_and_get_initial_page_data, computes processing range via _determine_page_processing_range, seeds run state, and logs context with log_starting_position.",
      "quality": "monitor",
      "concerns": [
        "Raises RuntimeError for expected control flow (no pages), requiring callers to inspect message text.",
        "Mutates shared state dictionary in place, which obscures data flow for reviewers."
      ],
      "opportunities": [
        "Return typed result objects or dataclasses instead of mutating external state.",
        "Adopt dedicated exception for 'no pages' scenarios to simplify upstream handling."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Respects MATCHES_PER_PAGE configuration when estimating total work."
    },
    {
      "id": "function:action6_gather._main_page_processing_loop",
      "type": "function",
      "name": "_main_page_processing_loop",
      "path": "action6_gather.py",
      "summary": "Iterates through the requested page range while managing dynamic API failure thresholds.",
      "mechanism": "Adjusts CRITICAL_API_FAILURE_THRESHOLD based on run length, estimates match totals, and repeatedly invokes _process_single_page until all pages complete or a fatal error occurs.",
      "quality": "monitor",
      "concerns": [
        "Temporarily overrides global CRITICAL_API_FAILURE_THRESHOLD and does not restore value if exceptions skip normal exit.",
        "Combines threshold tuning, looping, and logging responsibilities in a single function."
      ],
      "opportunities": [
        "Isolate threshold calculation into pure helper with explicit return value.",
        "Restore baseline threshold in a finally block to guard against premature exits."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Reuses first-page matches when starting from checkpoint to avoid duplicate fetch."
    },
    {
      "id": "function:action6_gather._process_single_page",
      "type": "function",
      "name": "_process_single_page",
      "path": "action6_gather.py",
      "summary": "Handles the full lifecycle for a single DNA matches page including fetching, batching, metrics, and rate limiting.",
      "mechanism": "Validates session health, fetches matches with fast-skip optimisation, executes _do_batch for database upsert, updates cumulative state, logs progress, and waits on the rate limiter.",
      "quality": "needs-review",
      "concerns": [
        "Exceeds 150 lines with deep branching that mixes control flow, logging, and state mutation.",
        "Depends on numerous magic keys in the shared state dict, increasing fragility during refactors."
      ],
      "opportunities": [
        "Split into smaller helpers (fetch, batch_process, update_state) returning typed results.",
        "Replace ad-hoc state dict updates with a dataclass to improve readability and validation."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Primary performance hotspot; regressions here directly affect throughput and reliability."
    },
    {
      "id": "function:action6_gather._log_final_results",
      "type": "function",
      "name": "_log_final_results",
      "path": "action6_gather.py",
      "summary": "Consolidates final metrics logging and rate limiter statistics once Action 6 completes.",
      "mechanism": "Calculates elapsed runtime, delegates to _emit_final_summary, _emit_timing_breakdown, _emit_rate_limiter_metrics, and _emit_action_status to produce operator-facing output.",
      "quality": "stable",
      "concerns": [
        "Assumes state dict contains numerous counters; missing keys trigger KeyError late in execution."
      ],
      "opportunities": [
        "Guard logging with dict.get defaults or adopt structured result objects to avoid runtime failures."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Interfaces with rate_limiter persistence helpers when the module is available."
    },
    {
      "id": "function:action6_gather._emit_final_summary",
      "type": "function",
      "name": "_emit_final_summary",
      "path": "action6_gather.py",
      "summary": "Builds the final match count summary and forwards it to the shared logging helper.",
      "mechanism": "Collects totals from the state dictionary, computes derived counts, and invokes the injected log_final_summary callable.",
      "quality": "stable",
      "concerns": [
        "Relies on mandatory state keys; absence leads to KeyError during teardown."
      ],
      "opportunities": [
        "Adopt safer dict access or dataclasses to make required fields explicit."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Paired with _emit_action_status to deliver concise operator summaries."
    },
    {
      "id": "function:action6_gather._emit_action_status",
      "type": "function",
      "name": "_emit_action_status",
      "path": "action6_gather.py",
      "summary": "Formats the final action status message using the shared logging utility.",
      "mechanism": "Derives optional error message from state totals and calls log_action_status with success flag and context.",
      "quality": "stable",
      "concerns": [
        "Failure messaging surfaces only aggregate counts, lacking direct reference to the triggering error."
      ],
      "opportunities": [
        "Augment output with page number or last exception identifier to speed diagnosis."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Invoked exclusively by _log_final_results during Action 6 teardown."
    },
    {
      "id": "function:action6_gather._handle_page_fetch_and_validation",
      "type": "function",
      "name": "_handle_page_fetch_and_validation",
      "path": "action6_gather.py",
      "summary": "Retrieves match data for the current page, retrying DB sessions and short-circuiting on fetch failures.",
      "mechanism": "Obtains a pooled SQLAlchemy session via _get_database_session_with_retry, invokes _fetch_page_matches, and updates run state/controls when data is unavailable.",
      "quality": "monitor",
      "concerns": [
        "Heavy reliance on shared state dict counters makes it easy to double-count errors when multiple branches fire.",
        "Returns tuples with control flags that are loosely documented, increasing cognitive load for callers."
      ],
      "opportunities": [
        "Replace tuple return with a small dataclass to clarify match payload vs. control intent.",
        "Reset database error streak when fetch succeeds to avoid false-positive aborts."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Entrypoint for each page inside _process_single_page; differentiates between skip vs. fatal conditions."
    },
    {
      "id": "function:action6_gather._get_database_session_with_retry",
      "type": "function",
      "name": "_get_database_session_with_retry",
      "path": "action6_gather.py",
      "summary": "Attempts to lease a database session from SessionManager with exponential delay between retries.",
      "mechanism": "Loops up to three times calling SessionManager.get_db_conn, logging warnings and sleeping five seconds between failures before incrementing a shared error counter.",
      "quality": "stable",
      "concerns": [
        "Fixed five-second sleep may prolong recovery when the pool is permanently exhausted."
      ],
      "opportunities": [
        "Expose retry/backoff parameters in configuration to tune for deployment environments."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Resets db_connection_errors streak on success; feeds abort logic when consecutive failures accumulate."
    },
    {
      "id": "function:action6_gather._fetch_page_matches",
      "type": "function",
      "name": "_fetch_page_matches",
      "path": "action6_gather.py",
      "summary": "Invokes get_matches for the current page and normalizes error handling/results.",
      "mechanism": "Validates session health, calls get_matches with DB session context, increments error counters on exceptions, and always returns a list to simplify upstream logic.",
      "quality": "monitor",
      "concerns": [
        "Returns empty list for hard failures, requiring callers to infer failure from state counters."
      ],
      "opportunities": [
        "Adopt Result/Either pattern to distinguish between true empty pages and fetch errors."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Ensures DB session is returned to pool in finally block even when exceptions occur."
    },
    {
      "id": "function:action6_gather._try_fast_skip_page",
      "type": "function",
      "name": "_try_fast_skip_page",
      "path": "action6_gather.py",
      "summary": "Detects when all matches on a page are unchanged and logs a fast-skip summary.",
      "mechanism": "Retrieves a short-lived DB session, leverages _lookup_existing_persons and _identify_fetch_candidates to compare UUIDs, and logs when all matches can be skipped.",
      "quality": "monitor",
      "concerns": [
        "Acquires an additional DB session for each page; could increase pool pressure during long runs.",
        "State mutation (total_skipped, total_pages_processed) bypasses normal completion logging path."
      ],
      "opportunities": [
        "Reuse the page-level session already fetched for batching to avoid duplicate lookups.",
        "Return a structured result so _process_single_page can centralize logging and counters."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Short-circuits batch processing when list-view data confirms no updates required."
    },
    {
      "id": "function:action6_gather._lookup_existing_persons",
      "type": "function",
      "name": "_lookup_existing_persons",
      "path": "action6_gather.py",
      "summary": "Queries the ORM for existing Person records matching page UUIDs with eager DNA/tree relationships.",
      "mechanism": "Normalizes UUID case, performs SQLAlchemy query with joinedload, and maps valid results to uppercase keys while logging diagnostics.",
      "quality": "monitor",
      "concerns": [
        "Raises ValueError when enum mismatches occur, which bubbles up as generic errors without dedicated handling."
      ],
      "opportunities": [
        "Handle enum mismatch with explicit remediation guidance (e.g., migration script reference)."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Called by both fast-skip path and main batching workflow to reuse cached DB state."
    },
    {
      "id": "function:action6_gather._identify_fetch_candidates",
      "type": "function",
      "name": "_identify_fetch_candidates",
      "path": "action6_gather.py",
      "summary": "Compares list-view matches against DB records to decide which UUIDs need detailed API refresh.",
      "mechanism": "Iterates matches, flags missing/new UUIDs, applies heuristics via _check_if_fetch_needed, and records skip counts and ethnicity refresh flags.",
      "quality": "stable",
      "concerns": [
        "Logs a warning for every missing UUID; noisy data feeds may flood logs during outages."
      ],
      "opportunities": [
        "Aggregate missing UUID warnings and surface a summarized alert at page end."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Downstream batching relies on the fetch list and metadata flags this helper produces."
    },
    {
      "id": "function:action6_gather._do_batch",
      "type": "function",
      "name": "_do_batch",
      "path": "action6_gather.py",
      "summary": "Coordinates adaptive batching for a page, including database session reuse and performance recording.",
      "mechanism": "Determines optimized batch size, optionally reuses a single DB session across batches, delegates to _process_page_matches/_process_batches_for_page, and logs throughput metrics.",
      "quality": "needs-review",
      "concerns": [
        "Function mixes batch orchestration, performance tracking, and error handling in 80+ lines, making future changes risky.",
        "Relies on global mutable structures (_RECENT_BATCH_DURATIONS) without thread-safety guarantees."
      ],
      "opportunities": [
        "Split orchestration vs. metrics recording into separate helpers to simplify testing.",
        "Encapsulate batch history in a lightweight object stored on SessionManager for clarity."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Key driver of throughput; adjustments here directly impact run duration."
    },
    {
      "id": "function:action6_gather._process_batches_for_page",
      "type": "function",
      "name": "_process_batches_for_page",
      "path": "action6_gather.py",
      "summary": "Splits a page of matches into batches, executes each batch, and aggregates metrics.",
      "mechanism": "Iterates over slices of match data, calling _execute_single_batch and merging PageProcessingMetrics while tracking total duration and batch counts.",
      "quality": "monitor",
      "concerns": [
        "Per-batch logging may become verbose on large pages; consider DEBUG gating."
      ],
      "opportunities": [
        "Record per-batch failures distinctly to analyze error distribution across large pages."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Ensures aggregate metrics track total matches processed and observed latency."
    },
    {
      "id": "function:action6_gather._execute_single_batch",
      "type": "function",
      "name": "_execute_single_batch",
      "path": "action6_gather.py",
      "summary": "Runs one batch of matches, measuring duration and logging throughput.",
      "mechanism": "Delegates to _process_page_matches for actual work, updates timing metrics, and logs batch summary including rate per second.",
      "quality": "monitor",
      "concerns": [
        "Throughput calculation divides by duration without guard against extremely small times, though upstream ensures batching."
      ],
      "opportunities": [
        "Capture per-batch error counts in telemetry for later analysis."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Bridge between batch orchestration and per-match processing."
    },
    {
      "id": "function:action6_gather._process_page_matches",
      "type": "function",
      "name": "_process_page_matches",
      "path": "action6_gather.py",
      "summary": "Core processing pipeline performing DB lookups, API prefetches, data prep, and commits for a batch/page.",
      "mechanism": "Initializes state, acquires session (reused or new), sequences _process_batch_lookups, _perform_batch_api_prefetches, and _prepare_and_commit_batch_data, while collecting detailed timing metrics.",
      "quality": "needs-review",
      "concerns": [
        "Large try/except nesting obscures failure modes; many branches simply increment error counters without granular context.",
        "Relies on mutable dicts and magic keys for status tracking, hindering static verification."
      ],
      "opportunities": [
        "Refactor into smaller steps returning typed result objects per phase.",
        "Emit structured telemetry events for DB/API phases to aid regression analysis."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Primary hotspot for performance tuning and correctness; interacts with numerous helpers."
    },
    {
      "id": "function:action6_gather._process_batch_lookups",
      "type": "function",
      "name": "_process_batch_lookups",
      "path": "action6_gather.py",
      "summary": "Prepares batch context by loading existing persons and determining fetch candidates.",
      "mechanism": "Uses _lookup_existing_persons to hydrate ORM objects, then calls _identify_fetch_candidates to split matches into skip vs fetch groups, updating status counters.",
      "quality": "stable",
      "concerns": [
        "Assumes UUID casing consistency; unexpected lowercase data may reduce cache hits."
      ],
      "opportunities": [
        "Normalize UUIDs before logging to simplify comparison across branches."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Feeds both API prefetch and DB preparation stages with curated input lists."
    },
    {
      "id": "function:action6_gather._perform_batch_api_prefetches",
      "type": "function",
      "name": "_perform_batch_api_prefetches",
      "path": "action6_gather.py",
      "summary": "Executes sequential API prefetches for candidate matches and returns payload plus timing telemetry.",
      "mechanism": "When fetch candidates exist, calls _perform_api_prefetches to gather detail data and yields aggregated timings and call counts for logging.",
      "quality": "monitor",
      "concerns": [
        "When no candidates exist, returns empty dict but callers still expect tuple; defensive coding relies on truthiness checks."
      ],
      "opportunities": [
        "Return a dataclass capturing payload and metrics to avoid unpack ambiguity."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Maintains sequential API pattern to respect rate limiting constraints."
    },
    {
      "id": "function:action6_gather._perform_api_prefetches",
      "type": "function",
      "name": "_perform_api_prefetches",
      "path": "action6_gather.py",
      "summary": "Shared helper performing sequential API calls to enrich matches with detailed ancestry data.",
      "mechanism": "Iterates candidate UUIDs, enforces rate limiter waits via SessionManager API manager, caches responses, and records per-endpoint timing telemetry.",
      "quality": "monitor",
      "concerns": [
        "Per-call exception handling is broad and may mask individual endpoint issues with generic warnings."
      ],
      "opportunities": [
        "Return structured telemetry that distinguishes cache hits from live API calls for performance tuning."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used by both batch and single-match enrichment paths; respects sequential processing mandate."
    },
    {
      "id": "function:action6_gather._prepare_and_commit_batch_data",
      "type": "function",
      "name": "_prepare_and_commit_batch_data",
      "path": "action6_gather.py",
      "summary": "Transforms prefetched match data into bulk DB operations and executes commits within transaction guard.",
      "mechanism": "Invokes _prepare_bulk_db_data to build payloads, updates page status counters, and calls _execute_batch_db_commit to perform SQLAlchemy transaction with error handling.",
      "quality": "monitor",
      "concerns": [
        "Error handling collapses new/updated counts to zero on failure, making it hard to discern partial successes."
      ],
      "opportunities": [
        "Return detailed failure metadata so upstream can log actionable remediation steps."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Final stage before logging; ensures DB state reflects prefetched match data."
    },
    {
      "id": "function:action6_gather._execute_batch_db_commit",
      "type": "function",
      "name": "_execute_batch_db_commit",
      "path": "action6_gather.py",
      "summary": "Wraps bulk database operations in a transaction and adjusts per-page counters on failure.",
      "mechanism": "Uses db_transn context manager to call _execute_bulk_db_operations, catches IntegrityError/SQLAlchemyError/Exception, and mutates page_statuses when bulk execution fails.",
      "quality": "monitor",
      "concerns": [
        "Catches broad Exception and converts all failures to counter adjustments, hiding root cause details upstream."
      ],
      "opportunities": [
        "Propagate structured error info so calling code can differentiate IntegrityError vs unexpected exceptions."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Called exclusively from _prepare_and_commit_batch_data after data preparation succeeds."
    },
    {
      "id": "function:action6_gather._execute_bulk_db_operations",
      "type": "function",
      "name": "_execute_bulk_db_operations",
      "path": "action6_gather.py",
      "summary": "Coordinates Person, DnaMatch, and FamilyTree bulk inserts/updates within an open transaction.",
      "mechanism": "Separates prepared payloads, runs _process_person_creates/_updates, builds master ID map, and triggers DNA/FamilyTree handlers while capturing IntegrityError scenarios for recovery.",
      "quality": "monitor",
      "concerns": [
        "Mixes control flow and logging with integrity recovery logic, making it difficult to reason about failure outcomes."
      ],
      "opportunities": [
        "Extract strategy object for each table to isolate responsibilities and improve testability."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Returns True/False to signal transaction success to _execute_batch_db_commit."
    },
    {
      "id": "class:action6_gather._PrefetchStats",
      "type": "class",
      "name": "_PrefetchStats",
      "path": "action6_gather.py",
      "summary": "Lightweight dataclass tracking counters during sequential API prefetch runs.",
      "mechanism": "Stores failure counts, ethnicity fetch statistics, and next progress threshold so helper functions can mutate shared state without global variables.",
      "quality": "stable",
      "concerns": [
        "Mutable fields are written from multiple helpers, making ordering assumptions implicit."
      ],
      "opportunities": [
        "Expose explicit increment helpers to prevent accidental direct mutation."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Embedded within _PrefetchPlan and passed across helper functions."
    },
    {
      "id": "class:action6_gather._PrefetchPlan",
      "type": "class",
      "name": "_PrefetchPlan",
      "path": "action6_gather.py",
      "summary": "Immutable container describing badge, relationship, and ethnicity targets for a prefetch pass.",
      "mechanism": "Bundles stats tracker, candidate UUID sets, count metadata, and tree context so downstream helpers receive a consistent view of the plan.",
      "quality": "stable",
      "concerns": [
        "Plan mutability relies on consumers not reassigning set attributes in place."
      ],
      "opportunities": [
        "Replace bare sets with frozenset to guarantee immutability once constructed."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Constructed once per _perform_api_prefetches call via _prepare_prefetch_plan."
    },
    {
      "id": "class:action6_gather._EthnicityScreeningStats",
      "type": "class",
      "name": "_EthnicityScreeningStats",
      "path": "action6_gather.py",
      "summary": "Accumulates skip reasons while evaluating matches for ethnicity enrichment.",
      "mechanism": "Counts matches already refreshed and those filtered by cM threshold so logging can report why candidates were excluded.",
      "quality": "stable",
      "concerns": [
        "Only used for logging; callers must remember to check counts for actionable insights."
      ],
      "opportunities": [
        "Return structured skip metrics alongside candidate set for easier analytics."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Instantiated inside _determine_ethnicity_candidates."
    },
    {
      "id": "function:action6_gather._prepare_prefetch_plan",
      "type": "function",
      "name": "_prepare_prefetch_plan",
      "path": "action6_gather.py",
      "summary": "Builds the execution blueprint for sequential API prefetching.",
      "mechanism": "Derives badge candidates, classifies match priority tiers, trims medium-priority relationship requests, and compiles ethnicity targets before returning a _PrefetchPlan.",
      "quality": "monitor",
      "concerns": [
        "Relies on several helper functions that mutate shared logging state, which complicates reasoning about priority outcomes."
      ],
      "opportunities": [
        "Return diagnostic metadata (e.g., trimmed medium count) directly to the caller to reduce reliance on logs."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Executed once per _perform_api_prefetches invocation to scope downstream work."
    },
    {
      "id": "function:action6_gather._classify_match_priorities",
      "type": "function",
      "name": "_classify_match_priorities",
      "path": "action6_gather.py",
      "summary": "Assigns fetch candidates to high/medium priority buckets based on cM, tree presence, and starring.",
      "mechanism": "Iterates matches, applies _determine_match_priority, logs representative examples via _log_priority_decision, and returns UUID sets for each tier.",
      "quality": "monitor",
      "concerns": [
        "Depends on mutable log_state dict to throttle logging, introducing incidental complexity."
      ],
      "opportunities": [
        "Refactor logging suppression into a reusable helper shared across priority routines."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Feeds both relationship probability and ethnicity planning."
    },
    {
      "id": "function:action6_gather._limit_relationship_probability_requests",
      "type": "function",
      "name": "_limit_relationship_probability_requests",
      "path": "action6_gather.py",
      "summary": "Caps relationship probability fetches to stay within configured per-page limits.",
      "mechanism": "Preserves all high-priority UUIDs, ranks medium-priority matches via _relationship_priority_sort_key, and trims overflow while reporting how many were excluded.",
      "quality": "stable",
      "concerns": [
        "Sorting medium-priority matches requires materializing dictionaries for each page, which adds overhead on large pages."
      ],
      "opportunities": [
        "Cache computed sort keys when iterating repeatedly over the same match list."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Returns the adjusted priority sets consumed by _prepare_prefetch_plan."
    },
    {
      "id": "function:action6_gather._determine_ethnicity_candidates",
      "type": "function",
      "name": "_determine_ethnicity_candidates",
      "path": "action6_gather.py",
      "summary": "Filters priority matches down to those needing ethnicity enrichment.",
      "mechanism": "Evaluates UUIDs against priority set, checks refresh flags, enforces cM thresholds, and records skip reasons through _EthnicityScreeningStats.",
      "quality": "monitor",
      "concerns": [
        "Relies on mutable stats helpers and multiple guard clauses, which can be difficult to unit test exhaustively."
      ],
      "opportunities": [
        "Return both candidates and detailed skip categories to better inform downstream metrics."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Called during _prepare_prefetch_plan to finalize ethnicity candidates."
    },
    {
      "id": "function:action6_gather._match_requires_ethnicity_refresh",
      "type": "function",
      "name": "_match_requires_ethnicity_refresh",
      "path": "action6_gather.py",
      "summary": "Decides whether a match explicitly flags that ethnicity data needs refresh.",
      "mechanism": "Reads the _needs_ethnicity_refresh marker and increments stats when matches are already current.",
      "quality": "stable",
      "concerns": [
        "Assumes the flag is attached to every match; missing keys silently default to True."
      ],
      "opportunities": [
        "Document flag semantics in config to ensure upstream producers set consistent values."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Utility for _determine_ethnicity_candidates."
    },
    {
      "id": "function:action6_gather._is_below_ethnicity_threshold",
      "type": "function",
      "name": "_is_below_ethnicity_threshold",
      "path": "action6_gather.py",
      "summary": "Checks whether a match's cM falls below the configured enrichment threshold.",
      "mechanism": "Converts match cm_dna to int via _safe_cm_value and updates stats when candidates are filtered out.",
      "quality": "stable",
      "concerns": [
        "Threshold logic depends on global ETHNICITY_ENRICHMENT_MIN_CM; tests must seed configuration carefully."
      ],
      "opportunities": [
        "Inject threshold value as parameter to ease unit testing and experimentation."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Supports _determine_ethnicity_candidates decision flow."
    },
    {
      "id": "function:action6_gather._log_ethnicity_skip_counts",
      "type": "function",
      "name": "_log_ethnicity_skip_counts",
      "path": "action6_gather.py",
      "summary": "Emits debug summaries describing why ethnicity matches were skipped.",
      "mechanism": "Examines _EthnicityScreeningStats tallies and logs skip categories alongside threshold value.",
      "quality": "stable",
      "concerns": [
        "Only logs at DEBUG level, so production observability is limited unless log level is raised."
      ],
      "opportunities": [
        "Surface aggregated metrics through telemetry to monitor enrichment coverage."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Invoked at the end of _determine_ethnicity_candidates."
    },
    {
      "id": "function:action6_gather._prefetch_combined_details",
      "type": "function",
      "name": "_prefetch_combined_details",
      "path": "action6_gather.py",
      "summary": "Retrieves combined match details and records duration counters.",
      "mechanism": "Calls _handle_combined_details_fetch, updates endpoint timing maps, and increments call counts per UUID.",
      "quality": "monitor",
      "concerns": [
        "Failure handling increments critical failure counters but does not differentiate transient vs persistent errors."
      ],
      "opportunities": [
        "Tag failures with exception types for downstream alerting."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Run for every fetch candidate within _perform_api_prefetches."
    },
    {
      "id": "function:action6_gather._prefetch_relationship_probability",
      "type": "function",
      "name": "_prefetch_relationship_probability",
      "path": "action6_gather.py",
      "summary": "Fetches relationship probability data for high-priority matches.",
      "mechanism": "Checks candidate priority membership, issues _fetch_optional_relationship_data, and updates endpoint telemetry maps.",
      "quality": "monitor",
      "concerns": [
        "Call count increments even when fetch is skipped, which can skew metrics if not carefully interpreted."
      ],
      "opportunities": [
        "Guard counter increments to only occur when requests are attempted."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Part of the sequential loop inside _perform_api_prefetches."
    },
    {
      "id": "function:action6_gather._prefetch_badge_metadata",
      "type": "function",
      "name": "_prefetch_badge_metadata",
      "path": "action6_gather.py",
      "summary": "Prefetches badge metadata for matches appearing in the user's tree.",
      "mechanism": "Verifies UUID against badge candidate set, calls _fetch_optional_badge_data, and accumulates timing and count telemetry.",
      "quality": "monitor",
      "concerns": [
        "Temp badge dictionary uses optional values; downstream consumers must handle None consistently."
      ],
      "opportunities": [
        "Normalize badge payload structure before returning to simplify later processing."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Feeds ladder enrichment once the loop completes."
    },
    {
      "id": "function:action6_gather._prefetch_ethnicity_data",
      "type": "function",
      "name": "_prefetch_ethnicity_data",
      "path": "action6_gather.py",
      "summary": "Conditionally fetches ethnicity enrichment data for priority matches.",
      "mechanism": "Short-circuits when enrichment disabled, otherwise delegates to _process_ethnicity_candidate while tracking stats and telemetry.",
      "quality": "monitor",
      "concerns": [
        "Stats increments rely on multiple early returns, so refactors must keep counters aligned."
      ],
      "opportunities": [
        "Return a structured outcome enum to make caller logic clearer."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Runs inside the sequential API fetch loop."
    },
    {
      "id": "function:action6_gather._log_prefetch_progress",
      "type": "function",
      "name": "_log_prefetch_progress",
      "path": "action6_gather.py",
      "summary": "Throttles progress logging for long prefetch loops.",
      "mechanism": "Calculates completion percentage, compares against PREFETCH_PROGRESS_THRESHOLDS, and emits info logs when thresholds are crossed.",
      "quality": "stable",
      "concerns": [
        "Maintains state via _PrefetchStats index; callers must pass the same stats object every iteration."
      ],
      "opportunities": [
        "Abstract threshold handling into reusable progress tracker shared with other long-running loops."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used by _perform_api_prefetches after each candidate is processed."
    },
    {
      "id": "function:action6_gather._identify_badge_candidates",
      "type": "function",
      "name": "_identify_badge_candidates",
      "path": "action6_gather.py",
      "summary": "Collects UUIDs eligible for badge and ladder enrichment calls.",
      "mechanism": "Filters matches for those marked in_my_tree and intersecting the fetch candidate set, returning a set for later use.",
      "quality": "stable",
      "concerns": [
        "Requires matches_to_process_later entries to include in_my_tree flags; missing data silently excludes candidates."
      ],
      "opportunities": [
        "Consider returning diagnostic counts of excluded tree members for observability."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "First step in building the _PrefetchPlan."
    },
    {
      "id": "function:action6_gather._enforce_session_health_for_prefetch",
      "type": "function",
      "name": "_enforce_session_health_for_prefetch",
      "path": "action6_gather.py",
      "summary": "Guards sequential API calls by aborting when session health checks fail.",
      "mechanism": "Every ten candidates, invokes SessionManager.check_session_health and raises MaxApiFailuresExceededError when the session is no longer valid.",
      "quality": "monitor",
      "concerns": [
        "Fixed interval of ten candidates may delay detection during rapid failures."
      ],
      "opportunities": [
        "Make the polling interval configurable or adaptive based on elapsed time."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Called within _perform_api_prefetches loop before each fetch."
    },
    {
      "id": "function:action6_gather._raise_prefetch_threshold_if_needed",
      "type": "function",
      "name": "_raise_prefetch_threshold_if_needed",
      "path": "action6_gather.py",
      "summary": "Escalates errors when the critical API failure threshold is reached.",
      "mechanism": "Checks stats.critical_failures against CRITICAL_API_FAILURE_THRESHOLD and raises MaxApiFailuresExceededError, optionally chaining the triggering exception.",
      "quality": "stable",
      "concerns": [
        "Uses a module-level constant; tuning requires code change instead of configuration."
      ],
      "opportunities": [
        "Expose threshold via configuration to align with rate-limit policy updates."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Invoked by combined details handler and other prefetch helpers when incrementing critical failures."
    },
    {
      "id": "function:action6_gather._handle_combined_details_fetch",
      "type": "function",
      "name": "_handle_combined_details_fetch",
      "path": "action6_gather.py",
      "summary": "Wraps combined details retrieval with error handling and critical failure tracking.",
      "mechanism": "Calls _fetch_combined_details, stores results, logs warnings for None payloads, and raises when failure counts breach thresholds.",
      "quality": "monitor",
      "concerns": [
        "Broad exception handler collapses all errors into generic log messages, reducing triage specificity."
      ],
      "opportunities": [
        "Capture exception types in stats to enable targeted remediation."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Only invoked through _prefetch_combined_details."
    },
    {
      "id": "function:action6_gather._fetch_optional_relationship_data",
      "type": "function",
      "name": "_fetch_optional_relationship_data",
      "path": "action6_gather.py",
      "summary": "Fetches relationship probability details when a UUID is prioritized.",
      "mechanism": "Confirms UUID priority, calls _fetch_batch_relationship_prob with dynamic label limits, and stores results or None on failure.",
      "quality": "stable",
      "concerns": [
        "Exceptions are logged but swallowed, requiring upstream counters to detect degraded accuracy."
      ],
      "opportunities": [
        "Return a structured outcome so telemetry can differentiate success vs fallback."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used by _prefetch_relationship_probability."
    },
    {
      "id": "function:action6_gather._fetch_optional_badge_data",
      "type": "function",
      "name": "_fetch_optional_badge_data",
      "path": "action6_gather.py",
      "summary": "Loads badge metadata for UUIDs associated with the user's tree.",
      "mechanism": "Checks membership within badge_candidates, invokes _fetch_batch_badge_details, and logs errors without raising.",
      "quality": "stable",
      "concerns": [
        "Silent None assignments make it hard to distinguish between missing data and fetch errors downstream."
      ],
      "opportunities": [
        "Return a tuple containing outcome status to aid metrics aggregation."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Called only via _prefetch_badge_metadata."
    },
    {
      "id": "function:action6_gather._process_ethnicity_candidate",
      "type": "function",
      "name": "_process_ethnicity_candidate",
      "path": "action6_gather.py",
      "summary": "Issues ethnicity API requests for approved candidates and updates stats.",
      "mechanism": "Confirms UUID remains in candidate set, calls _fetch_ethnicity_for_batch, increments success/skip counters, and falls back to None on error.",
      "quality": "monitor",
      "concerns": [
        "Errors are logged without surfacing exception context to upstream decision makers."
      ],
      "opportunities": [
        "Return error metadata so the caller can aggregate failure reasons per endpoint."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Invoked from _prefetch_ethnicity_data."
    },
    {
      "id": "function:action6_gather._build_cfpid_mapping",
      "type": "function",
      "name": "_build_cfpid_mapping",
      "path": "action6_gather.py",
      "summary": "Creates reverse lookup structures from badge CFPIDs back to UUIDs.",
      "mechanism": "Iterates badge results, extracts CFPID values, and returns a list plus map for downstream ladder enrichment.",
      "quality": "stable",
      "concerns": [
        "Ignores duplicate CFPIDs silently; later enrichment may overwrite earlier UUID mappings."
      ],
      "opportunities": [
        "Detect and log duplicates to surface potential data quality issues."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used exclusively by _fetch_ladder_details_for_badges."
    },
    {
      "id": "function:action6_gather._fetch_ladder_details_for_badges",
      "type": "function",
      "name": "_fetch_ladder_details_for_badges",
      "path": "action6_gather.py",
      "summary": "Enriches badge results with ladder data when tree context is available.",
      "mechanism": "Builds CFPID map, iterates ladder requests via _fetch_batch_ladder, merges responses into badge data, and tracks call counts.",
      "quality": "monitor",
      "concerns": [
        "Per-CFPID try/except swallows all errors, so persistent ladder failures only appear in logs."
      ],
      "opportunities": [
        "Aggregate ladder failure stats and bubble them up to _perform_api_prefetches telemetry."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Completes after the main fetch loop to avoid interleaving ladder requests."
    },
    {
      "id": "function:action6_gather._log_prefetch_summary",
      "type": "function",
      "name": "_log_prefetch_summary",
      "path": "action6_gather.py",
      "summary": "Logs aggregate timing and ethnicity outcomes after the prefetch loop finishes.",
      "mechanism": "Records overall duration, checks whether ethnicity enrichment was enabled, and emits fetch vs skip counts when available.",
      "quality": "stable",
      "concerns": [
        "Primarily debug-level logging; lacks integration with telemetry store for long-term tracking."
      ],
      "opportunities": [
        "Send summary metrics to prompt telemetry for cross-run comparisons."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Called from _perform_api_prefetches once ladder enrichment completes."
    },
    {
      "id": "function:action6_gather._get_prefetched_data_for_match",
      "type": "function",
      "name": "_get_prefetched_data_for_match",
      "path": "action6_gather.py",
      "summary": "Retrieves prefetched combined, tree, relationship, and ethnicity payloads for a UUID.",
      "mechanism": "Reads the four prefetched buckets built by _perform_api_prefetches and returns a tuple so downstream match processing has consistent inputs.",
      "quality": "stable",
      "concerns": [
        "Depends on specific dictionary keys; missing buckets return None silently."
      ],
      "opportunities": [
        "Return a small dataclass to improve readability and type-checking downstream."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used inside _process_single_match_for_bulk prior to calling _do_match."
    },
    {
      "id": "function:action6_gather._process_single_match_for_bulk",
      "type": "function",
      "name": "_process_single_match_for_bulk",
      "path": "action6_gather.py",
      "summary": "Prepares individual match data using prefetched payloads and delegates to _do_match.",
      "mechanism": "Validates UUID, enriches match dict with relationship/ethnicity info, checks session health, then calls _do_match to construct bulk payloads and status codes.",
      "quality": "monitor",
      "concerns": [
        "Mutates match_list_data in place, which can leak state between retries."
      ],
      "opportunities": [
        "Clone or normalize match dict before mutation to avoid side effects."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Core worker invoked for every candidate within _prepare_bulk_db_data."
    },
    {
      "id": "function:action6_gather._do_match",
      "type": "function",
      "name": "_do_match",
      "path": "action6_gather.py",
      "summary": "Evaluates a single DNA match to determine create/update operations for Person, DnaMatch, and FamilyTree tables.",
      "mechanism": "Combines prefetched details with existing Person data, decides operation type, builds structured payload dict, and returns status plus optional error message.",
      "quality": "monitor",
      "concerns": [
        "Large function with many inline heuristics; difficult to unit test due to tight coupling with global config and logging."
      ],
      "opportunities": [
        "Extract domain-specific decision helpers (e.g., tree updates, DNA thresholds) to shrink cyclomatic complexity."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Consumes prefetched combined/tree payloads and is the definitive source of per-match operation decisions."
    },
    {
      "id": "function:action6_gather._update_page_statuses",
      "type": "function",
      "name": "_update_page_statuses",
      "path": "action6_gather.py",
      "summary": "Increments per-page counters based on match processing status.",
      "mechanism": "Adjusts totals for new, updated, skipped, and error buckets while emitting debug logs for unexpected values.",
      "quality": "stable",
      "concerns": [
        "Treats unknown statuses as errors, which may mask new enum variants without warning."
      ],
      "opportunities": [
        "Switch to Enum-based status handling to ensure exhaustive coverage."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Utility consumed by _handle_match_processing_result during bulk prep."
    },
    {
      "id": "function:action6_gather._handle_match_processing_result",
      "type": "function",
      "name": "_handle_match_processing_result",
      "path": "action6_gather.py",
      "summary": "Routes match preparation outcomes into page counters and bulk payload lists.",
      "mechanism": "Calls _update_page_statuses and appends prepared data when status indicates new or updated records, logging errors for failure cases.",
      "quality": "stable",
      "concerns": [
        "Skips reuse of prepared payloads on retries, so idempotency relies on outer logic."
      ],
      "opportunities": [
        "Return structured results to allow richer telemetry on error reasons."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Called for each candidate inside _prepare_bulk_db_data."
    },
    {
      "id": "function:action6_gather._prepare_bulk_db_data",
      "type": "function",
      "name": "_prepare_bulk_db_data",
      "path": "action6_gather.py",
      "summary": "Transforms match candidates plus prefetched payloads into bulk-ready dictionaries and status counts.",
      "mechanism": "Iterates candidates, invokes _process_single_match_for_bulk, updates page counters through _handle_match_processing_result, and returns prepared data alongside status metrics.",
      "quality": "needs-review",
      "concerns": [
        "Large try/except block swallows detailed failure causes, exposing only generic error increments."
      ],
      "opportunities": [
        "Collect structured error telemetry (UUID, stage, exception) to improve observability."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Entry point for data prep before _execute_batch_db_commit."
    },
    {
      "id": "function:action6_gather._deduplicate_person_creates",
      "type": "function",
      "name": "_deduplicate_person_creates",
      "path": "action6_gather.py",
      "summary": "Filters duplicate Person create operations within a batch based on profile ID.",
      "mechanism": "Tracks seen profile IDs, logs skips, allows null IDs, and returns the reduced list for downstream preparation.",
      "quality": "stable",
      "concerns": [
        "Relies on profile_id uniqueness; duplicates across batches still possible."
      ],
      "opportunities": [
        "Surface skip counts to telemetry for better monitoring of duplicate inputs."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Invoked by _process_person_creates prior to bulk insert."
    },
    {
      "id": "function:action6_gather._check_existing_profile_ids",
      "type": "function",
      "name": "_check_existing_profile_ids",
      "path": "action6_gather.py",
      "summary": "Queries the database for Person profile IDs already present to prevent duplicate inserts.",
      "mechanism": "Runs a filtered SQLAlchemy query against non-deleted records and returns the set of matching profile IDs.",
      "quality": "stable",
      "concerns": [
        "Swallows exceptions with warnings, potentially leaving duplicates undetected."
      ],
      "opportunities": [
        "Bubble up errors to allow retry logic or fallback strategies."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used by _check_existing_records during insert preparation."
    },
    {
      "id": "function:action6_gather._check_existing_uuids",
      "type": "function",
      "name": "_check_existing_uuids",
      "path": "action6_gather.py",
      "summary": "Detects existing Person UUIDs in the database to avoid insert conflicts.",
      "mechanism": "Uppercases UUIDs, queries the Person table for non-deleted rows, and returns the found UUID set.",
      "quality": "stable",
      "concerns": [
        "Logs warnings but continues on query failure, risking constraint violations later."
      ],
      "opportunities": [
        "Introduce retry/backoff or escalate errors for operational awareness."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Paired with _check_existing_profile_ids in _check_existing_records."
    },
    {
      "id": "function:action6_gather._check_existing_records",
      "type": "function",
      "name": "_check_existing_records",
      "path": "action6_gather.py",
      "summary": "Aggregates checks for existing profile IDs and UUIDs before bulk Person inserts.",
      "mechanism": "Builds lookup sets from raw insert data and delegates to _check_existing_profile_ids and _check_existing_uuids, returning both sets.",
      "quality": "stable",
      "concerns": [
        "Duplicates conversion logic already performed elsewhere; any divergence risks mismatched casing."
      ],
      "opportunities": [
        "Centralize UUID/profile normalization to a shared helper."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Supports _prepare_person_insert_data."
    },
    {
      "id": "function:action6_gather._handle_integrity_error_recovery",
      "type": "function",
      "name": "_handle_integrity_error_recovery",
      "path": "action6_gather.py",
      "summary": "Attempts to recover from UNIQUE constraint violations during person inserts by falling back to individual inserts.",
      "mechanism": "Rolls back the session, iterates records one-by-one with flush attempts, skips duplicates, and logs successes vs failures.",
      "quality": "monitor",
      "concerns": [
        "Large try/except suppresses granular error reporting; production diagnosis is difficult."
      ],
      "opportunities": [
        "Collect metrics on how often recovery triggers and which fields conflict."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used by _execute_bulk_db_operations when people.uuid uniqueness trips."
    },
    {
      "id": "function:action6_gather._should_skip_person_insert",
      "type": "function",
      "name": "_should_skip_person_insert",
      "path": "action6_gather.py",
      "summary": "Determines whether a Person create operation should be skipped to avoid duplicates.",
      "mechanism": "Checks batch-level seen UUIDs, existing maps, and database presence, returning a skip flag with optional reason.",
      "quality": "stable",
      "concerns": [
        "Relies on caller to log reasons; silent skips may go unnoticed when reason None."
      ],
      "opportunities": [
        "Return structured result capturing skip reason codes for telemetry."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Invoked within _prepare_person_insert_data."
    },
    {
      "id": "function:action6_gather._convert_status_enums",
      "type": "function",
      "name": "_convert_status_enums",
      "path": "action6_gather.py",
      "summary": "Normalizes Person status enum values before SQLAlchemy bulk operations.",
      "mechanism": "Iterates insert dictionaries and replaces Enum instances with their value attribute when present.",
      "quality": "stable",
      "concerns": [
        "Only handles items with direct 'status' key; nested enums are ignored."
      ],
      "opportunities": [
        "Generalize to handle other enum fields that may be added later."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Final normalization step in _prepare_person_insert_data."
    },
    {
      "id": "function:action6_gather._prepare_person_insert_data",
      "type": "function",
      "name": "_prepare_person_insert_data",
      "path": "action6_gather.py",
      "summary": "Validates and normalizes Person create payloads prior to bulk insert.",
      "mechanism": "Strips private keys, calls _check_existing_records, filters duplicates via _should_skip_person_insert, uppercases UUIDs, and converts enums before returning the dataset.",
      "quality": "monitor",
      "concerns": [
        "Mixed responsibilities (filtering, logging, normalization) make the function lengthy and harder to test."
      ],
      "opportunities": [
        "Break into smaller helpers for readability and unit coverage."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Supports _process_person_creates bulk workflow."
    },
    {
      "id": "function:action6_gather._is_person_create",
      "type": "function",
      "name": "_is_person_create",
      "path": "action6_gather.py",
      "summary": "Identifies whether a prepared bulk dictionary represents a Person create operation.",
      "mechanism": "Checks for a person payload and _operation flag set to 'create'.",
      "quality": "stable",
      "concerns": [
        "Assumes _operation flag is always present; missing flags default to False."
      ],
      "opportunities": [
        "Validate _operation value before returning to catch typos early."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used by _separate_bulk_operations."
    },
    {
      "id": "function:action6_gather._is_person_update",
      "type": "function",
      "name": "_is_person_update",
      "path": "action6_gather.py",
      "summary": "Identifies whether a prepared bulk dictionary represents a Person update operation.",
      "mechanism": "Checks for person payload with _operation set to 'update'.",
      "quality": "stable",
      "concerns": [
        "Does not validate presence of required identifiers, leaving that burden to later steps."
      ],
      "opportunities": [
        "Ensure UUID/existing ID presence before treating as update."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used by _separate_bulk_operations."
    },
    {
      "id": "function:action6_gather._separate_bulk_operations",
      "type": "function",
      "name": "_separate_bulk_operations",
      "path": "action6_gather.py",
      "summary": "Splits prepared bulk payloads into person creates, person updates, DNA operations, and family tree operations.",
      "mechanism": "Uses _is_person_create/_is_person_update checks and collects table-specific payloads into four lists for subsequent processing.",
      "quality": "stable",
      "concerns": [
        "Assumes every dict contains expected keys; missing entries may trigger KeyError earlier in pipeline."
      ],
      "opportunities": [
        "Validate payload structure and raise descriptive errors when required fields are absent."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "First step inside _execute_bulk_db_operations."
    },
    {
      "id": "function:action6_gather._validate_no_duplicate_profile_ids",
      "type": "function",
      "name": "_validate_no_duplicate_profile_ids",
      "path": "action6_gather.py",
      "summary": "Ensures Person insert payloads do not contain duplicate non-null profile IDs.",
      "mechanism": "Uses Counter to detect duplicates, logs offending IDs, and raises IntegrityError when duplicates are present.",
      "quality": "stable",
      "concerns": [
        "Raises IntegrityError with ValueError payload, which can be confusing for callers."
      ],
      "opportunities": [
        "Define a dedicated exception type to clarify validation failures."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Called within _process_person_creates before bulk insert."
    },
    {
      "id": "function:action6_gather._get_person_id_mapping",
      "type": "function",
      "name": "_get_person_id_mapping",
      "path": "action6_gather.py",
      "summary": "Builds a map of UUID to Person ID after bulk inserts to support related table operations.",
      "mechanism": "Flushes/commits the session, queries inserted UUIDs, attempts recovery queries for missing rows, and logs mismatches.",
      "quality": "monitor",
      "concerns": [
        "Commits within batch preparation, reducing transactional isolation and complicating rollback."
      ],
      "opportunities": [
        "Swap commit for flush plus SELECT .. WITH HOLD to avoid altering transaction scope."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used by _process_person_creates to feed ID mapping."
    },
    {
      "id": "function:action6_gather._process_person_creates",
      "type": "function",
      "name": "_process_person_creates",
      "path": "action6_gather.py",
      "summary": "Executes Person bulk insert pipeline and returns created ID mappings for related records.",
      "mechanism": "Deduplicates creates, prepares insert data, validates profile IDs, bulk inserts, flushes, and derives UUID->ID mapping for downstream tables.",
      "quality": "monitor",
      "concerns": [
        "Commits and flushes multiple times within transaction; error handling may leave session in inconsistent state."
      ],
      "opportunities": [
        "Refactor to rely on a single flush and postpone commits to outer transaction manager."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Called by _execute_bulk_db_operations after splitting payloads."
    },
    {
      "id": "function:action6_gather._build_person_update_dict",
      "type": "function",
      "name": "_build_person_update_dict",
      "path": "action6_gather.py",
      "summary": "Constructs sanitized mapping for Person update operations.",
      "mechanism": "Drops private keys, converts enum status, injects record id and updated_at timestamp before returning the update payload.",
      "quality": "stable",
      "concerns": [
        "Assumes timezone-aware datetime; callers must ensure consistent timezone usage."
      ],
      "opportunities": [
        "Parameterize timestamp generation for easier testing."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used by _process_person_updates when building bulk update mappings."
    },
    {
      "id": "function:action6_gather._process_person_updates",
      "type": "function",
      "name": "_process_person_updates",
      "path": "action6_gather.py",
      "summary": "Performs bulk update operations for Person records flagged as updates.",
      "mechanism": "Validates presence of existing IDs, builds update dicts via _build_person_update_dict, and calls bulk_update_mappings when payloads contain real changes.",
      "quality": "stable",
      "concerns": [
        "Drops updates lacking _existing_person_id without escalating; data drift may persist unnoticed."
      ],
      "opportunities": [
        "Aggregate missing ID occurrences and surface them via monitoring alerts."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Invoked from _execute_bulk_db_operations after person creates."
    },
    {
      "id": "function:action6_gather._add_update_ids_to_map",
      "type": "function",
      "name": "_add_update_ids_to_map",
      "path": "action6_gather.py",
      "summary": "Adds UUID->Person ID mappings from update payloads into the master ID map.",
      "mechanism": "Iterates person updates and inserts their existing IDs into the shared mapping dictionary.",
      "quality": "stable",
      "concerns": [
        "Relies on _existing_person_id being populated earlier; missing values are silently ignored."
      ],
      "opportunities": [
        "Return count of skipped entries to aid diagnostics."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used within _create_master_id_map."
    },
    {
      "id": "function:action6_gather._add_existing_ids_to_map",
      "type": "function",
      "name": "_add_existing_ids_to_map",
      "path": "action6_gather.py",
      "summary": "Ensures all known existing persons contribute IDs to the master map, even without new payloads.",
      "mechanism": "Adds IDs from prepared data and existing_persons_map to all_person_ids_map, logging totals added for transparency.",
      "quality": "stable",
      "concerns": [
        "Iterates entire existing_persons_map for each batch; could be heavy on large pages."
      ],
      "opportunities": [
        "Track whether additions already occurred to avoid redundant logging."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Called by _create_master_id_map."
    },
    {
      "id": "function:action6_gather._create_master_id_map",
      "type": "function",
      "name": "_create_master_id_map",
      "path": "action6_gather.py",
      "summary": "Combines newly created, updated, and pre-existing Person IDs into a unified lookup map.",
      "mechanism": "Copies created_person_map, augments it with update IDs and existing entries via helper functions, and logs resulting size.",
      "quality": "stable",
      "concerns": [
        "Assumes helper functions never fail; lack of error handling could hide missing IDs."
      ],
      "opportunities": [
        "Validate final map covers all UUIDs present in prepared data to prevent downstream lookups from failing silently."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Feeds both DNA and FamilyTree operations inside _execute_bulk_db_operations."
    },
    {
      "id": "function:action6_gather._resolve_person_id",
      "type": "function",
      "name": "_resolve_person_id",
      "path": "action6_gather.py",
      "summary": "Resolves or fetches Person IDs for DNA/FamilyTree operations using multiple strategies.",
      "mechanism": "Attempts lookup in the master map, fallbacks to existing_persons_map, and finally queries the database, caching successes for later reuse.",
      "quality": "monitor",
      "concerns": [
        "Database fallback query runs per UUID when not found; can become expensive without batching."
      ],
      "opportunities": [
        "Cache miss counters and add metrics to highlight frequent DB fallbacks."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Shared helper for DNA and FamilyTree processing."
    },
    {
      "id": "function:action6_gather._get_existing_dna_matches",
      "type": "function",
      "name": "_get_existing_dna_matches",
      "path": "action6_gather.py",
      "summary": "Fetches existing DnaMatch IDs for the people in the current batch.",
      "mechanism": "Queries DnaMatch table for people IDs in the batch, logs coverage gaps, and returns a mapping of people_id to DnaMatch id.",
      "quality": "stable",
      "concerns": [
        "Large IN query may stress the database when batches are big; lacks chunking mechanism."
      ],
      "opportunities": [
        "Chunk queries for large batches or reuse cached results across batches."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used by _classify_dna_match_operations."
    },
    {
      "id": "function:action6_gather._prepare_dna_match_data",
      "type": "function",
      "name": "_prepare_dna_match_data",
      "path": "action6_gather.py",
      "summary": "Strips private keys and associates person_id for DNA match operations.",
      "mechanism": "Filters out internal fields, removes UUID, and injects people_id to build insert/update payloads.",
      "quality": "stable",
      "concerns": [
        "Does not guard against missing people_id; relying on caller validation."
      ],
      "opportunities": [
        "Assert presence of people_id to prevent silent data loss."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Utility for _classify_dna_match_operations."
    },
    {
      "id": "function:action6_gather._classify_dna_match_operations",
      "type": "function",
      "name": "_classify_dna_match_operations",
      "path": "action6_gather.py",
      "summary": "Splits DNA match payloads into insert vs update lists, handling ethnicity data and existing matches.",
      "mechanism": "Resolves person IDs, prepares operation dicts, checks for existing matches via map/direct query, and populates insert/update collections, adding timestamps where needed.",
      "quality": "monitor",
      "concerns": [
        "Direct DB queries per person when cache misses occur may degrade performance."
      ],
      "opportunities": [
        "Introduce per-batch memoization or prefetch to minimize repeated queries."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Feeds _bulk_insert_dna_matches and _bulk_update_dna_matches."
    },
    {
      "id": "function:action6_gather._apply_ethnicity_data",
      "type": "function",
      "name": "_apply_ethnicity_data",
      "path": "action6_gather.py",
      "summary": "Applies ethnicity columns to dna_match rows using parameterized SQL.",
      "mechanism": "Builds UPDATE statements via sqlalchemy.text and executes them per people_id to set ethnicity fields.",
      "quality": "monitor",
      "concerns": [
        "Executes one UPDATE per record; batching could improve performance."
      ],
      "opportunities": [
        "Switch to bulk_update_mappings or single multi-row update where supported."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Invoked by both DNA insert and update pipelines."
    },
    {
      "id": "function:action6_gather._bulk_insert_dna_matches",
      "type": "function",
      "name": "_bulk_insert_dna_matches",
      "path": "action6_gather.py",
      "summary": "Performs bulk inserts for DNA matches while managing ethnicity columns separately.",
      "mechanism": "Splits core vs ethnicity attributes, bulk inserts core data, flushes, and then applies ethnicity updates via _apply_ethnicity_data.",
      "quality": "monitor",
      "concerns": [
        "Ethnicity updates loop per record, potentially slowing large batches."
      ],
      "opportunities": [
        "Aggregate ethnicity updates into batched SQL statements."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Called from _process_dna_match_operations after classification."
    },
    {
      "id": "function:action6_gather._separate_core_and_ethnicity",
      "type": "function",
      "name": "_separate_core_and_ethnicity",
      "path": "action6_gather.py",
      "summary": "Splits DNA match update payloads into core vs ethnicity dictionaries.",
      "mechanism": "Partitions dict items based on the ethnicity_ prefix so callers can apply updates to different storage paths.",
      "quality": "stable",
      "concerns": [
        "Requires callers to remember to recombine results in correct order."
      ],
      "opportunities": [
        "Return a named tuple for clearer downstream usage."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Helper for _bulk_update_dna_matches."
    },
    {
      "id": "function:action6_gather._bulk_update_dna_matches",
      "type": "function",
      "name": "_bulk_update_dna_matches",
      "path": "action6_gather.py",
      "summary": "Updates existing DNA matches and applies ethnicity changes where necessary.",
      "mechanism": "Separates core and ethnicity fields, executes bulk updates for core data, then iterates ethnicity updates via _apply_ethnicity_data.",
      "quality": "monitor",
      "concerns": [
        "Sequential ethnicity updates could be slow; lacks batching."
      ],
      "opportunities": [
        "Reuse the same batching approach proposed for inserts to cut down DB calls."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Called within _process_dna_match_operations."
    },
    {
      "id": "function:action6_gather._process_dna_match_operations",
      "type": "function",
      "name": "_process_dna_match_operations",
      "path": "action6_gather.py",
      "summary": "Coordinates DNA match inserts and updates after person IDs are resolved.",
      "mechanism": "Classifies operations, performs bulk insert/update flows, and expires session cache to ensure subsequent batches see changes.",
      "quality": "monitor",
      "concerns": [
        "Cache expiration after every batch could reduce ORM performance by forcing reloads."
      ],
      "opportunities": [
        "Track frequency of expire_all calls to evaluate impact and consider targeted expiration."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Invoked by _execute_bulk_db_operations."
    },
    {
      "id": "function:action6_gather._prepare_family_tree_inserts",
      "type": "function",
      "name": "_prepare_family_tree_inserts",
      "path": "action6_gather.py",
      "summary": "Builds FamilyTree insert payloads using resolved person IDs.",
      "mechanism": "Leverages _resolve_person_id to find people_id, copies whitelisted fields, and removes UUID before queuing inserts.",
      "quality": "stable",
      "concerns": [
        "Skips entries lacking person IDs without highlighting frequency."
      ],
      "opportunities": [
        "Return counts of skipped records for observability."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used by _process_family_tree_operations."
    },
    {
      "id": "function:action6_gather._prepare_family_tree_updates",
      "type": "function",
      "name": "_prepare_family_tree_updates",
      "path": "action6_gather.py",
      "summary": "Generates update mappings for FamilyTree records flagged for modification.",
      "mechanism": "Validates presence of existing tree IDs, strips private keys, adds record id and timestamp, and filters out no-op updates.",
      "quality": "stable",
      "concerns": [
        "Silently skips updates without _existing_tree_id; root cause may be upstream data issues."
      ],
      "opportunities": [
        "Track how often updates are skipped so data producers can fix gaps."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Helper for _process_family_tree_operations."
    },
    {
      "id": "function:action6_gather._process_family_tree_operations",
      "type": "function",
      "name": "_process_family_tree_operations",
      "path": "action6_gather.py",
      "summary": "Orchestrates FamilyTree insert and update sequences based on prepared bulk data.",
      "mechanism": "Separates create vs update operations, prepares insert/update payloads, and executes bulk mappings while logging absence of work.",
      "quality": "stable",
      "concerns": [
        "Does not expire session state after operations, unlike DNA flow; ORM cache may become stale."
      ],
      "opportunities": [
        "Align cache management with DNA pipeline to ensure consistent behavior."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Invoked from _execute_bulk_db_operations to maintain tree data."
    },
    {
      "id": "function:action6_gather._compare_datetime_field",
      "type": "function",
      "name": "_compare_datetime_field",
      "path": "action6_gather.py",
      "summary": "Normalizes datetime values to UTC before comparison for change detection.",
      "mechanism": "Converts both datetimes to UTC with zeroed microseconds when possible and reports difference plus new value.",
      "quality": "stable",
      "concerns": [
        "Falls back to None when timezone info missing, which may miss naive timestamp changes."
      ],
      "opportunities": [
        "Enforce explicit timezone normalization upstream to avoid lossy comparisons."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Comparator referenced by _get_field_comparator for last_logged_in field."
    },
    {
      "id": "function:action6_gather._compare_status_field",
      "type": "function",
      "name": "_compare_status_field",
      "path": "action6_gather.py",
      "summary": "Compares Person status values with enum normalization.",
      "mechanism": "Extracts .value when inputs are PersonStatusEnum instances and reports change flag with new value.",
      "quality": "stable",
      "concerns": [
        "Assumes enums mirror stored DB values; divergence would slip through silently."
      ],
      "opportunities": [
        "Validate against allowed enum list to catch unexpected statuses."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used via _get_field_comparator when comparing status updates."
    },
    {
      "id": "function:action6_gather._compare_birth_year_field",
      "type": "function",
      "name": "_compare_birth_year_field",
      "path": "action6_gather.py",
      "summary": "Allows birth year updates only when new value is numeric and existing value is missing.",
      "mechanism": "Attempts int conversion for new value, logging warning on invalid input, and signals whether update should occur.",
      "quality": "stable",
      "concerns": [
        "Rejects legitimate corrections where current value is non-null but inaccurate."
      ],
      "opportunities": [
        "Permit updates when new value differs but add audit telemetry to monitor churn."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Special-case comparator selected by _get_field_comparator."
    },
    {
      "id": "function:action6_gather._compare_gender_field",
      "type": "function",
      "name": "_compare_gender_field",
      "path": "action6_gather.py",
      "summary": "Restricts gender updates to first-time assignments with valid markers.",
      "mechanism": "Accepts only 'f' or 'm' strings when database field is None, returning lowercase value for persistence.",
      "quality": "stable",
      "concerns": [
        "No support for non-binary values; future schema changes would need comparator refresh."
      ],
      "opportunities": [
        "Reference enum of allowed genders so updates align with domain rules."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Invoked through _get_field_comparator for gender field."
    },
    {
      "id": "function:action6_gather._compare_profile_id_field",
      "type": "function",
      "name": "_compare_profile_id_field",
      "path": "action6_gather.py",
      "summary": "Normalizes profile identifiers to uppercase before detecting changes.",
      "mechanism": "Uppercases current and new values (when present) and returns diff flag plus normalized value.",
      "quality": "stable",
      "concerns": [
        "Casts None to 'None' string if careless callers pass non-str types; relies on upstream typing."
      ],
      "opportunities": [
        "Add explicit None check to avoid accidental stringification of missing IDs."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used for both tester and admin profile ID comparisons."
    },
    {
      "id": "function:action6_gather._compare_boolean_field",
      "type": "function",
      "name": "_compare_boolean_field",
      "path": "action6_gather.py",
      "summary": "Performs basic boolean comparison for change detection.",
      "mechanism": "Casts both values to bool and returns whether they differ alongside normalized value.",
      "quality": "stable",
      "concerns": [
        "Bool cast treats many inputs as True, potentially masking tri-state fields."
      ],
      "opportunities": [
        "Handle None explicitly to retain unknown vs False distinction."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Fallback comparator when bool types detected in _get_field_comparator."
    },
    {
      "id": "function:action6_gather._get_field_comparator",
      "type": "function",
      "name": "_get_field_comparator",
      "path": "action6_gather.py",
      "summary": "Selects specialized comparator functions for Person field updates.",
      "mechanism": "Looks for boolean types first, then matches field names to comparator map to ensure consistent normalization rules.",
      "quality": "stable",
      "concerns": [
        "Comparator map must stay in sync with schema; missing entries silently fall back to naive comparison."
      ],
      "opportunities": [
        "Log when field falls back to default to catch schema drift early."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Central hook used by _compare_person_field."
    },
    {
      "id": "function:action6_gather._compare_person_field",
      "type": "function",
      "name": "_compare_person_field",
      "path": "action6_gather.py",
      "summary": "Applies comparator logic to determine if a Person attribute changed and the normalized value to persist.",
      "mechanism": "Delegates to specialized comparators when available, including birth year log-aware variant, otherwise uses direct equality check.",
      "quality": "stable",
      "concerns": [
        "Default branch performs shallow comparison; complex types could slip through unchanged."
      ],
      "opportunities": [
        "Extend comparator registry to cover additional structured fields like addresses."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Looped by _prepare_person_operation_data while inspecting each incoming field."
    },
    {
      "id": "function:action6_gather._determine_profile_ids_when_both_exist",
      "type": "function",
      "name": "_determine_profile_ids_when_both_exist",
      "path": "action6_gather.py",
      "summary": "Resolves tester vs administrator profile IDs when API returns both values.",
      "mechanism": "Compares IDs and usernames to decide which identifier belongs to the tester versus admin, returning normalized tuple.",
      "quality": "stable",
      "concerns": [
        "Relies on username string equality; whitespace or locale differences could yield incorrect assignments."
      ],
      "opportunities": [
        "Normalize usernames more aggressively (trim, casefold) before comparison."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Helper for _extract_profile_ids."
    },
    {
      "id": "function:action6_gather._extract_raw_profile_data",
      "type": "function",
      "name": "_extract_raw_profile_data",
      "path": "action6_gather.py",
      "summary": "Pulls initial tester/admin profile metadata from combined details and match list records.",
      "mechanism": "Reads profile/admin IDs and usernames from API payloads, normalizing case and formatting administrator name when available.",
      "quality": "stable",
      "concerns": [
        "Assumes details payload present; missing keys default to None without logging."
      ],
      "opportunities": [
        "Emit debug logs when important identifiers are absent to aid troubleshooting."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Feeds _extract_profile_ids with normalized inputs."
    },
    {
      "id": "function:action6_gather._extract_profile_ids",
      "type": "function",
      "name": "_extract_profile_ids",
      "path": "action6_gather.py",
      "summary": "Determines final person and administrator profile IDs for bulk Person rows.",
      "mechanism": "Combines raw detail data with username-derived heuristics, delegating conflict resolution to _determine_profile_ids_when_both_exist.",
      "quality": "stable",
      "concerns": [
        "Returns three-tuple with potential None entries; callers must handle carefully."
      ],
      "opportunities": [
        "Replace tuple with dataclass for clearer field naming and static checking."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used by _prepare_person_operation_data when building person payload."
    },
    {
      "id": "function:action6_gather._build_message_link",
      "type": "function",
      "name": "_build_message_link",
      "path": "action6_gather.py",
      "summary": "Constructs messaging URL for a match using either tester or admin profile ID.",
      "mechanism": "Selects available profile/admin ID and formats messaging endpoint using config base URL.",
      "quality": "stable",
      "concerns": [
        "Assumes config_schema.api.base_url present; missing config yields silent None."
      ],
      "opportunities": [
        "Log when neither identifier is available to highlight unreachable contacts."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Part of person payload assembly in _prepare_person_operation_data."
    },
    {
      "id": "function:action6_gather._extract_birth_year",
      "type": "function",
      "name": "_extract_birth_year",
      "path": "action6_gather.py",
      "summary": "Parses birth year from prefetched tree data with defensive casting.",
      "mechanism": "Attempts to read 'their_birth_year' and convert to int, suppressing ValueError/TypeError when invalid.",
      "quality": "stable",
      "concerns": [
        "Silently ignores invalid values; difficult to detect data quality issues."
      ],
      "opportunities": [
        "Track suppressions with debug logs to aid data cleanup."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used when building incoming person data for updates."
    },
    {
      "id": "function:action6_gather._normalize_last_logged_in",
      "type": "function",
      "name": "_normalize_last_logged_in",
      "path": "action6_gather.py",
      "summary": "Ensures last_logged_in timestamps are timezone-aware UTC before persistence.",
      "mechanism": "Attaches UTC tzinfo to naive datetimes or converts aware ones to UTC, returning unchanged value otherwise.",
      "quality": "stable",
      "concerns": [
        "Returns naive datetime unchanged when not datetime instance; earlier validation must guard types."
      ],
      "opportunities": [
        "Raise or log when non-datetime values appear to catch upstream serialization issues."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Called from _prepare_person_operation_data before comparisons."
    },
    {
      "id": "function:action6_gather._build_incoming_person_data",
      "type": "function",
      "name": "_build_incoming_person_data",
      "path": "action6_gather.py",
      "summary": "Creates normalized dictionary representing the latest Person attributes from API data.",
      "mechanism": "Aggregates identifiers, messaging link, contactability flags, and tree context into a single payload with ACTIVE status.",
      "quality": "stable",
      "concerns": [
        "Hardcodes status ACTIVE; lacks hooks for suppressed/archived states."
      ],
      "opportunities": [
        "Derive status from upstream signals instead of constant assignment."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Forms basis for create/update decisions in _prepare_person_operation_data."
    },
    {
      "id": "function:action6_gather._prepare_person_operation_data",
      "type": "function",
      "name": "_prepare_person_operation_data",
      "path": "action6_gather.py",
      "summary": "Determines Person create/update payloads by comparing incoming API data with existing records.",
      "mechanism": "Builds normalized incoming data, generates message links, runs field comparisons via _compare_person_field, and returns operation dict plus change flag.",
      "quality": "monitor",
      "concerns": [
        "Loops over many fields with implicit ordering; missing comparator registration may silently skip updates."
      ],
      "opportunities": [
        "Refactor to explicit schema definition to make comparisons declarative and testable."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Consumed within _process_person_data_safe and ultimately _do_match."
    },
    {
      "id": "function:action6_gather._check_basic_dna_changes",
      "type": "function",
      "name": "_check_basic_dna_changes",
      "path": "action6_gather.py",
      "summary": "Detects fundamental DNA metric changes (centimorgans or segment counts).",
      "mechanism": "Compares API cm and shared segment counts against database values and logs which metric differed.",
      "quality": "stable",
      "concerns": [
        "Casts API values to int without guarding None; rely on upstream defaults."
      ],
      "opportunities": [
        "Add validation to flag negative or missing DNA metrics before comparison."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "First gate within _compare_dna_fields."
    },
    {
      "id": "function:action6_gather._check_longest_segment_changes",
      "type": "function",
      "name": "_check_longest_segment_changes",
      "path": "action6_gather.py",
      "summary": "Evaluates longest shared segment differences including data loss cases.",
      "mechanism": "Calculates absolute difference with 0.01 tolerance and logs when API loses previously stored value.",
      "quality": "stable",
      "concerns": [
        "String-to-float conversion may raise ValueError if API returns unexpected text."
      ],
      "opportunities": [
        "Wrap conversion in try/except to avoid bubbling errors to caller."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Second stage inside _compare_dna_fields."
    },
    {
      "id": "function:action6_gather._check_relationship_and_side_changes",
      "type": "function",
      "name": "_check_relationship_and_side_changes",
      "path": "action6_gather.py",
      "summary": "Checks predicted relationship shifts and parental side flags for DNA updates.",
      "mechanism": "Compares predicted relationship strings and father/mother side booleans, logging any differences.",
      "quality": "stable",
      "concerns": [
        "Equality comparisons treat None and 'N/A' differently; may log false positives."
      ],
      "opportunities": [
        "Normalize empty values before comparison to reduce noise."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used by _compare_dna_fields to decide update necessity."
    },
    {
      "id": "function:action6_gather._compare_dna_fields",
      "type": "function",
      "name": "_compare_dna_fields",
      "path": "action6_gather.py",
      "summary": "Aggregates DNA comparison logic to determine if record updates are required.",
      "mechanism": "Runs basic metric, longest segment, relationship, and meiosis checks against stored values with detailed logging.",
      "quality": "monitor",
      "concerns": [
        "Wraps several conversions in try/except higher up, but partial failures fall back to generic warning and forced update."
      ],
      "opportunities": [
        "Return structured reasons for updates to improve telemetry and test coverage."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Called by _check_dna_update_needed when existing record present."
    },
    {
      "id": "function:action6_gather._check_dna_update_needed",
      "type": "function",
      "name": "_check_dna_update_needed",
      "path": "action6_gather.py",
      "summary": "Determines whether to create or update a DNA match based on existing record state.",
      "mechanism": "Returns True when no existing record exists or when _compare_dna_fields detects differences, handling comparison exceptions conservatively.",
      "quality": "stable",
      "concerns": [
        "Treats comparison errors as update-required, potentially masking systematic parsing issues."
      ],
      "opportunities": [
        "Track exception rate separately to identify parser regressions."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Entry point for DNA change detection within _prepare_dna_match_operation_data."
    },
    {
      "id": "function:action6_gather._build_dna_dict_base",
      "type": "function",
      "name": "_build_dna_dict_base",
      "path": "action6_gather.py",
      "summary": "Constructs baseline DNA payload containing key identifiers and relationship fields.",
      "mechanism": "Uppercases UUID, copies compare link, cm value, and predicted relationship while defaulting operation to create.",
      "quality": "stable",
      "concerns": [
        "Always sets _operation='create'; caller must adjust for updates afterward."
      ],
      "opportunities": [
        "Parameterize operation type to avoid downstream mutation needs."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used before adding details in _prepare_dna_match_operation_data."
    },
    {
      "id": "function:action6_gather._add_dna_details",
      "type": "function",
      "name": "_add_dna_details",
      "path": "action6_gather.py",
      "summary": "Augments DNA payload with segment counts and parental side data when prefetched details available.",
      "mechanism": "Copies combined detail metrics into dna_dict_base, falling back to list data when details missing and logging warning.",
      "quality": "stable",
      "concerns": [
        "Silently skips several fields when details absent; may not capture latest shared segment counts."
      ],
      "opportunities": [
        "Emit metrics on fallback frequency to prioritize coverage improvements."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Part of DNA payload assembly helper chain."
    },
    {
      "id": "function:action6_gather._filter_dna_dict",
      "type": "function",
      "name": "_filter_dna_dict",
      "path": "action6_gather.py",
      "summary": "Removes None values from DNA payload while preserving sentinel fields.",
      "mechanism": "Filters dictionary entries except for whitelisted keys such as predicted_relationship, UUID, and internal markers.",
      "quality": "stable",
      "concerns": [
        "Whitelist must stay aligned with schema; new nullable columns risk being dropped inadvertently."
      ],
      "opportunities": [
        "Drive whitelist from model metadata to reduce maintenance overhead."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Final cleanup step in _prepare_dna_match_operation_data."
    },
    {
      "id": "function:action6_gather._filter_changed_ethnicity_values",
      "type": "function",
      "name": "_filter_changed_ethnicity_values",
      "path": "action6_gather.py",
      "summary": "Reduces ethnicity update payloads to columns whose values differ from existing record.",
      "mechanism": "Iterates prefetched ethnicity mapping, compares against current DnaMatch attributes, and returns only changed keys.",
      "quality": "stable",
      "concerns": [
        "Falls back to updating all fields when attribute missing on model; may hide schema drift."
      ],
      "opportunities": [
        "Log unexpected attribute gaps to surface migrations that failed to run."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used by _add_ethnicity_data before mutating dna_dict_base."
    },
    {
      "id": "function:action6_gather._add_ethnicity_data",
      "type": "function",
      "name": "_add_ethnicity_data",
      "path": "action6_gather.py",
      "summary": "Integrates ethnicity columns into DNA payload when refresh deemed necessary.",
      "mechanism": "Checks refresh eligibility via _needs_ethnicity_refresh, filters changed values, updates dna_dict_base, and logs result counts.",
      "quality": "monitor",
      "concerns": [
        "Relies on match dict side channel (_prefetched_ethnicity); absence leads to silent skips."
      ],
      "opportunities": [
        "Record telemetry when prefetched ethnicity missing to guide API coverage improvements."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Called after _add_dna_details inside _prepare_dna_match_operation_data."
    },
    {
      "id": "function:action6_gather._prepare_dna_match_operation_data",
      "type": "function",
      "name": "_prepare_dna_match_operation_data",
      "path": "action6_gather.py",
      "summary": "Builds DNA create/update payloads by merging list data, prefetched details, and ethnicity refresh rules.",
      "mechanism": "Determines need via _check_dna_update_needed, constructs base payload, layers combined detail fields, applies ethnicity diffs, and filters None values before returning.",
      "quality": "monitor",
      "concerns": [
        "Assumes predicted_relationship fallback 'N/A' acceptable for downstream analytics."
      ],
      "opportunities": [
        "Return structured reason codes to aid instrumentation of update causes."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Invoked via _process_dna_data_safe inside _do_match."
    },
    {
      "id": "function:action6_gather._build_tree_links",
      "type": "function",
      "name": "_build_tree_links",
      "path": "action6_gather.py",
      "summary": "Generates facts and view URLs for tree members using session context.",
      "mechanism": "Composes tree-specific URLs with cfpid and session identifiers, returning tuple of facts and view links.",
      "quality": "stable",
      "concerns": [
        "Assumes session_manager.my_tree_id populated; missing value yields silent None results."
      ],
      "opportunities": [
        "Warn when tree_id absent so operators know to reauthenticate."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Helper for _prepare_family_tree_operation_data."
    },
    {
      "id": "function:action6_gather._check_tree_update_needed",
      "type": "function",
      "name": "_check_tree_update_needed",
      "path": "action6_gather.py",
      "summary": "Evaluates whether stored FamilyTree record diverges from prefetched tree details.",
      "mechanism": "Iterates set of fields (cfpid, relationship, links) comparing against existing record, logging first difference found.",
      "quality": "stable",
      "concerns": [
        "Only logs first differing field; deeper insight requires additional instrumentation."
      ],
      "opportunities": [
        "Return list of changed fields to improve diagnostics."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used by _determine_tree_operation before requesting update."
    },
    {
      "id": "function:action6_gather._build_tree_data_dict",
      "type": "function",
      "name": "_build_tree_data_dict",
      "path": "action6_gather.py",
      "summary": "Creates family tree payload containing relationship context and target links.",
      "mechanism": "Populates dictionary with normalized fields, retains operation metadata (_operation/_existing_tree_id), and filters out None values except required markers.",
      "quality": "stable",
      "concerns": [
        "Relies on prefetched_tree_data keys; missing relationship_path leads to partial updates without warning."
      ],
      "opportunities": [
        "Log when key fields absent to guide API enrichment improvements."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Called from _prepare_family_tree_operation_data when operation not none."
    },
    {
      "id": "function:action6_gather._determine_tree_operation",
      "type": "function",
      "name": "_determine_tree_operation",
      "path": "action6_gather.py",
      "summary": "Decides whether to create, update, or skip a FamilyTree record based on tree membership and existing data.",
      "mechanism": "Considers match_in_my_tree flag, presence of existing record, and change detection via _check_tree_update_needed, logging inconsistencies.",
      "quality": "stable",
      "concerns": [
        "Skips create when tree data missing even if match flagged in tree; depending on API reliability, may drop legitimate relationships."
      ],
      "opportunities": [
        "Introduce retry or deferred queue when tree data missing but membership true."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Feeds operation flag returned by _prepare_family_tree_operation_data."
    },
    {
      "id": "function:action6_gather._prepare_family_tree_operation_data",
      "type": "function",
      "name": "_prepare_family_tree_operation_data",
      "path": "action6_gather.py",
      "summary": "Constructs create/update payloads for FamilyTree table using prefetched ladder and badge details.",
      "mechanism": "Builds cfpid links, invokes _determine_tree_operation, assembles data dict via _build_tree_data_dict when applicable, and warns if details missing.",
      "quality": "monitor",
      "concerns": [
        "Returns None when data absent even if operation flagged; upstream must interpret carefully."
      ],
      "opportunities": [
        "Return structured outcome including reason for 'none' to sharpen telemetry."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used within _process_tree_data_safe during _do_match orchestration."
    },
    {
      "id": "function:action6_gather._extract_match_info",
      "type": "function",
      "name": "_extract_match_info",
      "path": "action6_gather.py",
      "summary": "Pulls core identification fields from match list entry and formats username for logging.",
      "mechanism": "Returns tuple containing UUID, formatted username, predicted relationship, in-tree flag, and short log reference string.",
      "quality": "stable",
      "concerns": [
        "Assumes format_name handles None gracefully; odd characters may leak to logs."
      ],
      "opportunities": [
        "Clamp username length to prevent excessive log lines."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "First step inside _do_match."
    },
    {
      "id": "function:action6_gather._process_person_data_safe",
      "type": "function",
      "name": "_process_person_data_safe",
      "path": "action6_gather.py",
      "summary": "Wrapper around _prepare_person_operation_data that logs and swallows exceptions.",
      "mechanism": "Calls person preparation helper in try/except, logging stack trace on failure and returning (None, False) to signal skip.",
      "quality": "monitor",
      "concerns": [
        "Suppresses errors by returning False flag; repeated failures may go unnoticed without telemetry."
      ],
      "opportunities": [
        "Count failures and surface metrics to reliability dashboards."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used by _do_match after extracting match info."
    },
    {
      "id": "function:action6_gather._process_dna_data_safe",
      "type": "function",
      "name": "_process_dna_data_safe",
      "path": "action6_gather.py",
      "summary": "Guarded call to _prepare_dna_match_operation_data with error logging.",
      "mechanism": "Runs DNA preparation helper inside try/except, logging on failure and returning None to skip DNA updates when errors occur.",
      "quality": "monitor",
      "concerns": [
        "Silent fallback to None may hide systemic API parsing bugs."
      ],
      "opportunities": [
        "Track error occurrences via counters or alerts to catch regressions early."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Invoked from _do_match for each candidate."
    },
    {
      "id": "function:action6_gather._process_tree_data_safe",
      "type": "function",
      "name": "_process_tree_data_safe",
      "path": "action6_gather.py",
      "summary": "Wraps _prepare_family_tree_operation_data with defensive logging.",
      "mechanism": "Executes helper in try/except, logging errors and returning (None, 'none') to keep bulk processing resilient.",
      "quality": "monitor",
      "concerns": [
        "Returns string 'none' even on failure; upstream cannot distinguish between genuine skip and error case."
      ],
      "opportunities": [
        "Extend return signature with error flag to support telemetry."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Called from _do_match alongside person and DNA processing."
    },
    {
      "id": "function:action6_gather._populate_bulk_data_dict",
      "type": "function",
      "name": "_populate_bulk_data_dict",
      "path": "action6_gather.py",
      "summary": "Moves prepared person/DNA/tree payloads into bulk dictionary honoring create semantics.",
      "mechanism": "Assigns person and DNA payloads when present and only includes tree payload on new person creates unless update explicitly requested.",
      "quality": "stable",
      "concerns": [
        "Couples tree inclusion to is_new_person flag; updates for existing members rely on upstream logic."
      ],
      "opportunities": [
        "Make tree inclusion criteria configurable to support additional scenarios."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Helper used by _assemble_bulk_data."
    },
    {
      "id": "function:action6_gather._determine_overall_status",
      "type": "function",
      "name": "_determine_overall_status",
      "path": "action6_gather.py",
      "summary": "Derives overall match status (new/updated/skipped) from per-table operation outcomes.",
      "mechanism": "Returns 'new' for new person, 'updated' when any payload present, and defaults to 'skipped' otherwise.",
      "quality": "stable",
      "concerns": [
        "Treats any tree operation as update even if data identical; may over-report updates."
      ],
      "opportunities": [
        "Include reason codes or differentiate between DNA vs tree updates for better metrics."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Used by _assemble_bulk_data."
    },
    {
      "id": "function:action6_gather._assemble_bulk_data",
      "type": "function",
      "name": "_assemble_bulk_data",
      "path": "action6_gather.py",
      "summary": "Creates final bulk payload dict and status tuple for _do_match results.",
      "mechanism": "Initializes data shell, populates payloads via _populate_bulk_data_dict, and determines overall status through _determine_overall_status.",
      "quality": "stable",
      "concerns": [
        "Initial dict includes None placeholders that must be cleaned by callers before serialization."
      ],
      "opportunities": [
        "Return dataclass with explicit optional fields to eliminate sentinel None usage."
      ],
      "tests": "action6_gather_module_tests",
      "notes": "Immediate precursor to _do_match return value."
    },
    {
      "id": "file:action7_inbox.py",
      "type": "file",
      "name": "action7_inbox.py",
      "path": "action7_inbox.py",
      "summary": "Inbox processing pipeline handling classification, sentiment analysis, and follow-up orchestration for conversations.",
      "mechanism": "Coordinates SessionManager resources to fetch conversations, applies AI intent classifiers, updates engagement metrics, and schedules reminder tasks via heuristic follow-up payloads.",
      "quality": "monitor",
      "concerns": [
        "Large module with mixed responsibilities; follow-up heuristics and task creation share stateful helpers."
      ],
      "opportunities": [
        "Factor follow-up reminder helpers into dedicated component with focused unit tests."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Spot-checked follow-up payload heuristics for PRODUCTIVE inbound and outbound scenarios on 2025-11-11."
    },
    {
      "id": "class:action7_inbox.InboxProcessor",
      "type": "class",
      "name": "InboxProcessor",
      "path": "action7_inbox.py",
      "summary": "Orchestrates inbox fetches, sentiment analysis, engagement updates, and follow-up task preparation.",
      "mechanism": "Uses SessionManager for API calls, caches conversation batches, drives AI classifiers, and records metrics while routing follow-up heuristics through helper methods.",
      "quality": "monitor",
      "concerns": [
        "Class breadth makes it difficult to reason about individual pipelines without additional docs."
      ],
      "opportunities": [
        "Document sub-pipelines (classification vs follow-up) and consider extracting reminder task builder."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Follow-up helpers validated manually; deeper audit pending for remaining pipelines."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._analyze_follow_up_requirements",
      "type": "function",
      "name": "InboxProcessor._analyze_follow_up_requirements",
      "path": "action7_inbox.py",
      "summary": "Computes follow-up payload heuristics from latest message context and AI classifications.",
      "mechanism": "Flags follow-up when latest direction is inbound PRODUCTIVE, derives pending questions, builds reminder copy, sets urgency, and assigns due windows of 7/14/30 days based on sentiment and phase.",
      "quality": "monitor",
      "concerns": [
        "Pending item detection only checks for question marks; nuance like multi-question threads may be missed."
      ],
      "opportunities": [
        "Augment heuristics with AI summarization or structured extraction to populate pending_items."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Manual spot-check confirmed urgent 7-day follow-up for inbound PRODUCTIVE questions and no follow-up for outbound replies."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._extract_follow_up_requirements",
      "type": "function",
      "name": "InboxProcessor._extract_follow_up_requirements",
      "path": "action7_inbox.py",
      "summary": "Gateway that skips non-actionable conversations and assembles follow-up heuristic inputs.",
      "mechanism": "Short-circuits on DESIST/CLOSED states, builds recent history context, invokes heuristic analyzer, and normalizes results via _process_follow_up_result.",
      "quality": "monitor",
      "concerns": [
        "Complexity will grow as heuristics evolve; lacks explicit telemetry when skip conditions dominate."
      ],
      "opportunities": [
        "Emit counters for skip reasons to improve observability of follow-up coverage."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Relies on conversation history slicing (last 10 entries) before heuristic evaluation."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._process_follow_up_result",
      "type": "function",
      "name": "InboxProcessor._process_follow_up_result",
      "path": "action7_inbox.py",
      "summary": "Validates heuristic response payloads and schedules due dates when follow-up required.",
      "mechanism": "Handles error dicts, unwraps nested response objects, calculates due datetime from days_until_due, and logs scheduled reminders.",
      "quality": "monitor",
      "concerns": [
        "Assumes days_until_due present when follow_up_required; missing field drops reminder silently."
      ],
      "opportunities": [
        "Consider defaulting to configuration-driven due window when heuristics omit days_until_due."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Feeds MS To-Do creation pipeline with normalized follow-up payload."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._default_follow_up_payload",
      "type": "function",
      "name": "InboxProcessor._default_follow_up_payload",
      "path": "action7_inbox.py",
      "summary": "Provides baseline payload structure when no follow-up required or heuristics fail.",
      "mechanism": "Returns dictionary with follow_up_required False and null due date/assignee fields.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Extend with reason codes to help downstream analytics differentiate error vs no-action scenarios."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Used as safety fallback across extraction pipeline."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._determine_follow_up_window",
      "type": "function",
      "name": "InboxProcessor._determine_follow_up_window",
      "path": "action7_inbox.py",
      "summary": "Maps message direction, sentiment, and phase to days-until-due heuristics.",
      "mechanism": "Prioritizes inbound PRODUCTIVE messages (7 days), cautious interest and response phases (14 days), and falls back to 30-day window otherwise.",
      "quality": "stable",
      "concerns": [
        "Static thresholds may need tuning as engagement datasets grow."
      ],
      "opportunities": [
        "Parameterize via config to allow experimentation without code changes."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Shared between heuristic analyzer and result processor via days_until_due field."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._determine_pending_items",
      "type": "function",
      "name": "InboxProcessor._determine_pending_items",
      "path": "action7_inbox.py",
      "summary": "Extracts pending action items from the latest message content.",
      "mechanism": "Returns the message when it contains a question mark, otherwise yields empty list.",
      "quality": "monitor",
      "concerns": [
        "Simplistic string heuristic may miss implicit requests or multi-question messages."
      ],
      "opportunities": [
        "Integrate NLP entity extraction to detect requests and commitments beyond simple '?'."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Feeds reminder body copy with the user's explicit question when present."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._derive_follow_up_reason",
      "type": "function",
      "name": "InboxProcessor._derive_follow_up_reason",
      "path": "action7_inbox.py",
      "summary": "Translates follow-up flags and sentiment into human-readable justification.",
      "mechanism": "Returns canned explanations for PRODUCTIVE questions and cautiously interested matches, otherwise None.",
      "quality": "stable",
      "concerns": [
        "Hard-coded strings limit localization or personalization."
      ],
      "opportunities": [
        "Drive messaging from template catalog or AI summarizer for richer reasons."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Reason field later surfaced in reminder task body for operator clarity."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._build_reminder_details",
      "type": "function",
      "name": "InboxProcessor._build_reminder_details",
      "path": "action7_inbox.py",
      "summary": "Composes reminder title and body text for MS To-Do follow-ups.",
      "mechanism": "Returns default title when follow-up required and uses pending item question or latest history snippet for body copy.",
      "quality": "stable",
      "concerns": [
        "History snippet truncation may surface mid-sentence content; review readability."
      ],
      "opportunities": [
        "Leverage AI summarizer to produce concise, context-rich task descriptions."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Outputs None tuple when no follow-up to avoid unnecessary task creation."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._calculate_urgency_level",
      "type": "function",
      "name": "InboxProcessor._calculate_urgency_level",
      "path": "action7_inbox.py",
      "summary": "Assigns urgency tier based on sentiment and message direction.",
      "mechanism": "Marks inbound PRODUCTIVE messages as urgent, cautious interest as standard, and defaults to standard otherwise.",
      "quality": "stable",
      "concerns": [
        "Current heuristic ignores depth of engagement or pending commitments."
      ],
      "opportunities": [
        "Incorporate engagement score or response latency to refine urgency."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Input direction and AI sentiment derived earlier in the pipeline."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._build_follow_up_history",
      "type": "function",
      "name": "InboxProcessor._build_follow_up_history",
      "path": "action7_inbox.py",
      "summary": "Condenses recent conversation entries into labeled transcript for AI heuristics.",
      "mechanism": "Collects up to ten latest log entries, prefixes ME/USER labels, truncates content to 500 characters per entry, and joins with spacing.",
      "quality": "stable",
      "concerns": [
        "Truncation may omit critical details for longer messages."
      ],
      "opportunities": [
        "Persist richer context or allow configurable window size per action requirements."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Used as input to follow-up heuristic analyzer and AI context builders."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._should_skip_follow_up",
      "type": "function",
      "name": "InboxProcessor._should_skip_follow_up",
      "path": "action7_inbox.py",
      "summary": "Determines whether follow-up heuristics should skip evaluation based on sentiment or phase.",
      "mechanism": "Returns True for DESIST/UNINTERESTED sentiments or when conversation phase is CLOSED.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add telemetry counters to track frequency of skip conditions."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Provides initial guardrail in follow-up extraction pipeline."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._calculate_task_importance",
      "type": "function",
      "name": "InboxProcessor._calculate_task_importance",
      "path": "action7_inbox.py",
      "summary": "Derives MS To-Do importance tier from DNA centimorgans, engagement score, and urgency overrides.",
      "mechanism": "Loads Person via SessionManager DB session, extracts DNA/engagement metrics, and maps thresholds to high/normal/low with urgency overrides.",
      "quality": "monitor",
      "concerns": [
        "Requires DB session availability; missing session logs warning but degrades to normal importance."
      ],
      "opportunities": [
        "Cache engagement metrics to reduce repeated DB lookups during bulk task creation."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Supports follow-up reminder task creation by prioritizing closer relatives."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._create_follow_up_reminder_task",
      "type": "function",
      "name": "InboxProcessor._create_follow_up_reminder_task",
      "path": "action7_inbox.py",
      "summary": "Creates MS To-Do follow-up task using Microsoft Graph when configuration permits.",
      "mechanism": "Imports ms_graph_utils lazily, respects dry_run/test modes, acquires device-flow token, resolves list id, applies importance heuristic, and invokes create_todo_task with due date and categories.",
      "quality": "monitor",
      "concerns": [
        "Broad exception handling hides granular failure modes; relies on external Graph configuration."
      ],
      "opportunities": [
        "Add success/failure telemetry and retry strategy for transient Graph issues."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Manual workflow depends on ms_graph_utils availability; dry run logs intention without API call."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._determine_conversation_phase",
      "type": "function",
      "name": "InboxProcessor._determine_conversation_phase",
      "path": "action7_inbox.py",
      "summary": "Classifies conversation lifecycle phase using message direction, sentiment, recency, and engagement heuristics.",
      "mechanism": "Evaluates ordered heuristic checks (closed, outreach, response, stalled, collaboration, information_shared) using message counts, days elapsed, and AI sentiment to return ConversationPhaseEnum value.",
      "quality": "monitor",
      "concerns": [
        "Phase transitions depend on hardcoded thresholds; limited telemetry on misclassifications."
      ],
      "opportunities": [
        "Instrument phase outcomes to validate heuristics against real user feedback."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Feeding follow-up heuristics and analytics tracking with phase context."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._process_in_message",
      "type": "function",
      "name": "InboxProcessor._process_in_message",
      "path": "action7_inbox.py",
      "summary": "Processes latest inbound message, running AI classification, phase detection, follow-up extraction, and analytics updates.",
      "mechanism": "Compares timestamps with DB, classifies message via AI, derives conversation phase, extracts follow-up payload, enqueues log upsert, optionally creates reminder task, records analytics, and updates person status.",
      "quality": "monitor",
      "concerns": [
        "Combines multiple responsibilities; failures in any step could short-circuit downstream actions."
      ],
      "opportunities": [
        "Split into smaller units or add structured telemetry for each stage."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Central entry for follow-up automation triggered by inbound PRODUCTIVE messages."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._process_out_message",
      "type": "function",
      "name": "InboxProcessor._process_out_message",
      "path": "action7_inbox.py",
      "summary": "Persists outbound message updates and tracks engagement analytics when new content detected.",
      "mechanism": "Detects newer outbound messages, assigns conversation phase without AI sentiment, enqueues log upsert, and records analytics if DB session available.",
      "quality": "stable",
      "concerns": [
        "Lacks follow-up linkage; relies on inbound processing for reminders."
      ],
      "opportunities": [
        "Could track operator response latency metrics for productivity insights."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Complements inbound processing to keep conversation logs fresh."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._create_conversation_log_upsert",
      "type": "function",
      "name": "InboxProcessor._create_conversation_log_upsert",
      "path": "action7_inbox.py",
      "summary": "Builds dictionary payload for upserting conversation logs with follow-up metadata.",
      "mechanism": "Returns dict combining conversation identifiers, truncated message content, timestamps, AI sentiment, conversation phase, follow-up due date, and awaiting response fields respecting config limits.",
      "quality": "stable",
      "concerns": [
        "No schema validation before commit_bulk_data; relies on downstream integrity."
      ],
      "opportunities": [
        "Introduce dataclass or pydantic model for stronger typing prior to persistence."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Used for both inbound and outbound log entries."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._update_person_status_from_ai",
      "type": "function",
      "name": "InboxProcessor._update_person_status_from_ai",
      "path": "action7_inbox.py",
      "summary": "Adjusts person engagement status map based on AI sentiment classification.",
      "mechanism": "Maps UNINTERESTED sentiment to DESIST status and leaves PRODUCTIVE contacts active, accumulating updates for batch commit.",
      "quality": "stable",
      "concerns": [
        "Future sentiment categories may require expanded mapping logic."
      ],
      "opportunities": [
        "Hook into Action 9 prioritization to adjust outreach cadence."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Operates on in-memory dict prior to commit_bulk_data."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._get_db_timestamp_for_comparison",
      "type": "function",
      "name": "InboxProcessor._get_db_timestamp_for_comparison",
      "path": "action7_inbox.py",
      "summary": "Retrieves last-known message timestamp from cached DB logs for freshness checks.",
      "mechanism": "Looks up ConversationLog by conversation/direction key and returns latest timestamp or minimum fallback for comparison with API data.",
      "quality": "stable",
      "concerns": [
        "Assumes cached logs keyed consistently; corrupt cache could skip updates."
      ],
      "opportunities": [
        "Instrument cache misses/hits for diagnostics."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Supports both inbound and outbound message processors."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._commit_batch_updates",
      "type": "function",
      "name": "InboxProcessor._commit_batch_updates",
      "path": "action7_inbox.py",
      "summary": "Persists accumulated conversation logs and person status changes for current batch.",
      "mechanism": "Invokes commit_bulk_data with log upserts and person updates, clears in-memory buffers, and returns commit counts.",
      "quality": "stable",
      "concerns": [
        "If commit fails silently, buffers are cleared; consider transactional safeguards."
      ],
      "opportunities": [
        "Capture metrics on rows affected per batch for throughput monitoring."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Used after processing each batch of conversations."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._handle_exception_with_save",
      "type": "function",
      "name": "InboxProcessor._handle_exception_with_save",
      "path": "action7_inbox.py",
      "summary": "Attempts final persistence when batch processing raises exceptions, handling session cascade errors.",
      "mechanism": "Logs warning, retries commit_bulk_data, escalates session death cascade via MaxApiFailuresExceededError, and returns counts otherwise.",
      "quality": "monitor",
      "concerns": [
        "Relies on string matching to detect session cascade; fragile against message changes."
      ],
      "opportunities": [
        "Expose structured error codes from commit_bulk_data to avoid string parsing."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Provides graceful degradation during API/DB faults."
    },
    {
      "id": "function:action7_inbox.InboxProcessor._check_cancellation_requested",
      "type": "function",
      "name": "InboxProcessor._check_cancellation_requested",
      "path": "action7_inbox.py",
      "summary": "Checks cooperative cancellation flag to stop processing when timeout wrappers request abort.",
      "mechanism": "Imports core.cancellation.is_cancel_requested and returns its value, defaulting to False on import errors.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Consider caching cancellation function reference to avoid repeated imports."
      ],
      "tests": "action7_inbox_module_tests",
      "notes": "Invoked within long-running loops to respect global cancellation."
    },
    {
      "id": "file:action8_messaging.py",
      "type": "file",
      "name": "action8_messaging.py",
      "path": "action8_messaging.py",
      "summary": "Messaging automation engine for Action 8, handling candidate selection, personalized template application, and Microsoft Graph delivery.",
      "mechanism": "Coordinates SessionManager resources, fetches eligible matches, applies messaging heuristics, batches database commits, and triggers MS To-Do reminders with layered recovery decorators.",
      "quality": "monitor",
      "concerns": [
        "Monolithic module with numerous responsibilities; difficult to unit test top-level flow end-to-end."
      ],
      "opportunities": [
        "Split orchestration, template selection, and delivery into dedicated components to simplify reasoning."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Initial mapping covers main orchestration and candidate processing loops."
    },
    {
      "id": "function:action8_messaging.send_messages_to_matches",
      "type": "function",
      "name": "send_messages_to_matches",
      "path": "action8_messaging.py",
      "summary": "Primary Action 8 workflow orchestrating candidate retrieval, messaging loop execution, commits, cleanup, and performance logging.",
      "mechanism": "Validates prerequisites, initializes resources, executes main processing loop, performs final commit and cleanup, and logs metrics under layered resilience decorators (connection, circuit breaker, graceful degradation).",
      "quality": "monitor",
      "concerns": [
        "Broad exception handling aggregates many failure modes; success flag depends on multiple mutable counters."
      ],
      "opportunities": [
        "Introduce structured result object and targeted telemetry to clarify failure causes."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Called by Action 8 menu handler; returns False on critical DB or prereq failure."
    },
    {
      "id": "function:action8_messaging._execute_main_processing_loop",
      "type": "function",
      "name": "_execute_main_processing_loop",
      "path": "action8_messaging.py",
      "summary": "Configures batch settings and delegates candidate iteration to _process_all_candidates.",
      "mechanism": "Builds BatchConfig with commit, memory, and rate limits then calls _process_all_candidates, returning its aggregated result dict.",
      "quality": "stable",
      "concerns": [
        "Batch thresholds are hardcoded; tuning requires code change."
      ],
      "opportunities": [
        "Surface batch sizing via configuration to allow experimentation."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Thin wrapper keeping main workflow readable."
    },
    {
      "id": "function:action8_messaging._process_all_candidates",
      "type": "function",
      "name": "_process_all_candidates",
      "path": "action8_messaging.py",
      "summary": "Iterates through messaging candidates, handling browser health, resource management, and batching while calling per-person processing.",
      "mechanism": "Initializes counters/state, loops over persons, performs browser checks, runs _process_single_candidate_iteration, and accumulates results until halting conditions met.",
      "quality": "monitor",
      "concerns": [
        "Loop intertwines error handling, resource management, and metric updates, making behavior hard to reason about."
      ],
      "opportunities": [
        "Refactor to isolate health checks and batching into helper strategies for easier testing."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Returns aggregated counts plus pending commit payloads."
    },
    {
      "id": "function:action8_messaging._process_single_candidate_iteration",
      "type": "function",
      "name": "_process_single_candidate_iteration",
      "path": "action8_messaging.py",
      "summary": "Processes one person: checks send limits, retrieves history, generates/sends message, updates counters, and triggers batch commits when needed.",
      "mechanism": "Applies send limit and halt checks, gathers latest logs, invokes _process_single_person, updates counters via _update_counters_and_collect_data, and commits when thresholds met.",
      "quality": "monitor",
      "concerns": [
        "Relies on many globals (_check_message_send_limit, _update_counters_and_collect_data); failures bubble up via dict flags."
      ],
      "opportunities": [
        "Consider turning result dict into dataclass and injecting dependencies for clarity."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Central per-person processing hook; cascades stop on MaxApiFailuresExceededError."
    },
    {
      "id": "function:action8_messaging._handle_main_processing_exception",
      "type": "function",
      "name": "_handle_main_processing_exception",
      "path": "action8_messaging.py",
      "summary": "Handles top-level exceptions by mapping to overall success flag and forcing resource cleanup.",
      "mechanism": "Delegates to _handle_action8_exception for logging/severity mapping, then attempts emergency resource cleanup with fallback logging.",
      "quality": "stable",
      "concerns": [
        "Cleanup failures are logged but not surfaced; could mask resource leaks."
      ],
      "opportunities": [
        "Track cleanup outcomes in telemetry to detect recurring failures."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Used in overarching try/except around main loop."
    },
    {
      "id": "function:action8_messaging._process_single_person",
      "type": "function",
      "name": "_process_single_person",
      "path": "action8_messaging.py",
      "summary": "End-to-end per-person pipeline: eligibility checks, template selection, message formatting, API send/simulate, and staging DB updates.",
      "mechanism": "Validates halt signals, determines message via status/sequence helpers, formats content (personalizer fallback), enforces mode filters, calls messaging API, and prepares conversation log plus status update.",
      "quality": "monitor",
      "concerns": [
        "Large try/except block mixes control flow with error categorization, obscuring recoverable vs fatal failures."
      ],
      "opportunities": [
        "Extract state machine style helper to clarify stop reasons vs hard errors."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Raises StopIteration with status tokens to signal skip reasons back to caller."
    },
    {
      "id": "function:action8_messaging._handle_person_status",
      "type": "function",
      "name": "_handle_person_status",
      "path": "action8_messaging.py",
      "summary": "Dispatches messaging behavior based on Person.status, handling DESIST acknowledgments and ACTIVE sequencing.",
      "mechanism": "Routes DESIST users to acknowledgement workflow or ACTIVE users through reply/interval checks before invoking message sequencing helper.",
      "quality": "stable",
      "concerns": [
        "Relies on StopIteration for control flow; future contributors must preserve convention."
      ],
      "opportunities": [
        "Replace StopIteration signaling with explicit Result object for readability."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Returns template selection reason alongside DNA/FamilyTree handles for downstream formatting."
    },
    {
      "id": "function:action8_messaging._determine_message_to_send",
      "type": "function",
      "name": "_determine_message_to_send",
      "path": "action8_messaging.py",
      "summary": "Chooses next script message using sequencing history, tree state, and A/B testing hooks.",
      "mechanism": "Extracts last script details, invokes determine_next_message_type, applies variant/ confidence selectors, and logs template selection reason.",
      "quality": "monitor",
      "concerns": [
        "Sequencing logic spans multiple helpers; difficult to reason about fallback order without tracing logs."
      ],
      "opportunities": [
        "Capture sequencing decisions in telemetry to audit experimentation impact."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Raises StopIteration when sequencing disallows additional messages."
    },
    {
      "id": "function:action8_messaging._check_message_interval",
      "type": "function",
      "name": "_check_message_interval",
      "path": "action8_messaging.py",
      "summary": "Enforces minimum plus adaptive wait interval between scripted outbound messages.",
      "mechanism": "Normalizes timestamps, compares against MIN_MESSAGE_INTERVAL and calculate_adaptive_interval result, raising StopIteration when threshold not met.",
      "quality": "monitor",
      "concerns": [
        "StopIteration used for flow control; datetime failures collapse into skip with generic reason."
      ],
      "opportunities": [
        "Factor interval evaluation into pure function for easier unit testing."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Adaptive logic active only in production mode via config schema knobs."
    },
    {
      "id": "function:action8_messaging._check_mode_filtering",
      "type": "function",
      "name": "_check_mode_filtering",
      "path": "action8_messaging.py",
      "summary": "Applies app-mode specific recipient filters (testing vs production) before sending.",
      "mechanism": "Compares person profile IDs against configured testing profile based on app_mode, returning send flag and skip reason token.",
      "quality": "stable",
      "concerns": [
        "Depends on config_schema.testing_profile_id being populated for testing mode; missing config forces skip."
      ],
      "opportunities": [
        "Surface explicit diagnostic when production mode still targets test profile."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Used inside _process_single_person prior to API invocation."
    },
    {
      "id": "function:action8_messaging._send_or_simulate_message",
      "type": "function",
      "name": "_send_or_simulate_message",
      "path": "action8_messaging.py",
      "summary": "Executes real API send via SessionManager or fabricates skip status in dry-run/testing scenarios.",
      "mechanism": "Calls _safe_api_call_with_validation wrapper around call_send_message_api when send flag true; otherwise returns skip token and synthetic conversation ID.",
      "quality": "stable",
      "concerns": [
        "Error handling collapses all API validation failures into single generic status."
      ],
      "opportunities": [
        "Differentiate API transport vs schema failures for richer telemetry alerts."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Ensures simulated runs still produce deterministic conversation IDs for logging."
    },
    {
      "id": "function:action8_messaging._prepare_conversation_log_entry",
      "type": "function",
      "name": "_prepare_conversation_log_entry",
      "path": "action8_messaging.py",
      "summary": "Constructs ConversationLog ORM object capturing outbound script message details.",
      "mechanism": "Validates template mapping, requires effective conversation ID, composes truncated content and enhanced status metadata before instantiating ConversationLog.",
      "quality": "stable",
      "concerns": [
        "Fails with StopIteration on missing template ID; upstream callers must catch to prevent crashes."
      ],
      "opportunities": [
        "Migrate to dataclass payload then convert to ORM in commit layer to reduce ORM coupling."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Used for both real sends and simulated skips to record activity."
    },
    {
      "id": "function:action8_messaging._determine_final_status",
      "type": "function",
      "name": "_determine_final_status",
      "path": "action8_messaging.py",
      "summary": "Maps API/message outcome to standardized status token and optional Person status update.",
      "mechanism": "Treats delivered or skipped messages as sent/acked, archives person on Desist ACK, logs warnings for failures, and returns tuple for counter updates.",
      "quality": "stable",
      "concerns": [
        "Hardcodes status-string matching; new API statuses require manual updates."
      ],
      "opportunities": [
        "Centralize status taxonomy to avoid string drift across modules."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Feeds directly into _update_counters_and_collect_data."
    },
    {
      "id": "function:action8_messaging._update_counters_and_collect_data",
      "type": "function",
      "name": "_update_counters_and_collect_data",
      "path": "action8_messaging.py",
      "summary": "Aggregates messaging outcome counters and stages DB payloads based on status classification.",
      "mechanism": "Converts new log to dict, routes through sent/acked/error handlers, pushes payloads into batch collections, and updates overall success flag via error categorizer.",
      "quality": "stable",
      "concerns": [
        "Multiple mutable structures passed through; unit tests should guard against partial updates on exceptions."
      ],
      "opportunities": [
        "Introduce immutable result object to simplify reasoning about side effects."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Called for every processed person to maintain running totals."
    },
    {
      "id": "function:action8_messaging._initialize_action8_counters_and_config",
      "type": "function",
      "name": "_initialize_action8_counters_and_config",
      "path": "action8_messaging.py",
      "summary": "Constructs default counter values and control flags for an Action 8 run.",
      "mechanism": "Returns tuple of zeroed counters, processed counts, batch index, and critical error flag for caller unpacking.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Replace tuple with dataclass to improve readability of unpacking order."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Used immediately after prerequisite validation in send_messages_to_matches."
    },
    {
      "id": "function:action8_messaging._initialize_resource_management",
      "type": "function",
      "name": "_initialize_resource_management",
      "path": "action8_messaging.py",
      "summary": "Creates ResourceManager/ErrorCategorizer and registers batch collections for cleanup.",
      "mechanism": "Initializes tracked lists/dicts, wires cleanup hooks, and attaches critical monitoring alert hook.",
      "quality": "stable",
      "concerns": [
        "ResourceManager dependency opaque; failures in track_resource would propagate late."
      ],
      "opportunities": [
        "Return lightweight dataclass bundling structures for clearer downstream references."
      ],
      "tests": "action8_messaging_tests",
      "notes": "First stop before entering database session acquisition."
    },
    {
      "id": "function:action8_messaging._validate_action8_prerequisites",
      "type": "function",
      "name": "_validate_action8_prerequisites",
      "path": "action8_messaging.py",
      "summary": "Ensures system health, template availability, and profile context before run proceeds.",
      "mechanism": "Calls session health validator, ensures profile ID fallback, loads message templates, and returns status/profile tuple.",
      "quality": "monitor",
      "concerns": [
        "Profile ID fallback silently swaps to test ID; production issues may hide behind warning."
      ],
      "opportunities": [
        "Surface explicit telemetry when using debug profile to avoid silent misroutes."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Short-circuits Action 8 when prerequisites fail."
    },
    {
      "id": "function:action8_messaging._fetch_messaging_data",
      "type": "function",
      "name": "_fetch_messaging_data",
      "path": "action8_messaging.py",
      "summary": "Retrieves message templates map and eligible candidates for the current run.",
      "mechanism": "Invokes _get_simple_messaging_data with session_manager, handles cascade failures, counts candidates, and logs run limits.",
      "quality": "monitor",
      "concerns": [
        "Returns None triad on failure; callers must guard to avoid unpack errors."
      ],
      "opportunities": [
        "Refactor to return structured result with explicit error reason."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Provides total_candidates metric used for loop progress and summaries."
    },
    {
      "id": "function:action8_messaging._handle_critical_db_error",
      "type": "function",
      "name": "_handle_critical_db_error",
      "path": "action8_messaging.py",
      "summary": "Updates progress bar and skipped counters when a critical DB failure halts processing.",
      "mechanism": "Computes remaining candidates, updates progress bar description, increments skip tally, and returns remaining count.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Include telemetry event capturing failure context for postmortem analysis."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Called when commit failure flag persists in _process_all_candidates."
    },
    {
      "id": "function:action8_messaging._check_and_handle_browser_health",
      "type": "function",
      "name": "_check_and_handle_browser_health",
      "path": "action8_messaging.py",
      "summary": "Monitors browser session during loops and attempts recovery on failure.",
      "mechanism": "Every five iterations calls SessionManager.check_browser_health, triggers recovery or logs failure, and returns halt indicators.",
      "quality": "monitor",
      "concerns": [
        "Recovery logic tied to console logging; no structured telemetry for automated alerts."
      ],
      "opportunities": [
        "Emit structured health events for monitoring dashboards."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Feeds back into _process_all_candidates to decide on halting."
    },
    {
      "id": "function:action8_messaging._check_message_send_limit",
      "type": "function",
      "name": "_check_message_send_limit",
      "path": "action8_messaging.py",
      "summary": "Enforces per-run message send cap using combined sent and acked counters.",
      "mechanism": "Compares current totals to configured max, updates progress bar description once, and signals skip.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Return explicit enum instead of bool to distinguish hard stop vs skip."
      ],
      "tests": "action8_messaging_tests",
      "notes": "First guard executed in _process_single_candidate_iteration."
    },
    {
      "id": "function:action8_messaging._log_periodic_progress",
      "type": "function",
      "name": "_log_periodic_progress",
      "path": "action8_messaging.py",
      "summary": "Logs progress milestones every 5% or 100 candidates processed.",
      "mechanism": "Evaluates modulus threshold and records summary counts via logger.info when triggered.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Supplement with structured metrics for dashboards."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Used to provide operator feedback during long runs."
    },
    {
      "id": "function:action8_messaging._create_result_dict",
      "type": "function",
      "name": "_create_result_dict",
      "path": "action8_messaging.py",
      "summary": "Normalizes iteration outcome into a consistent dictionary for loop handling.",
      "mechanism": "Packages counters, batch number, critical flag, success flag, and continuation flag into dict consumed by caller.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Return typed dataclass for stricter access semantics."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Shared between normal iteration flow and exception paths."
    },
    {
      "id": "function:action8_messaging._should_commit_batch",
      "type": "function",
      "name": "_should_commit_batch",
      "path": "action8_messaging.py",
      "summary": "Evaluates whether batch thresholds require a database commit.",
      "mechanism": "Checks current size, memory usage, and item count against BatchConfig limits and returns boolean trigger.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Expose decision rationale for telemetry to tune thresholds."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Called within _handle_batch_commit_if_needed before invoking commit routine."
    },
    {
      "id": "function:action8_messaging._calculate_batch_memory",
      "type": "function",
      "name": "_calculate_batch_memory",
      "path": "action8_messaging.py",
      "summary": "Estimates current batch size and memory footprint to inform commit decisions.",
      "mechanism": "Uses sys.getsizeof on log and person update collections to compute combined count and memory usage in MB.",
      "quality": "monitor",
      "concerns": [
        "getsizeof underestimates nested structures; actual memory could exceed thresholds."
      ],
      "opportunities": [
        "Track rolling averages to calibrate more accurate thresholds."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Shared by batch commit logic and memory monitoring."
    },
    {
      "id": "function:action8_messaging._perform_batch_commit",
      "type": "function",
      "name": "_perform_batch_commit",
      "path": "action8_messaging.py",
      "summary": "Commits accumulated logs and person updates in batches with rollback safety.",
      "mechanism": "Bumps batch counter, invokes _safe_commit_with_rollback, clears buffers on success, logs batch metrics, or flags failure.",
      "quality": "monitor",
      "concerns": [
        "Failure path only logs critical message; caller must halt to prevent data loss."
      ],
      "opportunities": [
        "Return error details to support retry with reduced batch size."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Used by _handle_batch_commit_if_needed and final commit routines."
    },
    {
      "id": "function:action8_messaging._handle_batch_commit_if_needed",
      "type": "function",
      "name": "_handle_batch_commit_if_needed",
      "path": "action8_messaging.py",
      "summary": "Gatekeeper combining batch size checks, commit invocation, and error propagation.",
      "mechanism": "Computes batch metrics, calls _perform_batch_commit when thresholds exceeded, updates state, and returns error flags.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Return typed result to distinguish commit failure from skip."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Primary control point ensuring sequential commits respect limits."
    },
    {
      "id": "function:action8_messaging._log_message_creation_debug",
      "type": "function",
      "name": "_log_message_creation_debug",
      "path": "action8_messaging.py",
      "summary": "Provides debug logging for newly created outbound messages with template context.",
      "mechanism": "Fetches template key when available and logs mapping between person and template usage.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Include conversation ID for easier tracing across logs."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Invoked after _process_single_person to corroborate template decisions."
    },
    {
      "id": "function:action8_messaging._get_person_message_history",
      "type": "function",
      "name": "_get_person_message_history",
      "path": "action8_messaging.py",
      "summary": "Prefetches latest inbound/outbound conversation logs and recent template key for a person.",
      "mechanism": "Queries ConversationLog with joinedload, returns tuple used for interval checks and sequencing.",
      "quality": "stable",
      "concerns": [
        "Potential N+1 queries if eager loading misconfigured; rely on joinedload accuracy."
      ],
      "opportunities": [
        "Cache results during batch to avoid repeat lookups for same person."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Called each iteration before per-person processing."
    },
    {
      "id": "function:action8_messaging._update_messaging_performance",
      "type": "function",
      "name": "_update_messaging_performance",
      "path": "action8_messaging.py",
      "summary": "Feeds per-person duration into SessionManager performance tracker.",
      "mechanism": "Delegates to session_manager.performance_monitor when present, updating rolling averages and sample counts.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Emit explicit metric event for long-running outliers."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Supports performance telemetry for Action 8 throughput."
    },
    {
      "id": "function:action8_messaging._check_halt_signal",
      "type": "function",
      "name": "_check_halt_signal",
      "path": "action8_messaging.py",
      "summary": "Inspects global halt flag to prevent further processing during session cascades.",
      "mechanism": "Queries SessionManager.should_halt_operations, raises MaxApiFailuresExceededError with cascade count when set.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Surface halt reason for downstream logging context."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Used both at per-person and per-iteration entry points."
    },
    {
      "id": "function:action8_messaging._initialize_person_processing",
      "type": "function",
      "name": "_initialize_person_processing",
      "path": "action8_messaging.py",
      "summary": "Extracts identifiers and builds log prefix string for person processing.",
      "mechanism": "Uses safe_column_value to gather username, ID, status, and returns tuple for downstream logging.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Return small struct with attributes to reduce positional tuple usage."
      ],
      "tests": "action8_messaging_tests",
      "notes": "First step within _process_single_person after halt check."
    },
    {
      "id": "function:action8_messaging._check_person_eligibility",
      "type": "function",
      "name": "_check_person_eligibility",
      "path": "action8_messaging.py",
      "summary": "Filters out archived/blocked/deceased matches before messaging logic proceeds.",
      "mechanism": "Examines Person.status and raises StopIteration with skip token for disallowed statuses.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Extend to cover additional statuses like pending verification if introduced."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Keeps downstream logic focused on actionable matches."
    },
    {
      "id": "function:action8_messaging._handle_desist_status",
      "type": "function",
      "name": "_handle_desist_status",
      "path": "action8_messaging.py",
      "summary": "Handles DESIST contacts by determining whether to send acknowledgement template.",
      "mechanism": "Looks up User_Requested_Desist template ID, checks if already sent, and returns template key/reason or skip.",
      "quality": "stable",
      "concerns": [
        "Hardcoded template key; mismatch with DB name would raise StopIteration error."
      ],
      "opportunities": [
        "Centralize desist template key in configuration constants."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Used by _handle_person_status for DESIST workflow."
    },
    {
      "id": "function:action8_messaging._check_reply_received",
      "type": "function",
      "name": "_check_reply_received",
      "path": "action8_messaging.py",
      "summary": "Skips messaging when a recipient replied after the last script message or had manual response.",
      "mechanism": "Compares timestamps of last in/out logs, checks custom reply flag, and raises StopIteration with skip tokens when active dialogue detected.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Move datetime normalization into shared helper to reduce duplication."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Prevents automated follow-ups during active conversations."
    },
    {
      "id": "function:action8_messaging._get_last_script_message_details",
      "type": "function",
      "name": "_get_last_script_message_details",
      "path": "action8_messaging.py",
      "summary": "Extracts template name, timestamp, and status from most recent script-driven outbound log.",
      "mechanism": "Normalizes timestamp to UTC, handles missing template key gracefully, and returns tuple for sequencing helper.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Include last status directly in knowledge graph to aid analysis."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Feeds determine_next_message_type logic."
    },
    {
      "id": "function:action8_messaging.determine_next_message_type",
      "type": "function",
      "name": "determine_next_message_type",
      "path": "action8_messaging.py",
      "summary": "Evaluates conversation history and tree status to pick baseline template key.",
      "mechanism": "Analyzes last message metadata, conversation phase, and in-tree flag to return next step in script sequence.",
      "quality": "monitor",
      "concerns": [
        "Logic intertwined with multiple global constants; difficult to verify new branches."
      ],
      "opportunities": [
        "Externalize sequencing rules into configuration or DSL for easier experimentation."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Core decision point for message sequencing."
    },
    {
      "id": "function:action8_messaging.select_template_variant_ab_testing",
      "type": "function",
      "name": "select_template_variant_ab_testing",
      "path": "action8_messaging.py",
      "summary": "Performs A/B selection for initial templates using deterministic hash-based routing.",
      "mechanism": "Uses person ID hashing to assign variant buckets while respecting fallback to base template.",
      "quality": "stable",
      "concerns": [
        "Bucket assignment deterministic but undisclosed; ensure documentation for analysts."
      ],
      "opportunities": [
        "Parameterize bucketing strategy to support multi-variant experiments."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Invoked by _determine_message_to_send for first-contact sequences."
    },
    {
      "id": "function:action8_messaging.select_template_by_confidence",
      "type": "function",
      "name": "select_template_by_confidence",
      "path": "action8_messaging.py",
      "summary": "Chooses template variant based on DNA match confidence and tree context.",
      "mechanism": "Examines family_tree and dna_match metadata to switch between high/low confidence templates.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Include explicit confidence thresholds to align with analytics definitions."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Called when A/B testing returns base template key."
    },
    {
      "id": "function:action8_messaging.track_template_selection",
      "type": "function",
      "name": "track_template_selection",
      "path": "action8_messaging.py",
      "summary": "Logs template choices for later analytics review.",
      "mechanism": "Records template key, person id, and reason to telemetry tracker for experimentation metrics.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Integrate with prompt telemetry stream for unified reporting."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Called for every message selection to monitor distribution."
    },
    {
      "id": "function:action8_messaging._add_tree_statistics_to_format_data",
      "type": "function",
      "name": "_add_tree_statistics_to_format_data",
      "path": "action8_messaging.py",
      "summary": "Augments template format data with family tree statistics and shared ethnicity context.",
      "mechanism": "Fetches tree metrics and optional ethnicity commonality, handling missing data with safe defaults.",
      "quality": "monitor",
      "concerns": [
        "Multiple DB lookups per person may affect performance if caching disabled."
      ],
      "opportunities": [
        "Cache stats per run to avoid repeated aggregate queries."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Supports personalization in _prepare_message_format_data."
    },
    {
      "id": "function:action8_messaging._prepare_message_format_data",
      "type": "function",
      "name": "_prepare_message_format_data",
      "path": "action8_messaging.py",
      "summary": "Builds dictionary of personalization fields for message templates.",
      "mechanism": "Derives names, relationship info, tree stats, and optional phase-5 enhancements before returning format map.",
      "quality": "monitor",
      "concerns": [
        "Optional enhancer imports add silent failures; logging at warning level may be noisy."
      ],
      "opportunities": [
        "Memoize expensive stats per person to reduce repeated queries."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Provides data used by both standard and enhanced templates."
    },
    {
      "id": "function:action8_messaging._format_message_text",
      "type": "function",
      "name": "_format_message_text",
      "path": "action8_messaging.py",
      "summary": "Generates final message body via personalization engine or standard template formatting.",
      "mechanism": "Attempts enhanced personalizer with genealogical data, falls back to str.format with error handling for missing keys.",
      "quality": "monitor",
      "concerns": [
        "Enhanced personalizer exceptions caught broadly; difficult to trace formatting issues."
      ],
      "opportunities": [
        "Collect structured failure reasons to iterate on enhanced templates."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Throws StopIteration with error tokens when formatting fails."
    },
    {
      "id": "function:action8_messaging._prepare_log_dict",
      "type": "function",
      "name": "_prepare_log_dict",
      "path": "action8_messaging.py",
      "summary": "Transforms ConversationLog ORM object into plain dict for bulk commit.",
      "mechanism": "Delegates to _convert_log_object_to_dict, returns tuple of dict/status flag for downstream handling.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Return dataclass with explicit fields instead of tuple."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Ensures batch commits interact with JSON-serializable payloads."
    },
    {
      "id": "function:action8_messaging._convert_log_object_to_dict",
      "type": "function",
      "name": "_convert_log_object_to_dict",
      "path": "action8_messaging.py",
      "summary": "Serializes SQLAlchemy ConversationLog into dictionary ensuring timestamp normalization.",
      "mechanism": "Iterates mapped columns, validates required keys, enforces UTC timestamp, and returns dict ready for commit.",
      "quality": "monitor",
      "concerns": [
        "Broad exception logging may hide systematic schema drift issues."
      ],
      "opportunities": [
        "Validate schema at startup to prevent runtime errors."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Supports both sent and skipped log recording."
    },
    {
      "id": "function:action8_messaging._handle_sent_status",
      "type": "function",
      "name": "_handle_sent_status",
      "path": "action8_messaging.py",
      "summary": "Updates sent counter and queues log dict for commit when message delivered.",
      "mechanism": "Appends log dict to batch list when present and increments counters.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": "action8_messaging_tests",
      "notes": "Used within _update_counters_and_collect_data for sent outcomes."
    },
    {
      "id": "function:action8_messaging._handle_acked_status",
      "type": "function",
      "name": "_handle_acked_status",
      "path": "action8_messaging.py",
      "summary": "Processes desist acknowledgement outcome, staging log and person status update.",
      "mechanism": "Appends log dict, stores person status tuple for later commit, and increments ack counter.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": "action8_messaging_tests",
      "notes": "Keeps ack totals separate from standard sent counts."
    },
    {
      "id": "function:action8_messaging._handle_error_or_skip_status",
      "type": "function",
      "name": "_handle_error_or_skip_status",
      "path": "action8_messaging.py",
      "summary": "Categorizes non-sent outcomes, updates counters, and triggers monitoring alerts when needed.",
      "mechanism": "Uses error_categorizer to label status, queues logs for skips, increments error counts, and updates overall success flag.",
      "quality": "monitor",
      "concerns": [
        "Relies on string parsing of status tokens; mismatches may fall into warning path."
      ],
      "opportunities": [
        "Replace string-based taxonomy with enum to avoid drift."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Supports monitoring integration for technical vs business skips."
    },
    {
      "id": "function:action8_messaging._safe_commit_with_rollback",
      "type": "function",
      "name": "_safe_commit_with_rollback",
      "path": "action8_messaging.py",
      "summary": "Wraps commit_bulk_data execution with rollback and retry logging for Action 8 batches.",
      "mechanism": "Attempts commit_bulk_data, rolls back on failure, logs context, and returns tuple with success flag and error info.",
      "quality": "monitor",
      "concerns": [
        "Relies on outer caller to halt on repeated failures; no retry logic inside helper."
      ],
      "opportunities": [
        "Integrate with enhanced recovery decorators for DB commits."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Shared by batch commit and final commit flows."
    },
    {
      "id": "function:action8_messaging._handle_action8_exception",
      "type": "function",
      "name": "_handle_action8_exception",
      "path": "action8_messaging.py",
      "summary": "Classifies top-level exceptions, logs appropriately, and signals failure.",
      "mechanism": "Checks exception type against known Action 8 errors, logs with severity, and always returns False for overall success.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Return structured error code for telemetry correlation."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Used by _handle_main_processing_exception to decide fallback behavior."
    },
    {
      "id": "function:action8_messaging._log_final_summary",
      "type": "function",
      "name": "_log_final_summary",
      "path": "action8_messaging.py",
      "summary": "Prints final run statistics including counts, error breakdown, and runtime.",
      "mechanism": "Calculates runtime, logs totals, queries error_categorizer summary, and handles logging exceptions gracefully.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Emit JSON summary to telemetry file for later analysis."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Called from _perform_final_cleanup."
    },
    {
      "id": "function:action8_messaging._perform_final_commit",
      "type": "function",
      "name": "_perform_final_commit",
      "path": "action8_messaging.py",
      "summary": "Flushes any remaining batch data after main loop completes.",
      "mechanism": "Invokes _safe_commit_with_rollback for final batch, clears buffers on success, logs final batch metrics, signals success flag.",
      "quality": "monitor",
      "concerns": [
        "Failure leaves buffered data unapplied without retry."
      ],
      "opportunities": [
        "Add retry with smaller batch size to reduce data loss risk."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Returns updated batch number for reporting."
    },
    {
      "id": "function:action8_messaging._perform_final_cleanup",
      "type": "function",
      "name": "_perform_final_cleanup",
      "path": "action8_messaging.py",
      "summary": "Releases DB session, adjusts skipped counts, and emits final summary logs.",
      "mechanism": "Returns session to manager, adds skipped count for unprocessed candidates on failure, and calls _log_final_summary.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Incorporate telemetry flush ensuring summary captured externally."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Final step before resource cleanup in send_messages_to_matches."
    },
    {
      "id": "function:action8_messaging._perform_resource_cleanup",
      "type": "function",
      "name": "_perform_resource_cleanup",
      "path": "action8_messaging.py",
      "summary": "Invokes ResourceManager cleanup routines and logs any failures.",
      "mechanism": "Calls cleanup_resources and trigger_garbage_collection with protective logging wrappers.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Track cleanup duration to detect slow resource release."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Executed after final cleanup regardless of overall success."
    },
    {
      "id": "function:action8_messaging._log_performance_summary",
      "type": "function",
      "name": "_log_performance_summary",
      "path": "action8_messaging.py",
      "summary": "Finalizes performance monitoring, logging runtime, memory, and API call counts.",
      "mechanism": "Calls stop_advanced_monitoring, logs metrics, and handles exceptions gracefully to avoid masking run results.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Push performance summary to telemetry file for historical tracking."
      ],
      "tests": "action8_messaging_tests",
      "notes": "Completes instrumentation pipeline when send_messages_to_matches finishes."
    },
    {
      "id": "file:run_all_tests.py",
      "type": "file",
      "name": "run_all_tests.py",
      "path": "run_all_tests.py",
      "summary": "Test suite entry script coordinating lint checks, module discovery, execution, and reporting.",
      "mechanism": "Enforces virtualenv usage, parses CLI flags, orchestrates sequential or parallel test execution, and aggregates performance and log analytics.",
      "quality": "stable",
      "concerns": [
        "Parallel execution assumes module tests are thread-safe."
      ],
      "opportunities": [
        "Extract argument parsing into a dedicated helper for easier extension."
      ],
      "tests": null,
      "notes": "Main CLI entry; supports log-analysis only mode."
    },
    {
      "id": "function:run_all_tests.main",
      "type": "function",
      "name": "main",
      "path": "run_all_tests.py",
      "summary": "Drives comprehensive test run including environment prep, execution, and reporting.",
      "mechanism": "Fixes trailing whitespace, configures flags, optionally performs log analysis, coordinates discovery and execution, prints summaries, and returns success state.",
      "quality": "stable",
      "concerns": [
        "Sequential pass count recomputation could drift if results are mutated later."
      ],
      "opportunities": [
        "Refactor reporting into reusable formatter for CI integration."
      ],
      "tests": null,
      "notes": "Invoked via __main__ guard and callable from other tooling."
    },
    {
      "id": "function:run_all_tests._setup_test_environment",
      "type": "function",
      "name": "_setup_test_environment",
      "path": "run_all_tests.py",
      "summary": "Parses CLI flags and sets environment toggles before running tests.",
      "mechanism": "Checks for --fast and --benchmark options, verifies psutil availability, and sets SKIP_* environment variables before returning execution flags.",
      "quality": "stable",
      "concerns": [
        "Monitoring quietly disables itself when psutil is missing."
      ],
      "opportunities": [
        "Consider using argparse for clearer usage messaging."
      ],
      "tests": null,
      "notes": "Called early from main to gate later features."
    },
    {
      "id": "function:run_all_tests._print_test_header",
      "type": "function",
      "name": "_print_test_header",
      "path": "run_all_tests.py",
      "summary": "Outputs suite banner describing execution modes.",
      "mechanism": "Prints header text and indicates fast or benchmark mode based on parsed flags.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Centralize shared CLI messaging helpers across scripts."
      ],
      "tests": null,
      "notes": "Presentation-only helper invoked from main."
    },
    {
      "id": "function:run_all_tests._run_pre_test_checks",
      "type": "function",
      "name": "_run_pre_test_checks",
      "path": "run_all_tests.py",
      "summary": "Runs Ruff linter unless explicitly skipped.",
      "mechanism": "Honors --skip-linter flag and otherwise invokes run_linter to enforce hygiene before continuing the suite.",
      "quality": "stable",
      "concerns": [
        "Blocking lint run adds latency during frequent local iterations."
      ],
      "opportunities": [
        "Cache lint results or provide --lint=skip option for rapid debugging."
      ],
      "tests": null,
      "notes": "Returns False to abort when blocking lint failures occur."
    },
    {
      "id": "function:run_all_tests.run_linter",
      "type": "function",
      "name": "run_linter",
      "path": "run_all_tests.py",
      "summary": "Executes Ruff auto-fix and blocking rule checks prior to running tests.",
      "mechanism": "Runs Ruff fix-all, enforces critical error selection, prints diagnostic statistics, and aborts on blocking violations.",
      "quality": "stable",
      "concerns": [
        "Configured timeouts may be tight for large repositories."
      ],
      "opportunities": [
        "Emit structured lint summary for CI dashboards."
      ],
      "tests": null,
      "notes": "Called through _run_pre_test_checks before module discovery."
    },
    {
      "id": "function:run_all_tests.run_quality_checks",
      "type": "function",
      "name": "run_quality_checks",
      "path": "run_all_tests.py",
      "summary": "Runs CodeQualityChecker across curated files and aggregates scores for reporting.",
      "mechanism": "Instantiates CodeQualityChecker, iterates through a hard-coded file list when present, accumulates quality scores, and flags failure when the average dips below 70.",
      "quality": "stable",
      "concerns": [
        "Static file list may fall out of sync with actual critical modules."
      ],
      "opportunities": [
        "Allow configuration or reuse discovery to select analysis targets dynamically."
      ],
      "tests": null,
      "notes": "Returns a success flag and score tuples; exceptions degrade gracefully to a soft pass."
    },
    {
      "id": "function:run_all_tests._discover_and_prepare_modules",
      "type": "function",
      "name": "_discover_and_prepare_modules",
      "path": "run_all_tests.py",
      "summary": "Discovers test modules and collects descriptions for reporting.",
      "mechanism": "Uses discovery helpers to list modules, deduplicates order, optimizes fast-mode sequencing, extracts docstring descriptions, and builds module-description tuples.",
      "quality": "stable",
      "concerns": [
        "Docstring parsing is heuristic and may miss unconventional formats."
      ],
      "opportunities": [
        "Persist discovery cache to reduce repeated filesystem scans."
      ],
      "tests": null,
      "notes": "Prints module counts and enhanced description coverage."
    },
    {
      "id": "function:run_all_tests._execute_tests",
      "type": "function",
      "name": "_execute_tests",
      "path": "run_all_tests.py",
      "summary": "Executes test modules sequentially or in parallel while gathering metrics.",
      "mechanism": "Chooses between run_tests_parallel and sequential loop, tracks metrics, updates ordering history, and returns aggregated results with counts.",
      "quality": "stable",
      "concerns": [
        "Sequential loop forces monitoring, which can add overhead to quick runs."
      ],
      "opportunities": [
        "Share execution logic between sequential and parallel paths to reduce drift."
      ],
      "tests": null,
      "notes": "Central coordination point for execution strategy."
    },
    {
      "id": "function:run_all_tests.run_module_tests",
      "type": "function",
      "name": "run_module_tests",
      "path": "run_all_tests.py",
      "summary": "Runs a module's comprehensive tests with optional performance and quality analysis.",
      "mechanism": "Starts performance monitoring when enabled, executes module in subprocess, parses output for success metrics, runs code quality checks, and prints status summary.",
      "quality": "stable",
      "concerns": [
        "Output parsing depends on specific message patterns that may change."
      ],
      "opportunities": [
        "Adopt structured IPC or JSON to report results without string heuristics."
      ],
      "tests": null,
      "notes": "Used by both sequential loop and parallel executor."
    },
    {
      "id": "function:run_all_tests.run_tests_parallel",
      "type": "function",
      "name": "run_tests_parallel",
      "path": "run_all_tests.py",
      "summary": "Executes module test suites concurrently using a thread pool.",
      "mechanism": "Determines worker count, submits run_module_tests tasks, waits for completion, and aggregates success counts and metrics from futures.",
      "quality": "stable",
      "concerns": [
        "Thread-based execution assumes suites are free of shared-resource conflicts."
      ],
      "opportunities": [
        "Evaluate process-based parallelism to isolate interpreter state."
      ],
      "tests": null,
      "notes": "Activated when --fast flag is present."
    },
    {
      "id": "function:run_all_tests._print_basic_summary",
      "type": "function",
      "name": "_print_basic_summary",
      "path": "run_all_tests.py",
      "summary": "Prints overall statistics for the completed test run.",
      "mechanism": "Calculates success rate and outputs duration, test totals, and pass versus fail counts.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Emit machine-readable summary alongside console output."
      ],
      "tests": null,
      "notes": "Called for both sequential and parallel runs."
    },
    {
      "id": "function:run_all_tests._print_performance_metrics",
      "type": "function",
      "name": "_print_performance_metrics",
      "path": "run_all_tests.py",
      "summary": "Reports averaged performance metrics and saves history when benchmarking is enabled.",
      "mechanism": "Aggregates memory and CPU usage from module metrics, computes parallel efficiency, prints optimization suggestions, and persists metrics to JSON when requested.",
      "quality": "stable",
      "concerns": [
        "Sampling frequency may underrepresent short-lived spikes in resource usage."
      ],
      "opportunities": [
        "Allow configurable retention and opt-out for metrics persistence."
      ],
      "tests": null,
      "notes": "Only invoked when monitoring is enabled."
    },
    {
      "id": "function:run_all_tests._print_final_results",
      "type": "function",
      "name": "_print_final_results",
      "path": "run_all_tests.py",
      "summary": "Summarizes module pass and fail counts by category and flags issues.",
      "mechanism": "Lists failed modules, tallies enhanced versus standard modules, and prints celebratory or warning messaging based on outcomes.",
      "quality": "stable",
      "concerns": [
        "Relies on description mapping accuracy to classify enhanced modules."
      ],
      "opportunities": [
        "Link failed modules to troubleshooting docs or log excerpts."
      ],
      "tests": null,
      "notes": "Runs regardless of benchmark settings."
    },
    {
      "id": "function:run_all_tests._print_final_quality_summary",
      "type": "function",
      "name": "_print_final_quality_summary",
      "path": "run_all_tests.py",
      "summary": "Aggregates quality scores across modules and highlights distribution tiers.",
      "mechanism": "Extracts QualityMetrics from collected data, computes averages and thresholds, and prints counts of modules per tier with warnings for low scores.",
      "quality": "stable",
      "concerns": [
        "Modules without quality metrics are silently excluded from averages."
      ],
      "opportunities": [
        "Persist quality histogram for regression analysis over time."
      ],
      "tests": null,
      "notes": "Skips quietly when quality metrics are unavailable."
    },
    {
      "id": "function:run_all_tests.analyze_application_logs",
      "type": "function",
      "name": "analyze_application_logs",
      "path": "run_all_tests.py",
      "summary": "Parses Ancestry application logs for error counts and API timing insights.",
      "mechanism": "Loads log content, applies regex searches to tally errors, warnings, API timing records, and aggregates throughput metrics into a dictionary.",
      "quality": "stable",
      "concerns": [
        "Reads entire log file into memory, which may be expensive for long runs."
      ],
      "opportunities": [
        "Implement streaming analysis to handle multi-GB logs safely."
      ],
      "tests": null,
      "notes": "Defaults to Logs/app.log or LOG_FILE environment override."
    },
    {
      "id": "function:run_all_tests.format_log_analysis",
      "type": "function",
      "name": "format_log_analysis",
      "path": "run_all_tests.py",
      "summary": "Formats log analysis metrics into a multi-section textual report.",
      "mechanism": "Builds summary lines for errors, warnings, throughput, and timing stats, including estimated completion for remaining pages.",
      "quality": "stable",
      "concerns": [
        "Assumes a fixed workload of 802 pages when estimating completion time."
      ],
      "opportunities": [
        "Parameterize workload size or derive from log metadata."
      ],
      "tests": null,
      "notes": "Consumed by print_log_analysis and CLI flag handling."
    },
    {
      "id": "function:run_all_tests.print_log_analysis",
      "type": "function",
      "name": "print_log_analysis",
      "path": "run_all_tests.py",
      "summary": "Generates and prints the formatted log analysis report.",
      "mechanism": "Invokes analyze_application_logs and passes results to format_log_analysis before printing to stdout.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Provide option to export summary to file for CI artifacts."
      ],
      "tests": null,
      "notes": "Used by --analyze-logs mode or post-run reporting."
    },
    {
      "id": "function:run_all_tests._check_venv",
      "type": "function",
      "name": "_check_venv",
      "path": "run_all_tests.py",
      "summary": "Warns users when running outside an activated virtual environment and optionally aborts.",
      "mechanism": "Inspects sys prefixes to detect venv usage, prompts user for confirmation, and exits if declined.",
      "quality": "stable",
      "concerns": [
        "Blocks non-interactive runs by prompting for input."
      ],
      "opportunities": [
        "Provide override flag to skip the prompt during CI."
      ],
      "tests": null,
      "notes": "Invoked at import time before other setup occurs."
    },
    {
      "id": "function:run_all_tests._check_and_use_venv",
      "type": "function",
      "name": "_check_and_use_venv",
      "path": "run_all_tests.py",
      "summary": "Ensures execution under .venv by re-invoking the script with the environment's Python interpreter.",
      "mechanism": "Detects active venv, verifies .venv paths, and reruns the script through subprocess.run when needed, exiting with child status.",
      "quality": "stable",
      "concerns": [
        "Assumes default .venv layout; custom environments require manual activation."
      ],
      "opportunities": [
        "Allow environment path override via flag or environment variable."
      ],
      "tests": null,
      "notes": "Called during module import to guarantee dependencies available."
    },
    {
      "id": "function:run_all_tests._fix_trailing_whitespace",
      "type": "function",
      "name": "_fix_trailing_whitespace",
      "path": "run_all_tests.py",
      "summary": "Pre-flight hygiene step that strips trailing whitespace from targeted Python files.",
      "mechanism": "Iterates configured filenames, rewrites lines without trailing spaces, and silently skips missing or unreadable files.",
      "quality": "stable",
      "concerns": [
        "Currently hardcodes a single file list; may drift from actual lint requirements."
      ],
      "opportunities": [
        "Drive list from configuration or detect dynamically via lint output."
      ],
      "tests": null,
      "notes": "Invoked by main() before discovery to avoid lint noise."
    },
    {
      "id": "function:run_all_tests._invoke_ruff",
      "type": "function",
      "name": "_invoke_ruff",
      "path": "run_all_tests.py",
      "summary": "Executes Ruff CLI commands with timeout and output capture.",
      "mechanism": "Builds python -m ruff command, executes via subprocess.run with timeout handling, and returns CompletedProcess for callers to inspect.",
      "quality": "stable",
      "concerns": [
        "Timeout fallback suppresses failure details beyond warning message."
      ],
      "opportunities": [
        "Log timed-out commands to aid diagnosing slow lint operations."
      ],
      "tests": null,
      "notes": "Utility used by run_linter and _ruff_available."
    },
    {
      "id": "function:run_all_tests._ruff_available",
      "type": "function",
      "name": "_ruff_available",
      "path": "run_all_tests.py",
      "summary": "Detects Ruff availability by running ruff --version.",
      "mechanism": "Delegates to _invoke_ruff and inspects the return code to gate lint execution.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Cache results to avoid repeated version calls in a single run."
      ],
      "tests": null,
      "notes": "Called by run_linter before attempting lint passes."
    },
    {
      "id": "function:run_all_tests._print_tail",
      "type": "function",
      "name": "_print_tail",
      "path": "run_all_tests.py",
      "summary": "Prints the last non-empty lines of command output to keep logs concise.",
      "mechanism": "Filters blank lines, slices trailing subset, and emits them sequentially to stdout.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Parameterize whether to include headings for clarity."
      ],
      "tests": null,
      "notes": "Used when Ruff blocking rules fail to show relevant diagnostics."
    },
    {
      "id": "function:run_all_tests._print_nonempty_lines",
      "type": "function",
      "name": "_print_nonempty_lines",
      "path": "run_all_tests.py",
      "summary": "Outputs a capped set of non-empty lines from command stdout.",
      "mechanism": "Filters out blank lines, limits to configured count, and prints in order for readability.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Allow callers to control whether lines are taken from start or end of output."
      ],
      "tests": null,
      "notes": "Applied by run_linter for non-blocking diagnostics."
    },
    {
      "id": "function:run_all_tests._should_skip_system_file",
      "type": "function",
      "name": "_should_skip_system_file",
      "path": "run_all_tests.py",
      "summary": "Filters out runner and root __init__ modules during discovery scans.",
      "mechanism": "Checks filenames against a blocklist and treats only the project-root __init__.py as skippable so package initializers remain eligible.",
      "quality": "stable",
      "concerns": [
        "Hardcoded exclusions require maintenance when more infrastructure files are added."
      ],
      "opportunities": [
        "Drive the exclusion list from configuration shared with other tooling."
      ],
      "tests": null,
      "notes": "First guard applied in discover_test_modules."
    },
    {
      "id": "function:run_all_tests._should_skip_cache_or_temp_file",
      "type": "function",
      "name": "_should_skip_cache_or_temp_file",
      "path": "run_all_tests.py",
      "summary": "Skips cached, backup, temp, or virtualenv artifacts while crawling for tests.",
      "mechanism": "Converts the path to string and short-circuits when markers such as __pycache__, .venv, Logs, or backup suffixes are detected.",
      "quality": "stable",
      "concerns": [
        "Broad substring checks could miss newly introduced build directories."
      ],
      "opportunities": [
        "Share ignore logic with repo-level tooling like Ruff or git attributes."
      ],
      "tests": null,
      "notes": "Pairs with other skip helpers inside discover_test_modules."
    },
    {
      "id": "function:run_all_tests._should_skip_demo_file",
      "type": "function",
      "name": "_should_skip_demo_file",
      "path": "run_all_tests.py",
      "summary": "Drops demo or experimental scripts from the discovered test set.",
      "mechanism": "Lowercases filenames and looks for keywords like demo, prototype, experimental, or sandbox.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Expand markers list or accept overrides for one-off showcase modules."
      ],
      "tests": null,
      "notes": "Runs after cache exclusion when scanning files."
    },
    {
      "id": "function:run_all_tests._should_skip_interactive_file",
      "type": "function",
      "name": "_should_skip_interactive_file",
      "path": "run_all_tests.py",
      "summary": "Avoids running interactive-only utilities as part of the automated suite.",
      "mechanism": "Matches filenames against a small allowlist of interactive tools such as db_viewer.py and test_program_executor.py.",
      "quality": "stable",
      "concerns": [
        "List must stay in sync if more interactive helpers are introduced."
      ],
      "opportunities": [
        "Allow tagging files via metadata to mark them as interactive instead of hardcoding names."
      ],
      "tests": null,
      "notes": "Invoked for each candidate in discover_test_modules."
    },
    {
      "id": "function:run_all_tests._has_test_function",
      "type": "function",
      "name": "_has_test_function",
      "path": "run_all_tests.py",
      "summary": "Detects whether a module implements the standardized test entry point.",
      "mechanism": "Performs substring checks for run_comprehensive_tests definition or assignment to the shared runner factory.",
      "quality": "stable",
      "concerns": [
        "String search can produce false positives if mentioned in comments."
      ],
      "opportunities": [
        "Parse AST to ensure the function actually exists and adheres to signature expectations."
      ],
      "tests": null,
      "notes": "Used after file content is read inside discover_test_modules."
    },
    {
      "id": "function:run_all_tests.discover_test_modules",
      "type": "function",
      "name": "discover_test_modules",
      "path": "run_all_tests.py",
      "summary": "Locates all project modules that expose the standard run_comprehensive_tests hook.",
      "mechanism": "Walks the repository tree, skips infrastructure and temporary files via helper filters, reads Python source, and collects relative paths when the test hook string is found.",
      "quality": "stable",
      "concerns": [
        "Reading every Python file can be slow; large modules add I/O overhead."
      ],
      "opportunities": [
        "Cache discovery results or reuse git metadata to avoid scanning unchanged trees."
      ],
      "tests": null,
      "notes": "Feeds _discover_and_prepare_modules with a sorted module list."
    },
    {
      "id": "function:run_all_tests._should_skip_line",
      "type": "function",
      "name": "_should_skip_line",
      "path": "run_all_tests.py",
      "summary": "Determines whether a source line should be ignored when parsing module docstrings.",
      "mechanism": "Treats blank strings and comment-prefixed lines as ignorable to find meaningful docstring content quickly.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Extend skipping rules to handle encoding declarations or type ignore pragmas."
      ],
      "tests": null,
      "notes": "Helper for _parse_docstring_lines."
    },
    {
      "id": "function:run_all_tests._extract_docstring_start",
      "type": "function",
      "name": "_extract_docstring_start",
      "path": "run_all_tests.py",
      "summary": "Captures text immediately following opening triple quotes of a docstring.",
      "mechanism": "Searches the stripped line for \"\"\", appends trailing content into the accumulator, and signals that docstring processing has begun.",
      "quality": "stable",
      "concerns": [
        "Assumes module docstrings use double quotes and appear near file top."
      ],
      "opportunities": [
        "Support single-quoted triple strings for completeness."
      ],
      "tests": null,
      "notes": "Works alongside _extract_docstring_end inside _parse_docstring_lines."
    },
    {
      "id": "function:run_all_tests._extract_docstring_end",
      "type": "function",
      "name": "_extract_docstring_end",
      "path": "run_all_tests.py",
      "summary": "Collects docstring text that appears before closing triple quotes.",
      "mechanism": "Finds \"\"\" in the stripped line, grabs preceding content, appends it to the buffer, and tells the parser to stop.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Handle inline closing quotes on the same line as opening to simplify logic elsewhere."
      ],
      "tests": null,
      "notes": "Complement to _extract_docstring_start during parsing."
    },
    {
      "id": "function:run_all_tests._parse_docstring_lines",
      "type": "function",
      "name": "_parse_docstring_lines",
      "path": "run_all_tests.py",
      "summary": "Extracts the module docstring into a list of meaningful lines.",
      "mechanism": "Iterates file lines, skips comments via _should_skip_line, uses docstring start/end helpers to collect content, and trims whitespace-only entries.",
      "quality": "stable",
      "concerns": [
        "Stops at the first docstring only; modules with multiple headers are ignored."
      ],
      "opportunities": [
        "Extend to capture module-level metadata such as author or version tags."
      ],
      "tests": null,
      "notes": "Feeds extract_module_description before choosing display text."
    },
    {
      "id": "function:run_all_tests._is_valid_description_line",
      "type": "function",
      "name": "_is_valid_description_line",
      "path": "run_all_tests.py",
      "summary": "Screens docstring lines to ensure they contain descriptive content.",
      "mechanism": "Rejects separator lines or entries shorter than a threshold so reporting focuses on meaningful sentences.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Tune line-length threshold or add stopword filtering for cleaner output."
      ],
      "tests": null,
      "notes": "Called by _extract_first_meaningful_line."
    },
    {
      "id": "function:run_all_tests._clean_description_text",
      "type": "function",
      "name": "_clean_description_text",
      "path": "run_all_tests.py",
      "summary": "Normalizes module description strings by trimming redundant prefixes.",
      "mechanism": "Strips punctuation, removes module name echoes, and ensures text starts with a meaningful phrase.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Move cleanup heuristics into a reusable text utility if other tools need them."
      ],
      "tests": null,
      "notes": "Supports _extract_first_meaningful_line."
    },
    {
      "id": "function:run_all_tests._extract_first_meaningful_line",
      "type": "function",
      "name": "_extract_first_meaningful_line",
      "path": "run_all_tests.py",
      "summary": "Chooses the first descriptive docstring line for reporting.",
      "mechanism": "Iterates parsed lines, applies validation and cleanup helpers, and returns the earliest acceptable description for the module.",
      "quality": "stable",
      "concerns": [
        "Falls back to None when docstrings lack sufficiently long sentences."
      ],
      "opportunities": [
        "Consider joining multiple lines for richer summaries when available."
      ],
      "tests": null,
      "notes": "Called by extract_module_description."
    },
    {
      "id": "function:run_all_tests.extract_module_description",
      "type": "function",
      "name": "extract_module_description",
      "path": "run_all_tests.py",
      "summary": "Derives human-readable descriptions from module docstrings for reporting.",
      "mechanism": "Reads module source, feeds it to _parse_docstring_lines, and selects the first meaningful line via _extract_first_meaningful_line.",
      "quality": "stable",
      "concerns": [
        "Entire file read could be expensive for large modules and lacks caching."
      ],
      "opportunities": [
        "Cache descriptions to avoid repeated file reads across runs."
      ],
      "tests": null,
      "notes": "Used by _discover_and_prepare_modules when enriching module listings."
    },
    {
      "id": "function:run_all_tests._generate_module_description",
      "type": "function",
      "name": "_generate_module_description",
      "path": "run_all_tests.py",
      "summary": "Produces fallback descriptions from module naming conventions.",
      "mechanism": "Inspects module path patterns (core/, config/, *_utils.py, etc.) and synthesizes a human-friendly phrase when docstrings are absent.",
      "quality": "stable",
      "concerns": [
        "Pattern list may not cover new directory structures automatically."
      ],
      "opportunities": [
        "Allow modules to supply metadata files to override generated labels."
      ],
      "tests": null,
      "notes": "Called by run_module_tests to ensure every module has display text."
    },
    {
      "id": "function:run_all_tests._try_pattern_passed_failed",
      "type": "function",
      "name": "_try_pattern_passed_failed",
      "path": "run_all_tests.py",
      "summary": "Parses emoji-formatted pass/fail summaries to infer total tests run.",
      "mechanism": "Scans stdout for \"\u2705 Passed\" and \"\u274c Failed\" markers, handling split-line counts to return combined totals.",
      "quality": "stable",
      "concerns": [
        "Assumes emoji markers remain consistent across test output styles."
      ],
      "opportunities": [
        "Support configurable symbols for custom reporters."
      ],
      "tests": null,
      "notes": "First heuristic attempted by _extract_test_count_from_output."
    },
    {
      "id": "function:run_all_tests._try_pattern_tests_passed",
      "type": "function",
      "name": "_try_pattern_tests_passed",
      "path": "run_all_tests.py",
      "summary": "Detects X/Y tests passed style output and extracts the denominator.",
      "mechanism": "Splits lines containing \"tests passed\" and a slash, capturing the total count segment for reporting.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Handle localized language variants of the phrase."
      ],
      "tests": null,
      "notes": "Used when reporters print combined pass ratios."
    },
    {
      "id": "function:run_all_tests._try_pattern_passed_failed_ansi",
      "type": "function",
      "name": "_try_pattern_passed_failed_ansi",
      "path": "run_all_tests.py",
      "summary": "Removes ANSI color codes before parsing emoji pass/fail counts.",
      "mechanism": "Uses regex to strip escape sequences, then reuses the emoji markers to compute totals even with colored output.",
      "quality": "stable",
      "concerns": [
        "Limited to basic ANSI patterns and may miss nested sequences."
      ],
      "opportunities": [
        "Share escape removal utility with other log parsing helpers."
      ],
      "tests": null,
      "notes": "Fallback when reporters emit colorized status lines."
    },
    {
      "id": "function:run_all_tests._try_pattern_unittest_ran",
      "type": "function",
      "name": "_try_pattern_unittest_ran",
      "path": "run_all_tests.py",
      "summary": "Matches Python unittest \"Ran X tests in Ys\" style output.",
      "mechanism": "Strips ANSI codes, locates the word \"Ran\", and converts the following token into an integer count.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Support doctest and pytest variants that share similar phrasing."
      ],
      "tests": null,
      "notes": "Covers the default unittest runner format."
    },
    {
      "id": "function:run_all_tests._try_pattern_numbered_tests",
      "type": "function",
      "name": "_try_pattern_numbered_tests",
      "path": "run_all_tests.py",
      "summary": "Counts enumerated \"Test N:\" labels to infer total cases.",
      "mechanism": "Applies regex over cleaned lines to collect numeric suffixes from test headings and returns their cardinality.",
      "quality": "stable",
      "concerns": [
        "May undercount when numbering resets per section."
      ],
      "opportunities": [
        "Track highest observed test number as alternate heuristic."
      ],
      "tests": null,
      "notes": "Handles custom reporters that label each test sequentially."
    },
    {
      "id": "function:run_all_tests._try_pattern_number_followed_by_test",
      "type": "function",
      "name": "_try_pattern_number_followed_by_test",
      "path": "run_all_tests.py",
      "summary": "Searches for generic '<number> tests' phrases in output.",
      "mechanism": "Uses regex to capture digits preceding the word 'tests' (with optional qualifiers) and returns the parsed count.",
      "quality": "stable",
      "concerns": [
        "Can misinterpret unrelated statistics mentioning tests."
      ],
      "opportunities": [
        "Add context checks to ensure the line references execution results."
      ],
      "tests": null,
      "notes": "Broad safety net for varied textual summaries."
    },
    {
      "id": "function:run_all_tests._try_pattern_all_tests_completed",
      "type": "function",
      "name": "_try_pattern_all_tests_completed",
      "path": "run_all_tests.py",
      "summary": "Targets 'All X tests completed/passed' messaging to extract counts.",
      "mechanism": "Removes ANSI codes, then uses regex for \"All/Total <n> tests\" phrases tied to success words.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Expand vocabulary of success verbs (e.g., executed, verified)."
      ],
      "tests": null,
      "notes": "Useful for high-level success banners."
    },
    {
      "id": "function:run_all_tests._try_pattern_all_tests_passed_with_counts",
      "type": "function",
      "name": "_try_pattern_all_tests_passed_with_counts",
      "path": "run_all_tests.py",
      "summary": "Handles uppercase 'ALL TESTS PASSED' messages with adjacent counts.",
      "mechanism": "Detects the banner line and searches nearby output for 'Passed:' totals to report combined counts.",
      "quality": "stable",
      "concerns": [
        "Assumes count lines follow the banner; may miss asynchronous logs."
      ],
      "opportunities": [
        "Track last seen count while scanning to avoid second pass."
      ],
      "tests": null,
      "notes": "Catches celebratory all-pass summaries."
    },
    {
      "id": "function:run_all_tests._extract_count_from_line",
      "type": "function",
      "name": "_extract_count_from_line",
      "path": "run_all_tests.py",
      "summary": "Utility to parse numeric counts from lines containing a keyword.",
      "mechanism": "Strips ANSI codes, verifies the keyword is present, and slices the following token into an integer if possible.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Return both integer and original substring for richer diagnostics."
      ],
      "tests": null,
      "notes": "Shared by _find_passed_failed_counts."
    },
    {
      "id": "function:run_all_tests._find_passed_failed_counts",
      "type": "function",
      "name": "_find_passed_failed_counts",
      "path": "run_all_tests.py",
      "summary": "Searches output for explicit Passed:/Failed: counters.",
      "mechanism": "Iterates lines once, using _extract_count_from_line to capture counts and returning the pair when available.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Support additional keywords like Skipped for broader totals."
      ],
      "tests": null,
      "notes": "Feeds the final fallback pattern aggregator."
    },
    {
      "id": "function:run_all_tests._try_pattern_passed_failed_counts_any",
      "type": "function",
      "name": "_try_pattern_passed_failed_counts_any",
      "path": "run_all_tests.py",
      "summary": "Fallback heuristic that sums any discovered Passed:/Failed: totals.",
      "mechanism": "Calls _find_passed_failed_counts and, when counts exist, returns the combined total as a test count estimate.",
      "quality": "stable",
      "concerns": [
        "Can double-count when output contains historical summaries."
      ],
      "opportunities": [
        "Ignore lines flagged as summary archives or past runs."
      ],
      "tests": null,
      "notes": "Last-resort pattern in _extract_test_count_from_output."
    },
    {
      "id": "function:run_all_tests._check_for_failures_in_output",
      "type": "function",
      "name": "_check_for_failures_in_output",
      "path": "run_all_tests.py",
      "summary": "Post-processes stdout to confirm success flags and catch hidden failures.",
      "mechanism": "Splits output into lines and looks for failure indicators while ignoring benign 'Failed: 0' cases, flipping the success flag when evidence is found.",
      "quality": "stable",
      "concerns": [
        "Indicator list must stay current with new failure message formats."
      ],
      "opportunities": [
        "Log which indicator triggered the failure for faster triage."
      ],
      "tests": null,
      "notes": "Applied inside _analyze_test_output as a safety check."
    },
    {
      "id": "function:run_all_tests.save_performance_metrics",
      "type": "function",
      "name": "save_performance_metrics",
      "path": "run_all_tests.py",
      "summary": "Persists suite and module performance metrics to JSON history.",
      "mechanism": "Loads existing test_performance_metrics.json when present, appends the latest metrics snapshot capped to the most recent 50 runs, and writes formatted JSON back to disk with error handling.",
      "quality": "stable",
      "concerns": [
        "Lack of file locking could race when multiple runners execute concurrently."
      ],
      "opportunities": [
        "Stream metrics to a central analytics service for richer dashboards."
      ],
      "tests": null,
      "notes": "Invoked when benchmark mode is active to retain historical trends."
    },
    {
      "id": "function:run_all_tests.analyze_performance_trends",
      "type": "function",
      "name": "analyze_performance_trends",
      "path": "run_all_tests.py",
      "summary": "Evaluates collected metrics to suggest performance optimizations.",
      "mechanism": "Scans module metrics for slow duration, high memory, and high CPU usage outliers, adding textual hints and recommending parallel mode when total runtime is high.",
      "quality": "stable",
      "concerns": [
        "Thresholds are hard-coded and may need tuning for different hardware."
      ],
      "opportunities": [
        "Incorporate percentile analysis or failure correlations for smarter advice."
      ],
      "tests": null,
      "notes": "Returns suggestion strings consumed by _print_performance_metrics."
    },
    {
      "id": "class:run_all_tests.TestExecutionMetrics",
      "type": "class",
      "name": "TestExecutionMetrics",
      "path": "run_all_tests.py",
      "summary": "Dataclass capturing per-module execution timing, resource, and quality data.",
      "mechanism": "Stores module name, duration, success flag, test counts, resource usage, timestamps, optional error text, and embedded QualityMetrics.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Consider persisting additional percentiles for richer analytics."
      ],
      "tests": null,
      "notes": "Populated by _create_test_metrics based on subprocess results."
    },
    {
      "id": "class:run_all_tests.TestSuitePerformance",
      "type": "class",
      "name": "TestSuitePerformance",
      "path": "run_all_tests.py",
      "summary": "Dataclass tracking aggregate suite metrics for benchmark runs.",
      "mechanism": "Captures totals for duration, tests, pass/fail counts, averaged resource usage, computed parallel efficiency, and optimization suggestions list.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Augment with percentile latency data for slowest modules."
      ],
      "tests": null,
      "notes": "Persisted to test_performance_metrics.json when benchmarking enabled."
    },
    {
      "id": "class:run_all_tests.TestExecutionConfig",
      "type": "class",
      "name": "TestExecutionConfig",
      "path": "run_all_tests.py",
      "summary": "Dataclass packaging execution parameters for _execute_tests.",
      "mechanism": "Holds discovered modules, description mapping, monitoring toggles, and concurrency flags for downstream helpers.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Expose per-module overrides to tune instrumentation cost."
      ],
      "tests": null,
      "notes": "Constructed within main before invoking _execute_tests."
    },
    {
      "id": "class:run_all_tests.PerformanceMetricsConfig",
      "type": "class",
      "name": "PerformanceMetricsConfig",
      "path": "run_all_tests.py",
      "summary": "Dataclass for passing aggregated metrics into _print_performance_metrics.",
      "mechanism": "Bundles collected TestExecutionMetrics, totals, pass/fail counts, and flag state controlling output and persistence.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add optional percentile thresholds to target problematic modules."
      ],
      "tests": null,
      "notes": "Assembled in main when monitoring is enabled."
    },
    {
      "id": "class:run_all_tests.TestResultCache",
      "type": "class",
      "name": "TestResultCache",
      "path": "run_all_tests.py",
      "summary": "Utility class persisting prior test outcomes to skip unchanged modules.",
      "mechanism": "Reads/writes JSON cache keyed by module, tracks MD5 file hashes, and exposes helpers for deciding if a module can be skipped.",
      "quality": "monitor",
      "concerns": [
        "Hash lookup assumes modules live alongside runner and may miss nested paths."
      ],
      "opportunities": [
        "Integrate with optimize_test_order to avoid re-running fast clean modules."
      ],
      "tests": null,
      "notes": "Test Infrastructure Todo #18 placeholder; not yet fully wired into execution path."
    },
    {
      "id": "function:run_all_tests.optimize_test_order",
      "type": "function",
      "name": "optimize_test_order",
      "path": "run_all_tests.py",
      "summary": "Reorders discovered modules based on historical duration and recent failures.",
      "mechanism": "Reads Logs/test_metrics_history.json, groups modules into fast, failed, slow, or unknown buckets, sorts by duration, and returns concatenated order for faster feedback.",
      "quality": "stable",
      "concerns": [
        "Falls back to legacy order when metrics file missing or malformed."
      ],
      "opportunities": [
        "Incorporate per-module flakiness weighting to surface unstable suites sooner."
      ],
      "tests": null,
      "notes": "Applied by _discover_and_prepare_modules when --fast flag supplied."
    },
    {
      "id": "function:run_all_tests.update_test_history",
      "type": "function",
      "name": "update_test_history",
      "path": "run_all_tests.py",
      "summary": "Persists execution duration and success booleans for future ordering heuristics.",
      "mechanism": "Loads Logs/test_metrics_history.json, maintains running averages and last run metadata, and writes updated JSON after each module completion.",
      "quality": "stable",
      "concerns": [
        "Lacks concurrency guard when parallel execution updates history simultaneously."
      ],
      "opportunities": [
        "Capture additional metrics like failure counts for smarter prioritization."
      ],
      "tests": null,
      "notes": "Invoked from sequential path inside _execute_tests."
    },
    {
      "id": "class:run_all_tests.PerformanceMonitor",
      "type": "class",
      "name": "PerformanceMonitor",
      "path": "run_all_tests.py",
      "summary": "Threaded sampler capturing psutil memory and CPU usage during test execution.",
      "mechanism": "Spawns background thread polling psutil.Process metrics every 100ms, aggregates average/peak usage, and exposes start/stop lifecycle methods.",
      "quality": "stable",
      "concerns": [
        "Polling strategy increases overhead on very short tests."
      ],
      "opportunities": [
        "Consider adaptive sampling or integration with psutil oneshot APIs."
      ],
      "tests": null,
      "notes": "Used by run_module_tests when monitoring enabled."
    },
    {
      "id": "function:run_all_tests._build_test_command",
      "type": "function",
      "name": "_build_test_command",
      "path": "run_all_tests.py",
      "summary": "Constructs subprocess invocation and environment for a module test run.",
      "mechanism": "Builds python command with optional coverage flags, clones environment variables, and sets RUN_INTERNAL_TESTS for designated modules.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Expose per-module timeout overrides alongside command construction."
      ],
      "tests": null,
      "notes": "Used by _run_test_subprocess to materialize command list."
    },
    {
      "id": "function:run_all_tests._run_quality_analysis",
      "type": "function",
      "name": "_run_quality_analysis",
      "path": "run_all_tests.py",
      "summary": "Executes code quality checks against a module when possible.",
      "mechanism": "Detects on-disk module file, instantiates CodeQualityChecker, and returns QualityMetrics or None on failure.",
      "quality": "stable",
      "concerns": [
        "Exceptions are swallowed, so persistent quality checker failures pass silently."
      ],
      "opportunities": [
        "Log suppressed errors to aid debugging when quality analysis fails."
      ],
      "tests": null,
      "notes": "Results feed _print_test_result quality output and final summary."
    },
    {
      "id": "function:run_all_tests._create_test_metrics",
      "type": "function",
      "name": "_create_test_metrics",
      "path": "run_all_tests.py",
      "summary": "Wraps subprocess results into a TestExecutionMetrics instance.",
      "mechanism": "Receives module name, result dictionary, optional QualityMetrics, and returns populated dataclass with resource stats and error message extraction.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Include per-module coverage data when coverage mode enabled."
      ],
      "tests": null,
      "notes": "Called by run_module_tests after parsing output."
    },
    {
      "id": "function:run_all_tests._create_error_metrics",
      "type": "function",
      "name": "_create_error_metrics",
      "path": "run_all_tests.py",
      "summary": "Fabricates failure metrics when monitoring is enabled but subprocess crashes.",
      "mechanism": "Creates minimal TestExecutionMetrics with zero counts, timestamps, and captured error message for reporting consistency.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Record exception types separately to aid failure triage."
      ],
      "tests": null,
      "notes": "Used in run_module_tests error handler."
    },
    {
      "id": "function:run_all_tests._run_test_subprocess",
      "type": "function",
      "name": "_run_test_subprocess",
      "path": "run_all_tests.py",
      "summary": "Runs a module's tests in a subprocess and enforces module-specific timeouts.",
      "mechanism": "Builds command/env, executes via subprocess.run with capture_output, synthesizes timeout failures into CompletedProcess, and returns duration plus start timestamp.",
      "quality": "stable",
      "concerns": [
        "Timeout list explicitly handles action8 only; consider configuration-driven thresholds."
      ],
      "opportunities": [
        "Surface captured stdout/stderr on timeout to simplify diagnosis."
      ],
      "tests": null,
      "notes": "Used by run_module_tests prior to monitoring aggregation."
    },
    {
      "id": "function:run_all_tests._analyze_test_output",
      "type": "function",
      "name": "_analyze_test_output",
      "path": "run_all_tests.py",
      "summary": "Interprets subprocess stdout/stderr to determine success and test counts.",
      "mechanism": "Combines output lines, checks return code, scans for failure markers, extracts textual test counts, and returns success flag plus numeric counts.",
      "quality": "stable",
      "concerns": [
        "Parsing relies on emoji markers that could change with future formatting tweaks."
      ],
      "opportunities": [
        "Adopt structured output contract from module test framework to reduce heuristics."
      ],
      "tests": null,
      "notes": "Results consumed by run_module_tests printing and metrics creation."
    },
    {
      "id": "function:run_all_tests._print_test_result",
      "type": "function",
      "name": "_print_test_result",
      "path": "run_all_tests.py",
      "summary": "Prints per-module status line with duration, test counts, and quality info.",
      "mechanism": "Formats success emoji, appends quality indicator string, prints quality violations when below threshold, and delegates failure detail printing if needed.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Provide quiet mode to reduce console noise during large suites."
      ],
      "tests": null,
      "notes": "Called by run_module_tests after analyzing output."
    },
    {
      "id": "function:run_all_tests._categorize_violation",
      "type": "function",
      "name": "_categorize_violation",
      "path": "run_all_tests.py",
      "summary": "Maps lint violation text to a coarse-grained category label.",
      "mechanism": "Scans violation strings for keywords such as 'too long', 'too complex', or 'missing type hint' and returns the corresponding category otherwise defaulting to 'Other'.",
      "quality": "stable",
      "concerns": [
        "Keyword matching will drift if lint message wording changes."
      ],
      "opportunities": [
        "Share taxonomy with CodeQualityChecker to keep categories synchronized."
      ],
      "tests": null,
      "notes": "Used by _print_quality_violations when grouping issues."
    },
    {
      "id": "function:run_all_tests._format_violation_message",
      "type": "function",
      "name": "_format_violation_message",
      "path": "run_all_tests.py",
      "summary": "Produces bullet-friendly text for a single quality violation.",
      "mechanism": "Extracts function names from violation strings when present and returns a formatted bullet line, falling back to the raw message otherwise.",
      "quality": "stable",
      "concerns": [
        "String splitting assumes apostrophe-delimited function names."
      ],
      "opportunities": [
        "Include severity or line numbers for richer debugging context."
      ],
      "tests": null,
      "notes": "Feeds display output inside _print_quality_violations."
    },
    {
      "id": "function:run_all_tests._print_quality_violations",
      "type": "function",
      "name": "_print_quality_violations",
      "path": "run_all_tests.py",
      "summary": "Outputs categorized snapshots of code quality issues when score below 95.",
      "mechanism": "Groups first few violations by category such as Length/Complexity and prints representative entries with indentation.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Link to detailed lint hints or documentation for recurring categories."
      ],
      "tests": null,
      "notes": "Invoked by _print_test_result."
    },
    {
      "id": "function:run_all_tests._format_quality_info",
      "type": "function",
      "name": "_format_quality_info",
      "path": "run_all_tests.py",
      "summary": "Generates status suffix summarizing quality score and violation counts.",
      "mechanism": "Returns warning, neutral, or pass indicator depending on score thresholds, including violation tallies when available.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add colorization toggle for easier scanning in supported terminals."
      ],
      "tests": null,
      "notes": "Used by _print_test_result to append quality summary."
    },
    {
      "id": "function:run_all_tests._print_failure_details",
      "type": "function",
      "name": "_print_failure_details",
      "path": "run_all_tests.py",
      "summary": "Displays trailing stderr/stdout lines for failed modules.",
      "mechanism": "Prints last few stderr lines, searches stdout for failure indicators, and outputs final lines to aid debugging.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Offer richer pattern matching to highlight assertion diffs automatically."
      ],
      "tests": null,
      "notes": "Called from _print_test_result when success flag false."
    },
    {
      "id": "function:run_all_tests._extract_numeric_test_count",
      "type": "function",
      "name": "_extract_numeric_test_count",
      "path": "run_all_tests.py",
      "summary": "Converts formatted test count strings into integers for metrics.",
      "mechanism": "Attempts regex extraction from textual counts, returning zero when unknown or parsing fails.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Record parse failures to encourage standardizing module output."
      ],
      "tests": null,
      "notes": "Used by _analyze_test_output to derive numeric counts."
    },
    {
      "id": "function:run_all_tests._extract_test_count_from_output",
      "type": "function",
      "name": "_extract_test_count_from_output",
      "path": "run_all_tests.py",
      "summary": "Heuristically determines test totals from captured stdout/stderr.",
      "mechanism": "Applies multiple pattern matchers targeting suite emoji output, pass/fail summaries, and fallback heuristics to return human-readable test count text.",
      "quality": "stable",
      "concerns": [
        "Relies on emoji markers and may fail for third-party output styles."
      ],
      "opportunities": [
        "Accept plugin hooks for modules to report counts explicitly."
      ],
      "tests": null,
      "notes": "Called by _analyze_test_output prior to numeric parse."
    },
    {
      "id": "function:main.menu",
      "type": "function",
      "name": "menu",
      "path": "main.py",
      "summary": "Renders the CLI menu, displays active log level, and returns the normalized user selection.",
      "mechanism": "Prints menu options, inspects console handler level when available, then reads stdin choice trimmed and lowercased for downstream dispatch.",
      "quality": "stable",
      "concerns": [
        "Blocking input handling complicates automated testing or headless execution."
      ],
      "opportunities": [
        "Inject configurable IO adapter so tests and headless runs can supply menu choices."
      ],
      "tests": null,
      "notes": "Used by the main loop each iteration to capture operator intent."
    },
    {
      "id": "function:main.clear_log_file",
      "type": "function",
      "name": "clear_log_file",
      "path": "main.py",
      "summary": "Clears the active file handler log by closing the handler and truncating the backing file.",
      "mechanism": "Searches logger handlers for FileHandler, flushes and closes it, rewrites the file empty, and reports success with the file path.",
      "quality": "stable",
      "concerns": [
        "Rebinding the file handler after truncation is implicit; silent failures could leave logging disabled."
      ],
      "opportunities": [
        "Reopen the handler automatically or surface explicit diagnostics when no file handler is attached."
      ],
      "tests": null,
      "notes": "Returns tuple of (success flag, log path) for callers that need follow-up messaging."
    },
    {
      "id": "function:main._delete_table_records",
      "type": "function",
      "name": "_delete_table_records",
      "path": "main.py",
      "summary": "Deletes records from a specific ORM table except the protected person id and logs the count removed.",
      "mechanism": "Issues SQLAlchemy bulk delete filtered by provided condition and coerces None responses to zero for consistent logging.",
      "quality": "stable",
      "concerns": [
        "Bulk delete bypasses ORM cascades; new relational dependencies must be added manually to avoid orphan data."
      ],
      "opportunities": [
        "Consider reflecting metadata to enumerate related tables dynamically during deletes."
      ],
      "tests": null,
      "notes": "Supports Action 0 cleanup routine while preserving the configured test profile."
    },
    {
      "id": "function:main._perform_deletions",
      "type": "function",
      "name": "_perform_deletions",
      "path": "main.py",
      "summary": "Coordinates deletion of ConversationLog, DnaMatch, FamilyTree, and Person rows while keeping the protected profile.",
      "mechanism": "Invokes _delete_table_records for each table, aggregates counts into a dict, and reports when no rows were removed.",
      "quality": "stable",
      "concerns": [
        "Assumes the four hard-coded tables cover all relationships; future tables require manual inclusion."
      ],
      "opportunities": [
        "Share delete-table list with database schema metadata to reduce maintenance effort."
      ],
      "tests": null,
      "notes": "Returns dict of deletion counts consumed by Action 0 output logging."
    },
    {
      "id": "function:main._run_action6_gather",
      "type": "function",
      "name": "_run_action6_gather",
      "path": "main.py",
      "summary": "Executes the Action 6 DNA gathering workflow and prints operator-facing status messages.",
      "mechanism": "Calls gather_dna_matches starting from page 1, logs errors on False return, and emits checkmark messaging on success.",
      "quality": "stable",
      "concerns": [
        "Start page is hard-coded to 1 even when workflow might resume from checkpoints."
      ],
      "opportunities": [
        "Accept resume metadata or reuse Action 6 checkpoint to avoid redundant reprocessing."
      ],
      "tests": null,
      "notes": "Used inside run_core_workflow_action when include_action6_in_workflow is enabled."
    },
    {
      "id": "function:main._run_action7_inbox",
      "type": "function",
      "name": "_run_action7_inbox",
      "path": "main.py",
      "summary": "Runs the inbox scraping workflow with navigation, waits, and structured error reporting.",
      "mechanism": "Navigates to messaging URL via nav_to_page, instantiates InboxProcessor, invokes search_inbox, and surfaces printable errors when failures occur.",
      "quality": "stable",
      "concerns": [
        "Relies on static CSS selector and fixed sleep interval which may break if UI layout changes."
      ],
      "opportunities": [
        "Replace magic delays with DOM-ready polling or reuse SessionValidator wait helpers."
      ],
      "tests": null,
      "notes": "Outputs friendly success/failure indicators for the combined workflow runner."
    },
    {
      "id": "function:main._run_action9_process_productive",
      "type": "function",
      "name": "_run_action9_process_productive",
      "path": "main.py",
      "summary": "Handles navigation and messaging around the productive message processing pipeline.",
      "mechanism": "Routes to base URL via nav_to_page, waits briefly, calls process_productive_messages, and prints outcomes for the operator.",
      "quality": "stable",
      "concerns": [
        "Shares nearly identical navigation code with other helpers; duplication invites drift."
      ],
      "opportunities": [
        "Extract a common navigation guard for Actions 8 and 9 to centralize retry logic."
      ],
      "tests": null,
      "notes": "Participates in the core workflow sequence executed by Action 1."
    },
    {
      "id": "function:main._run_action8_send_messages",
      "type": "function",
      "name": "_run_action8_send_messages",
      "path": "main.py",
      "summary": "Enforces navigation prerequisites before invoking the Action 8 messaging loop.",
      "mechanism": "Ensures base URL is reachable through nav_to_page, pauses briefly, and then calls send_messages_to_matches with operator feedback.",
      "quality": "stable",
      "concerns": [
        "Fixed sleep duration may be insufficient on slow connections leading to race conditions."
      ],
      "opportunities": [
        "Hook into page readiness heuristics from SessionValidator to avoid arbitrary delays."
      ],
      "tests": null,
      "notes": "Provides narrative status inside the composite workflow and standalone menu action."
    },
    {
      "id": "function:main._truncate_all_tables",
      "type": "function",
      "name": "_truncate_all_tables",
      "path": "main.py",
      "summary": "Clears core tables using a transactional delete sequence during database resets.",
      "mechanism": "Obtains temp manager session, runs db_transn context to delete rows from ConversationLog, DnaMatch, FamilyTree, and Person in dependency order, then returns session to pool.",
      "quality": "stable",
      "concerns": [
        "Additional tables introduced later will remain populated unless explicitly added to the deletion list."
      ],
      "opportunities": [
        "Iterate mapped tables dynamically to keep reset behavior aligned with schema evolution."
      ],
      "tests": null,
      "notes": "First phase of Action 2 database reset pipeline."
    },
    {
      "id": "function:main._reinitialize_database_schema",
      "type": "function",
      "name": "_reinitialize_database_schema",
      "path": "main.py",
      "summary": "Drops and recreates the SQLite schema using the current SQLAlchemy metadata.",
      "mechanism": "Calls DatabaseManager._initialize_engine_and_session, invokes Base.metadata.drop_all, then create_all to rebuild tables before handoff to seeding phase.",
      "quality": "stable",
      "concerns": [
        "Uses DatabaseManager private method which may change in future refactors."
      ],
      "opportunities": [
        "Expose a public DatabaseManager reset API to decouple Action 2 from internal details."
      ],
      "tests": null,
      "notes": "Returns True/False so calling reset pipeline can abort early."
    },
    {
      "id": "function:main._seed_message_templates",
      "type": "function",
      "name": "_seed_message_templates",
      "path": "main.py",
      "summary": "Populates message template rows from the canonical defaults helper when none exist.",
      "mechanism": "Within db_transn queries template count, fetches defaults via database helper, inserts them when absent, and logs resulting count.",
      "quality": "stable",
      "concerns": [
        "Relies on implicit structure of template dictionaries; schema changes require synchronized updates."
      ],
      "opportunities": [
        "Validate inserted template count against source data to catch partial seeds."
      ],
      "tests": null,
      "notes": "Used during Action 2 reset after schema recreation."
    },
    {
      "id": "function:main._initialize_ethnicity_columns_from_metadata",
      "type": "function",
      "name": "_initialize_ethnicity_columns_from_metadata",
      "path": "main.py",
      "summary": "Attempts to add ethnicity columns to dna_match using cached metadata when available.",
      "mechanism": "Imports dna_ethnicity_utils.initialize_ethnicity_columns_from_metadata and runs it with the temporary SessionManager, logging success or fallback messaging.",
      "quality": "stable",
      "concerns": [
        "Catches broad exceptions which can mask actionable failures in metadata parsing."
      ],
      "opportunities": [
        "Return structured status including error details to help operators remediate data mismatches."
      ],
      "tests": null,
      "notes": "Non-critical step; failure only delays column population until the next Action 6 run."
    },
    {
      "id": "function:main._close_main_pool_for_reset",
      "type": "function",
      "name": "_close_main_pool_for_reset",
      "path": "main.py",
      "summary": "Closes the primary SessionManager database pool and forces garbage collection before reset operations.",
      "mechanism": "Invokes session_manager.cls_db_conn with keep_db=False, triggers GC twice with short sleep to release handles prior to file operations.",
      "quality": "stable",
      "concerns": [
        "Fixed sleep may still race with lingering connections under heavy load."
      ],
      "opportunities": [
        "Poll for open handles or pool metrics to ensure deterministic shutdown before continuing."
      ],
      "tests": null,
      "notes": "Ensures SQLite file handle is free before deletion or copy operations."
    },
    {
      "id": "function:main._perform_database_reset_steps",
      "type": "function",
      "name": "_perform_database_reset_steps",
      "path": "main.py",
      "summary": "Bundles truncation, schema recreation, template seeding, and ethnicity initialization for Action 2 resets.",
      "mechanism": "Sequentially calls table truncation, schema rebuild, obtains session for seeding, inserts message templates, conditionally applies ethnicity metadata, commits, and returns (success, session).",
      "quality": "stable",
      "concerns": [
        "Partial failures rely on boolean flags; richer error reporting would aid troubleshooting."
      ],
      "opportunities": [
        "Return structured result detailing which phase failed to accelerate recovery."
      ],
      "tests": null,
      "notes": "Returned session allows caller to release resources before tearing down temp manager."
    },
    {
      "id": "function:main._display_table_statistics",
      "type": "function",
      "name": "_display_table_statistics",
      "path": "main.py",
      "summary": "Prints row counts for every table in the restored database to confirm restore health.",
      "mechanism": "Builds SQLite engine on restored path, inspects table names, executes SELECT COUNT(*) per table, and logs formatted totals.",
      "quality": "stable",
      "concerns": [
        "Uses string-formatted SQL; unusual table names could break query rendering."
      ],
      "opportunities": [
        "Quote identifiers via SQLAlchemy text bindings to avoid naming edge cases."
      ],
      "tests": null,
      "notes": "Invoked post-restore to give operators immediate confidence in dataset state."
    },
    {
      "id": "function:main._display_session_info",
      "type": "function",
      "name": "_display_session_info",
      "path": "main.py",
      "summary": "Prints tree owner metadata, profile identifiers, and CSRF preview from the active session_manager.",
      "mechanism": "Checks SessionManager attributes for tree owner, profile id, UUID, tree id, and API CSRF token then prints human-readable lines for each.",
      "quality": "stable",
      "concerns": [
        "Outputs sensitive identifiers directly to console which may be undesirable in recorded demos."
      ],
      "opportunities": [
        "Offer masked output or logging-only mode to protect identifiers during screen sharing."
      ],
      "tests": null,
      "notes": "Shared helper for login success messaging across Action 5 flows."
    },
    {
      "id": "function:main._handle_logged_in_status",
      "type": "function",
      "name": "_handle_logged_in_status",
      "path": "main.py",
      "summary": "Handles the case where login_status already reports True by printing confirmation and session details.",
      "mechanism": "Writes confirmation message, delegates to _display_session_info, and returns True to caller.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Include last authentication time or session age to aid troubleshooting."
      ],
      "tests": null,
      "notes": "Short-circuits Action 5 when authentication is already valid."
    },
    {
      "id": "function:main._verify_login_success",
      "type": "function",
      "name": "_verify_login_success",
      "path": "main.py",
      "summary": "Revalidates login status after attempting credentials and outputs session details on success.",
      "mechanism": "Calls login_status with UI fallback, prints warning on ambiguous results, and uses _display_session_info when verification passes.",
      "quality": "stable",
      "concerns": [
        "Returns False on both failure and indeterminate status; upstream handlers must differentiate via logs."
      ],
      "opportunities": [
        "Return structured enum distinguishing failure vs. ambiguous verification."
      ],
      "tests": null,
      "notes": "Used by _attempt_login to confirm credentials actually applied."
    },
    {
      "id": "function:main._attempt_login",
      "type": "function",
      "name": "_attempt_login",
      "path": "main.py",
      "summary": "Provides operator feedback around login attempts using stored credentials when initial status is false.",
      "mechanism": "Prints prompts, invokes log_in on the session_manager, handles exceptions, and relies on _verify_login_success to confirm the outcome.",
      "quality": "stable",
      "concerns": [
        "Broad exception handling may hide root causes unless logs are reviewed."
      ],
      "opportunities": [
        "Surface specific guidance (e.g., MFA required) based on exception types returned by log_in."
      ],
      "tests": null,
      "notes": "Returns False to Action 5 when credentials cannot be applied automatically."
    },
    {
      "id": "function:main._perform_gedcom_search",
      "type": "function",
      "name": "_perform_gedcom_search",
      "path": "main.py",
      "summary": "Runs the GEDCOM data load and scoring pipeline, returning datasets alongside match list.",
      "mechanism": "Loads GEDCOM file when available, builds filter criteria, applies filter_and_score_individuals, and catches exceptions to avoid aborting the wrapper action.",
      "quality": "stable",
      "concerns": [
        "Suppresses errors to logs only, so upstream callers cannot tell whether GEDCOM load failed without reading logs."
      ],
      "opportunities": [
        "Return a status flag or error message to improve fallback decision making."
      ],
      "tests": null,
      "notes": "First stage of the GEDCOM-first comparison workflow."
    },
    {
      "id": "function:main._perform_api_search_fallback",
      "type": "function",
      "name": "_perform_api_search_fallback",
      "path": "main.py",
      "summary": "Executes the API search path when GEDCOM results are absent, including session readiness and cookie sync.",
      "mechanism": "Ensures session readiness via SessionManager, attempts cookie sync to APIManager, and calls search_ancestry_api_for_person returning candidate list or empty default.",
      "quality": "stable",
      "concerns": [
        "Proceeds with API search even if cookie sync fails, which can lead to confusing downstream errors."
      ],
      "opportunities": [
        "Return descriptive failure codes so the caller can differentiate auth vs. search errors."
      ],
      "tests": null,
      "notes": "Only invoked when GEDCOM search produced no matches."
    },
    {
      "id": "function:main._format_table_row",
      "type": "function",
      "name": "_format_table_row",
      "path": "main.py",
      "summary": "Formats column values into a padded string suitable for ASCII table output.",
      "mechanism": "Iterates column values alongside width list, converts to string, left justifies each cell, and joins them with separators.",
      "quality": "stable",
      "concerns": [
        "Assumes widths list length matches number of columns; mismatches raise implicit errors."
      ],
      "opportunities": [
        "Add guardrails or fallback padding when widths and row lengths differ."
      ],
      "tests": null,
      "notes": "Shared utility for GEDCOM/API comparison table logging."
    },
    {
      "id": "function:main._compute_table_widths",
      "type": "function",
      "name": "_compute_table_widths",
      "path": "main.py",
      "summary": "Calculates column widths based on header and row content for result table alignment.",
      "mechanism": "Initializes widths from header lengths then iterates each row updating width with the max string length encountered per column.",
      "quality": "stable",
      "concerns": [
        "Casts everything to string, so numeric alignment is always left-justified."
      ],
      "opportunities": [
        "Support alignment options (right/center) when presenting numeric scores."
      ],
      "tests": null,
      "notes": "Feeds _log_result_table width calculations."
    },
    {
      "id": "function:main._log_result_table",
      "type": "function",
      "name": "_log_result_table",
      "path": "main.py",
      "summary": "Logs a formatted table of GEDCOM or API matches when debug logging is enabled.",
      "mechanism": "Derives column widths, creates header row, logs separators, and iterates rows formatting each via _format_table_row.",
      "quality": "stable",
      "concerns": [
        "Output restricted to debug level, so operators at info level cannot view tabular breakdowns."
      ],
      "opportunities": [
        "Allow optional console print when verbose flag enabled for richer CLI experience."
      ],
      "tests": null,
      "notes": "Used by _display_search_results to provide developer-facing diagnostics."
    },
    {
      "id": "function:main._display_search_results",
      "type": "function",
      "name": "_display_search_results",
      "path": "main.py",
      "summary": "Shows top GEDCOM and API matches and delegates to logger for detailed tables.",
      "mechanism": "Builds table rows via helper creators, prints fallback when no matches, and when debug enabled logs both GEDCOM and API tables using _log_result_table.",
      "quality": "stable",
      "concerns": [
        "Outputs only top candidate to the console; additional context requires debug logging access."
      ],
      "opportunities": [
        "Expose max display count as config so operators can view more than the top match."
      ],
      "tests": null,
      "notes": "Part of the Action 10 GEDCOM/API comparison interface."
    },
    {
      "id": "function:main._display_detailed_match_info",
      "type": "function",
      "name": "_display_detailed_match_info",
      "path": "main.py",
      "summary": "Displays deep dive information for top GEDCOM match or API fallback including family context.",
      "mechanism": "When GEDCOM matches exist, normalizes ids and calls analyze_top_match; otherwise executes API supplementary info phase, swallowing exceptions to keep workflow resilient.",
      "quality": "stable",
      "concerns": [
        "Exceptions are logged but not surfaced, leaving operators unaware that detailed info failed."
      ],
      "opportunities": [
        "Return status to caller so analytics can record when supplementary detail fails."
      ],
      "tests": null,
      "notes": "Completes the Action 10 comparison experience by surfacing context around the best candidate."
    },
    {
      "id": "function:main._import_search_modules",
      "type": "function",
      "name": "_import_search_modules",
      "path": "main.py",
      "summary": "Aggregates GEDCOM and API search helpers into a single import tuple for reuse.",
      "mechanism": "Imports scoring, table formatting, and search utilities from action10, api_search_core, and search_criteria_utils, returning them as a consolidated tuple.",
      "quality": "stable",
      "concerns": [
        "Currently unused; future refactors should remove or integrate to avoid dead code."
      ],
      "opportunities": [
        "Leverage to reduce duplicate import blocks across GEDCOM comparison helpers."
      ],
      "tests": null,
      "notes": "Legacy convenience wrapper retained during ongoing Action 10 consolidation."
    },
    {
      "id": "function:main._set_windows_console_focus",
      "type": "function",
      "name": "_set_windows_console_focus",
      "path": "main.py",
      "summary": "Brings the console window to the foreground on Windows hosts before interaction begins.",
      "mechanism": "On nt platforms, uses ctypes to obtain the console handle and calls SetForegroundWindow/ShowWindow; silently ignores failures and other OS types.",
      "quality": "stable",
      "concerns": [
        "Windows API calls can fail when console host is disallowed from taking focus, leaving UX unchanged."
      ],
      "opportunities": [
        "Gate behind configuration so remote or headless sessions can disable focus attempts."
      ],
      "tests": null,
      "notes": "Invoked at the top of main() to reduce accidental background execution."
    },
    {
      "id": "function:main._print_config_error_message",
      "type": "function",
      "name": "_print_config_error_message",
      "path": "main.py",
      "summary": "Prints detailed remediation steps when configuration validation fails and terminates the process.",
      "mechanism": "Logs a critical error, prints multi-section guidance for setting up .env credentials, and exits with status code 1 via sys.exit().",
      "quality": "stable",
      "concerns": [
        "Hard exits make it difficult to embed the CLI within higher-level orchestration scripts."
      ],
      "opportunities": [
        "Return an error object so callers can decide whether to exit or raise custom exceptions."
      ],
      "tests": null,
      "notes": "Called from _initialize_application when ConfigManager returns None."
    },
    {
      "id": "function:main._check_action_confirmation",
      "type": "function",
      "name": "_check_action_confirmation",
      "path": "main.py",
      "summary": "Prompts the user for confirmation before executing destructive database operations.",
      "mechanism": "Looks up the selected action in a warning map, prompts for yes/no, and returns False when the user declines to continue.",
      "quality": "stable",
      "concerns": [
        "Relies on blocking stdin input, which can impede scripted automation."
      ],
      "opportunities": [
        "Allow command-line flags or environment variables to pre-approve destructive operations."
      ],
      "tests": null,
      "notes": "Executed inside the main menu loop before dispatching the selected action."
    },
    {
      "id": "function:main._run_main_tests",
      "type": "function",
      "name": "_run_main_tests",
      "path": "main.py",
      "summary": "Executes the main.py internal test suite through run_comprehensive_tests and reports results to the operator.",
      "mechanism": "Prints a formatted header, invokes run_comprehensive_tests(), interprets the boolean result, and waits for the user to press Enter before returning.",
      "quality": "stable",
      "concerns": [
        "Blocks on stdin after execution which prevents batch test runs without user intervention."
      ],
      "opportunities": [
        "Accept a non-interactive flag to skip the pause when triggered from automation."
      ],
      "tests": null,
      "notes": "Reached via the 'test' meta command within the menu system."
    },
    {
      "id": "function:main._run_all_tests",
      "type": "function",
      "name": "_run_all_tests",
      "path": "main.py",
      "summary": "Launches the repository-wide test runner script and reports its exit status.",
      "mechanism": "Uses subprocess.run with sys.executable to execute run_all_tests.py, relaying success or failure messaging and pausing for user acknowledgment.",
      "quality": "stable",
      "concerns": [
        "Captures neither stdout nor stderr, so failures require scrolling back in the console."
      ],
      "opportunities": [
        "Stream subprocess output live or provide a tail of failure logs for quicker triage."
      ],
      "tests": null,
      "notes": "Triggered through the 'testall' meta command."
    },
    {
      "id": "function:main._show_analytics_dashboard",
      "type": "function",
      "name": "_show_analytics_dashboard",
      "path": "main.py",
      "summary": "Displays the conversation analytics dashboard using a temporary SessionManager and database session.",
      "mechanism": "Instantiates SessionManager, acquires a DB session, calls conversation_analytics.print_analytics_dashboard, handles errors, and pauses for input before returning.",
      "quality": "stable",
      "concerns": [
        "Creates a new SessionManager instead of reusing the primary instance, which may duplicate connections."
      ],
      "opportunities": [
        "Reuse the shared session manager or share the database session from the main loop to avoid redundant setup."
      ],
      "tests": null,
      "notes": "Accessible via the 'analytics' meta command."
    },
    {
      "id": "function:main._show_base_cache_stats",
      "type": "function",
      "name": "_show_base_cache_stats",
      "path": "main.py",
      "summary": "Prints disk-backed cache statistics provided by cache.get_cache_stats().",
      "mechanism": "Calls the cache layer to obtain hit/miss metrics, prints formatted values when available, and returns a boolean indicating whether stats were shown.",
      "quality": "stable",
      "concerns": [
        "Swallows exceptions with debug log only, leaving the operator without feedback when stats are unavailable."
      ],
      "opportunities": [
        "Surface a user-facing notice when cache stats cannot be retrieved to reduce confusion."
      ],
      "tests": null,
      "notes": "Contributes to the aggregated cache statistics view."
    },
    {
      "id": "function:main._show_unified_cache_stats",
      "type": "function",
      "name": "_show_unified_cache_stats",
      "path": "main.py",
      "summary": "Outputs session, API, and system cache metrics from the unified cache manager if available.",
      "mechanism": "Calls get_unified_cache_manager().get_comprehensive_stats(), prints each cache section present, and indicates whether any statistics were displayed.",
      "quality": "stable",
      "concerns": [
        "Assumes stat keys exist; missing keys default to empty, yielding sparse output without explanation."
      ],
      "opportunities": [
        "Include fallbacks or headings indicating when subsystems are disabled to aid interpretation."
      ],
      "tests": null,
      "notes": "Feeds the overall cache stats dashboard invoked from the menu."
    },
    {
      "id": "function:main._show_tree_stats_cache",
      "type": "function",
      "name": "_show_tree_stats_cache",
      "path": "main.py",
      "summary": "Reports the number of cached tree statistics entries stored in the database.",
      "mechanism": "Initializes DatabaseManager, opens a session, counts TreeStatisticsCache rows, prints the total, and returns True when successful.",
      "quality": "stable",
      "concerns": [
        "Creates a fresh DatabaseManager instead of using the shared SessionManager instance, which may incur extra engine setup."
      ],
      "opportunities": [
        "Pass in the existing database manager to avoid redundant connections and leverage pooled resources."
      ],
      "tests": null,
      "notes": "Complements other cache summaries for the cache statistics screen."
    },
    {
      "id": "function:main._show_performance_cache_stats",
      "type": "function",
      "name": "_show_performance_cache_stats",
      "path": "main.py",
      "summary": "Displays GEDCOM performance cache metrics when available.",
      "mechanism": "Calls performance_cache.get_cache_stats(), prints memory-oriented figures, and returns True if data was produced.",
      "quality": "stable",
      "concerns": [
        "Only logs errors at debug level; operators may not realize why no data is shown."
      ],
      "opportunities": [
        "Elevate error visibility or provide default messaging indicating the cache is disabled."
      ],
      "tests": null,
      "notes": "Integrated into the cache statistics console output."
    },
    {
      "id": "function:main._show_cache_statistics",
      "type": "function",
      "name": "_show_cache_statistics",
      "path": "main.py",
      "summary": "Clears the screen and aggregates cache statistics across base, unified, tree, and performance caches.",
      "mechanism": "Clears the console, prints a summary header, invokes each cache-specific display helper with short-circuiting boolean tracking, and pauses for user acknowledgment.",
      "quality": "stable",
      "concerns": [
        "Always clears the console, which may hide prior context the operator wanted to reference."
      ],
      "opportunities": [
        "Accept a flag to skip screen clearing to preserve earlier output during debugging."
      ],
      "tests": null,
      "notes": "Available as the 's' meta command for cache inspection."
    },
    {
      "id": "function:main._toggle_log_level",
      "type": "function",
      "name": "_toggle_log_level",
      "path": "main.py",
      "summary": "Switches the console log level between INFO and DEBUG at runtime.",
      "mechanism": "Detects the stderr StreamHandler, flips its level between DEBUG and INFO, re-runs setup_logging to refresh handlers, and logs the new level.",
      "quality": "stable",
      "concerns": [
        "Relies on discovering a specific stream handler; non-standard logging setups may be unsupported."
      ],
      "opportunities": [
        "Expose an explicit CLI option to choose among more log levels or persist selection across runs."
      ],
      "tests": null,
      "notes": "Bound to the 't' meta command for quick verbosity changes."
    },
    {
      "id": "function:main._handle_database_actions",
      "type": "function",
      "name": "_handle_database_actions",
      "path": "main.py",
      "summary": "Dispatches database-only menu selections through exec_actn without browser preparation.",
      "mechanism": "Matches the choice against known database actions (0,2,3,4) and invokes exec_actn with the corresponding handler, returning True once dispatch completes.",
      "quality": "stable",
      "concerns": [
        "Assumes exec_actn handles errors uniformly; additional user messaging may be helpful for failures."
      ],
      "opportunities": [
        "Return the action result to enable success/failure feedback in the menu loop."
      ],
      "tests": null,
      "notes": "Keeps the menu dispatcher tidy by isolating DB-oriented commands."
    },
    {
      "id": "function:main._handle_action6_with_start_page",
      "type": "function",
      "name": "_handle_action6_with_start_page",
      "path": "main.py",
      "summary": "Parses the optional start page argument for Action 6 and executes gather_dna_matches via exec_actn.",
      "mechanism": "Splits the user choice, validates positive integer start page fallback to 1, warns on invalid input, and calls exec_actn with gather_dna_matches and the derived arguments.",
      "quality": "stable",
      "concerns": [
        "Only accepts positional page numbers; future enhancements might allow keyword flags or resume tokens."
      ],
      "opportunities": [
        "Surface checkpoint information before overriding the start page to inform the operator."
      ],
      "tests": null,
      "notes": "Supports the '6 [page]' syntax for DNA match gathering."
    },
    {
      "id": "function:main._handle_browser_actions",
      "type": "function",
      "name": "_handle_browser_actions",
      "path": "main.py",
      "summary": "Routes browser-dependent menu selections, ensuring caching warm-ups and delegating to exec_actn or specialized helpers.",
      "mechanism": "Switches on the normalized choice, optionally initializes caching, then calls exec_actn with the appropriate action wrapper or uses _handle_action6_with_start_page for Action 6 variants.",
      "quality": "stable",
      "concerns": [
        "Contains a growing set of hard-coded branches; future actions may benefit from a metadata-driven registry."
      ],
      "opportunities": [
        "Return execution results so the menu can present consistent success/failure prompts."
      ],
      "tests": null,
      "notes": "Handles Actions 1,5-10 and the Action 6 shorthand."
    },
    {
      "id": "function:main._handle_test_options",
      "type": "function",
      "name": "_handle_test_options",
      "path": "main.py",
      "summary": "Processes testing shortcuts from the menu, launching either main-only or full test suites.",
      "mechanism": "Checks for 'test' or 'testall' menu choices and triggers _run_main_tests or _run_all_tests respectively, returning True when handled.",
      "quality": "stable",
      "concerns": [
        "No support for additional tooling such as linting; handlers must be extended manually."
      ],
      "opportunities": [
        "Add structured mapping to include future diagnostics commands without expanding branching logic."
      ],
      "tests": null,
      "notes": "Allows quick testing from within the interactive CLI."
    },
    {
      "id": "function:main._show_metrics_report",
      "type": "function",
      "name": "_show_metrics_report",
      "path": "main.py",
      "summary": "Displays comprehensive Prometheus metrics report with exporter status and current metrics.",
      "mechanism": "Imports observability components, checks if metrics enabled, retrieves registry and exporter status, displays first 20 metrics with counts, and provides setup tips if disabled.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add filtering options to show specific metric categories."
      ],
      "tests": null,
      "notes": "Added 2025-11-16 as new menu option 'metrics' for real-time observability visibility."
    },
    {
      "id": "function:main._handle_meta_options",
      "type": "function",
      "name": "_handle_meta_options",
      "path": "main.py",
      "summary": "Handles analytics, metrics, cache, logging, clear-screen, and exit meta commands from the menu.",
      "mechanism": "Maps supported meta choices to helper callables (including new metrics option), executes them, and manages the exit case by clearing the screen and returning False when the user chooses to quit.",
      "quality": "stable",
      "concerns": [
        "Meta command registry is hard-coded; dynamic registration could simplify future additions."
      ],
      "opportunities": [
        "Provide descriptive help text listing meta commands directly in the menu."
      ],
      "tests": null,
      "notes": "Supports 'analytics', 'metrics', 's', 't', 'c', and 'q' path logic. Updated 2025-11-16 to include metrics report."
    },
    {
      "id": "function:main._dispatch_menu_action",
      "type": "function",
      "name": "_dispatch_menu_action",
      "path": "main.py",
      "summary": "Central dispatcher translating menu selections into database, browser, test, or meta handlers.",
      "mechanism": "Evaluates the choice against database actions, browser actions, test options, and meta commands in order, delegating to the respective helper and returning a boolean to continue or exit the loop.",
      "quality": "stable",
      "concerns": [
        "Returns True even when delegated action fails, leaving the operator reliant on logs for status."
      ],
      "opportunities": [
        "Propagate action success results to enable uniform success/error messaging."
      ],
      "tests": null,
      "notes": "Main loop uses the return value to determine whether to keep prompting the operator."
    },
    {
      "id": "function:main._check_startup_status",
      "type": "function",
      "name": "_check_startup_status",
      "path": "main.py",
      "summary": "Performs initial health checks on the database connection and proactively syncs cookies for API calls.",
      "mechanism": "Attempts DatabaseManager.ensure_ready(), logs results, then if the session is valid and an API manager is present, synchronizes browser cookies into the API session while handling non-fatal exceptions.",
      "quality": "stable",
      "concerns": [
        "Relies on debug logging for cookie sync failures, which may hide issues from operators running at info level."
      ],
      "opportunities": [
        "Include explicit user-facing notices when cookie sync fails to encourage session refresh."
      ],
      "tests": null,
      "notes": "Executed during startup before presenting the menu to ensure smoother first action runs."
    },
    {
      "id": "function:main._check_lm_studio_running",
      "type": "function",
      "name": "_check_lm_studio_running",
      "path": "main.py",
      "summary": "Detects whether the LM Studio desktop process is already active on the host.",
      "mechanism": "Iterates over running processes with psutil, normalizes names, and returns True when a match containing 'lm studio' is found.",
      "quality": "stable",
      "concerns": [
        "Currently unused in the startup flow, so drift in LM Studio behavior may go unnoticed."
      ],
      "opportunities": [
        "Integrate with _validate_local_llm_config to skip redundant auto-start logic when Studio is already running."
      ],
      "tests": null,
      "notes": "Utility retained from early LM Studio launch experiments."
    },
    {
      "id": "function:main._validate_local_llm_config",
      "type": "function",
      "name": "_validate_local_llm_config",
      "path": "main.py",
      "summary": "Validates LM Studio API configuration and attempts to auto-start the local LLM stack when needed.",
      "mechanism": "Builds an LM Studio manager from config, calls ensure_ready(), and probes the OpenAI-compatible endpoint to confirm the configured model is loaded.",
      "quality": "stable",
      "concerns": [
        "Relies on external LM Studio APIs that can change without notice, yielding warning-only failures."
      ],
      "opportunities": [
        "Surface richer diagnostics when model validation fails to accelerate operator troubleshooting."
      ],
      "tests": null,
      "notes": "Runs during startup when ai_provider is set to local_llm."
    },
    {
      "id": "function:main._validate_cloud_provider",
      "type": "function",
      "name": "_validate_cloud_provider",
      "path": "main.py",
      "summary": "Performs a quick configuration sanity check for cloud AI providers.",
      "mechanism": "Confirms both API key and model name are present, logging success or a warning for the given provider.",
      "quality": "stable",
      "concerns": [
        "Does not verify credentials against the remote service, so misconfigured keys pass silently."
      ],
      "opportunities": [
        "Add optional connectivity probes to catch expired credentials before first action usage."
      ],
      "tests": null,
      "notes": "Used by _validate_ai_provider_on_startup for DeepSeek, Gemini, and Moonshot checks."
    },
    {
      "id": "function:main._validate_ai_provider_on_startup",
      "type": "function",
      "name": "_validate_ai_provider_on_startup",
      "path": "main.py",
      "summary": "Routes startup AI validation to the configured provider-specific health checks.",
      "mechanism": "Reads config_schema.ai_provider and dispatches to local or cloud validation helpers, logging missing configuration states.",
      "quality": "stable",
      "concerns": [
        "Warn-only behavior means invalid AI setups are only caught when actions later require them."
      ],
      "opportunities": [
        "Return structured results so the menu can highlight AI readiness status to the operator."
      ],
      "tests": null,
      "notes": "Called from main() before presenting the menu."
    },
    {
      "id": "function:main._display_tree_owner",
      "type": "function",
      "name": "_display_tree_owner",
      "path": "main.py",
      "summary": "Prints the Ancestry tree owner name once startup checks complete.",
      "mechanism": "Reads tree_owner_name from the SessionManager API client and logs the value if available, ignoring any lookup errors.",
      "quality": "stable",
      "concerns": [
        "Suppresses exceptions entirely, which can hide API regressions exposing tree metadata."
      ],
      "opportunities": [
        "Emit a debug log on failure so telemetry can surface misconfigured sessions."
      ],
      "tests": null,
      "notes": "Cosmetic feedback to reassure operators about the active tree context."
    },
    {
      "id": "function:main._pre_authenticate_session",
      "type": "function",
      "name": "_pre_authenticate_session",
      "path": "main.py",
      "summary": "Warm-ups the global session to avoid first-action authentication latency.",
      "mechanism": "Calls get_authenticated_session with explicit context, logging success and swallowing failures to allow deferred auth.",
      "quality": "stable",
      "concerns": [
        "Broad exception handling can hide genuine credential issues until an action fails later."
      ],
      "opportunities": [
        "Return a status flag so the menu can prompt the operator to refresh credentials proactively."
      ],
      "tests": null,
      "notes": "Executed during main() startup sequence."
    },
    {
      "id": "function:main._pre_authenticate_ms_graph",
      "type": "function",
      "name": "_pre_authenticate_ms_graph",
      "path": "main.py",
      "summary": "Optionally acquires a Microsoft Graph token ahead of Action 9 task generation.",
      "mechanism": "Invokes acquire_token_device_flow, promoting successful device-code auth and logging non-fatal failures for later retries.",
      "quality": "stable",
      "concerns": [
        "Device code prompts at startup can distract operators who do not intend to run Action 9."
      ],
      "opportunities": [
        "Gate the pre-auth behind a config flag or defer until Action 9 is selected."
      ],
      "tests": null,
      "notes": "Runs before the menu loop to reduce MS Graph latency."
    },
    {
      "id": "function:main._cleanup_session_manager",
      "type": "function",
      "name": "_cleanup_session_manager",
      "path": "main.py",
      "summary": "Shuts down the SessionManager and related browser resources during application exit.",
      "mechanism": "Redirects stderr to suppress driver noise, calls close_sess, clears references, forces garbage collection, and prints a final exit message.",
      "quality": "stable",
      "concerns": [
        "Redirected stderr may hide legitimate shutdown diagnostics when automation fails."
      ],
      "opportunities": [
        "Expose an optional verbose cleanup mode for debugging persistent driver processes."
      ],
      "tests": null,
      "notes": "Triggered from main()'s finally block after restoring system sleep settings."
    },
    {
      "id": "function:main._test_clear_log_file_function",
      "type": "function",
      "name": "_test_clear_log_file_function",
      "path": "main.py",
      "summary": "Verifies that clear_log_file returns a well-formed tuple and handles failures gracefully.",
      "mechanism": "Invokes clear_log_file, asserts return structure, and tolerates exceptions by confirming they are standard Exception instances.",
      "quality": "stable",
      "concerns": [
        "Touches the real log file path, so concurrent runs could race on filesystem state."
      ],
      "opportunities": [
        "Mock filesystem interactions to isolate the test from environment-specific paths."
      ],
      "tests": "Executed via main_module_tests().",
      "notes": "Part of the main module regression suite."
    },
    {
      "id": "function:main._test_main_function_structure",
      "type": "function",
      "name": "_test_main_function_structure",
      "path": "main.py",
      "summary": "Asserts that main() remains parameterless and callable for CLI entry point compatibility.",
      "mechanism": "Uses inspect.signature to confirm main takes no arguments while ensuring the symbol is callable.",
      "quality": "stable",
      "concerns": [
        "Only inspects the signature; semantic regressions inside main() still depend on other tests."
      ],
      "opportunities": [
        "Extend to verify docstring or annotations once main() gains richer metadata."
      ],
      "tests": "Executed via main_module_tests().",
      "notes": "Guards against inadvertent API changes to the CLI entry point."
    },
    {
      "id": "function:main._test_reset_db_actn_integration",
      "type": "function",
      "name": "_test_reset_db_actn_integration",
      "path": "main.py",
      "summary": "Confirms reset_db_actn dependencies exist without mutating the database.",
      "mechanism": "Instantiates SessionManager, asserts required DatabaseManager attributes, and avoids executing the destructive reset logic.",
      "quality": "stable",
      "concerns": [
        "Relies on real SessionManager construction which may open live resources during tests."
      ],
      "opportunities": [
        "Swap in lightweight fakes for SessionManager to reduce startup overhead."
      ],
      "tests": "Executed via main_module_tests().",
      "notes": "Integration safety net for the database reset action."
    },
    {
      "id": "function:main._test_edge_case_handling",
      "type": "function",
      "name": "_test_edge_case_handling",
      "path": "main.py",
      "summary": "Ensures critical action modules remain imported for edge-case handling coverage.",
      "mechanism": "Inspects sys.modules for action6-10 entries and asserts they are available during main module execution.",
      "quality": "stable",
      "concerns": [
        "Does not validate lazy imports inside run_gedcom_then_api_fallback beyond module presence."
      ],
      "opportunities": [
        "Add targeted import tests for lazily loaded helpers referenced in Action 10."
      ],
      "tests": "Executed via main_module_tests().",
      "notes": "Captures regressions where refactors drop required imports."
    },
    {
      "id": "function:main._test_import_error_handling",
      "type": "function",
      "name": "_test_import_error_handling",
      "path": "main.py",
      "summary": "Validates that the main module exposes essential imported symbols.",
      "mechanism": "Checks globals() for action orchestrators, configuration, and SessionManager references, raising assertion failures when absent.",
      "quality": "stable",
      "concerns": [
        "Global lookups will pass even if modules are partially initialized or incompatible."
      ],
      "opportunities": [
        "Expand to import the modules directly to catch partially loaded states."
      ],
      "tests": "Executed via main_module_tests().",
      "notes": "Protects against accidental import regression in the entry module."
    },
    {
      "id": "function:main._test_validate_action_config",
      "type": "function",
      "name": "_test_validate_action_config",
      "path": "main.py",
      "summary": "Exercises validate_action_config to confirm Action 6 rate-limit protections stay active.",
      "mechanism": "Calls validate_action_config, asserting a boolean return and tolerating exceptions that reference missing configuration.",
      "quality": "stable",
      "concerns": [
        "Directly invokes production validation which may read the operator's real .env values during tests."
      ],
      "opportunities": [
        "Provide injectable config fixtures so tests can run in isolation from developer secrets."
      ],
      "tests": "Executed via main_module_tests().",
      "notes": "Ensures startup guardrails remain in place after Action 6 bug fixes."
    },
    {
      "id": "function:main._test_database_integration",
      "type": "function",
      "name": "_test_database_integration",
      "path": "main.py",
      "summary": "Checks that core database helpers and models are reachable from main.py.",
      "mechanism": "Asserts backup_database and db_transn are callable and imports the SQLAlchemy Base to ensure metadata exposure.",
      "quality": "stable",
      "concerns": [
        "Touches live database modules, which can be slow if metadata reflection triggers heavy imports."
      ],
      "opportunities": [
        "Swap to lightweight metadata probes or mock engine bindings during tests."
      ],
      "tests": "Executed via main_module_tests().",
      "notes": "Prevents accidental removal of database integration points."
    },
    {
      "id": "function:main._test_action_integration",
      "type": "function",
      "name": "_test_action_integration",
      "path": "main.py",
      "summary": "Verifies that primary action entry points remain callable from the main module.",
      "mechanism": "Iterates over the key action functions imported at module load, asserting they are callable and non-null.",
      "quality": "stable",
      "concerns": [
        "Only checks callable presence; deeper behavioral regressions require action-specific suites."
      ],
      "opportunities": [
        "Expand to invoke lightweight dry-run routines once deterministic mocks are available."
      ],
      "tests": "Executed via main_module_tests().",
      "notes": "Catches regressions where imports are removed or renamed."
    },
    {
      "id": "function:main._test_import_performance",
      "type": "function",
      "name": "_test_import_performance",
      "path": "main.py",
      "summary": "Guards against slow module reloads that could regress CLI startup times.",
      "mechanism": "Reloads cached modules such as config and asserts the elapsed wall time stays below one second.",
      "quality": "stable",
      "concerns": [
        "Performance assertions can be flaky on heavily loaded CI agents."
      ],
      "opportunities": [
        "Collect and compare historical import timing to tune thresholds adaptively."
      ],
      "tests": "Executed via main_module_tests().",
      "notes": "Acts as a smoke alarm for runaway import costs."
    },
    {
      "id": "function:main._test_memory_efficiency",
      "type": "function",
      "name": "_test_memory_efficiency",
      "path": "main.py",
      "summary": "Keeps module-level memory usage within guardrails after refactors.",
      "mechanism": "Uses sys.getsizeof and globals() length checks to enforce size limits on the main module object graph.",
      "quality": "stable",
      "concerns": [
        "Crude thresholds may need adjustment as new helpers are added to main.py."
      ],
      "opportunities": [
        "Track historical globals counts to justify updated ceilings when new features land."
      ],
      "tests": "Executed via main_module_tests().",
      "notes": "Prevents accidental bloat from runaway global state."
    },
    {
      "id": "function:main._test_function_call_performance",
      "type": "function",
      "name": "_test_function_call_performance",
      "path": "main.py",
      "summary": "Ensures routine function calls remain performant within the CLI loop.",
      "mechanism": "Executes 1000 callable(menu) checks and asserts the total runtime stays below 100ms.",
      "quality": "stable",
      "concerns": [
        "Time-based assertions can become brittle on slow developer laptops or CI containers."
      ],
      "opportunities": [
        "Replace hard-coded thresholds with percentile tracking fed by telemetry."
      ],
      "tests": "Executed via main_module_tests().",
      "notes": "Helps catch regressions that make the interactive loop sluggish."
    },
    {
      "id": "function:main._test_error_handling_structure",
      "type": "function",
      "name": "_test_error_handling_structure",
      "path": "main.py",
      "summary": "Confirms main() retains its defensive try/except/finally structure.",
      "mechanism": "Uses inspect.getsource to ensure the function source contains try, except, finally, and KeyboardInterrupt handlers.",
      "quality": "stable",
      "concerns": [
        "String-based checks could miss structural issues if formatting changes break the pattern without removing keywords."
      ],
      "opportunities": [
        "Upgrade to AST-based analysis to verify the actual control-flow tree."
      ],
      "tests": "Executed via main_module_tests().",
      "notes": "Protects against refactors that accidentally drop cleanup or error handling."
    },
    {
      "id": "function:main._test_cleanup_procedures",
      "type": "function",
      "name": "_test_cleanup_procedures",
      "path": "main.py",
      "summary": "Checks that cleanup logic remains present in main()'s finally block.",
      "mechanism": "Examines the source of main() to ensure cleanup terminology and finally blocks remain intact.",
      "quality": "stable",
      "concerns": [
        "Relies on textual heuristics rather than asserting specific cleanup calls."
      ],
      "opportunities": [
        "Assert that _cleanup_session_manager is invoked to tighten the guarantee."
      ],
      "tests": "Executed via main_module_tests().",
      "notes": "Complements _test_error_handling_structure for exit hygiene."
    },
    {
      "id": "function:main._test_exception_handling_coverage",
      "type": "function",
      "name": "_test_exception_handling_coverage",
      "path": "main.py",
      "summary": "Ensures exception handling in main() covers generic errors and logs appropriately.",
      "mechanism": "Analyzes the source text of main() to confirm Exception clauses and logging references are present.",
      "quality": "stable",
      "concerns": [
        "String scanning can give false positives if keywords appear in comments only."
      ],
      "opportunities": [
        "Adopt AST parsing to verify actual except blocks and logger calls."
      ],
      "tests": "Executed via main_module_tests().",
      "notes": "Guards against regressions that drop critical logging."
    },
    {
      "id": "function:main.main_module_tests",
      "type": "function",
      "name": "main_module_tests",
      "path": "main.py",
      "summary": "Aggregates main.py unit and integration checks using the shared TestSuite harness.",
      "mechanism": "Initializes a TestSuite, suppresses logging noise, and registers targeted tests covering configuration, integration, performance, and error handling before finishing the suite.",
      "quality": "stable",
      "concerns": [
        "Relies on real imports and environment, so failures can stem from external state instead of code regressions."
      ],
      "opportunities": [
        "Parameterize the suite to allow focused subsets (e.g., skip performance tests on slow nodes)."
      ],
      "tests": null,
      "notes": "Entry point for the comprehensive main.py self-tests."
    },
    {
      "id": "function:main.run_comprehensive_tests",
      "type": "function",
      "name": "run_comprehensive_tests",
      "path": "main.py",
      "summary": "Standardized wrapper exposing main_module_tests through the global testing convention.",
      "mechanism": "Delegates directly to main_module_tests, returning its boolean success flag for runners expecting the shared contract.",
      "quality": "stable",
      "concerns": [
        "No additional logging or telemetry is emitted, so upstream callers must inspect TestSuite output themselves."
      ],
      "opportunities": [
        "Emit a concise summary line to improve discoverability when invoked via menu commands."
      ],
      "tests": null,
      "notes": "Allows run_all_tests.py to execute main's suite alongside other modules."
    },
    {
      "id": "class:analytics._State",
      "type": "class",
      "name": "_State",
      "path": "analytics.py",
      "summary": "Module-local container for transient analytics extras between action execution and logging.",
      "mechanism": "Provides a namespace with a single extras attribute that set_transient_extras mutates and pop_transient_extras clears.",
      "quality": "stable",
      "concerns": [
        "Not thread-safe; concurrent invocations could overwrite extras unexpectedly."
      ],
      "opportunities": [
        "Replace with contextvars or per-session storage if background workers ever emit analytics in parallel."
      ],
      "tests": null,
      "notes": "Internal implementation detail; callers interact via helper functions."
    },
    {
      "id": "function:analytics.set_transient_extras",
      "type": "function",
      "name": "set_transient_extras",
      "path": "analytics.py",
      "summary": "Stores optional metadata that will be attached to the next analytics event.",
      "mechanism": "Copies the provided extras dict into the module-level _State container, guarding against serialization errors and falling back to None on failure.",
      "quality": "stable",
      "concerns": [
        "Silent fallback to None makes debugging serialization issues harder when extras are malformed."
      ],
      "opportunities": [
        "Emit structured debug details or validation to highlight discarded extras during development."
      ],
      "tests": null,
      "notes": "Called by run_gedcom_then_api_fallback before exec_actn persists analytics."
    },
    {
      "id": "function:analytics.pop_transient_extras",
      "type": "function",
      "name": "pop_transient_extras",
      "path": "analytics.py",
      "summary": "Retrieves and clears the stored analytics extras payload.",
      "mechanism": "Returns the current _State.extras value and immediately resets the container to None so each analytics event consumes data at most once.",
      "quality": "stable",
      "concerns": [
        "If exec_actn crashes before logging, extras are lost with no retry pathway."
      ],
      "opportunities": [
        "Consider integrating with a context manager to guarantee cleanup on failure paths."
      ],
      "tests": null,
      "notes": "Exec_actn calls this just before writing the analytics entry."
    },
    {
      "id": "function:analytics._get_analytics_path",
      "type": "function",
      "name": "_get_analytics_path",
      "path": "analytics.py",
      "summary": "Resolves the analytics log destination ensuring the Logs directory exists.",
      "mechanism": "Attempts to create Logs/, falling back to the project root on failure and returns a Path to analytics.jsonl.",
      "quality": "stable",
      "concerns": [
        "Falls back silently to the repo root which can scatter analytics files when permissions differ."
      ],
      "opportunities": [
        "Surface a warning when the fallback triggers to alert operators about directory permission issues."
      ],
      "tests": null,
      "notes": "Used by both event logging and weekly summary generation."
    },
    {
      "id": "function:analytics.log_event",
      "type": "function",
      "name": "log_event",
      "path": "analytics.py",
      "summary": "Appends a timestamped analytics record for the action that just ran.",
      "mechanism": "Builds a JSON payload with outcome, timing, memory, and extras metadata then writes a line into analytics.jsonl using UTF-8 encoding.",
      "quality": "stable",
      "concerns": [
        "Writes are fire-and-forget; IO errors only surface in debug logs which can hide disk issues."
      ],
      "opportunities": [
        "Introduce lightweight buffering or retry for transient filesystem errors when analytics fidelity matters."
      ],
      "tests": null,
      "notes": "Triggered from exec_actn once an action completes."
    },
    {
      "id": "function:analytics._parse_analytics_line",
      "type": "function",
      "name": "_parse_analytics_line",
      "path": "analytics.py",
      "summary": "Safely converts an analytics log line into a Python dictionary.",
      "mechanism": "Strips whitespace, ignores empty lines, and wraps json.loads in a broad exception handler returning None on failures.",
      "quality": "stable",
      "concerns": [
        "Swallowing all exceptions can hide schema drift or partially written lines without telemetry."
      ],
      "opportunities": [
        "Count and report malformed lines so operators know when analytics integrity is degraded."
      ],
      "tests": null,
      "notes": "Helper for weekly summary aggregation."
    },
    {
      "id": "function:analytics._parse_timestamp",
      "type": "function",
      "name": "_parse_timestamp",
      "path": "analytics.py",
      "summary": "Translates ISO-8601 strings from analytics entries into timezone-aware datetimes.",
      "mechanism": "Pulls the ts field and uses datetime.fromisoformat after normalizing a trailing Z to UTC.",
      "quality": "stable",
      "concerns": [
        "Returns None silently on parse errors, reducing visibility into corrupted timestamps."
      ],
      "opportunities": [
        "Emit structured debug logs including the offending value to aid troubleshooting."
      ],
      "tests": null,
      "notes": "Used when filtering records within a rolling window."
    },
    {
      "id": "function:analytics._initialize_action_entry",
      "type": "function",
      "name": "_initialize_action_entry",
      "path": "analytics.py",
      "summary": "Creates the accumulator structure for per-action analytics rollups.",
      "mechanism": "Returns a dict with run counters and running totals for duration and memory before averages are computed.",
      "quality": "stable",
      "concerns": [
        "Structure is implicit; callers must remember key names when extending metrics."
      ],
      "opportunities": [
        "Switch to a dataclass or TypedDict to make downstream usage safer."
      ],
      "tests": null,
      "notes": "Internal helper invoked by generate_weekly_summary."
    },
    {
      "id": "function:analytics._update_action_entry",
      "type": "function",
      "name": "_update_action_entry",
      "path": "analytics.py",
      "summary": "Accumulates run statistics for a single analytics record into the rollup entry.",
      "mechanism": "Increments run counters, tallies successes, and adds duration/memory totals when numeric values are present.",
      "quality": "stable",
      "concerns": [
        "Non-numeric values are ignored silently, which can hide upstream logging regressions."
      ],
      "opportunities": [
        "Track skipped fields to flag analytics schema drift during weekly summaries."
      ],
      "tests": null,
      "notes": "Paired with _finalize_action_entry to produce averages."
    },
    {
      "id": "function:analytics._finalize_action_entry",
      "type": "function",
      "name": "_finalize_action_entry",
      "path": "analytics.py",
      "summary": "Computes success rate and average metrics for a completed rollup entry.",
      "mechanism": "Derives averages from the aggregated totals, guards against divide-by-zero, and removes intermediate counters for a compact report.",
      "quality": "stable",
      "concerns": [
        "Drops raw totals, preventing later secondary calculations like variance without reprocessing logs."
      ],
      "opportunities": [
        "Retain optional verbose totals when callers request additional analytics detail."
      ],
      "tests": null,
      "notes": "Finalize pass executed after generate_weekly_summary processes all records."
    },
    {
      "id": "function:analytics.generate_weekly_summary",
      "type": "function",
      "name": "generate_weekly_summary",
      "path": "analytics.py",
      "summary": "Aggregates analytics.jsonl entries into per-action statistics for a rolling window.",
      "mechanism": "Iterates recent log records, parses timestamps, creates entries as needed, updates counters, and finalizes averages before returning a dict keyed by action name.",
      "quality": "stable",
      "concerns": [
        "Reads the entire log file on each invocation, which could grow expensive without compaction."
      ],
      "opportunities": [
        "Persist incremental summaries or cap log size to keep weekly reports fast."
      ],
      "tests": null,
      "notes": "Print_weekly_summary builds on this data structure for operator feedback."
    },
    {
      "id": "function:analytics.print_weekly_summary",
      "type": "function",
      "name": "print_weekly_summary",
      "path": "analytics.py",
      "summary": "Formats the weekly summary data for human-friendly console output.",
      "mechanism": "Calls generate_weekly_summary, emits a header, and prints runs, success rate, average duration, and memory per action sorted alphabetically.",
      "quality": "stable",
      "concerns": [
        "Outputs directly to stdout, limiting reuse in automated dashboards."
      ],
      "opportunities": [
        "Return the formatted lines or accept a stream parameter to support alternative presentation layers."
      ],
      "tests": null,
      "notes": "Used when operators inspect recent action performance manually."
    },
    {
      "id": "class:analyze_test_quality.TestQualityAnalyzer",
      "type": "class",
      "name": "TestQualityAnalyzer",
      "path": "analyze_test_quality.py",
      "summary": "Aggregates heuristic checks to score and report on module test quality.",
      "mechanism": "Stores cumulative statistics, per-module findings, and orchestrates AST-based inspections across the repository.",
      "quality": "stable",
      "concerns": [
        "Processes files sequentially; large repositories could benefit from batch parallelization."
      ],
      "opportunities": [
        "Surface severity levels per issue to prioritize remediation work."
      ],
      "tests": null,
      "notes": "Executed via script entrypoint to assess adherence to anti-smoke-test policy."
    },
    {
      "id": "method:TestQualityAnalyzer.__init__",
      "type": "method",
      "name": "TestQualityAnalyzer.__init__",
      "path": "analyze_test_quality.py",
      "summary": "Initializes aggregation structures for test quality analysis.",
      "mechanism": "Sets up result containers, issue maps, and baseline counters used during repository traversal.",
      "quality": "stable",
      "concerns": [
        "Direct instantiation is required before analysis; consider classmethod factory for custom exclusions."
      ],
      "opportunities": [
        "Persist baseline stats to disk so deviations can be tracked between runs."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:TestQualityAnalyzer.analyze_all_modules",
      "type": "method",
      "name": "TestQualityAnalyzer.analyze_all_modules",
      "path": "analyze_test_quality.py",
      "summary": "Walks the repository and analyzes every Python module discovered.",
      "mechanism": "Uses os.walk with skip lists, normalizes file paths, and delegates inspection of each file to analyze_module.",
      "quality": "stable",
      "concerns": [
        "Directory exclusions are hard-coded; new workspace folders must be added manually."
      ],
      "opportunities": [
        "Accept CLI arguments to customize inclusion/exclusion without editing source."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:TestQualityAnalyzer.analyze_module",
      "type": "method",
      "name": "TestQualityAnalyzer.analyze_module",
      "path": "analyze_test_quality.py",
      "summary": "Parses a single module, extracts test functions, and records issues.",
      "mechanism": "Reads file content, builds an AST, collects test_* functions, updates statistics, and aggregates per-test findings.",
      "quality": "stable",
      "concerns": [
        "Entire file is read into memory; very large artifacts might need streaming."
      ],
      "opportunities": [
        "Short-circuit once failures exceed a threshold to speed up noisy modules."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:TestQualityAnalyzer._find_test_functions",
      "type": "method",
      "name": "TestQualityAnalyzer._find_test_functions",
      "path": "analyze_test_quality.py",
      "summary": "Locates test_* functions and captures their source segments.",
      "mechanism": "Traverses the AST to find FunctionDef nodes, slices the original source lines, and returns metadata dictionaries.",
      "quality": "stable",
      "concerns": [
        "Source slicing relies on end_lineno; Python <3.8 compatibility would need manual line counting."
      ],
      "opportunities": [
        "Include decorator metadata to spot skipped tests or fixtures."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:TestQualityAnalyzer._analyze_test_function",
      "type": "method",
      "name": "TestQualityAnalyzer._analyze_test_function",
      "path": "analyze_test_quality.py",
      "summary": "Runs a suite of heuristics against a single test function.",
      "mechanism": "Evaluates assertions, smoke patterns, return semantics, auth dependencies, and minimal logic heuristics to flag quality gaps.",
      "quality": "stable",
      "concerns": [
        "Returns only text strings; downstream tooling must parse to categorize severity."
      ],
      "opportunities": [
        "Return structured issue objects (type, severity) for richer reporting."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:TestQualityAnalyzer._is_smoke_test",
      "type": "method",
      "name": "TestQualityAnalyzer._is_smoke_test",
      "path": "analyze_test_quality.py",
      "summary": "Detects trivial tests that simply return True.",
      "mechanism": "Strips comments, inspects minimal bodies, and flags functions that short-circuit with constant success.",
      "quality": "stable",
      "concerns": [
        "Whitespace heuristics may miss multi-line return patterns."
      ],
      "opportunities": [
        "Upgrade to AST analysis for more precise detection of constant returns."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:TestQualityAnalyzer._has_explicit_assertions",
      "type": "method",
      "name": "TestQualityAnalyzer._has_explicit_assertions",
      "path": "analyze_test_quality.py",
      "summary": "Searches for standard assertion statements within test source.",
      "mechanism": "Uses regex patterns to detect assert keywords and unittest-style assertion helpers.",
      "quality": "stable",
      "concerns": [
        "Regex heuristics can produce false positives for strings mentioning assert."
      ],
      "opportunities": [
        "Parse AST to differentiate code from string literals or comments."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:TestQualityAnalyzer._has_boolean_return_pattern",
      "type": "method",
      "name": "TestQualityAnalyzer._has_boolean_return_pattern",
      "path": "analyze_test_quality.py",
      "summary": "Checks for boolean return statements signaling validation logic.",
      "mechanism": "Finds return True/False patterns and multiple return statements to infer pass/fail semantics.",
      "quality": "stable",
      "concerns": [
        "Does not validate surrounding conditions; complex expressions may be overlooked."
      ],
      "opportunities": [
        "Inspect AST Return nodes to capture richer boolean expressions."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:TestQualityAnalyzer._has_comparison_return",
      "type": "method",
      "name": "TestQualityAnalyzer._has_comparison_return",
      "path": "analyze_test_quality.py",
      "summary": "Detects comparison operators used within return statements.",
      "mechanism": "Applies regex to find equality/relational operators in returned expressions.",
      "quality": "stable",
      "concerns": [
        "String-based matching may flag comparisons inside comments."
      ],
      "opportunities": [
        "Switch to AST-based analysis for accuracy and resilience."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:TestQualityAnalyzer._has_result_variable_pattern",
      "type": "method",
      "name": "TestQualityAnalyzer._has_result_variable_pattern",
      "path": "analyze_test_quality.py",
      "summary": "Looks for result/success variable assignments validated later.",
      "mechanism": "Matches patterns where result or success variables capture boolean checks before returning the value.",
      "quality": "stable",
      "concerns": [
        "Assumes specific variable names; alternate naming conventions go undetected."
      ],
      "opportunities": [
        "Allow configurable name lists or infer from return statements dynamically."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:TestQualityAnalyzer._has_aggregation_pattern",
      "type": "method",
      "name": "TestQualityAnalyzer._has_aggregation_pattern",
      "path": "analyze_test_quality.py",
      "summary": "Identifies all() or similar aggregation patterns in tests.",
      "mechanism": "Scans for all(...) usage coupled with a return statement to acknowledge aggregated checks.",
      "quality": "stable",
      "concerns": [
        "Ignores any()/custom aggregators; may undercount advanced patterns."
      ],
      "opportunities": [
        "Extend to recognize any() and custom helper invocations via AST analysis."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:TestQualityAnalyzer._has_suite_finish_pattern",
      "type": "method",
      "name": "TestQualityAnalyzer._has_suite_finish_pattern",
      "path": "analyze_test_quality.py",
      "summary": "Detects tests that return TestSuite.finish_suite() results.",
      "mechanism": "Looks for returns referencing finish_suite to treat delegated reporting as valid assertions.",
      "quality": "stable",
      "concerns": [
        "Assumes finish_suite signature remains stable across framework updates."
      ],
      "opportunities": [
        "Generalize to accept other standardized suite completion helpers."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:TestQualityAnalyzer._has_assertions",
      "type": "method",
      "name": "TestQualityAnalyzer._has_assertions",
      "path": "analyze_test_quality.py",
      "summary": "Aggregates assertion heuristics to determine if a test performs validation.",
      "mechanism": "Calls explicit assertion, boolean-return, comparison, result-variable, aggregation, and finish-suite checks, returning True if any succeed.",
      "quality": "stable",
      "concerns": [
        "Composite logic mirrors helper set; forgetting to update when helpers change can desync behavior."
      ],
      "opportunities": [
        "Return which heuristic passed to aid reporting on assertion style distribution."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:TestQualityAnalyzer._always_returns_true",
      "type": "method",
      "name": "TestQualityAnalyzer._always_returns_true",
      "path": "analyze_test_quality.py",
      "summary": "Flags tests ending with unconditional True returns and little logic.",
      "mechanism": "Counts meaningful lines and checks for trailing return True to mark bogus validations.",
      "quality": "stable",
      "concerns": [
        "Short but valid tests may be flagged when they intentionally return True after assertions."
      ],
      "opportunities": [
        "Ignore cases where assertions precede the return to reduce false positives."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:TestQualityAnalyzer._needs_authentication",
      "type": "method",
      "name": "TestQualityAnalyzer._needs_authentication",
      "path": "analyze_test_quality.py",
      "summary": "Heuristically identifies tests that depend on live authentication flows.",
      "mechanism": "Matches known session/auth keywords to point operators at tests requiring valid credentials.",
      "quality": "stable",
      "concerns": [
        "Keyword list may miss new authentication helpers introduced later."
      ],
      "opportunities": [
        "Load patterns from configuration so auth checks stay in sync with session utilities."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:TestQualityAnalyzer._is_minimal_test",
      "type": "method",
      "name": "TestQualityAnalyzer._is_minimal_test",
      "path": "analyze_test_quality.py",
      "summary": "Counts executable lines to label extremely small tests.",
      "mechanism": "Skips docstrings/comments, tallies code lines, and flags tests with fewer than three statements.",
      "quality": "stable",
      "concerns": [
        "Line-based heuristic ignores logical complexity; multi-statement lines may slip through."
      ],
      "opportunities": [
        "Incorporate AST node counts to capture compound statements accurately."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:TestQualityAnalyzer.print_report",
      "type": "method",
      "name": "TestQualityAnalyzer.print_report",
      "path": "analyze_test_quality.py",
      "summary": "Outputs aggregated statistics and detailed issues to stdout.",
      "mechanism": "Formats overall counts, lists module issues, and prints parse/analysis errors when present.",
      "quality": "stable",
      "concerns": [
        "Reports only to console; callers must capture stdout for further processing."
      ],
      "opportunities": [
        "Emit structured JSON alongside console output for CI integration."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "script:analyze_test_quality.__main__",
      "type": "script",
      "name": "analyze_test_quality.__main__",
      "path": "analyze_test_quality.py",
      "summary": "Entry point that runs the analyzer across the repo and prints the report.",
      "mechanism": "Instantiates TestQualityAnalyzer with default skips, executes full analysis, and outputs findings.",
      "quality": "stable",
      "concerns": [
        "Hard-coded configuration limits reuse in other repositories."
      ],
      "opportunities": [
        "Expose CLI arguments so callers can customize filters and output formats."
      ],
      "tests": null,
      "notes": "Invoked when the script is executed directly."
    },
    {
      "id": "file:analyze_test_quality.py",
      "type": "file",
      "name": "analyze_test_quality.py",
      "path": "analyze_test_quality.py",
      "summary": "CLI wrapper around TestQualityAnalyzer heuristics for smoke-test detection and assertion coverage reporting.",
      "mechanism": "Exposes TestQualityAnalyzer class plus __main__ hook to walk repository files and emit console diagnostics.",
      "quality": "stable",
      "concerns": [
        "Tightly couples analyzer configuration to script; reuse in other repos requires editing source."
      ],
      "opportunities": [
        "Export analyzer entrypoints so CI jobs can import without invoking __main__."
      ],
      "tests": null,
      "notes": "File node added to anchor class and script edges."
    },
    {
      "id": "file:code_quality_checker.py",
      "type": "file",
      "name": "code_quality_checker.py",
      "path": "code_quality_checker.py",
      "summary": "Aggregates code quality heuristics, reporting helpers, and the CLI/test harness entrypoints.",
      "mechanism": "Defines QualityMetrics dataclass, CodeQualityChecker engine, module-level tests, and a __main__ runner for ad-hoc scans.",
      "quality": "stable",
      "concerns": [
        "Hard-coded directory depth and exclusions limit reuse across varied repo layouts."
      ],
      "opportunities": [
        "Surface configuration knobs via CLI flags or settings module."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "class:code_quality_checker.QualityMetrics",
      "type": "class",
      "name": "QualityMetrics",
      "path": "code_quality_checker.py",
      "summary": "Immutable record of per-file quality statistics produced by CodeQualityChecker.",
      "mechanism": "Stores function counts, annotation coverage, complexity markers, and violation notes for later reporting.",
      "quality": "stable",
      "concerns": [
        "Violation list can grow unbounded for large files, inflating memory use during bulk scans."
      ],
      "opportunities": [
        "Add helper to collapse similar violations to reduce report noise."
      ],
      "tests": null,
      "notes": "Frozen dataclass to keep metrics hashable if caching is introduced."
    },
    {
      "id": "method:QualityMetrics.type_hint_coverage",
      "type": "method",
      "name": "QualityMetrics.type_hint_coverage",
      "path": "code_quality_checker.py",
      "summary": "Computes percentage of analyzed functions that include type hints.",
      "mechanism": "Returns 100 when no functions exist, otherwise divides annotated count by total and scales to percent.",
      "quality": "stable",
      "concerns": [
        "Treats pytest-style tests as fully annotated, which can overstate coverage ratios."
      ],
      "opportunities": [
        "Differentiate production vs. test functions to publish two coverage metrics."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:QualityMetrics.quality_score",
      "type": "method",
      "name": "QualityMetrics.quality_score",
      "path": "code_quality_checker.py",
      "summary": "Derives composite quality score combining annotations, complexity, and violations.",
      "mechanism": "Blends type hint coverage with weighted penalties for long/complex functions and recorded rule breaches, clamping to 0-100.",
      "quality": "stable",
      "concerns": [
        "Penalty weights are hard-coded; tuning requires code edits rather than configuration."
      ],
      "opportunities": [
        "Expose weighting configuration so teams can align scoring with evolving standards."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "class:code_quality_checker.CodeQualityChecker",
      "type": "class",
      "name": "CodeQualityChecker",
      "path": "code_quality_checker.py",
      "summary": "AST-driven engine that inspects Python files for basic quality heuristics.",
      "mechanism": "Parses modules, tallies annotations, lengths, and complexity, flags mutable defaults, and aggregates violations per file.",
      "quality": "stable",
      "concerns": [
        "Swallows all exceptions in check_file, making it hard to triage parse-specific failures."
      ],
      "opportunities": [
        "Return structured error details so callers can surface parse issues separately from quality scores."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:CodeQualityChecker.__init__",
      "type": "method",
      "name": "CodeQualityChecker.__init__",
      "path": "code_quality_checker.py",
      "summary": "Initializes violation tracking structures.",
      "mechanism": "Seeds in-memory dictionaries and lists for later population of per-file metrics and rule breaches.",
      "quality": "stable",
      "concerns": [
        "Does not accept configuration overrides; consumers must mutate attributes after construction."
      ],
      "opportunities": [
        "Allow injection of rule configuration to support different project standards."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:CodeQualityChecker.check_file",
      "type": "method",
      "name": "CodeQualityChecker.check_file",
      "path": "code_quality_checker.py",
      "summary": "Loads source file and analyzes it for quality issues.",
      "mechanism": "Reads file contents, builds AST, delegates to _analyze_ast, and wraps failures in a sentinel QualityMetrics payload.",
      "quality": "stable",
      "concerns": [
        "Broad exception handler only logs error message, forfeiting stack context for debugging."
      ],
      "opportunities": [
        "Surface exception data alongside metrics so CI consumers can fail fast on syntax errors."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:CodeQualityChecker._analyze_ast",
      "type": "method",
      "name": "CodeQualityChecker._analyze_ast",
      "path": "code_quality_checker.py",
      "summary": "Traverses AST to compute metrics and collect violations.",
      "mechanism": "Iterates functions, checks annotations, calculates length and complexity, and evaluates mutable defaults before building QualityMetrics.",
      "quality": "stable",
      "concerns": [
        "Length threshold of 400 lines is extremely high and may miss overly large functions."
      ],
      "opportunities": [
        "Parameterize thresholds and reuse for targeted refactoring reports."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:CodeQualityChecker._has_type_hints",
      "type": "method",
      "name": "CodeQualityChecker._has_type_hints",
      "path": "code_quality_checker.py",
      "summary": "Determines whether a function includes annotations.",
      "mechanism": "Checks for return annotation and argument annotations among positional parameters to qualify coverage.",
      "quality": "stable",
      "concerns": [
        "Ignores keyword-only and positional-only parameters, undercounting hints in modern signatures."
      ],
      "opportunities": [
        "Inspect kwonlyargs and posonlyargs to account for all function parameter kinds."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:CodeQualityChecker._calculate_complexity",
      "type": "method",
      "name": "CodeQualityChecker._calculate_complexity",
      "path": "code_quality_checker.py",
      "summary": "Computes simplified cyclomatic complexity score.",
      "mechanism": "Walks function AST to count branching constructs such as if/loop/except nodes, starting from base 1.",
      "quality": "stable",
      "concerns": [
        "Treats boolean operators as individual branches without weighting nested conditions differently."
      ],
      "opportunities": [
        "Adopt full cyclomatic formula or integrate radon metrics for richer insights."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:CodeQualityChecker._has_mutable_defaults",
      "type": "method",
      "name": "CodeQualityChecker._has_mutable_defaults",
      "path": "code_quality_checker.py",
      "summary": "Detects mutable default arguments in function definitions.",
      "mechanism": "Scans default values for list, dict, or set literals and flags them as violations.",
      "quality": "stable",
      "concerns": [
        "Does not inspect keyword-only defaults, missing part of the signature."
      ],
      "opportunities": [
        "Extend to keyword defaults and consider tuple-of-mutable patterns as well."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:CodeQualityChecker.check_directory",
      "type": "method",
      "name": "CodeQualityChecker.check_directory",
      "path": "code_quality_checker.py",
      "summary": "Recursively walks directories and analyzes eligible Python files.",
      "mechanism": "Applies exclusion patterns, depth limit, and calls check_file for each discovered module, assembling a metrics dictionary keyed by path.",
      "quality": "stable",
      "concerns": [
        "Depth guard skips nested packages, so large subsystems may never be evaluated."
      ],
      "opportunities": [
        "Allow configurable depth or explicit include lists for targeted scans."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "method:CodeQualityChecker.generate_report",
      "type": "method",
      "name": "CodeQualityChecker.generate_report",
      "path": "code_quality_checker.py",
      "summary": "Formats aggregated metrics into a human-readable report string.",
      "mechanism": "Calculates totals and averages, sorts results by quality score, and summarizes violations with bullet-point output.",
      "quality": "stable",
      "concerns": [
        "Only returns plain text, forcing callers to parse output to integrate with dashboards."
      ],
      "opportunities": [
        "Emit structured JSON or markdown tables alongside console-friendly text."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:code_quality_checker.code_quality_checker_module_tests",
      "type": "function",
      "name": "code_quality_checker.code_quality_checker_module_tests",
      "path": "code_quality_checker.py",
      "summary": "Module-local tests validating QualityMetrics scoring and CodeQualityChecker setup.",
      "mechanism": "Builds a TestSuite, defines assertions for metrics calculations and checker initialization, then runs the suite.",
      "quality": "stable",
      "concerns": [
        "Only covers happy path scenarios; no fixtures exercise AST failures or directory traversal logic."
      ],
      "opportunities": [
        "Add regression tests for violation aggregation to detect scoring changes quickly."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:code_quality_checker.run_comprehensive_tests",
      "type": "function",
      "name": "code_quality_checker.run_comprehensive_tests",
      "path": "code_quality_checker.py",
      "summary": "Wrapper produced by create_standard_test_runner to execute module tests via shared harness.",
      "mechanism": "Delegates to create_standard_test_runner with code_quality_checker_module_tests, returning a callable used by __main__.",
      "quality": "stable",
      "concerns": [
        "Exports only as closure; harder to introspect or extend without reading test utilities implementation."
      ],
      "opportunities": [
        "Provide explicit docstring noting expected return semantics for downstream tooling."
      ],
      "tests": null,
      "notes": "Callable stored at module level for reuse across scripts."
    },
    {
      "id": "script:code_quality_checker.__main__",
      "type": "script",
      "name": "code_quality_checker.__main__",
      "path": "code_quality_checker.py",
      "summary": "Command-line entry that scans the current directory and prints a quality report before running tests.",
      "mechanism": "Instantiates CodeQualityChecker, analyzes repository files, renders report text, then executes run_comprehensive_tests for verification.",
      "quality": "stable",
      "concerns": [
        "Always scans repository root; cannot target subdirectories or alternate paths via CLI."
      ],
      "opportunities": [
        "Accept arguments for path, exclusions, and output file to integrate with CI more flexibly."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "file:test_utilities.py",
      "type": "file",
      "name": "test_utilities.py",
      "path": "test_utilities.py",
      "summary": "Shared testing toolbox covering mocks, validators, and standard test runner patterns.",
      "mechanism": "Defines reusable helper functions for unit tests, including factories for functions, validators, database fixtures, and module-level test runners.",
      "quality": "stable",
      "concerns": [
        "File has grown large, mixing simple helpers with database fixtures and could benefit from section splits."
      ],
      "opportunities": [
        "Break into thematic modules (factories, validators, db mocks) to improve discoverability."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "class:test_utilities.EmptyTestService",
      "type": "class",
      "name": "EmptyTestService",
      "path": "test_utilities.py",
      "summary": "Mixin base for service stubs that need no initialization logic.",
      "mechanism": "Provides a single inheritance point so empty test service classes no longer repeat bare pass definitions.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Document typical usage patterns so contributors discover the helper quickly."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.mock_func",
      "type": "function",
      "name": "test_utilities.mock_func",
      "path": "test_utilities.py",
      "summary": "Returns a fixed string for registry and execution checks.",
      "mechanism": "One-liner that always yields 'test_result' to validate wiring of function registries.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.mock_func_with_param",
      "type": "function",
      "name": "test_utilities.mock_func_with_param",
      "path": "test_utilities.py",
      "summary": "Simple arithmetic helper used to test parameterized delegations.",
      "mechanism": "Doubles the provided integer to confirm argument passing in harness code.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.sample_function",
      "type": "function",
      "name": "test_utilities.sample_function",
      "path": "test_utilities.py",
      "summary": "Lightweight sample function for registration smoke tests.",
      "mechanism": "Returns 'sample_result' so registry lookups can assert expected outputs.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.temp_function",
      "type": "function",
      "name": "test_utilities.temp_function",
      "path": "test_utilities.py",
      "summary": "Temporary helper for cleanup path verification.",
      "mechanism": "Returns 'temp' and is often removed from registries to ensure deregistration works.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.safe_func",
      "type": "function",
      "name": "test_utilities.safe_func",
      "path": "test_utilities.py",
      "summary": "Baseline helper used when exercising safe execution decorators.",
      "mechanism": "Returns 'safe_result' without side effects to keep focus on decorator mechanics.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.decorated_safe_func",
      "type": "function",
      "name": "test_utilities.decorated_safe_func",
      "path": "test_utilities.py",
      "summary": "Secondary safe helper to validate decorator stacking.",
      "mechanism": "Returns 'decorated_safe_result' so wrappers can detect distinct payloads.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.create_test_function",
      "type": "function",
      "name": "test_utilities.create_test_function",
      "path": "test_utilities.py",
      "summary": "Factory producing zero-arg functions that return predetermined values.",
      "mechanism": "Captures return_value in closure, enabling concise creation of deterministic callbacks for tests.",
      "quality": "stable",
      "concerns": [
        "Does not copy metadata; debugging output lacks original context."
      ],
      "opportunities": [
        "Attach __name__ or __doc__ metadata so generated functions are easier to identify in reports."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.create_parameterized_test_function",
      "type": "function",
      "name": "test_utilities.create_parameterized_test_function",
      "path": "test_utilities.py",
      "summary": "Factory building single-argument math helpers for parameterized tests.",
      "mechanism": "Generates functions that multiply/add/subtract by a factor, reducing repeated lambda definitions in suites.",
      "quality": "stable",
      "concerns": [
        "Silent fallback returns original input when operation is unknown, potentially hiding typos."
      ],
      "opportunities": [
        "Raise ValueError on unsupported operations to fail fast during suite setup."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.get_test_function",
      "type": "function",
      "name": "test_utilities.get_test_function",
      "path": "test_utilities.py",
      "summary": "Registry lookup for frequently reused mock functions.",
      "mechanism": "Validates presence in TEST_FUNCTIONS and returns the stored callable, raising KeyError for missing entries.",
      "quality": "stable",
      "concerns": [
        "Registry is module-scoped; modifications during tests may leak between cases."
      ],
      "opportunities": [
        "Expose context manager to temporarily extend registry without affecting global state."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.create_property_delegator",
      "type": "function",
      "name": "test_utilities.create_property_delegator",
      "path": "test_utilities.py",
      "summary": "Property factory forwarding attribute access to composed objects.",
      "mechanism": "Returns a property descriptor whose getter pulls target_attr and reads property_name, enabling DRY delegation.",
      "quality": "stable",
      "concerns": [
        "Returns None silently when composed object is absent, which may mask wiring mistakes."
      ],
      "opportunities": [
        "Allow optional default or raise flag so consumers can detect missing delegates early."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.create_method_delegator",
      "type": "function",
      "name": "test_utilities.create_method_delegator",
      "path": "test_utilities.py",
      "summary": "Builds delegating methods that forward to composed object methods.",
      "mechanism": "Returns a closure that fetches target_attr, resolves method_name, and invokes it with provided arguments.",
      "quality": "stable",
      "concerns": [
        "AttributeError messages lack owning class context when delegation fails."
      ],
      "opportunities": [
        "Include repr(self) details in exceptions to simplify debugging of wiring issues."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.create_range_validator",
      "type": "function",
      "name": "test_utilities.create_range_validator",
      "path": "test_utilities.py",
      "summary": "Generates functions checking that values fall within configured bounds.",
      "mechanism": "Produces validator closures supporting inclusive or exclusive comparisons with error suppression for invalid types.",
      "quality": "stable",
      "concerns": [
        "Catches TypeError/ValueError broadly, so unexpected comparisons simply return False without diagnostics."
      ],
      "opportunities": [
        "Add optional logging hook to highlight validation failures during tests."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.create_type_validator",
      "type": "function",
      "name": "test_utilities.create_type_validator",
      "path": "test_utilities.py",
      "summary": "Builds validators ensuring values match expected types.",
      "mechanism": "Supports optional None handling and wraps isinstance checks inside generated closures.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.create_string_validator",
      "type": "function",
      "name": "test_utilities.create_string_validator",
      "path": "test_utilities.py",
      "summary": "Produces string validators with length and whitespace controls.",
      "mechanism": "Wraps trimming, emptiness checks, and min/max length enforcement in a reusable closure.",
      "quality": "stable",
      "concerns": [
        "Length checks treat multi-byte characters uniformly; tests relying on code points may diverge."
      ],
      "opportunities": [
        "Expose normalization hook so callers can adjust trimming or case handling."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.create_composite_validator",
      "type": "function",
      "name": "test_utilities.create_composite_validator",
      "path": "test_utilities.py",
      "summary": "Chains validators so all conditions must pass.",
      "mechanism": "Returns closure invoking each provided validator and aggregating via all().",
      "quality": "stable",
      "concerns": [
        "No short-circuit diagnostics; hard to know which inner validator failed."
      ],
      "opportunities": [
        "Return tuple of results or first failing validator for richer error reporting."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.create_file_extension_validator",
      "type": "function",
      "name": "test_utilities.create_file_extension_validator",
      "path": "test_utilities.py",
      "summary": "Factory for validating file extensions against an allow list.",
      "mechanism": "Normalizes candidate paths into Path objects and compares suffix against lowercased allowed extensions.",
      "quality": "stable",
      "concerns": [
        "Rebuilds lowercase extension list on each call, incurring repeated allocations."
      ],
      "opportunities": [
        "Cache normalized extensions outside the closure to avoid per-call list construction."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.create_standard_test_runner",
      "type": "function",
      "name": "test_utilities.create_standard_test_runner",
      "path": "test_utilities.py",
      "summary": "Wraps a module test function with standardized error handling.",
      "mechanism": "Returns closure that invokes the provided module_test_function and traps exceptions to emit a readable failure string.",
      "quality": "stable",
      "concerns": [
        "Catches all exceptions and only prints message, dropping traceback context needed for debugging."
      ],
      "opportunities": [
        "Log stack traces or re-raise after logging in debug modes to preserve diagnostics."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.create_mock_session_manager",
      "type": "function",
      "name": "test_utilities.create_mock_session_manager",
      "path": "test_utilities.py",
      "summary": "Builds MagicMock with typical SessionManager attributes stubbed.",
      "mechanism": "Creates MagicMock, sets session_ready flag, wires get_db_conn to return Session-spec mock, and attaches driver/requests mocks.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Allow overrides for frequently customized attributes like rate limiter or api_manager."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.create_test_database",
      "type": "function",
      "name": "test_utilities.create_test_database",
      "path": "test_utilities.py",
      "summary": "Initializes in-memory SQLite database with project metadata.",
      "mechanism": "Creates engine, applies Base metadata, and returns a bound Session for data-access tests.",
      "quality": "stable",
      "concerns": [
        "Recreates schema per call; heavy usage could slow large test suites."
      ],
      "opportunities": [
        "Add optional shared engine cache to reuse setup between tests."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.load_test_gedcom",
      "type": "function",
      "name": "test_utilities.load_test_gedcom",
      "path": "test_utilities.py",
      "summary": "Loads GEDCOM fixture using configured path when available.",
      "mechanism": "Imports gedcom library, resolves path from config_schema fallback, and returns parsed structure or None on failure.",
      "quality": "stable",
      "concerns": [
        "Swallows all exceptions, so parse errors and missing files are indistinguishable."
      ],
      "opportunities": [
        "Return error details to aid troubleshooting when GEDCOM fixtures fail to load."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.create_test_person",
      "type": "function",
      "name": "test_utilities.create_test_person",
      "path": "test_utilities.py",
      "summary": "Produces MagicMock shaped like Person ORM entity for tests.",
      "mechanism": "Constructs Person-spec mock with DNA match stub when cm_dna provided, populating core attributes and engagement score.",
      "quality": "stable",
      "concerns": [
        "Embeds default UUID; forgetting to override can cause duplicate key assumptions in tests."
      ],
      "opportunities": [
        "Support auto-generating unique IDs to reduce collision risk in larger suites."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.run_parameterized_tests",
      "type": "function",
      "name": "test_utilities.run_parameterized_tests",
      "path": "test_utilities.py",
      "summary": "Automates registering parameterized cases with TestSuite.",
      "mechanism": "Iterates test case tuples and calls suite.run_test with the provided metadata.",
      "quality": "stable",
      "concerns": [
        "Treats all cases as direct type; lacks hooks for async or fixture-driven tests."
      ],
      "opportunities": [
        "Accept optional keyword args to better describe scenario metadata."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.assert_function_behavior",
      "type": "function",
      "name": "test_utilities.assert_function_behavior",
      "path": "test_utilities.py",
      "summary": "Assertion helper verifying function output for given arguments.",
      "mechanism": "Invokes target callable, compares result with expectation, and raises AssertionError with helpful message.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.create_test_session",
      "type": "function",
      "name": "test_utilities.create_test_session",
      "path": "test_utilities.py",
      "summary": "Convenience wrapper returning DatabaseManager-backed session.",
      "mechanism": "Instantiates DatabaseManager and calls get_session to deliver ready-to-use Session for tests.",
      "quality": "stable",
      "concerns": [
        "Creates full DatabaseManager per call; repeated usage may be heavier than necessary."
      ],
      "opportunities": [
        "Accept optional shared manager instance to reuse connection pools during suites."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.assert_database_state",
      "type": "function",
      "name": "test_utilities.assert_database_state",
      "path": "test_utilities.py",
      "summary": "Validates row counts for ORM queries in tests.",
      "mechanism": "Builds SQLAlchemy query from model and filters, counts results, and asserts they match expected_count.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.mock_api_response",
      "type": "function",
      "name": "test_utilities.mock_api_response",
      "path": "test_utilities.py",
      "summary": "Produces MagicMock resembling requests.Response for API tests.",
      "mechanism": "Configures status_code, json() return value, and optional text payload to simplify HTTP stubbing.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add headers and raise_for_status hooks to cover more response behaviors."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities._test_basic_functions",
      "type": "function",
      "name": "test_utilities._test_basic_functions",
      "path": "test_utilities.py",
      "summary": "Exercises baseline mock helpers and ensures registry values.",
      "mechanism": "Test helper executed by test_utilities_module_tests to guard utility regressions.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities._test_factory_functions",
      "type": "function",
      "name": "test_utilities._test_factory_functions",
      "path": "test_utilities.py",
      "summary": "Validates generated functions from factory helpers.",
      "mechanism": "Test helper executed by test_utilities_module_tests to guard utility regressions.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities._test_function_registry",
      "type": "function",
      "name": "test_utilities._test_function_registry",
      "path": "test_utilities.py",
      "summary": "Checks registry lookup returns expected callables.",
      "mechanism": "Test helper executed by test_utilities_module_tests to guard utility regressions.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities._test_runner_factory",
      "type": "function",
      "name": "test_utilities._test_runner_factory",
      "path": "test_utilities.py",
      "summary": "Confirms standard test runner invokes provided function.",
      "mechanism": "Test helper executed by test_utilities_module_tests to guard utility regressions.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities._test_assert_function_behavior",
      "type": "function",
      "name": "test_utilities._test_assert_function_behavior",
      "path": "test_utilities.py",
      "summary": "Ensures assertion helper works for success paths.",
      "mechanism": "Test helper executed by test_utilities_module_tests to guard utility regressions.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities._test_mock_api_response",
      "type": "function",
      "name": "test_utilities._test_mock_api_response",
      "path": "test_utilities.py",
      "summary": "Validates mock API response helper populates fields.",
      "mechanism": "Test helper executed by test_utilities_module_tests to guard utility regressions.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities._test_create_mock_session_manager",
      "type": "function",
      "name": "test_utilities._test_create_mock_session_manager",
      "path": "test_utilities.py",
      "summary": "Confirms session manager mock exposes expected attributes.",
      "mechanism": "Test helper executed by test_utilities_module_tests to guard utility regressions.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities._test_create_test_database",
      "type": "function",
      "name": "test_utilities._test_create_test_database",
      "path": "test_utilities.py",
      "summary": "Smoke tests in-memory database helper.",
      "mechanism": "Test helper executed by test_utilities_module_tests to guard utility regressions.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities._test_create_test_person",
      "type": "function",
      "name": "test_utilities._test_create_test_person",
      "path": "test_utilities.py",
      "summary": "Checks person factory populates default and DNA scenarios.",
      "mechanism": "Test helper executed by test_utilities_module_tests to guard utility regressions.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.test_utilities_module_tests",
      "type": "function",
      "name": "test_utilities.test_utilities_module_tests",
      "path": "test_utilities.py",
      "summary": "Aggregates TestSuite checks covering utility helpers in this module.",
      "mechanism": "Constructs TestSuite, registers validation helpers, runs with suppress_logging, and returns suite.finish_suite().",
      "quality": "stable",
      "concerns": [
        "Hardcodes test metadata strings; duplication between tuple fields could drift."
      ],
      "opportunities": [
        "Switch to dataclass-based test case descriptions for clarity and reuse."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:test_utilities.run_comprehensive_tests",
      "type": "function",
      "name": "test_utilities.run_comprehensive_tests",
      "path": "test_utilities.py",
      "summary": "Standardized entry used by other modules to run these tests.",
      "mechanism": "Created via create_standard_test_runner bound to test_utilities_module_tests, mirroring pattern across repo.",
      "quality": "stable",
      "concerns": [
        "Function object is generated dynamically; static analysis may not detect linkage automatically."
      ],
      "opportunities": [
        "Consider exporting factory binding metadata for documentation tools."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "script:test_utilities.__main__",
      "type": "script",
      "name": "test_utilities.__main__",
      "path": "test_utilities.py",
      "summary": "Direct invocation pathway that runs the module tests and exits with status code.",
      "mechanism": "Calls test_utilities_module_tests and exits with 0/1 depending on success to support CLI use.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Emit richer CLI output (timings, failure summaries) to align with other scripts."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "file:action9_process_productive.py",
      "type": "file",
      "name": "action9_process_productive.py",
      "path": "action9_process_productive.py",
      "summary": "Action 9 pipeline that converts productive conversations into acknowledgements and Microsoft To-Do tasks with enhanced context.",
      "mechanism": "Orchestrates candidate selection, AI-assisted reply generation, MS Graph task creation with DNA match URLs and tree information, and batched database commits for productive DNA matches.",
      "quality": "stable",
      "concerns": [
        "Single module still encompasses AI, messaging, and task orchestration, making refactors risky."
      ],
      "opportunities": [
        "Extract PersonProcessor and commit managers into dedicated modules for reusability."
      ],
      "tests": null,
      "notes": "Enhanced 2025-11-16 with comprehensive task context including Ancestry profile URLs, DNA comparison links, and tree view links."
    },
    {
      "id": "class:action9.ProcessingState",
      "type": "class",
      "name": "ProcessingState",
      "path": "action9_process_productive.py",
      "summary": "Tracks candidate counts, batch numbers, and aggregate outcomes for Action 9.",
      "mechanism": "Dataclass holding counters for processed/skipped/error candidates plus batch state used by summary logging and commit coordination.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add helper methods for incrementing counters to avoid manual arithmetic throughout the pipeline."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "class:action9.MSGraphState",
      "type": "class",
      "name": "MSGraphState",
      "path": "action9_process_productive.py",
      "summary": "Stores Microsoft To-Do identifiers and retry state for enhanced tasks.",
      "mechanism": "Dataclass caching list name, list id, auth tokens, and retry flags so tasks can be created without repeatedly hitting Graph API discovery endpoints.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Persist successful list discovery between runs to avoid cold-start checks."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "class:action9.DatabaseState",
      "type": "class",
      "name": "DatabaseState",
      "path": "action9_process_productive.py",
      "summary": "Wraps database session, staged logs, and commit thresholds for batch operations.",
      "mechanism": "Maintains SQLAlchemy session along with staged ConversationLog entries and Person status updates, enabling batched commits.",
      "quality": "stable",
      "concerns": [
        "Batch size defaults are duplicated from config; drift will impact commit cadence."
      ],
      "opportunities": [
        "Share commit thresholds with Action 6/8 to keep batching behavior consistent."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "class:action9.MessageConfig",
      "type": "class",
      "name": "MessageConfig",
      "path": "action9_process_productive.py",
      "summary": "Holds message templates and template ids used for acknowledgements and custom replies.",
      "mechanism": "Caches template strings and database identifiers so per-person processing can format emails without repeated lookups.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Cache message template lookups on disk to avoid re-querying each session."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "class:action9.PersonProcessor",
      "type": "class",
      "name": "PersonProcessor",
      "path": "action9_process_productive.py",
      "summary": "Encapsulates per-person productive follow-up workflow.",
      "mechanism": "Retrieves conversation context, filters opt-outs, drives AI extraction, queues MS Graph tasks, and stages replies while updating conversation state.",
      "quality": "stable",
      "concerns": [
        "Large method surface mixes AI handling, MS Graph calls, and database staging."
      ],
      "opportunities": [
        "Split AI extraction and messaging into composable strategies for easier testing."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "class:action9.BatchCommitManager",
      "type": "class",
      "name": "BatchCommitManager",
      "path": "action9_process_productive.py",
      "summary": "Manages batched commit execution for staged logs and person updates.",
      "mechanism": "Tracks staged entities, commits when threshold reached, and logs batch metrics to align with Action 6 reporting style.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Share commit batching utility across action modules to avoid duplication."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:action9_process_productive.process_productive_messages",
      "type": "function",
      "name": "action9_process_productive.process_productive_messages",
      "path": "action9_process_productive.py",
      "summary": "Orchestrates Action 9 productive follow-up pipeline.",
      "mechanism": "Initializes batch state, loads templates, queries eligible people, processes each candidate via PersonProcessor, commits results, and logs summary metrics.",
      "quality": "stable",
      "concerns": [
        "Relies on large global config footprint and multiple decorators which complicate testing."
      ],
      "opportunities": [
        "Introduce orchestration facade that accepts configuration for easier unit testing."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:action9_process_productive._setup_configuration",
      "type": "function",
      "name": "action9_process_productive._setup_configuration",
      "path": "action9_process_productive.py",
      "summary": "Prepares message templates and database handles before processing starts.",
      "mechanism": "Loads acknowledgement/custom reply templates, acquires SessionManager DB connection, and resolves template ids for downstream usage.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Surface missing template errors earlier via health checks."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:action9_process_productive._query_candidates",
      "type": "function",
      "name": "action9_process_productive._query_candidates",
      "path": "action9_process_productive.py",
      "summary": "Builds productive candidate query respecting adaptive follow-up rules.",
      "mechanism": "Constructs SQLAlchemy query with sentiment filters, acknowledgement suppression, and next_action_date gating, applying configured limit.",
      "quality": "stable",
      "concerns": [
        "Query mixes multiple joins; readability suffers without ORM query builder utilities."
      ],
      "opportunities": [
        "Extract query builder to dedicated repository module for reuse."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:action9_process_productive._process_candidates",
      "type": "function",
      "name": "action9_process_productive._process_candidates",
      "path": "action9_process_productive.py",
      "summary": "Iterates candidates, runs PersonProcessor, and triggers batch commits.",
      "mechanism": "Loops through people, updates ProcessingState counters, invokes PersonProcessor.process_person, and uses BatchCommitManager to flush staged changes.",
      "quality": "stable",
      "concerns": [
        "Progress logging uses print + logger, causing mixed outputs in CI logs."
      ],
      "opportunities": [
        "Route progress messages through analytics logger for consistency."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:action9_process_productive._final_commit",
      "type": "function",
      "name": "action9_process_productive._final_commit",
      "path": "action9_process_productive.py",
      "summary": "Flushes any remaining staged logs at the end of processing.",
      "mechanism": "Creates BatchCommitManager to commit lingering logs/person updates when no critical errors occurred.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Share final commit helper with other action modules to avoid duplication."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:action9_process_productive._log_summary",
      "type": "function",
      "name": "action9_process_productive._log_summary",
      "path": "action9_process_productive.py",
      "summary": "Emits aggregated metrics for productive processing run.",
      "mechanism": "Logs totals for candidates, skips, tasks, acknowledgements, and errors, mirroring Action 6 summary formatting.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Push summary metrics to analytics module for centralized reporting."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "file:standard_imports.py",
      "type": "file",
      "name": "standard_imports.py",
      "path": "standard_imports.py",
      "summary": "Centralizes module bootstrapping and shared helpers for the codebase.",
      "mechanism": "Wraps core_imports utilities to standardize logging, auto-registration, and safe import helpers, exporting a curated __all__ list for wildcard usage.",
      "quality": "stable",
      "concerns": [
        "Large __all__ surface encourages wildcard imports that complicate static analysis."
      ],
      "opportunities": [
        "Document a slimmer import contract for modules that only need setup_module."
      ],
      "tests": null,
      "notes": "Widely imported by action modules to ensure consistent logger setup."
    },
    {
      "id": "function:standard_imports.setup_module",
      "type": "function",
      "name": "standard_imports.setup_module",
      "path": "standard_imports.py",
      "summary": "One-line helper that registers a module and returns a namespaced logger.",
      "mechanism": "Calls standardize_module_imports, auto_register_module, and get_logger in sequence, falling back to direct logger creation on error.",
      "quality": "stable",
      "concerns": [
        "Swallows underlying setup exceptions by printing to stdout, which can hide failures in CI."
      ],
      "opportunities": [
        "Expose optional strict mode that re-raises for early detection during tests."
      ],
      "tests": null,
      "notes": "Used at the top of action modules to remove boilerplate."
    },
    {
      "id": "file:config.py",
      "type": "file",
      "name": "config.py",
      "path": "config.py",
      "summary": "Shim module that exposes ConfigManager singletons for project-wide configuration access.",
      "mechanism": "Instantiates ConfigManager from config.config_manager, caches config_schema for consumers, and provides a focused TestSuite verifying exports.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Consider lazy-loading config_schema so CLI utilities can override environment before first access."
      ],
      "tests": "config_module_tests",
      "notes": "Action 10 pulls config_schema here to locate GEDCOM files and scoring rules."
    },
    {
      "id": "file:performance_cache.py",
      "type": "file",
      "name": "performance_cache.py",
      "path": "performance_cache.py",
      "summary": "Provides high-throughput caching primitives tailored for GEDCOM analysis and test acceleration.",
      "mechanism": "Defines PerformanceCache with adaptive eviction plus decorators like cache_result and fast_test_cache to memoize expensive workloads.",
      "quality": "stable",
      "concerns": [
        "Complex adaptive sizing makes deterministic testing difficult without hooks."
      ],
      "opportunities": [
        "Expose lightweight cache stats API for action modules to report hit rates."
      ],
      "tests": null,
      "notes": "Action 10 reuses fast_test_cache to keep module tests responsive."
    },
    {
      "id": "function:performance_cache.fast_test_cache",
      "type": "function",
      "name": "performance_cache.fast_test_cache",
      "path": "performance_cache.py",
      "summary": "Decorator that memoizes test function outputs to avoid recomputing heavy suites.",
      "mechanism": "Builds a memory-only cache keyed by function name and arguments, short-circuiting repeated calls while logging timing information.",
      "quality": "stable",
      "concerns": [
        "Hashing args via str() can collide for complex objects, leading to incorrect reuse."
      ],
      "opportunities": [
        "Adopt a safer serialization strategy for cache keys to prevent collisions."
      ],
      "tests": null,
      "notes": "Decorates action10_module_tests to minimize rerun durations."
    },
    {
      "id": "file:gedcom_cache.py",
      "type": "file",
      "name": "gedcom_cache.py",
      "path": "gedcom_cache.py",
      "summary": "Manages multi-level caching for GEDCOM data with disk persistence and warming routines.",
      "mechanism": "Extends BaseCacheModule to coordinate memory and disk stores, track stats, and expose helpers like load_gedcom_with_aggressive_caching.",
      "quality": "stable",
      "concerns": [
        "Module re-instantiates ConfigManager locally, creating redundant schema loads."
      ],
      "opportunities": [
        "Share a singleton ConfigManager instance to reduce startup overhead."
      ],
      "tests": "gedcom_cache_module_tests",
      "notes": "Action 10 depends on its aggressive load path for faster GEDCOM bootstraps."
    },
    {
      "id": "function:gedcom_cache.load_gedcom_with_aggressive_caching",
      "type": "function",
      "name": "gedcom_cache.load_gedcom_with_aggressive_caching",
      "path": "gedcom_cache.py",
      "summary": "Loads GEDCOM files using memory and disk caches with modification-time invalidation.",
      "mechanism": "Checks in-memory store, reconstructs from disk snapshot when valid, and falls back to constructing GedcomData before refreshing caches and tagging source metadata.",
      "quality": "stable",
      "concerns": [
        "Relies on GedcomData internals (_cache_source) not formally documented."
      ],
      "opportunities": [
        "Return a lightweight DTO describing cache provenance instead of mutating GedcomData."
      ],
      "tests": null,
      "notes": "Directly invoked by action10._load_with_aggressive_caching."
    },
    {
      "id": "file:session_utils.py",
      "type": "file",
      "name": "session_utils.py",
      "path": "session_utils.py",
      "summary": "Defines the global SessionManager registry used across actions and tests.",
      "mechanism": "Stores a cached SessionManager, enforces single registration, and offers helpers to authenticate or reset the shared browser session.",
      "quality": "stable",
      "concerns": [
        "Module-level state makes isolated testing tricky without careful teardown."
      ],
      "opportunities": [
        "Expose context manager utilities to temporarily swap sessions during integration tests."
      ],
      "tests": null,
      "notes": "Action 10's live API test grabs the session through this module."
    },
    {
      "id": "function:session_utils.get_global_session",
      "type": "function",
      "name": "session_utils.get_global_session",
      "path": "session_utils.py",
      "summary": "Returns the cached SessionManager configured by main.py.",
      "mechanism": "Reads the module-level GLOBAL_SESSION container and hands back the registered SessionManager instance, or None when not set.",
      "quality": "stable",
      "concerns": [
        "Returns None silently, requiring callers to assert presence or risk attribute errors."
      ],
      "opportunities": [
        "Provide optional strict flag that raises when no session is registered."
      ],
      "tests": null,
      "notes": "Consumed by action10 API tests to reuse authenticated browser state."
    },
    {
      "id": "file:logging_config.py",
      "type": "file",
      "name": "logging_config.py",
      "path": "logging_config.py",
      "summary": "Configures project logging with aligned formatting, filtering, and console/file handlers.",
      "mechanism": "Builds formatters, installs filters to quiet noisy libraries, and tracks initialization to avoid duplicate handler registration.",
      "quality": "stable",
      "concerns": [
        "Module-level global logger assumes single-process usage; multiprocessing workers may need isolated configs."
      ],
      "opportunities": [
        "Add helper to attach structured JSON handlers for analytics pipelines."
      ],
      "tests": "logging_config_module_tests",
      "notes": "Action 10 invokes setup_logging when executed as a script."
    },
    {
      "id": "function:logging_config.setup_logging",
      "type": "function",
      "name": "logging_config.setup_logging",
      "path": "logging_config.py",
      "summary": "Initializes the shared logger with console and file handlers plus external library filters.",
      "mechanism": "Validates log level, creates aligned formatters, attaches stream and file handlers, and downgrades noisy third-party loggers before marking initialization complete.",
      "quality": "stable",
      "concerns": [
        "Reconfigures the root logger globally, which can interfere with test-specific logging setups."
      ],
      "opportunities": [
        "Support context manager usage so tests can temporarily adjust logging without side effects."
      ],
      "tests": null,
      "notes": "Called by action10 CLI guard to quiet performance logs."
    },
    {
      "id": "file:action10.py",
      "type": "file",
      "name": "action10.py",
      "path": "action10.py",
      "summary": "Action 10 GEDCOM analysis and research scoring workflow.",
      "mechanism": "Collects search criteria, loads GEDCOM data with caching, scores matches, and presents detailed analysis for top candidates.",
      "quality": "stable",
      "concerns": [
        "Large single file mixes CLI, scoring logic, and extensive test harnesses."
      ],
      "opportunities": [
        "Split CLI orchestration from scoring utilities to simplify maintenance."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:action10._load_with_aggressive_caching",
      "type": "function",
      "name": "action10._load_with_aggressive_caching",
      "path": "action10.py",
      "summary": "Attempts to reuse in-memory data before delegating GEDCOM loading to the shared cache module.",
      "mechanism": "Checks the module-level cache, calls load_gedcom_with_aggressive_caching when needed, and stores the result while emitting provenance details.",
      "quality": "stable",
      "concerns": [
        "Raises MissingConfigError when cache module returns None, so callers must wrap for graceful fallback."
      ],
      "opportunities": [
        "Expose cache-source metadata to callers instead of logging side effects."
      ],
      "tests": null,
      "notes": "Uses gedcom_cache to reduce Action 10 startup time."
    },
    {
      "id": "function:action10.test_api_search_peter_fraser",
      "type": "function",
      "name": "action10.test_api_search_peter_fraser",
      "path": "action10.py",
      "summary": "Exercises the live Ancestry API search for Peter Fraser to validate parsing and scoring logic.",
      "mechanism": "Obtains the global SessionManager, calls search_ancestry_api_for_person, and asserts the top result contains parsed identifiers and scores.",
      "quality": "stable",
      "concerns": [
        "Depends on external API stability; failures may reflect network issues rather than regressions."
      ],
      "opportunities": [
        "Provide recorded fixtures so the test can run offline when SKIP_LIVE_API_TESTS is set."
      ],
      "tests": null,
      "notes": "Highlights how Action 10 coordinates with session_utils and api_search_core."
    },
    {
      "id": "script:action10.__main__",
      "type": "script",
      "name": "action10.__main__",
      "path": "action10.py",
      "summary": "CLI entry point that runs performance validation or the comprehensive Action 10 test suite.",
      "mechanism": "Configures logging, disables performance monitors, routes to run_performance_validation when --performance is passed, and otherwise executes action10_module_tests with safe exit codes.",
      "quality": "stable",
      "concerns": [
        "Manipulates global logging handlers directly, which can leak state into subsequent invocations."
      ],
      "opportunities": [
        "Extract performance log suppression into reusable utilities shared with other actions."
      ],
      "tests": null,
      "notes": "Ensures standalone execution respects the logging_config setup helpers."
    },
    {
      "id": "function:action10.main",
      "type": "function",
      "name": "action10.main",
      "path": "action10.py",
      "summary": "Primary Action 10 entrypoint coordinating GEDCOM analysis.",
      "mechanism": "Initializes configuration, gathers search criteria, loads GEDCOM data, filters and scores individuals, displays top matches, and triggers detailed analysis.",
      "quality": "stable",
      "concerns": [
        "Decorated with multiple resilience wrappers, making local testing harder."
      ],
      "opportunities": [
        "Provide slim orchestration wrapper for unit tests without decorators."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:action10._initialize_analysis",
      "type": "function",
      "name": "action10._initialize_analysis",
      "path": "action10.py",
      "summary": "Parses CLI arguments and validates configuration before analysis.",
      "mechanism": "Logs startup, parses command-line inputs, and loads config settings required for subsequent steps.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Expose validation results for reuse by other tooling."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:action10._create_input_getter",
      "type": "function",
      "name": "action10._create_input_getter",
      "path": "action10.py",
      "summary": "Builds input accessor supporting automated inputs for testing.",
      "mechanism": "Returns closure that consumes auto_input arguments or falls back to interactive input().",
      "quality": "stable",
      "concerns": [
        "Auto input logging mixes prompts into action logs."
      ],
      "opportunities": [
        "Allow dependency injection of logger to redirect prompt echoing."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:action10._load_and_validate_gedcom",
      "type": "function",
      "name": "action10._load_and_validate_gedcom",
      "path": "action10.py",
      "summary": "Loads GEDCOM file and verifies availability before analysis.",
      "mechanism": "Invokes load_gedcom_data after confirming path, warning when data is unavailable.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Return error codes to distinguish missing file vs. parse failure."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:action10.load_gedcom_data",
      "type": "function",
      "name": "action10.load_gedcom_data",
      "path": "action10.py",
      "summary": "Loads GEDCOM data with aggressive caching and error handling.",
      "mechanism": "Validates path, attempts cache-backed load, falls back to standard loader, and raises MissingConfigError on failure.",
      "quality": "stable",
      "concerns": [
        "Aggressive caching branch depends on optional module; failure path could be clearer."
      ],
      "opportunities": [
        "Surface cache statistics to analytics for monitoring."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:action10._build_filter_criteria",
      "type": "function",
      "name": "action10._build_filter_criteria",
      "path": "action10.py",
      "summary": "Normalizes search criteria into lower-cased filter dictionary.",
      "mechanism": "Transforms scoring criteria strings for case-insensitive matching and passes through numeric fields unchanged.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Share normalization helper with Action 6 for consistency."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:action10.filter_and_score_individuals",
      "type": "function",
      "name": "action10.filter_and_score_individuals",
      "path": "action10.py",
      "summary": "Iterates GEDCOM cache to evaluate and score candidate individuals.",
      "mechanism": "Loops through cached individuals, applies filter criteria, computes scores with caching, and returns sorted matches.",
      "quality": "stable",
      "concerns": [
        "Single-threaded loop can be slow on large GEDCOM files."
      ],
      "opportunities": [
        "Expose yield-based iterator to support chunked processing or concurrency."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:action10.display_top_matches",
      "type": "function",
      "name": "action10.display_top_matches",
      "path": "action10.py",
      "summary": "Formats and prints top-scoring candidates with context details.",
      "mechanism": "Uses scoring breakdown helpers to build tables, logs summary, and returns selected top match for further analysis.",
      "quality": "stable",
      "concerns": [
        "Depends on console output; hard to test deterministically."
      ],
      "opportunities": [
        "Refactor to return render data structure consumed by presenter layer."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:action10.analyze_top_match",
      "type": "function",
      "name": "action10.analyze_top_match",
      "path": "action10.py",
      "summary": "Performs deep-dive analysis on the highest scoring match.",
      "mechanism": "Retrieves individual records, prepares family context, computes relationship paths, and presents results via presenter utilities.",
      "quality": "stable",
      "concerns": [
        "Assumes GEDCOM includes selected match; missing records simply log errors."
      ],
      "opportunities": [
        "Add retry to fetch alternative matches or request manual review when data missing."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:action10._calculate_display_bonuses",
      "type": "function",
      "name": "action10._calculate_display_bonuses",
      "path": "action10.py",
      "summary": "Legacy presentation helper that mirrors universal scoring bonus logic.",
      "mechanism": "Aggregates individual display bonuses such as document matches and relationship depth for score breakdown tables.",
      "quality": "legacy",
      "concerns": [
        "Duplicated logic with universal_scoring.calculate_display_bonuses causing maintenance drift."
      ],
      "opportunities": [
        "Replace invocations with universal_scoring.calculate_display_bonuses and delete this copy."
      ],
      "tests": null,
      "notes": "Identified as duplicate of universal scoring helper; keep until callers migrate."
    },
    {
      "id": "file:api_search_core.py",
      "type": "file",
      "name": "api_search_core.py",
      "path": "api_search_core.py",
      "summary": "API-based Ancestry search orchestration and result normalization layer.",
      "mechanism": "Wraps browse-less REST searches, harmonizes results with Action 10 scoring helpers, and prepares console-ready displays for fallback flows.",
      "quality": "stable",
      "concerns": [
        "Large module mixes API plumbing, scoring, and presentation code."
      ],
      "opportunities": [
        "Split display/table helpers into universal_scoring to reduce duplication."
      ],
      "tests": null,
      "notes": "Exports helpers consumed by action10 fallback when browser scraping fails."
    },
    {
      "id": "function:api_search_core._normalize_search_criteria",
      "type": "function",
      "name": "api_search_core._normalize_search_criteria",
      "path": "api_search_core.py",
      "summary": "Cleans API search criteria for deterministic cache key generation.",
      "mechanism": "Lowercases keys, standardizes numeric strings, and strips whitespace before hashing criteria payloads.",
      "quality": "stable",
      "concerns": [
        "Pass-through of nested structures may reduce cache hit rate."
      ],
      "opportunities": [
        "Normalize nested structures (e.g., locations) to boost deduplication."
      ],
      "tests": null,
      "notes": "First step in cache key workflow for API search deduplication."
    },
    {
      "id": "function:api_search_core._generate_cache_key",
      "type": "function",
      "name": "api_search_core._generate_cache_key",
      "path": "api_search_core.py",
      "summary": "Produces SHA256 hash representing normalized search inputs.",
      "mechanism": "Serializes normalized criteria with sorted keys and hashes with SHA256 to create 64-char cache key.",
      "quality": "stable",
      "concerns": [
        "No salt; collisions extremely unlikely but not impossible if different criteria serialize identically."
      ],
      "opportunities": [
        "Include version byte to allow future schema changes without invalidating cache."
      ],
      "tests": null,
      "notes": "Used for database lookup of cached API search results."
    },
    {
      "id": "function:api_search_core._get_cached_search_results",
      "type": "function",
      "name": "api_search_core._get_cached_search_results",
      "path": "api_search_core.py",
      "summary": "Attempts to load cached TreesUI search results from the database.",
      "mechanism": "Queries ApiSearchCache table for unexpired entry, updates hit stats, and returns parsed JSON payload when available.",
      "quality": "stable",
      "concerns": [
        "Direct session commit inside helper couples caching with transaction lifecycle."
      ],
      "opportunities": [
        "Use context-managed transaction to avoid partial commits on error."
      ],
      "tests": null,
      "notes": "Increments global cache stats for performance monitoring ceiling."
    },
    {
      "id": "function:api_search_core._store_search_results_in_cache",
      "type": "function",
      "name": "api_search_core._store_search_results_in_cache",
      "path": "api_search_core.py",
      "summary": "Persists fresh API search results into ApiSearchCache with 7-day expiry.",
      "mechanism": "Upserts JSON serialized results, updates metadata, and commits session while logging diagnostics.",
      "quality": "stable",
      "concerns": [
        "Rollbacks on error may hide original exception context from callers."
      ],
      "opportunities": [
        "Defer serialization to background task for large result sets."
      ],
      "tests": null,
      "notes": "Complements cache lookup helper to maintain deduplication dataset."
    },
    {
      "id": "function:api_search_core.get_api_search_cache_stats",
      "type": "function",
      "name": "api_search_core.get_api_search_cache_stats",
      "path": "api_search_core.py",
      "summary": "Returns snapshot of in-memory cache hit/miss counters.",
      "mechanism": "Computes hit rate percentage from module-level stats dictionary and returns metrics dict.",
      "quality": "stable",
      "concerns": [
        "Counters reset on process restart, so long-term rate requires external persistence."
      ],
      "opportunities": [
        "Expose structured telemetry event for monitoring dashboards."
      ],
      "tests": null,
      "notes": "Used when reporting cache performance to PerformanceMonitor."
    },
    {
      "id": "function:api_search_core.get_api_search_cache_hit_rate",
      "type": "function",
      "name": "api_search_core.get_api_search_cache_hit_rate",
      "path": "api_search_core.py",
      "summary": "Convenience helper returning cache hit rate percentage.",
      "mechanism": "Derives hit rate from module stats avoiding division by zero when no queries recorded.",
      "quality": "stable",
      "concerns": [
        "Shares state with stats helper; repeated calls recompute same value."
      ],
      "opportunities": [
        "Inline into stats helper or cache computed rate to avoid duplication."
      ],
      "tests": null,
      "notes": "Dual purpose for logging and monitor reporting."
    },
    {
      "id": "function:api_search_core.clear_api_search_cache",
      "type": "function",
      "name": "api_search_core.clear_api_search_cache",
      "path": "api_search_core.py",
      "summary": "Deletes cached API search entries from database and resets counters.",
      "mechanism": "Executes delete against ApiSearchCache table, commits transaction, logs outcome, and resets in-memory stats.",
      "quality": "stable",
      "concerns": [
        "Single bulk delete may be expensive on very large tables."
      ],
      "opportunities": [
        "Add time-bounded purge to avoid long transactions."
      ],
      "tests": null,
      "notes": "Supports manual cache invalidation for testing and operational recovery."
    },
    {
      "id": "function:api_search_core.report_api_cache_stats_to_performance_monitor",
      "type": "function",
      "name": "api_search_core.report_api_cache_stats_to_performance_monitor",
      "path": "api_search_core.py",
      "summary": "Publishes cache hit rate metrics to the central PerformanceMonitor.",
      "mechanism": "Fetches stats snapshot, computes hit rate, and invokes monitor.track_cache_hit_rate with configured thresholds.",
      "quality": "stable",
      "concerns": [
        "Assumes PerformanceMonitor available on session_manager; otherwise silently skips."
      ],
      "opportunities": [
        "Raise structured warning when monitor missing to encourage configuration."
      ],
      "tests": null,
      "notes": "Keeps Action 10 telemetry in sync with API cache performance."
    },
    {
      "id": "function:api_search_core._extract_field_scores_for_display",
      "type": "function",
      "name": "api_search_core._extract_field_scores_for_display",
      "path": "api_search_core.py",
      "summary": "Transforms candidate field scores into Action 10 style suffix keys.",
      "mechanism": "Maps raw scoring dictionary into normalized `_s` suffixed keys expected by table renderers.",
      "quality": "stable",
      "concerns": [
        "Assumes presence of numeric scores; lacks typing enforcement."
      ],
      "opportunities": [
        "Share conversion helper with Action 10 once display stack is unified."
      ],
      "tests": null,
      "notes": "Keeps API fallback displays consistent with Action 10 console tables."
    },
    {
      "id": "function:api_search_core._calc_display_bonuses_wrap",
      "type": "function",
      "name": "api_search_core._calc_display_bonuses_wrap",
      "path": "api_search_core.py",
      "summary": "Adapter that re-labels universal display bonuses for API output columns.",
      "mechanism": "Calls universal_scoring.calculate_display_bonuses with `_s` prefix and renames keys for table consumption.",
      "quality": "stable",
      "concerns": [
        "Maintains redundant key naming logic already handled upstream."
      ],
      "opportunities": [
        "Return universal structure directly and shift renaming to presenter."
      ],
      "tests": null,
      "notes": "Bridges API fallback table formatting to the shared scoring helper."
    },
    {
      "id": "function:api_search_core._create_table_row_for_candidate",
      "type": "function",
      "name": "api_search_core._create_table_row_for_candidate",
      "path": "api_search_core.py",
      "summary": "Builds console table row describing a scored API candidate.",
      "mechanism": "Formats name, birth/death data, and bonus indicators using normalized scores and bonus wrappers.",
      "quality": "stable",
      "concerns": [
        "Performs inline string truncation logic that complicates reuse."
      ],
      "opportunities": [
        "Switch to structured presenter object shared with Action 10 outputs."
      ],
      "tests": null,
      "notes": "Used by fallback workflow to mimic Action 10 match presentation."
    },
    {
      "id": "function:api_search_core._extract_candidate_data",
      "type": "function",
      "name": "api_search_core._extract_candidate_data",
      "path": "api_search_core.py",
      "summary": "Normalizes raw API suggestion dictionaries into scorer-friendly payloads.",
      "mechanism": "Pulls TreesUI fields, cleans names and dates, and returns canonical candidate dict consumed by universal scoring.",
      "quality": "stable",
      "concerns": [
        "Inline helper duplicates name normalization logic elsewhere."
      ],
      "opportunities": [
        "Share parsing utilities with GEDCOM loader to avoid drift."
      ],
      "tests": null,
      "notes": "Feeds into scoring pipeline before calculate_match_score invocation."
    },
    {
      "id": "function:api_search_core._calculate_candidate_score",
      "type": "function",
      "name": "api_search_core._calculate_candidate_score",
      "path": "api_search_core.py",
      "summary": "Wraps universal calculate_match_score with error handling for API candidates.",
      "mechanism": "Invokes gedcom_utils.calculate_match_score, converts outputs to primitives, and catches scoring failures per candidate.",
      "quality": "stable",
      "concerns": [
        "Swallows scoring exceptions by returning zero without surfacing context."
      ],
      "opportunities": [
        "Log structured error data to telemetry for prompt tuning."
      ],
      "tests": null,
      "notes": "Critical bridge ensuring API suggestions use the same scoring model as Action 10."
    },
    {
      "id": "function:api_search_core._build_processed_candidate",
      "type": "function",
      "name": "api_search_core._build_processed_candidate",
      "path": "api_search_core.py",
      "summary": "Formats raw API suggestion with score metadata for downstream display.",
      "mechanism": "Combines cleaned dates, places, total score, field breakdown, and original payload into a single candidate record.",
      "quality": "stable",
      "concerns": [
        "Relies on callable checks for utils that should always be available."
      ],
      "opportunities": [
        "Inject formatting utilities to simplify unit testing."
      ],
      "tests": null,
      "notes": "Output consumed both by cache persistence and table renderers."
    },
    {
      "id": "function:api_search_core._process_and_score_suggestions",
      "type": "function",
      "name": "api_search_core._process_and_score_suggestions",
      "path": "api_search_core.py",
      "summary": "Transforms API suggestions into scored candidate list sorted by descending score.",
      "mechanism": "Iterates treesUI suggestions, extracts normalized candidates, scores them, wraps into processed payloads, and sorts results.",
      "quality": "stable",
      "concerns": [
        "Synchronous loop may be slow for large suggestion sets."
      ],
      "opportunities": [
        "Introduce yield-based generator for streaming evaluation."
      ],
      "tests": null,
      "notes": "Used by both direct API searches and cache seeding."
    },
    {
      "id": "function:api_search_core._resolve_base_and_tree",
      "type": "function",
      "name": "api_search_core._resolve_base_and_tree",
      "path": "api_search_core.py",
      "summary": "Determines API base URL and tree identifier based on session state or config fallback.",
      "mechanism": "Reads session_manager attributes first, then falls back to test configuration for tree IDs when browser context unavailable.",
      "quality": "stable",
      "concerns": [
        "Does not validate URL format or tree ID presence beyond truthiness check."
      ],
      "opportunities": [
        "Return structured error codes instructing caller to refresh session."
      ],
      "tests": null,
      "notes": "First step in API search flow prior to cache lookup or remote calls."
    },
    {
      "id": "function:api_search_core.search_ancestry_api_for_person",
      "type": "function",
      "name": "api_search_core.search_ancestry_api_for_person",
      "path": "api_search_core.py",
      "summary": "Primary API fallback workflow providing scored candidates for Action 10/9.",
      "mechanism": "Resolves configuration, consults cache, fetches TreesUI suggestions, scores them via universal pipeline, caches results, and returns top matches.",
      "quality": "stable",
      "concerns": [
        "Error handling around database session acquisition is minimal."
      ],
      "opportunities": [
        "Surface cache bypass reasons to caller for observability."
      ],
      "tests": null,
      "notes": "Exposed to main fallback flow when browser scraping fails."
    },
    {
      "id": "function:api_search_core.cleanup_expired_api_search_cache",
      "type": "function",
      "name": "api_search_core.cleanup_expired_api_search_cache",
      "path": "api_search_core.py",
      "summary": "Purges ApiSearchCache rows whose expiration has elapsed.",
      "mechanism": "Executes delete query filtered by expires_at <= now, commits, and logs count of removed entries.",
      "quality": "stable",
      "concerns": [
        "Deletes entire result set in one transaction which may contend on large tables."
      ],
      "opportunities": [
        "Chunk deletes or add LIMIT for gradual cleanup."
      ],
      "tests": null,
      "notes": "Complements scheduled maintenance to keep cache table small."
    },
    {
      "id": "function:api_search_core._extract_year_from_candidate",
      "type": "function",
      "name": "api_search_core._extract_year_from_candidate",
      "path": "api_search_core.py",
      "summary": "Reads birth/death year from scored candidate with numeric safety checks.",
      "mechanism": "Looks at field_scores override and fallback keys, coercing digits to int while tolerating missing data.",
      "quality": "stable",
      "concerns": [
        "Only handles integer-like strings; ignores spelled-out years."
      ],
      "opportunities": [
        "Reuse universal normalization to handle additional formats."
      ],
      "tests": null,
      "notes": "Used during post-selection presentation headings."
    },
    {
      "id": "function:api_search_core._get_relationship_paths",
      "type": "function",
      "name": "api_search_core._get_relationship_paths",
      "path": "api_search_core.py",
      "summary": "Retrieves formatted and unified relationship paths between tree owner and candidate.",
      "mechanism": "Prefers relation ladder with labels API for readable output, falling back to discovery API and converting response via relationship_utils.",
      "quality": "stable",
      "concerns": [
        "Relies on session_manager.my_profile_id being populated; logs limited diagnostic when missing."
      ],
      "opportunities": [
        "Cache ladder responses to avoid repeated network calls during review."
      ],
      "tests": null,
      "notes": "Feeds supplementary presentation when API fallback selects a candidate."
    },
    {
      "id": "function:api_search_core._format_kinship_persons_path",
      "type": "function",
      "name": "api_search_core._format_kinship_persons_path",
      "path": "api_search_core.py",
      "summary": "Converts kinshipPersons array into human-readable relationship path text.",
      "mechanism": "Iterates relation ladder nodes, deduplicates names, inverts 'You are...' phrasing, and builds formatted lines.",
      "quality": "stable",
      "concerns": [
        "String operations embed presentation rules; difficult to localize or translate."
      ],
      "opportunities": [
        "Move to presenter layer with templating for better reuse."
      ],
      "tests": null,
      "notes": "Used when relation ladder API provides enriched kinship data."
    },
    {
      "id": "function:api_search_core._handle_supplementary_info_phase",
      "type": "function",
      "name": "api_search_core._handle_supplementary_info_phase",
      "path": "api_search_core.py",
      "summary": "Coordinates post-selection presentation of family and relationship context for API candidates.",
      "mechanism": "Uses API family details, relationship path helpers, and presenter utilities to display supplemental data to the user.",
      "quality": "stable",
      "concerns": [
        "Wraps broad responsibilities; difficult to unit test without extensive mocking."
      ],
      "opportunities": [
        "Break into smaller presenter-friendly functions for improved coverage."
      ],
      "tests": null,
      "notes": "Invoked after top match selection in API fallback flow."
    },
    {
      "id": "function:api_search_core._api_search_core_module_tests",
      "type": "function",
      "name": "api_search_core._api_search_core_module_tests",
      "path": "api_search_core.py",
      "summary": "Embedded TestSuite covering core API search helpers and cache behaviors.",
      "mechanism": "Defines targeted tests for table formatting, cache key stability, cache persistence, and search integration using mocks.",
      "quality": "stable",
      "concerns": [
        "Relies on MagicMock; real database behaviors may still differ."
      ],
      "opportunities": [
        "Split into focused tests per concern for clearer failure signals."
      ],
      "tests": null,
      "notes": "Callable via TestSuite framework; ensures cache logic remains reliable."
    },
    {
      "id": "file:api_utils.py",
      "type": "file",
      "name": "api_utils.py",
      "path": "api_utils.py",
      "summary": "Shared HTTP client wrappers for Ancestry discovery, relation ladder, and TreesUI APIs.",
      "mechanism": "Provides authenticated request helpers, retries, and JSON normalization utilities consumed by search workflows.",
      "quality": "stable",
      "concerns": [
        "Module aggregates many API endpoints, making maintenance diffuse."
      ],
      "opportunities": [
        "Split endpoints by domain (TreesUI vs Discovery) to simplify ownership."
      ],
      "tests": null,
      "notes": "Centralized API surface leveraged by actions 9\u201311 and search utilities."
    },
    {
      "id": "function:api_utils.call_treesui_list_api",
      "type": "function",
      "name": "api_utils.call_treesui_list_api",
      "path": "api_utils.py",
      "summary": "Issues TreesUI list search request and returns suggestion JSON payloads.",
      "mechanism": "Constructs request parameters, executes authenticated GET with retries, and parses structured results for downstream scoring.",
      "quality": "stable",
      "concerns": [
        "Response normalization is minimal; caller must handle inconsistent fields."
      ],
      "opportunities": [
        "Expose typed dataclasses to reduce repeated payload parsing."
      ],
      "tests": null,
      "notes": "Primary data source for API fallback scoring pipeline."
    },
    {
      "id": "function:api_utils.call_discovery_relationship_api",
      "type": "function",
      "name": "api_utils.call_discovery_relationship_api",
      "path": "api_utils.py",
      "summary": "Fetches relationship ladder data from Ancestry discovery API between two profiles.",
      "mechanism": "Builds authenticated request, handles timeout/retry logic, and returns JSON used to compute unified relationship paths.",
      "quality": "stable",
      "concerns": [
        "Error logging lacks structured context for debugging failures."
      ],
      "opportunities": [
        "Emit telemetry metrics for API latency and error codes."
      ],
      "tests": null,
      "notes": "Fallback path when relation ladder with labels API is unavailable."
    },
    {
      "id": "function:api_utils.call_relation_ladder_with_labels_api",
      "type": "function",
      "name": "api_utils.call_relation_ladder_with_labels_api",
      "path": "api_utils.py",
      "summary": "Retrieves enhanced relation ladder info including names, labels, and life spans.",
      "mechanism": "Calls dedicated relation ladder endpoint with authentication, parses JSON, and returns structured kinship data.",
      "quality": "stable",
      "concerns": [
        "High timeout values may prolong fallback when service is degraded."
      ],
      "opportunities": [
        "Implement circuit breaker integration similar to other API helpers."
      ],
      "tests": null,
      "notes": "Preferred data source for displaying human-readable relationship paths."
    },
    {
      "id": "function:api_utils.call_newfamilyview_api",
      "type": "function",
      "name": "api_utils.call_newfamilyview_api",
      "path": "api_utils.py",
      "summary": "Calls New Family View API to retrieve detailed household members for a person.",
      "mechanism": "Builds authenticated request to NewFamilyView endpoint, handles timeout, and returns JSON structure describing relatives.",
      "quality": "stable",
      "concerns": [
        "Large JSON payloads can be expensive to parse synchronously."
      ],
      "opportunities": [
        "Cache responses to reduce repeat requests during walkthroughs."
      ],
      "tests": null,
      "notes": "Primary data source for family detail enrichment in API fallback."
    },
    {
      "id": "function:api_utils.call_edit_relationships_api",
      "type": "function",
      "name": "api_utils.call_edit_relationships_api",
      "path": "api_utils.py",
      "summary": "Calls the Edit Relationships endpoint to gather parental, spouse, and child data.",
      "mechanism": "Constructs authenticated request with user/tree/person identifiers, executes HTTP call, and returns raw relationship JSON payloads.",
      "quality": "stable",
      "concerns": [
        "Response schema varies between 'data' string and 'res' object formats."
      ],
      "opportunities": [
        "Add response normalization to simplify downstream parsing."
      ],
      "tests": null,
      "notes": "Feeds api_search_utils._get_facts_data_from_api when New Family View data is unavailable."
    },
    {
      "id": "function:api_utils.call_getladder_api",
      "type": "function",
      "name": "api_utils.call_getladder_api",
      "path": "api_utils.py",
      "summary": "Queries GetLadder API to compute relationship ladder between two profiles.",
      "mechanism": "Performs authenticated request, applies retry logic, and returns raw ladder JSON for further formatting.",
      "quality": "stable",
      "concerns": [
        "Limited logging when ladder data missing; hard to diagnose remote failures."
      ],
      "opportunities": [
        "Augment with structured telemetry for ladder depth and latency."
      ],
      "tests": null,
      "notes": "Used by api_search_utils.get_api_relationship_path for reference comparisons."
    },
    {
      "id": "function:api_utils.call_suggest_api",
      "type": "function",
      "name": "api_utils.call_suggest_api",
      "path": "api_utils.py",
      "summary": "Requests Suggest API results for a person search using authenticated session context.",
      "mechanism": "Builds headers, enforces rate limiting through SessionManager, performs HTTP request, and returns parsed suggestion list while logging metrics.",
      "quality": "stable",
      "concerns": [
        "Large responses are processed synchronously without chunking."
      ],
      "opportunities": [
        "Capture per-call telemetry for scoring quality analysis."
      ],
      "tests": null,
      "notes": "Primary data source for api_search_utils._call_suggest_api_for_search."
    },
    {
      "id": "function:api_search_utils.get_api_relationship_path",
      "type": "function",
      "name": "api_search_utils.get_api_relationship_path",
      "path": "api_search_utils.py",
      "summary": "Generates formatted relationship path between target person and reference profile via API calls.",
      "mechanism": "Validates identifiers, calls getladder API, and formats output using relationship_utils helpers with graceful fallbacks.",
      "quality": "stable",
      "concerns": [
        "Returns plain strings; difficult to reuse in UI contexts without re-parsing."
      ],
      "opportunities": [
        "Return structured segments for templated presenters."
      ],
      "tests": null,
      "notes": "Complements fallback experience when relation ladder available."
    },
    {
      "id": "file:api_search_utils.py",
      "type": "file",
      "name": "api_search_utils.py",
      "path": "api_search_utils.py",
      "summary": "Utility helpers wrapping Ancestry API search endpoints and family detail retrieval.",
      "mechanism": "Provides reusable functions for suggestion scoring, family detail extraction, and relationship formatting used by fallback workflows.",
      "quality": "stable",
      "concerns": [
        "Large module mixes scoring utilities with API orchestration."
      ],
      "opportunities": [
        "Split scoring helpers into universal_scoring to reduce duplication."
      ],
      "tests": null,
      "notes": "Includes extensive internal TestSuite ensuring API search behaviors remain consistent."
    },
    {
      "id": "function:api_search_utils._extract_year_from_date",
      "type": "function",
      "name": "api_search_utils._extract_year_from_date",
      "path": "api_search_utils.py",
      "summary": "Extracts the first recognizable four-digit year from free-form date strings.",
      "mechanism": "Uses compiled regex matches to capture integer year tokens across normalized or descriptive date phrases, returning an int or None.",
      "quality": "stable",
      "concerns": [
        "Only returns the first year encountered, which can misrepresent ranges."
      ],
      "opportunities": [
        "Consider returning both endpoints when ranges are present."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Feeds TreesUI scoring to normalize vital statistics before comparison."
    },
    {
      "id": "function:api_search_utils._get_scoring_weights",
      "type": "function",
      "name": "api_search_utils._get_scoring_weights",
      "path": "api_search_utils.py",
      "summary": "Resolves scoring weight configuration for simplified suggestion scoring.",
      "mechanism": "Returns provided weights when supplied or clones config_schema.common_scoring_weights as defaults.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Could validate weight keys to catch config drift early."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Ensures scoring routines remain configurable without duplicating constants."
    },
    {
      "id": "function:api_search_utils._get_year_range",
      "type": "function",
      "name": "api_search_utils._get_year_range",
      "path": "api_search_utils.py",
      "summary": "Determines allowable year variance when evaluating birth and death matches.",
      "mechanism": "Reads year_match_range from provided date flexibility dict, defaulting to 10 when undefined.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Expose separate ranges for birth and death comparisons if needed."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Keeps simplified scoring aligned with Action 10 flexibility settings."
    },
    {
      "id": "function:api_search_utils._extract_search_criteria",
      "type": "function",
      "name": "api_search_utils._extract_search_criteria",
      "path": "api_search_utils.py",
      "summary": "Normalizes user-provided search criteria for downstream scoring.",
      "mechanism": "Lowercases and strips string fields while passing through numeric year values to simplify comparisons.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add phonetic normalization to better match variant spellings."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Used by both place requirement checks and simplified scoring."
    },
    {
      "id": "function:api_search_utils._extract_candidate_data",
      "type": "function",
      "name": "api_search_utils._extract_candidate_data",
      "path": "api_search_utils.py",
      "summary": "Standardizes external candidate payloads into canonical scoring fields.",
      "mechanism": "Maps camelCase and title-case keys to lowercase names, trimming strings and retaining numeric years for comparison.",
      "quality": "stable",
      "concerns": [
        "Falls back to None when unexpected key names are introduced."
      ],
      "opportunities": [
        "Support additional alias keys used by newer API versions."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Allows suggestion and TreesUI records to reuse the same scoring logic."
    },
    {
      "id": "function:api_search_utils._places_requirements_satisfied",
      "type": "function",
      "name": "api_search_utils._places_requirements_satisfied",
      "path": "api_search_utils.py",
      "summary": "Verifies that candidate places satisfy any explicit birth or death location filters.",
      "mechanism": "Reuses normalized search and candidate dictionaries to ensure required place substrings exist before accepting matches.",
      "quality": "stable",
      "concerns": [
        "Substring matching is case-sensitive to normalized lower-case values and may miss locale variants."
      ],
      "opportunities": [
        "Introduce fuzzy matching for broader geographic coverage."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Guards simplified scoring from returning records lacking requested locales."
    },
    {
      "id": "function:api_search_utils._score_name_match",
      "type": "function",
      "name": "api_search_utils._score_name_match",
      "path": "api_search_utils.py",
      "summary": "Adds weight-based points when candidate names contain the searched value.",
      "mechanism": "Performs substring checks on normalized names, updating running total, per-field scores, and explanation reasons.",
      "quality": "stable",
      "concerns": [
        "Simple substring logic may over-credit partial overlaps."
      ],
      "opportunities": [
        "Add scoring tiers for exact vs. partial matches."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Shared by first and surname evaluation inside simplified scoring."
    },
    {
      "id": "function:api_search_utils._score_year_match",
      "type": "function",
      "name": "api_search_utils._score_year_match",
      "path": "api_search_utils.py",
      "summary": "Applies exact and proximity bonuses when candidate years align with search expectations.",
      "mechanism": "Converts inputs to integers, awards full points on match, reduced points within configured range, and logs debug on conversion failures.",
      "quality": "stable",
      "concerns": [
        "Swallows non-numeric input by logging debug without surfacing to callers."
      ],
      "opportunities": [
        "Return structured mismatch data to aid diagnostics."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Handles scoring for both birth and death year comparisons."
    },
    {
      "id": "function:api_search_utils._score_place_match",
      "type": "function",
      "name": "api_search_utils._score_place_match",
      "path": "api_search_utils.py",
      "summary": "Awards points when candidate places contain requested birth or death locations.",
      "mechanism": "Performs normalized substring comparisons, updating totals and rationale list when matches occur.",
      "quality": "stable",
      "concerns": [
        "Substring logic can mis-score overlapping county names."
      ],
      "opportunities": [
        "Integrate gazetteer normalization to reduce ambiguity."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Supports both vital place checks prior to bonus aggregation."
    },
    {
      "id": "function:api_search_utils._apply_bonus_scores",
      "type": "function",
      "name": "api_search_utils._apply_bonus_scores",
      "path": "api_search_utils.py",
      "summary": "Adds bonus points when multiple related fields match simultaneously.",
      "mechanism": "Inspects accumulated field scores to apply configured bonuses for combined name, birth, or death matches while logging explanations.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Expose per-bonus toggles for experimentation."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Helps emulate universal_scoring bonus behavior for simplified API results."
    },
    {
      "id": "function:api_search_utils._run_simple_suggestion_scoring",
      "type": "function",
      "name": "api_search_utils._run_simple_suggestion_scoring",
      "path": "api_search_utils.py",
      "summary": "Performs lightweight scoring for API suggestions when GEDCOM utilities are unavailable.",
      "mechanism": "Normalizes search and candidate data, applies per-field matches with configured weights, and aggregates reasons alongside bonus logic.",
      "quality": "stable",
      "concerns": [
        "Lacks phonetic matching which can limit recall for nicknames."
      ],
      "opportunities": [
        "Integrate with universal_scoring to remove duplicate logic."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Used by both suggestion and TreesUI processors within search_api_for_criteria."
    },
    {
      "id": "function:api_search_utils._parse_hyphenated_lifespan",
      "type": "function",
      "name": "api_search_utils._parse_hyphenated_lifespan",
      "path": "api_search_utils.py",
      "summary": "Parses hyphen-separated lifespan strings into birth and death year integers.",
      "mechanism": "Splits on hyphen, strips whitespace, and converts tokens to ints while handling malformed segments gracefully.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Support partial lifespans where only one side is present."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Supports suggestion parsing when results include compact lifespan summaries."
    },
    {
      "id": "function:api_search_utils._parse_birth_notation",
      "type": "function",
      "name": "api_search_utils._parse_birth_notation",
      "path": "api_search_utils.py",
      "summary": "Extracts birth years from 'b. YYYY' style lifespan notes.",
      "mechanism": "Runs regex against lowercase lifespan text and converts the captured year to an int when possible.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": "api_search_utils_module_tests",
      "notes": "Used by _parse_lifespan as a fallback when hyphenated format is absent."
    },
    {
      "id": "function:api_search_utils._parse_death_notation",
      "type": "function",
      "name": "api_search_utils._parse_death_notation",
      "path": "api_search_utils.py",
      "summary": "Extracts death years from 'd. YYYY' lifespan notes.",
      "mechanism": "Applies regex against lowercase lifespan text and returns parsed year integers when present.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": "api_search_utils_module_tests",
      "notes": "Complements birth notation parsing for suggestion lifespans."
    },
    {
      "id": "function:api_search_utils._parse_lifespan",
      "type": "function",
      "name": "api_search_utils._parse_lifespan",
      "path": "api_search_utils.py",
      "summary": "Derives birth and death years from assorted lifespan string formats.",
      "mechanism": "Validates input then delegates to hyphenated or notation-specific parsers, returning a tuple of optional years.",
      "quality": "stable",
      "concerns": [
        "Returns (None, None) on unexpected formats without telemetry."
      ],
      "opportunities": [
        "Add logging hooks when parsing fails to improve monitoring."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Feeds suggestion scoring with structured vital years."
    },
    {
      "id": "function:api_search_utils._process_suggest_result",
      "type": "function",
      "name": "api_search_utils._process_suggest_result",
      "path": "api_search_utils.py",
      "summary": "Transforms a single Suggest API record into a scored match payload.",
      "mechanism": "Extracts name, lifespan, and location fields, invokes simplified scoring, applies place requirements, and returns enriched metadata when above threshold.",
      "quality": "stable",
      "concerns": [
        "Broad exception handler hides specific parsing failures."
      ],
      "opportunities": [
        "Surface structured error metrics for telemetry dashboards."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Primary entry point turning suggestion hits into Action 10 compatible records."
    },
    {
      "id": "function:api_search_utils._process_suggest_results",
      "type": "function",
      "name": "api_search_utils._process_suggest_results",
      "path": "api_search_utils.py",
      "summary": "Scores Suggest API payloads and returns ordered match candidates.",
      "mechanism": "Configures weights and date flexibility, iterates suggestion list through _process_suggest_result, and accumulates accepted matches until limits reached.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Track rejection reasons to aid prompt tuning."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Provides the first scoring pass before attempting TreesUI enrichment."
    },
    {
      "id": "function:api_search_utils._validate_session",
      "type": "function",
      "name": "api_search_utils._validate_session",
      "path": "api_search_utils.py",
      "summary": "Ensures the session manager has active API credentials before searching.",
      "mechanism": "Checks SessionManager attributes and logs errors when essential identifiers are unavailable, returning False when not ready.",
      "quality": "stable",
      "concerns": [
        "Relies on api_manager.has_essential_identifiers without fallback explanation."
      ],
      "opportunities": [
        "Emit telemetry counters for invalid session attempts."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "First guard in search_api_for_criteria to prevent unnecessary API calls."
    },
    {
      "id": "function:api_search_utils._call_suggest_api_for_search",
      "type": "function",
      "name": "api_search_utils._call_suggest_api_for_search",
      "path": "api_search_utils.py",
      "summary": "Invokes the Suggest API and unwraps suggestion data for scoring.",
      "mechanism": "Builds parameters, calls call_suggest_api helper, and returns list payloads while logging fetch issues.",
      "quality": "stable",
      "concerns": [
        "Minimal retry handling; depends on upstream resilience."
      ],
      "opportunities": [
        "Add telemetry on suggestion volume per request."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Feeds the first phase of API fallback search."
    },
    {
      "id": "function:api_search_utils._build_treesui_search_params",
      "type": "function",
      "name": "api_search_utils._build_treesui_search_params",
      "path": "api_search_utils.py",
      "summary": "Translates unified search criteria into TreesUI query parameters.",
      "mechanism": "Maps canonical keys to TreesUI field names, only including populated attributes to keep requests compact.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Validate parameter lengths to avoid API rejection."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Supports TreesUI fallback when Suggest results are sparse."
    },
    {
      "id": "function:api_search_utils._call_treesui_api_for_search",
      "type": "function",
      "name": "api_search_utils._call_treesui_api_for_search",
      "path": "api_search_utils.py",
      "summary": "Calls the TreesUI list API to obtain additional candidate persons.",
      "mechanism": "Logs request metadata, resolves base URL from config, and delegates to call_treesui_list_api with owner tree context.",
      "quality": "stable",
      "concerns": [
        "Returns None on empty params which can hide invocation mistakes."
      ],
      "opportunities": [
        "Record API latency for performance dashboards."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Secondary retrieval path used when Suggest results are insufficient."
    },
    {
      "id": "function:api_search_utils._process_treesui_person",
      "type": "function",
      "name": "api_search_utils._process_treesui_person",
      "path": "api_search_utils.py",
      "summary": "Converts a single TreesUI person entry into a scored match if it is not a duplicate.",
      "mechanism": "Extracts normalized vital data, adapts gender codes, invokes simplified scoring, checks place requirements, and avoids duplicates using prior results.",
      "quality": "stable",
      "concerns": [
        "Duplicate detection relies on in-memory list and may miss cross-run collisions."
      ],
      "opportunities": [
        "Capture more detailed duplicate diagnostics for tuning."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Expands result set beyond Suggest API when additional detail is available."
    },
    {
      "id": "function:api_search_utils._process_treesui_results",
      "type": "function",
      "name": "api_search_utils._process_treesui_results",
      "path": "api_search_utils.py",
      "summary": "Iterates TreesUI API responses and aggregates scored matches.",
      "mechanism": "Validates payload structure, extracts person listings, configures weights, and funnels each record through _process_treesui_person before returning augmented list.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Track statistics on accepted vs. rejected TreesUI entries."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Supplements Suggest scoring by incorporating TreesUI matches."
    },
    {
      "id": "function:api_search_utils._build_search_query",
      "type": "function",
      "name": "api_search_utils._build_search_query",
      "path": "api_search_utils.py",
      "summary": "Constructs a readable query string from unified search criteria for logging and validation.",
      "mechanism": "Concatenates populated name and vital fields into a single string with birth/death prefixes for traceability.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Include location qualifiers to aid log searches."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Used by search_api_for_criteria when reporting outbound searches."
    },
    {
      "id": "function:api_search_utils._get_tree_id",
      "type": "function",
      "name": "api_search_utils._get_tree_id",
      "path": "api_search_utils.py",
      "summary": "Retrieves the active tree identifier from session context or test configuration.",
      "mechanism": "Checks SessionManager for my_tree_id before falling back to config_schema test defaults.",
      "quality": "stable",
      "concerns": [
        "Returns empty string when config lacks overrides, leading to silent failures."
      ],
      "opportunities": [
        "Report telemetry when no tree ID can be resolved."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Critical for both Suggest and TreesUI API invocations."
    },
    {
      "id": "function:api_search_utils.search_api_for_criteria",
      "type": "function",
      "name": "api_search_utils.search_api_for_criteria",
      "path": "api_search_utils.py",
      "summary": "High-level orchestration that queries Suggest and TreesUI APIs then returns scored matches.",
      "mechanism": "Validates session state, builds search query, resolves tree context, scores Suggest results, optionally enriches with TreesUI candidates, and returns sorted matches up to max_results.",
      "quality": "stable",
      "concerns": [
        "Minimal differentiation between zero results and API failures."
      ],
      "opportunities": [
        "Emit structured result metrics to performance monitor."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Provides API fallback search used by Action 10 when GEDCOM scoring is unavailable."
    },
    {
      "id": "function:api_search_utils._resolve_tree_id",
      "type": "function",
      "name": "api_search_utils._resolve_tree_id",
      "path": "api_search_utils.py",
      "summary": "Resolves a tree identifier from explicit input, session context, or test configuration fallback.",
      "mechanism": "Checks provided tree_id, SessionManager.my_tree_id, and config_schema.test.test_tree_id in order, logging when missing.",
      "quality": "stable",
      "concerns": [
        "Returns None when all sources fail which upstream callers must handle."
      ],
      "opportunities": [
        "Record diagnostics when configuration lacks tree IDs."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Prerequisite for Edit Relationships API lookups."
    },
    {
      "id": "function:api_search_utils._resolve_owner_profile_id",
      "type": "function",
      "name": "api_search_utils._resolve_owner_profile_id",
      "path": "api_search_utils.py",
      "summary": "Determines the owner profile identifier required by relationship APIs.",
      "mechanism": "Reads SessionManager.my_profile_id or falls back to configured test_profile_id while warning when absent.",
      "quality": "stable",
      "concerns": [
        "Relies on optional test configuration when account data is unavailable."
      ],
      "opportunities": [
        "Persist owner profile ID once retrieved to avoid repeated lookups."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Pairs with _resolve_tree_id for Edit Relationships requests."
    },
    {
      "id": "function:api_search_utils._get_facts_data_from_api",
      "type": "function",
      "name": "api_search_utils._get_facts_data_from_api",
      "path": "api_search_utils.py",
      "summary": "Fetches raw relationship data from the Edit Relationships endpoint.",
      "mechanism": "Invokes call_edit_relationships_api, logs response schema, and returns the parsed 'res' payload or decoded JSON string variant.",
      "quality": "stable",
      "concerns": [
        "Consumes entire response in memory before parsing."
      ],
      "opportunities": [
        "Add telemetry when response format diverges from expectations."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Supports older fallback path for family detail extraction."
    },
    {
      "id": "function:api_search_utils._initialize_family_result",
      "type": "function",
      "name": "api_search_utils._initialize_family_result",
      "path": "api_search_utils.py",
      "summary": "Creates an empty family detail structure with default fields and lists.",
      "mechanism": "Returns a dictionary seeded with placeholder values for names, vitals, and relation collections keyed by person_id.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Extend to include metadata such as data_source or fetch_status."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Shared initializer for family detail workflows."
    },
    {
      "id": "function:api_search_utils._extract_person_info_from_target",
      "type": "function",
      "name": "api_search_utils._extract_person_info_from_target",
      "path": "api_search_utils.py",
      "summary": "Populates result metadata from the targetPerson object returned by Edit Relationships API.",
      "mechanism": "Reads given/surname, gender, and birth/death date components, formatting dates via _format_date before storing on result dict.",
      "quality": "stable",
      "concerns": [
        "Assumes month indices map directly to predefined name list."
      ],
      "opportunities": [
        "Handle localized month strings returned by international endpoints."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Used when Edit Relationships payload includes targetPerson data."
    },
    {
      "id": "function:api_search_utils._format_person_from_relationship_data",
      "type": "function",
      "name": "api_search_utils._format_person_from_relationship_data",
      "path": "api_search_utils.py",
      "summary": "Converts Edit Relationships relation entries into simplified display dictionaries.",
      "mechanism": "Combines given and surname fields, handles suffixes, and extracts birth/death years for downstream display.",
      "quality": "stable",
      "concerns": [
        "Omits location data even when available."
      ],
      "opportunities": [
        "Include relationship type to aid presenter formatting."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Shared by parent, spouse, and child extraction helpers."
    },
    {
      "id": "function:api_search_utils._format_date",
      "type": "function",
      "name": "api_search_utils._format_date",
      "path": "api_search_utils.py",
      "summary": "Formats day/month/year parts into human-readable genealogical dates.",
      "mechanism": "Maps month integers to three-letter names and builds display strings, defaulting to year or 'Unknown'.",
      "quality": "stable",
      "concerns": [
        "Month mapping lacks localization awareness."
      ],
      "opportunities": [
        "Support configurable locale-specific month names."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Reused by target person extraction to format birth/death dates."
    },
    {
      "id": "function:api_search_utils._debug_log_facts_structure",
      "type": "function",
      "name": "api_search_utils._debug_log_facts_structure",
      "path": "api_search_utils.py",
      "summary": "Outputs keys and collection sizes from Edit Relationships payloads for troubleshooting.",
      "mechanism": "Iterates dictionary entries, logging type and length information to assist schema diagnosis.",
      "quality": "stable",
      "concerns": [
        "Only reachable when manually invoked, limiting usefulness."
      ],
      "opportunities": [
        "Hook into a verbose flag to enable automatic diagnostics."
      ],
      "tests": null,
      "notes": "Aids debugging when API responses shift structure."
    },
    {
      "id": "function:api_search_utils._get_data_section_from_facts",
      "type": "function",
      "name": "api_search_utils._get_data_section_from_facts",
      "path": "api_search_utils.py",
      "summary": "Extracts the primary person section from Edit Relationships response variations.",
      "mechanism": "Returns the nested 'person' dict when present or the root payload for older schemas, ensuring downstream access to relation arrays.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Emit telemetry when structure differs to spot schema drift."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Simplifies compatibility across differing API response formats."
    },
    {
      "id": "function:api_search_utils._extract_target_person_info_if_available",
      "type": "function",
      "name": "api_search_utils._extract_target_person_info_if_available",
      "path": "api_search_utils.py",
      "summary": "Enriches result metadata when targetPerson details exist in Edit Relationships payloads.",
      "mechanism": "Attempts to fetch 'targetPerson' data and delegates to _extract_person_info_from_target with graceful error handling.",
      "quality": "stable",
      "concerns": [
        "Silently ignores exceptions which may mask parsing issues."
      ],
      "opportunities": [
        "Add diagnostic counters when target person extraction fails."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Optional enrichment step for Edit Relationships workflows."
    },
    {
      "id": "function:api_search_utils._extract_parents_from_data_section",
      "type": "function",
      "name": "api_search_utils._extract_parents_from_data_section",
      "path": "api_search_utils.py",
      "summary": "Appends parent records from Edit Relationships data to the family result.",
      "mechanism": "Iterates fathers and mothers arrays, formatting each entry through _format_person_from_relationship_data before storing in result['parents'].",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Capture relationship confidence or adoption indicators if present."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Part of legacy facts-based family extraction pipeline."
    },
    {
      "id": "function:api_search_utils._extract_spouses_from_data_section",
      "type": "function",
      "name": "api_search_utils._extract_spouses_from_data_section",
      "path": "api_search_utils.py",
      "summary": "Adds spouse entries from Edit Relationships payload to the result structure.",
      "mechanism": "Traverses the 'spouses' collection and formats each person using _format_person_from_relationship_data.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Track marriage metadata such as ceremony dates if exposed."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Complements parent and child extraction for full household context."
    },
    {
      "id": "function:api_search_utils._extract_children_from_data_section",
      "type": "function",
      "name": "api_search_utils._extract_children_from_data_section",
      "path": "api_search_utils.py",
      "summary": "Normalizes children arrays, handling nested list structures in Edit Relationships responses.",
      "mechanism": "Flattens list-of-lists child entries and formats each via _format_person_from_relationship_data before appending to result['children'].",
      "quality": "stable",
      "concerns": [
        "Does not de-duplicate child entries across multiple parent arrays."
      ],
      "opportunities": [
        "Track duplicate suppression metrics for QA insight."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Ensures consistent child data across varying API schemas."
    },
    {
      "id": "function:api_search_utils._find_target_person_in_list",
      "type": "function",
      "name": "api_search_utils._find_target_person_in_list",
      "path": "api_search_utils.py",
      "summary": "Locates the requested individual within New Family View person listings.",
      "mechanism": "Matches gid prefix against the target person_id to return the corresponding person dictionary.",
      "quality": "stable",
      "concerns": [
        "Assumes gid values consistently use '{id}:##' prefix."
      ],
      "opportunities": [
        "Fall back to direct id comparison when prefix format changes."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "First step in assembling family details from New Family View payloads."
    },
    {
      "id": "function:api_search_utils._create_persons_lookup",
      "type": "function",
      "name": "api_search_utils._create_persons_lookup",
      "path": "api_search_utils.py",
      "summary": "Builds a dictionary mapping New Family View gid values to person dictionaries for quick access.",
      "mechanism": "Iterates persons list, extracting gid.v values and storing the person object keyed by gid for lookup operations.",
      "quality": "stable",
      "concerns": [
        "Does not guard against duplicate GIDs beyond last-write wins."
      ],
      "opportunities": [
        "Add duplicate detection to catch API data anomalies."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Optimizes repeated lookups during family extraction."
    },
    {
      "id": "function:api_search_utils._extract_direct_family",
      "type": "function",
      "name": "api_search_utils._extract_direct_family",
      "path": "api_search_utils.py",
      "summary": "Populates parents, spouses, and children collections from New Family View relationships.",
      "mechanism": "Iterates relationship records, resolves related person via lookup, transforms entries through _parse_person_from_newfamilyview, and appends to result lists based on relation type codes.",
      "quality": "stable",
      "concerns": [
        "Assumes relation codes remain consistent across locales."
      ],
      "opportunities": [
        "Introduce mapping table configuration to adapt to future code changes."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Core routine for New Family View family extraction."
    },
    {
      "id": "function:api_search_utils._extract_siblings",
      "type": "function",
      "name": "api_search_utils._extract_siblings",
      "path": "api_search_utils.py",
      "summary": "Derives sibling relationships by traversing shared parent records from New Family View data.",
      "mechanism": "Collects parent GIDs, inspects their child entries, and appends formatted siblings while avoiding duplicates.",
      "quality": "stable",
      "concerns": [
        "Relies on consistent parent Family arrays; missing data can hide siblings."
      ],
      "opportunities": [
        "Flag cases where parent records lack family arrays for manual review."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Completes the family detail set beyond direct relations."
    },
    {
      "id": "function:api_search_utils._extract_person_id_from_gid",
      "type": "function",
      "name": "api_search_utils._extract_person_id_from_gid",
      "path": "api_search_utils.py",
      "summary": "Parses the base person identifier from a gid dictionary value.",
      "mechanism": "Splits the gid 'v' string on ':' and returns the first segment, falling back to 'Unknown' when missing.",
      "quality": "stable",
      "concerns": [
        "Returns literal 'Unknown' rather than None when parsing fails."
      ],
      "opportunities": [
        "Return Optional[str] to differentiate between failure and data absence."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Used during New Family View normalization to assign IDs."
    },
    {
      "id": "function:api_search_utils._extract_full_name_from_names",
      "type": "function",
      "name": "api_search_utils._extract_full_name_from_names",
      "path": "api_search_utils.py",
      "summary": "Builds a display name from New Family View Names arrays.",
      "mechanism": "Reads the first name entry, concatenating given and surname components with whitespace trimming.",
      "quality": "stable",
      "concerns": [
        "Ignores alternate names beyond the first list entry."
      ],
      "opportunities": [
        "Surface preferred name indicators when available."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Supports person normalization for family presentation."
    },
    {
      "id": "function:api_search_utils._extract_year_from_event_type",
      "type": "function",
      "name": "api_search_utils._extract_year_from_event_type",
      "path": "api_search_utils.py",
      "summary": "Extracts year information for specific event types within New Family View records.",
      "mechanism": "Scans Events list for matching type, splits normalized date strings, and converts the year component to int when possible.",
      "quality": "stable",
      "concerns": [
        "Stops at first matching event and ignores additional occurrences."
      ],
      "opportunities": [
        "Support approximate dates when nd field lacks year precision."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Feeding birth/death years into normalized family person structures."
    },
    {
      "id": "function:api_search_utils._parse_person_from_newfamilyview",
      "type": "function",
      "name": "api_search_utils._parse_person_from_newfamilyview",
      "path": "api_search_utils.py",
      "summary": "Normalizes a New Family View person entry into the project's standard person dictionary format.",
      "mechanism": "Uses helper extractors to pull ID, name, and vital years, returning a compact dict for presentation layers.",
      "quality": "stable",
      "concerns": [
        "Loses detailed event metadata beyond birth/death years."
      ],
      "opportunities": [
        "Extend to capture life events for richer displays."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Centralizes normalization for direct family and sibling extraction."
    },
    {
      "id": "function:api_search_utils._get_tree_id_for_relationship",
      "type": "function",
      "name": "api_search_utils._get_tree_id_for_relationship",
      "path": "api_search_utils.py",
      "summary": "Resolves tree identifier specifically for relationship ladder requests.",
      "mechanism": "Checks function argument, SessionManager.my_tree_id, and config_schema.test.test_tree_id, mirroring search flows.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Cache resolved tree ID for repeated ladder requests."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Ensures get_api_relationship_path has required context."
    },
    {
      "id": "function:api_search_utils._get_reference_id_for_relationship",
      "type": "function",
      "name": "api_search_utils._get_reference_id_for_relationship",
      "path": "api_search_utils.py",
      "summary": "Obtains the reference person identifier for ladder comparisons.",
      "mechanism": "Returns explicit parameter when provided or falls back to config_schema.reference_person_id if configured.",
      "quality": "stable",
      "concerns": [
        "Provides no alternate strategy when configuration lacks reference person."
      ],
      "opportunities": [
        "Surface clear error guidance when reference ID is missing."
      ],
      "tests": "api_search_utils_module_tests",
      "notes": "Supporting helper for get_api_relationship_path argument handling."
    },
    {
      "id": "function:api_search_utils._test_module_initialization",
      "type": "function",
      "name": "api_search_utils._test_module_initialization",
      "path": "api_search_utils.py",
      "summary": "Verifies configuration access patterns and default fallbacks within the module scope.",
      "mechanism": "Calls getattr on config_schema, asserting default values and expected types to ensure configuration wiring is intact.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "First sanity check executed in api_search_utils_module_tests."
    },
    {
      "id": "function:api_search_utils._test_core_functionality",
      "type": "function",
      "name": "api_search_utils._test_core_functionality",
      "path": "api_search_utils.py",
      "summary": "Exercises critical date extraction and simplified suggestion scoring workflows.",
      "mechanism": "Invokes _extract_year_from_date across varied inputs and validates positive scoring output from _run_simple_suggestion_scoring with representative data.",
      "quality": "stable",
      "concerns": [
        "Limited assertions on field_scores contents beyond type checking."
      ],
      "opportunities": [
        "Add explicit field score expectations to guard weight regressions."
      ],
      "tests": null,
      "notes": "Ensures baseline scoring pipeline remains functional."
    },
    {
      "id": "function:api_search_utils._test_edge_cases",
      "type": "function",
      "name": "api_search_utils._test_edge_cases",
      "path": "api_search_utils.py",
      "summary": "Validates resilience of year extraction and scoring routines with empty or malformed inputs.",
      "mechanism": "Passes blank strings, None, and range-like values into _extract_year_from_date and asserts zero score responses from simplified scoring on empty criteria.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add coverage for non-numeric birth/death values to mirror production anomalies."
      ],
      "tests": null,
      "notes": "Protects against regressions in defensive parsing logic."
    },
    {
      "id": "function:api_search_utils._test_integration",
      "type": "function",
      "name": "api_search_utils._test_integration",
      "path": "api_search_utils.py",
      "summary": "Confirms search_api_for_criteria integrates with mocked Suggest API responses.",
      "mechanism": "Uses unittest.mock to patch call_suggest_api and ensures search_api_for_criteria returns list output when dependencies succeed.",
      "quality": "stable",
      "concerns": [
        "Does not assert contents of returned suggestions beyond list type."
      ],
      "opportunities": [
        "Expand to validate score propagation from mocked responses."
      ],
      "tests": null,
      "notes": "Provides smoke coverage for orchestration flow with mocked session manager."
    },
    {
      "id": "function:api_search_utils._test_performance",
      "type": "function",
      "name": "api_search_utils._test_performance",
      "path": "api_search_utils.py",
      "summary": "Measures execution time of repeated simplified scoring to maintain performance envelope.",
      "mechanism": "Runs _run_simple_suggestion_scoring in a loop of 100 iterations and asserts duration under one second.",
      "quality": "stable",
      "concerns": [
        "Threshold may be environment dependent and could trigger flaky failures."
      ],
      "opportunities": [
        "Capture timing metrics for telemetry instead of hard assertion."
      ],
      "tests": null,
      "notes": "Acts as guardrail against accidental algorithmic slowdowns."
    },
    {
      "id": "function:api_search_utils._test_error_handling",
      "type": "function",
      "name": "api_search_utils._test_error_handling",
      "path": "api_search_utils.py",
      "summary": "Ensures configuration fallbacks and search error pathways behave safely.",
      "mechanism": "Checks getattr defaults on config_schema and verifies search_api_for_criteria returns empty results when session validation raises exceptions.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add assertions for logged errors to guarantee visibility."
      ],
      "tests": null,
      "notes": "Completes coverage of defensive search behaviors."
    },
    {
      "id": "function:api_search_utils.api_search_utils_module_tests",
      "type": "function",
      "name": "api_search_utils.api_search_utils_module_tests",
      "path": "api_search_utils.py",
      "summary": "Aggregates module-level tests into a TestSuite with logging suppression.",
      "mechanism": "Constructs a TestSuite, starts the suite, runs categorized tests within a suppress_logging context, and finalizes via finish_suite().",
      "quality": "stable",
      "concerns": [
        "Relies on hardcoded test descriptions which may drift from actual coverage."
      ],
      "opportunities": [
        "Generate metadata dynamically from function docstrings."
      ],
      "tests": null,
      "notes": "Reused by run_comprehensive_tests and __main__ guard."
    },
    {
      "id": "function:api_search_utils.run_comprehensive_tests",
      "type": "function",
      "name": "api_search_utils.run_comprehensive_tests",
      "path": "api_search_utils.py",
      "summary": "Convenience wrapper that executes the module TestSuite and returns success status.",
      "mechanism": "Delegates directly to api_search_utils_module_tests for compatibility with standardized runners.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "Supports command-line invocation and automated pipelines."
    },
    {
      "id": "file:test_framework.py",
      "type": "file",
      "name": "test_framework.py",
      "path": "test_framework.py",
      "summary": "Comprehensive testing harness providing TestSuite orchestration, logging controls, and assertion utilities.",
      "mechanism": "Defines TestSuite class with rich reporting, helper contexts like suppress_logging, and assorted validation utilities leveraged across modules.",
      "quality": "stable",
      "concerns": [
        "File size is large, making targeted maintenance more challenging."
      ],
      "opportunities": [
        "Factor reusable helpers into submodules to streamline navigation."
      ],
      "tests": "test_framework_module_tests",
      "notes": "Serves as shared foundation for embedded module test suites."
    },
    {
      "id": "class:test_framework.TestSuite",
      "type": "class",
      "name": "TestSuite",
      "path": "test_framework.py",
      "summary": "Standardized container managing ordered test execution with timing and result reporting.",
      "mechanism": "Tracks suite metadata, counts tests, times execution, and exposes start_suite, run_test, and finish_suite methods for consistent reporting.",
      "quality": "stable",
      "concerns": [
        "Holds state between runs; callers must create fresh instances for concurrency."
      ],
      "opportunities": [
        "Expose richer telemetry hooks for CI dashboards."
      ],
      "tests": "test_framework_module_tests",
      "notes": "Core primitive used by all module-level comprehensive tests."
    },
    {
      "id": "method:TestSuite.start_suite",
      "type": "method",
      "name": "TestSuite.start_suite",
      "path": "test_framework.py",
      "summary": "Initializes suite timing and logs header information prior to test execution.",
      "mechanism": "Sets start timestamp, prints formatted suite banner, and resets counters before individual tests run.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Allow dependency injection for output stream to simplify testing."
      ],
      "tests": "test_framework_module_tests",
      "notes": "Called by module test harnesses before registering cases."
    },
    {
      "id": "method:TestSuite.run_test",
      "type": "method",
      "name": "TestSuite.run_test",
      "path": "test_framework.py",
      "summary": "Executes a single test callable with standardized logging and exception handling.",
      "mechanism": "Wraps invocation in try/except, records pass/fail, captures duration, and prints formatted status lines with optional metadata.",
      "quality": "stable",
      "concerns": [
        "Inline formatting logic is extensive and could be modularized."
      ],
      "opportunities": [
        "Support async test callables for IO-bound checks."
      ],
      "tests": "test_framework_module_tests",
      "notes": "Used by every module ordering tests into the suite."
    },
    {
      "id": "method:TestSuite.finish_suite",
      "type": "method",
      "name": "TestSuite.finish_suite",
      "path": "test_framework.py",
      "summary": "Finalizes suite execution, prints aggregate results, and returns boolean success flag.",
      "mechanism": "Calculates elapsed time, formats summary tables, logs pass/fail counts, and indicates overall success to callers.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Emit machine-readable summary for CI ingestion."
      ],
      "tests": "test_framework_module_tests",
      "notes": "Return value is widely used to set process exit codes."
    },
    {
      "id": "function:test_framework.suppress_logging",
      "type": "function",
      "name": "test_framework.suppress_logging",
      "path": "test_framework.py",
      "summary": "Context manager temporarily silencing logging output during test execution.",
      "mechanism": "Adjusts logging levels and handlers within a context to avoid noisy stdout during TestSuite runs.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add parameterization for selective logger suppression."
      ],
      "tests": "test_framework_module_tests",
      "notes": "Commonly used by module tests to keep results concise."
    },
    {
      "id": "function:test_framework.test_function_availability",
      "type": "function",
      "name": "test_framework.test_function_availability",
      "path": "test_framework.py",
      "summary": "Utility asserting that required function names resolve to callables within a module scope.",
      "mechanism": "Iterates requested identifiers, checks globals for callables, logs missing entries, and returns boolean flags used by module suites.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Augment diagnostics with module path suggestions when functions are absent."
      ],
      "tests": "test_framework_module_tests",
      "notes": "Dependency for relationship_utils validation tests."
    },
    {
      "id": "function:api_search_utils.get_api_family_details",
      "type": "function",
      "name": "api_search_utils.get_api_family_details",
      "path": "api_search_utils.py",
      "summary": "Fetches immediate family information for a person via TreesUI APIs.",
      "mechanism": "Calls supporting API endpoints, normalizes parent/sibling/spouse/child data, and returns structured lists for presentation.",
      "quality": "stable",
      "concerns": [
        "Error handling falls back silently, which may hide API regressions."
      ],
      "opportunities": [
        "Surface telemetry when API responses lack expected keys."
      ],
      "tests": null,
      "notes": "Consumed by Action 10 fallback to present supplementary context."
    },
    {
      "id": "file:search_criteria_utils.py",
      "type": "file",
      "name": "search_criteria_utils.py",
      "path": "search_criteria_utils.py",
      "summary": "Shared CLI helper that gathers genealogical search criteria for downstream actions.",
      "mechanism": "Prompts for core person attributes, sanitizes inputs, constructs canonical criteria payloads, and logs printable summaries reused by Actions 10 and 11.",
      "quality": "stable",
      "concerns": [
        "Still duplicates year parsing helpers kept inside action10._collect_basic_criteria."
      ],
      "opportunities": [
        "Centralize year parsing with broader validation utilities to eliminate drift."
      ],
      "tests": "search_criteria_utils_module_tests",
      "notes": "Re-exports genealogy_presenter helpers to keep presentation logic in one place."
    },
    {
      "id": "function:search_criteria_utils.get_unified_search_criteria",
      "type": "function",
      "name": "search_criteria_utils.get_unified_search_criteria",
      "path": "search_criteria_utils.py",
      "summary": "Collects sanitized search criteria using optional injected input providers.",
      "mechanism": "Prompts for name, birth, and death fields, validates required identifiers, builds criteria with datetime objects, logs debug output, and prints a summary.",
      "quality": "stable",
      "concerns": [
        "Interactive prompting requires test doubles for automation."
      ],
      "opportunities": [
        "Allow persisted defaults or scripted templates for batch runs."
      ],
      "tests": "_test_get_unified_search_criteria_valid; _test_get_unified_search_criteria_minimal; _test_get_unified_search_criteria_cancelled",
      "notes": "Primary bridge ensuring Actions 10/11 share identical criteria prompts."
    },
    {
      "id": "function:search_criteria_utils._sanitize_input",
      "type": "function",
      "name": "search_criteria_utils._sanitize_input",
      "path": "search_criteria_utils.py",
      "summary": "Normalizes string input by trimming whitespace and handling empties.",
      "mechanism": "Strips whitespace, returning None when result is empty to simplify downstream checks.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Consider reusing utils.sanitize_input once module review completes."
      ],
      "tests": "_test_sanitize_input",
      "notes": "Utility scoped to search criteria prompts."
    },
    {
      "id": "function:search_criteria_utils._parse_year_input",
      "type": "function",
      "name": "search_criteria_utils._parse_year_input",
      "path": "search_criteria_utils.py",
      "summary": "Converts numeric year strings into integers for criteria payloads.",
      "mechanism": "Checks stripped input for digit-only content and returns int value when valid.",
      "quality": "stable",
      "concerns": [
        "Lacks upper/lower bound validation beyond digit check."
      ],
      "opportunities": [
        "Share validation with broader year parsing to enforce genealogical ranges."
      ],
      "tests": "_test_parse_year_input",
      "notes": "Keeps interactive prompts resilient to blank entries."
    },
    {
      "id": "function:search_criteria_utils._create_date_object",
      "type": "function",
      "name": "search_criteria_utils._create_date_object",
      "path": "search_criteria_utils.py",
      "summary": "Builds timezone-aware datetime placeholders from year values.",
      "mechanism": "Attempts to construct UTC datetime for January 1 of supplied year, logging warnings on ValueError and returning None when invalid.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Surface validation errors back to caller for richer UX messaging."
      ],
      "tests": "_test_create_date_object",
      "notes": "Used to align GEDCOM scoring with standardized date objects."
    },
    {
      "id": "function:search_criteria_utils._debug_log_criteria",
      "type": "function",
      "name": "search_criteria_utils._debug_log_criteria",
      "path": "search_criteria_utils.py",
      "summary": "Emits debug-level log entries for collected search criteria.",
      "mechanism": "Iterates collected fields, skipping datetime objects, and logs human-readable key/value pairs for troubleshooting.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Mask personally identifiable data if production logging introduces audit constraints."
      ],
      "tests": null,
      "notes": "Supports Action 10 telemetry when running in debug mode."
    },
    {
      "id": "function:search_criteria_utils._print_criteria_summary",
      "type": "function",
      "name": "search_criteria_utils._print_criteria_summary",
      "path": "search_criteria_utils.py",
      "summary": "Prints an info-level summary of search criteria for the operator.",
      "mechanism": "Maps canonical keys to friendly labels and prints only provided fields for concise CLI output.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Include configurable output channels for logging frameworks."
      ],
      "tests": null,
      "notes": "Produces consistent CLI output across Actions 10 and 11."
    },
    {
      "id": "function:search_criteria_utils._test_present_post_selection_minimal",
      "type": "function",
      "name": "search_criteria_utils._test_present_post_selection_minimal",
      "path": "search_criteria_utils.py",
      "summary": "Validates the presenter pipeline when only minimal match details are available.",
      "mechanism": "Captures stdout while calling present_post_selection with pared-down family data and asserts header plus relationship strings are emitted.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add variants covering relationship formatting errors."
      ],
      "tests": null,
      "notes": "Executed via search_criteria_utils_module_tests."
    },
    {
      "id": "function:search_criteria_utils._test_sanitize_input",
      "type": "function",
      "name": "search_criteria_utils._test_sanitize_input",
      "path": "search_criteria_utils.py",
      "summary": "Confirms _sanitize_input trims whitespace and normalizes empty strings.",
      "mechanism": "Exercises helper with typical values, whitespace-only inputs, and blank strings to ensure None is returned when appropriate.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "Executed via search_criteria_utils_module_tests."
    },
    {
      "id": "function:search_criteria_utils._test_parse_year_input",
      "type": "function",
      "name": "search_criteria_utils._test_parse_year_input",
      "path": "search_criteria_utils.py",
      "summary": "Ensures _parse_year_input converts digit strings to integers while rejecting invalid formats.",
      "mechanism": "Checks trimmed numeric strings return int values and asserts alphabetic, decimal, and empty inputs produce None.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "Executed via search_criteria_utils_module_tests."
    },
    {
      "id": "function:search_criteria_utils._test_create_date_object",
      "type": "function",
      "name": "search_criteria_utils._test_create_date_object",
      "path": "search_criteria_utils.py",
      "summary": "Verifies _create_date_object builds January first datetime placeholders for valid years.",
      "mechanism": "Asserts year, month, and day fields on successful calls while confirming None is returned for missing or extreme values.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "Executed via search_criteria_utils_module_tests."
    },
    {
      "id": "function:search_criteria_utils._test_get_unified_search_criteria_valid",
      "type": "function",
      "name": "search_criteria_utils._test_get_unified_search_criteria_valid",
      "path": "search_criteria_utils.py",
      "summary": "Checks get_unified_search_criteria returns complete dictionaries when all prompts are provided.",
      "mechanism": "Feeds mock input sequence covering every field and asserts names, places, years, and derived datetime objects exist in the result.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Include assertion for logging side effects once instrumentation expands."
      ],
      "tests": null,
      "notes": "Executed via search_criteria_utils_module_tests."
    },
    {
      "id": "function:search_criteria_utils._test_get_unified_search_criteria_minimal",
      "type": "function",
      "name": "search_criteria_utils._test_get_unified_search_criteria_minimal",
      "path": "search_criteria_utils.py",
      "summary": "Validates get_unified_search_criteria accepts minimal input and leaves optional fields blank.",
      "mechanism": "Supplies a mock input iterator with only first-name populated and ensures nullable fields remain None without raising errors.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "Executed via search_criteria_utils_module_tests."
    },
    {
      "id": "function:search_criteria_utils._test_get_unified_search_criteria_cancelled",
      "type": "function",
      "name": "search_criteria_utils._test_get_unified_search_criteria_cancelled",
      "path": "search_criteria_utils.py",
      "summary": "Ensures get_unified_search_criteria exits early when required name prompts remain empty.",
      "mechanism": "Mocks input returning blank strings and confirms the helper yields None to signal cancellation.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "Executed via search_criteria_utils_module_tests."
    },
    {
      "id": "function:search_criteria_utils._test_display_family_members",
      "type": "function",
      "name": "search_criteria_utils._test_display_family_members",
      "path": "search_criteria_utils.py",
      "summary": "Verifies family display helper integration remains intact after relocation.",
      "mechanism": "Captures stdout, invokes display_family_members with varied inputs, and asserts expected sections are present.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "Ensures re-exported presenter functions continue to behave as expected."
    },
    {
      "id": "function:search_criteria_utils.search_criteria_utils_module_tests",
      "type": "function",
      "name": "search_criteria_utils.search_criteria_utils_module_tests",
      "path": "search_criteria_utils.py",
      "summary": "Module-specific TestSuite orchestrating search criteria utility tests.",
      "mechanism": "Registers sanitization, parsing, date creation, prompt collection, and presenter smoke tests with the shared TestSuite harness.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add presenter regression cases covering localized output variants."
      ],
      "tests": null,
      "notes": "Wrapped by create_standard_test_runner for CLI execution."
    },
    {
      "id": "file:genealogy_presenter.py",
      "type": "file",
      "name": "genealogy_presenter.py",
      "path": "genealogy_presenter.py",
      "summary": "Shared CLI presenter that standardizes how match details and family sections are printed for Actions 10 and 11.",
      "mechanism": "Centralizes header formatting, family section rendering, and relationship path output so GEDCOM and API flows produce identical text.",
      "quality": "stable",
      "concerns": [
        "Presentation code duplicates some formatting logic that could move to view helpers."
      ],
      "opportunities": [
        "Allow dependency injection of output streams for testability beyond stdout."
      ],
      "tests": "genealogy_presenter_module_tests",
      "notes": "Acts as shared layer for search_criteria_utils and Action 10 presenter output."
    },
    {
      "id": "function:genealogy_presenter._format_years_display",
      "type": "function",
      "name": "genealogy_presenter._format_years_display",
      "path": "genealogy_presenter.py",
      "summary": "Formats birth/death year combinations for headers and list items.",
      "mechanism": "Applies simple conditional logic to return ranges, birth-only, death-only, or empty strings.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:genealogy_presenter._print_section_header",
      "type": "function",
      "name": "genealogy_presenter._print_section_header",
      "path": "genealogy_presenter.py",
      "summary": "Prints relation section headers with spacing control.",
      "mechanism": "Adds blank lines between sections after the first to keep output readable.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:genealogy_presenter._print_family_member",
      "type": "function",
      "name": "genealogy_presenter._print_family_member",
      "path": "genealogy_presenter.py",
      "summary": "Renders a single family member entry including optional years.",
      "mechanism": "Pulls sanitized name and year fields, delegates year formatting to internal helper.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:genealogy_presenter._deduplicate_members",
      "type": "function",
      "name": "genealogy_presenter._deduplicate_members",
      "path": "genealogy_presenter.py",
      "summary": "Removes duplicate family member entries before printing.",
      "mechanism": "Tracks lowercase name and year tuples to filter repeated objects.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:genealogy_presenter._filter_valid_members",
      "type": "function",
      "name": "genealogy_presenter._filter_valid_members",
      "path": "genealogy_presenter.py",
      "summary": "Filters out placeholder or empty family entries.",
      "mechanism": "Skips blank names and common sentinel values like 'Unknown' or '-' to avoid noisy output.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:genealogy_presenter.display_family_members",
      "type": "function",
      "name": "genealogy_presenter.display_family_members",
      "path": "genealogy_presenter.py",
      "summary": "Prints family sections (parents, spouses, etc.) in a consistent order.",
      "mechanism": "Iterates configured relation labels, deduplicates entries, filters invalid members, and prints each using shared formatting helpers.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:genealogy_presenter.present_post_selection",
      "type": "function",
      "name": "genealogy_presenter.present_post_selection",
      "path": "genealogy_presenter.py",
      "summary": "Unified presenter for match header, family sections, and relationship path summary.",
      "mechanism": "Prints header via year formatter, delegates family rendering, and optionally formats relationship text using relationship_utils when provided.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:genealogy_presenter.genealogy_presenter_module_tests",
      "type": "function",
      "name": "genealogy_presenter.genealogy_presenter_module_tests",
      "path": "genealogy_presenter.py",
      "summary": "TestSuite wrapper validating presenter helpers run without error.",
      "mechanism": "Instantiates the shared TestSuite, registers a smoke test invoking present_post_selection with placeholder family data, and finalizes the run for CLI integration.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Expand coverage to assert formatted output contents and edge cases."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:genealogy_presenter._test_presenter_runs",
      "type": "function",
      "name": "genealogy_presenter._test_presenter_runs",
      "path": "genealogy_presenter.py",
      "summary": "Smoke test ensuring present_post_selection handles empty family data gracefully.",
      "mechanism": "Invokes present_post_selection with blank relation arrays and default owner name to verify no exceptions are raised during printing.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Capture stdout and assert key headers when presenter coverage broadens."
      ],
      "tests": null,
      "notes": "Executed within genealogy_presenter_module_tests."
    },
    {
      "id": "function:genealogy_presenter.run_comprehensive_tests",
      "type": "function",
      "name": "genealogy_presenter.run_comprehensive_tests",
      "path": "genealogy_presenter.py",
      "summary": "Convenience wrapper enabling CLI execution of genealogy presenter tests.",
      "mechanism": "Created via create_standard_test_runner bound to genealogy_presenter_module_tests for consistent invocation across modules.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "Invoked by __main__ guard."
    },
    {
      "id": "file:relationship_utils.py",
      "type": "file",
      "name": "relationship_utils.py",
      "path": "relationship_utils.py",
      "summary": "Relationship utility toolkit powering GEDCOM and API match explanations.",
      "mechanism": "Provides LRU-cached bidirectional BFS over person graphs, converts raw ladder data into unified relationship paths, and renders narrative summaries for CLI output.",
      "quality": "stable",
      "concerns": [
        "Monolithic module mixes graph search, HTML parsing, and formatting heuristics."
      ],
      "opportunities": [
        "Split search, API parsing, and presentation utilities into focused modules."
      ],
      "tests": "relationship_utils_module_tests",
      "notes": "Critical dependency for Action 10 analysis and API relationship rendering."
    },
    {
      "id": "class:relationship_utils.RelationshipPathCache",
      "type": "class",
      "name": "relationship_utils.RelationshipPathCache",
      "path": "relationship_utils.py",
      "summary": "LRU cache tracking previously computed relationship paths between IDs.",
      "mechanism": "Wraps OrderedDict to store bidirectional key pairs, evicts oldest entries over maxsize, and records hit/miss statistics for telemetry.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Persist stats to disk so long-running sessions survive restarts."
      ],
      "tests": null,
      "notes": "Shared singleton _relationship_path_cache handles caching for fast_bidirectional_bfs."
    },
    {
      "id": "method:RelationshipPathCache.get",
      "type": "method",
      "name": "RelationshipPathCache.get",
      "path": "relationship_utils.py",
      "summary": "Retrieves a cached path using the normalized key ordering.",
      "mechanism": "Increments query counters, generates a bidirectional key via _make_key, and moves hits to the MRU end of the OrderedDict.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Record timestamp of last access for richer telemetry."
      ],
      "tests": null,
      "notes": "Called by fast_bidirectional_bfs before executing a search."
    },
    {
      "id": "method:RelationshipPathCache.put",
      "type": "method",
      "name": "RelationshipPathCache.put",
      "path": "relationship_utils.py",
      "summary": "Stores a path result and enforces LRU eviction policy.",
      "mechanism": "Builds the normalized key, inserts/updates the OrderedDict entry, and pops the oldest entry when capacity is exceeded.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Log evictions when cache churn exceeds expectations."
      ],
      "tests": null,
      "notes": "Invoked by fast_bidirectional_bfs after computing a path."
    },
    {
      "id": "method:RelationshipPathCache.clear",
      "type": "method",
      "name": "RelationshipPathCache.clear",
      "path": "relationship_utils.py",
      "summary": "Resets cached paths and associated statistics counters.",
      "mechanism": "Clears the OrderedDict storage and zeroes hit/miss/query counters to provide a fresh cache state.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "Used by clear_relationship_cache and cache regression tests."
    },
    {
      "id": "method:RelationshipPathCache.get_stats",
      "type": "method",
      "name": "RelationshipPathCache.get_stats",
      "path": "relationship_utils.py",
      "summary": "Returns cache size and hit/miss counters for monitoring.",
      "mechanism": "Calculates hit rate percentage from tracked counters and exposes current/max sizes in a dictionary payload.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Emit rolling hit rate averages for smoother trend analysis."
      ],
      "tests": null,
      "notes": "Consumed by monitoring helpers and regression tests."
    },
    {
      "id": "method:RelationshipPathCache._make_key",
      "type": "method",
      "name": "RelationshipPathCache._make_key",
      "path": "relationship_utils.py",
      "summary": "Creates an order-independent cache key from two person IDs.",
      "mechanism": "Sorts the provided IDs to guarantee bidirectional lookups map to the same tuple key.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Normalize IDs (upper-case) before sorting to avoid duplicates."
      ],
      "tests": null,
      "notes": "Shared by get and put when interacting with the cache store."
    },
    {
      "id": "function:relationship_utils.get_relationship_cache_stats",
      "type": "function",
      "name": "relationship_utils.get_relationship_cache_stats",
      "path": "relationship_utils.py",
      "summary": "Expose current cache metrics (hits, misses, size) for monitoring.",
      "mechanism": "Returns a stats dict from the global RelationshipPathCache instance without side effects.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Feed metrics into performance dashboards for long runs."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:relationship_utils.clear_relationship_cache",
      "type": "function",
      "name": "relationship_utils.clear_relationship_cache",
      "path": "relationship_utils.py",
      "summary": "Reset the relationship path cache and log the maintenance action.",
      "mechanism": "Clears the singleton cache object and emits an info-level message to aid support flows.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Expose CLI hook in maintenance scripts for operators."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:relationship_utils.report_cache_stats_to_performance_monitor",
      "type": "function",
      "name": "relationship_utils.report_cache_stats_to_performance_monitor",
      "path": "relationship_utils.py",
      "summary": "Send cache hit-rate statistics to the performance monitor subsystem.",
      "mechanism": "Imports performance_monitor lazily, then forwards cache counters to track cache effectiveness; failures degrade silently.",
      "quality": "stable",
      "concerns": [
        "Soft failure hides import/runtime issues behind DEBUG logs."
      ],
      "opportunities": [
        "Harden telemetry with explicit alerting when performance monitor is unavailable."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:relationship_utils._find_direct_relationship",
      "type": "function",
      "name": "relationship_utils._find_direct_relationship",
      "path": "relationship_utils.py",
      "summary": "Checks for immediate parent, child, or sibling relationships between two IDs.",
      "mechanism": "Examines parent and child maps plus shared parents to return the shortest direct connection, falling back to an empty list when none found.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Cache direct relationship lookups for very dense graphs."
      ],
      "tests": null,
      "notes": "Used by fast_bidirectional_bfs as a quick win before full search."
    },
    {
      "id": "function:relationship_utils._has_direct_relationship",
      "type": "function",
      "name": "relationship_utils._has_direct_relationship",
      "path": "relationship_utils.py",
      "summary": "Determines if two IDs share a direct parent, child, or sibling link.",
      "mechanism": "Checks parent/child mappings and limited grandparent/grandchild cases to grade path segments during scoring.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Extend detection to spouse relationships to refine scoring."
      ],
      "tests": null,
      "notes": "Supports _score_path when evaluating candidate ladders."
    },
    {
      "id": "function:relationship_utils._validate_bfs_inputs",
      "type": "function",
      "name": "relationship_utils._validate_bfs_inputs",
      "path": "relationship_utils.py",
      "summary": "Performs basic sanity checks before launching the bidirectional BFS.",
      "mechanism": "Verifies non-empty IDs and map availability, logging errors when prerequisites are missing so callers can short-circuit gracefully.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Surface detailed validation failures to the caller instead of booleans."
      ],
      "tests": null,
      "notes": "First guard inside fast_bidirectional_bfs."
    },
    {
      "id": "function:relationship_utils._initialize_bfs_queues",
      "type": "function",
      "name": "relationship_utils._initialize_bfs_queues",
      "path": "relationship_utils.py",
      "summary": "Seeds the forward and backward BFS queues with starting nodes.",
      "mechanism": "Creates deques for both search directions and initializes visited dictionaries with depth/path metadata.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Include heuristic weights to bias subsequent expansions."
      ],
      "tests": null,
      "notes": "Called by fast_bidirectional_bfs after validation passes."
    },
    {
      "id": "function:relationship_utils._check_search_limits",
      "type": "function",
      "name": "relationship_utils._check_search_limits",
      "path": "relationship_utils.py",
      "summary": "Enforces timeout and node exploration limits for the BFS.",
      "mechanism": "Compares elapsed time and processed node counts against thresholds, emitting warnings and halting when limits are reached.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Make thresholds configurable to match dataset size."
      ],
      "tests": null,
      "notes": "Used by _run_bfs_search_loop each iteration."
    },
    {
      "id": "function:relationship_utils._add_relative_to_queue",
      "type": "function",
      "name": "relationship_utils._add_relative_to_queue",
      "path": "relationship_utils.py",
      "summary": "Appends unvisited relatives to the BFS queue with updated paths.",
      "mechanism": "Avoids revisiting nodes by checking the visited map and builds new path sequences before enqueueing.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Track relationship types alongside IDs to improve pruning."
      ],
      "tests": null,
      "notes": "Shared by forward and backward expansion helpers."
    },
    {
      "id": "function:relationship_utils._expand_to_siblings",
      "type": "function",
      "name": "relationship_utils._expand_to_siblings",
      "path": "relationship_utils.py",
      "summary": "Traverses up to parents and down to siblings during BFS expansion.",
      "mechanism": "Iterates over parent IDs, then adds each different child as a sibling node with appropriate depth adjustments.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Deduplicate siblings when multiple parents share children."
      ],
      "tests": null,
      "notes": "Invoked by _expand_to_relatives for sibling exploration."
    },
    {
      "id": "function:relationship_utils._expand_to_relatives",
      "type": "function",
      "name": "relationship_utils._expand_to_relatives",
      "path": "relationship_utils.py",
      "summary": "Expands the BFS frontier to parents, children, and siblings for a node.",
      "mechanism": "Pushes parent and child IDs via _add_relative_to_queue and defers sibling traversal to _expand_to_siblings when appropriate.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Skip expansions when nodes already exceed max depth to save work."
      ],
      "tests": null,
      "notes": "Called by queue processors in both BFS directions."
    },
    {
      "id": "function:relationship_utils._process_forward_queue",
      "type": "function",
      "name": "relationship_utils._process_forward_queue",
      "path": "relationship_utils.py",
      "summary": "Processes one step of the forward BFS queue and records meeting points.",
      "mechanism": "Dequeues the next forward node, checks for intersections with backward visited nodes, logs paths found, and expands neighbors if depth allows.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Capture debug metrics on branching factor for tuning."
      ],
      "tests": null,
      "notes": "Used by _run_bfs_search_loop."
    },
    {
      "id": "function:relationship_utils._process_backward_queue",
      "type": "function",
      "name": "relationship_utils._process_backward_queue",
      "path": "relationship_utils.py",
      "summary": "Advances the backward BFS queue mirroring forward processing.",
      "mechanism": "Dequeues nodes from the backward frontier, detects intersections with the forward visited map, and expands neighbors when under depth limits.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Collect per-direction statistics to balance expansion strategies."
      ],
      "tests": null,
      "notes": "Used by _run_bfs_search_loop."
    },
    {
      "id": "function:relationship_utils._score_path",
      "type": "function",
      "name": "relationship_utils._score_path",
      "path": "relationship_utils.py",
      "summary": "Assigns a heuristic score to candidate paths based on directness and length.",
      "mechanism": "Counts how many edges represent direct relationships via _has_direct_relationship and subtracts a length penalty to favor concise paths.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Incorporate relationship weights (e.g., parents over cousins)."
      ],
      "tests": null,
      "notes": "Feeding into _select_best_path for final choice."
    },
    {
      "id": "function:relationship_utils._select_best_path",
      "type": "function",
      "name": "relationship_utils._select_best_path",
      "path": "relationship_utils.py",
      "summary": "Chooses the highest-scoring path among BFS intersections.",
      "mechanism": "Computes scores for each candidate path using _score_path and returns the path with the highest value, logging selection details for debugging.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Include tie-breakers using temporal or gender metadata."
      ],
      "tests": null,
      "notes": "Invoked by fast_bidirectional_bfs when paths are found."
    },
    {
      "id": "function:relationship_utils._run_bfs_search_loop",
      "type": "function",
      "name": "relationship_utils._run_bfs_search_loop",
      "path": "relationship_utils.py",
      "summary": "Coordinates the alternating forward/backward BFS expansions until limits are hit.",
      "mechanism": "Iteratively processes forward and backward queues, leveraging _check_search_limits, _process_forward_queue, and _process_backward_queue to accumulate path candidates.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Expose instrumentation hooks for runtime diagnostics."
      ],
      "tests": null,
      "notes": "Central loop used by fast_bidirectional_bfs."
    },
    {
      "id": "function:relationship_utils.fast_bidirectional_bfs",
      "type": "function",
      "name": "relationship_utils.fast_bidirectional_bfs",
      "path": "relationship_utils.py",
      "summary": "Compute relationship paths using a bidirectional BFS with caching and heuristic scoring.",
      "mechanism": "Validates inputs, checks the LRU cache, explores parents/children/siblings from both ends with depth limits, and scores candidate paths for directness before caching the best route.",
      "quality": "stable",
      "concerns": [
        "Search parameters remain hardcoded and may need tuning for very large trees."
      ],
      "opportunities": [
        "Surface knobs via config to adjust depth and timeouts per dataset."
      ],
      "tests": "relationship_utils_module_tests",
      "notes": ""
    },
    {
      "id": "function:relationship_utils.explain_relationship_path",
      "type": "function",
      "name": "relationship_utils.explain_relationship_path",
      "path": "relationship_utils.py",
      "summary": "Produce human-readable relationship explanations from GEDCOM path IDs.",
      "mechanism": "Converts raw ID paths into unified person dictionaries, then renders narrative text via format_relationship_path_unified.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add localization hooks for non-English output."
      ],
      "tests": "relationship_utils_module_tests",
      "notes": ""
    },
    {
      "id": "function:relationship_utils.format_api_relationship_path",
      "type": "function",
      "name": "relationship_utils.format_api_relationship_path",
      "path": "relationship_utils.py",
      "summary": "Normalize ladder API responses into the unified relationship narrative.",
      "mechanism": "Parses JSONP/HTML payloads, converts them into standardized path dictionaries, and reuses the unified formatter for final output.",
      "quality": "stable",
      "concerns": [
        "Dependent on fragile HTML scraping when JSON data unavailable."
      ],
      "opportunities": [
        "Prefer structured API responses when available to reduce parsing drift."
      ],
      "tests": "relationship_utils_module_tests",
      "notes": ""
    },
    {
      "id": "function:relationship_utils._extract_html_from_response",
      "type": "function",
      "name": "relationship_utils._extract_html_from_response",
      "path": "relationship_utils.py",
      "summary": "Separates HTML snippets and JSON payloads from ladder API responses.",
      "mechanism": "Detects JSONP wrappers, decodes embedded JSON via fast_json_loads, and returns the raw HTML plus parsed metadata for downstream formatting.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Expand JSONP detection to support additional callback names."
      ],
      "tests": null,
      "notes": "First step in format_api_relationship_path's parsing pipeline."
    },
    {
      "id": "function:relationship_utils._try_simple_text_relationship",
      "type": "function",
      "name": "relationship_utils._try_simple_text_relationship",
      "path": "relationship_utils.py",
      "summary": "Attempts to parse plain-text relationship strings without HTML.",
      "mechanism": "Runs regex scans for common relationship phrases and returns a quick narrative when matches are found, otherwise defers to richer parsing.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add support for extended kinship vocabulary beyond the core list."
      ],
      "tests": null,
      "notes": "Used within _try_html_formats before invoking BeautifulSoup handlers."
    },
    {
      "id": "function:relationship_utils._parse_html_relationship_data",
      "type": "function",
      "name": "relationship_utils._parse_html_relationship_data",
      "path": "relationship_utils.py",
      "summary": "Extracts ladder relationship rows from returned HTML markup.",
      "mechanism": "Uses BeautifulSoup to collect list items, filters hidden entries, and maps each node into dictionaries with name, relationship, and lifespan fields.",
      "quality": "stable",
      "concerns": [
        "Relies on class/structure conventions that may change without notice."
      ],
      "opportunities": [
        "Introduce schema validation to alert when HTML layouts drift."
      ],
      "tests": null,
      "notes": "Feeds convert_api_path_to_unified_format when HTML parsing succeeds."
    },
    {
      "id": "function:relationship_utils._format_discovery_api_path",
      "type": "function",
      "name": "relationship_utils._format_discovery_api_path",
      "path": "relationship_utils.py",
      "summary": "Renders Discovery API JSON relationship paths into bullet narratives.",
      "mechanism": "Iterates discovery path entries, normalizes names, resolves relationship labels via _get_relationship_term, and assembles a markdown-friendly list.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Share formatting templates with unified formatter to avoid divergence."
      ],
      "tests": null,
      "notes": "Called by format_api_relationship_path for JSON responses."
    },
    {
      "id": "function:relationship_utils._try_json_api_format",
      "type": "function",
      "name": "relationship_utils._try_json_api_format",
      "path": "relationship_utils.py",
      "summary": "Routes Discovery API JSON payloads through dedicated formatting.",
      "mechanism": "Checks for parsed JSON data, invokes _format_discovery_api_path when available, and returns None to fall back on HTML parsing otherwise.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add telemetry on JSON path coverage versus HTML fallback usage."
      ],
      "tests": null,
      "notes": "Cooperates with format_api_relationship_path."
    },
    {
      "id": "function:relationship_utils._try_html_formats",
      "type": "function",
      "name": "relationship_utils._try_html_formats",
      "path": "relationship_utils.py",
      "summary": "Drives HTML parsing fallbacks for ladder relationship data.",
      "mechanism": "Attempts simple text extraction, leverages BeautifulSoup when available, converts results via convert_api_path_to_unified_format, and formats them through the unified narrator.",
      "quality": "stable",
      "concerns": [
        "HTML parsing may break if upstream markup changes."
      ],
      "opportunities": [
        "Introduce structured API usage to reduce reliance on HTML scraping."
      ],
      "tests": null,
      "notes": "Fallback path inside format_api_relationship_path when JSON conversion fails."
    },
    {
      "id": "function:relationship_utils._should_skip_list_item",
      "type": "function",
      "name": "relationship_utils._should_skip_list_item",
      "path": "relationship_utils.py",
      "summary": "Filters irrelevant ladder list items before extraction.",
      "mechanism": "Checks BeautifulSoup tag visibility and class metadata to ignore hidden or icon-only entries during HTML parsing.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Extend filters to cover additional UI-only marker classes."
      ],
      "tests": null,
      "notes": "Used by _extract_person_from_list_item."
    },
    {
      "id": "function:relationship_utils._extract_name_from_item",
      "type": "function",
      "name": "relationship_utils._extract_name_from_item",
      "path": "relationship_utils.py",
      "summary": "Pulls display names from BeautifulSoup list items.",
      "mechanism": "Prefers bold tag text when present, falls back to direct string content, and returns sanitized strings for later formatting.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "Feeds _extract_person_from_list_item."
    },
    {
      "id": "function:relationship_utils._extract_relationship_from_item",
      "type": "function",
      "name": "relationship_utils._extract_relationship_from_item",
      "path": "relationship_utils.py",
      "summary": "Captures relationship descriptors from ladder HTML rows.",
      "mechanism": "Looks for italic tags to extract relationship phrases, returning empty strings if unavailable or tags missing methods.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "Feeds _extract_person_from_list_item."
    },
    {
      "id": "function:relationship_utils._extract_lifespan_from_item",
      "type": "function",
      "name": "relationship_utils._extract_lifespan_from_item",
      "path": "relationship_utils.py",
      "summary": "Derives lifespan year ranges from HTML item text.",
      "mechanism": "Performs regex search for YYYY-YYYY patterns (including Living) within list item text and returns the matched string when available.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "Feeds _extract_person_from_list_item."
    },
    {
      "id": "function:relationship_utils._extract_person_from_list_item",
      "type": "function",
      "name": "relationship_utils._extract_person_from_list_item",
      "path": "relationship_utils.py",
      "summary": "Combines name, relationship, and lifespan fields from HTML list entries.",
      "mechanism": "Skips irrelevant items, then aggregates name, relationship phrase, and lifespan by delegating to extraction helpers.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Return structured errors to aid debugging when parsing fails."
      ],
      "tests": null,
      "notes": "Used by _parse_html_relationship_data."
    },
    {
      "id": "function:relationship_utils.format_name",
      "type": "function",
      "name": "relationship_utils.format_name",
      "path": "relationship_utils.py",
      "summary": "Standardizes person names pulled from GEDCOM and API sources.",
      "mechanism": "Trims whitespace, removes GEDCOM slash wrappers, and title-cases each word while preserving initials and nicknames via helper routines.",
      "quality": "stable",
      "concerns": [
        "Relies on English-centric heuristics for particles and honorifics."
      ],
      "opportunities": [
        "Extract shared name normalization utilities for reuse across modules."
      ],
      "tests": "relationship_utils_module_tests",
      "notes": "Primary name normalizer for relationship conversions and presenters."
    },
    {
      "id": "function:relationship_utils._clean_gedcom_slashes",
      "type": "function",
      "name": "relationship_utils._clean_gedcom_slashes",
      "path": "relationship_utils.py",
      "summary": "Removes GEDCOM surname slash markers from raw name strings.",
      "mechanism": "Applies regex replacements to drop leading, trailing, and inline '/Surname/' tokens before further formatting.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Share logic with GEDCOM importers to avoid duplication."
      ],
      "tests": null,
      "notes": "Called by format_name prior to word-level formatting."
    },
    {
      "id": "function:relationship_utils._format_single_word",
      "type": "function",
      "name": "relationship_utils._format_single_word",
      "path": "relationship_utils.py",
      "summary": "Title-cases individual name tokens while honoring initials and prefixes.",
      "mechanism": "Keeps short all-caps segments, capitalizes particles like 'Mc' or \"O'\", preserves quoted nicknames, and defaults to title casing otherwise.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Augment particle list for broader cultural name coverage."
      ],
      "tests": null,
      "notes": "Used within format_name for per-word normalization."
    },
    {
      "id": "function:relationship_utils.convert_gedcom_path_to_unified_format",
      "type": "function",
      "name": "relationship_utils.convert_gedcom_path_to_unified_format",
      "path": "relationship_utils.py",
      "summary": "Translate GEDCOM ID sequences into the shared relationship data structure.",
      "mechanism": "Iterates IDs, extracts names and vital years, infers relationship terms via gedcom_utils helpers, and returns dictionaries with gender metadata.",
      "quality": "stable",
      "concerns": [
        "Fallback labeling defaults to 'relative' when heuristics fail."
      ],
      "opportunities": [
        "Adopt richer relationship taxonomy or confidence scoring."
      ],
      "tests": "relationship_utils_module_tests",
      "notes": ""
    },
    {
      "id": "function:relationship_utils.convert_api_path_to_unified_format",
      "type": "function",
      "name": "relationship_utils.convert_api_path_to_unified_format",
      "path": "relationship_utils.py",
      "summary": "Convert ladder API list elements into unified relationship dictionaries.",
      "mechanism": "Normalizes names, extracts lifespan years, infers genders and relationships using pattern helpers, and assembles the canonical structure for formatting.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Share gender inference logic with GEDCOM path converter to avoid drift."
      ],
      "tests": "relationship_utils_module_tests",
      "notes": ""
    },
    {
      "id": "function:relationship_utils._extract_person_basic_info",
      "type": "function",
      "name": "relationship_utils._extract_person_basic_info",
      "path": "relationship_utils.py",
      "summary": "Pulls name, life years, and gender markers from GEDCOM individual records.",
      "mechanism": "Reads NAME and vital tags via ged4py accessors, normalizes capitalization, and returns a tuple for downstream converters.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Cache repeated lookups when traversing long GEDCOM paths."
      ],
      "tests": null,
      "notes": "Used by convert_gedcom_path_to_unified_format."
    },
    {
      "id": "function:relationship_utils._are_spouses",
      "type": "function",
      "name": "relationship_utils._are_spouses",
      "path": "relationship_utils.py",
      "summary": "Thin wrapper around gedcom_utils._are_spouses with local signature alignment.",
      "mechanism": "Forwards person IDs and the GEDCOM reader to the shared helper while matching naming expectations within relationship_utils.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "Ensures spouse checks integrate with module-local relationship logic."
    },
    {
      "id": "function:relationship_utils._create_person_dict",
      "type": "function",
      "name": "relationship_utils._create_person_dict",
      "path": "relationship_utils.py",
      "summary": "Builds the canonical person dictionary consumed by unified formatters.",
      "mechanism": "Packages cleaned name, optional years, relationship label, and gender into a consistent dict structure.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "Shared between GEDCOM and API path converters."
    },
    {
      "id": "function:relationship_utils._determine_gedcom_relationship",
      "type": "function",
      "name": "relationship_utils._determine_gedcom_relationship",
      "path": "relationship_utils.py",
      "summary": "Classifies relationships between sequential GEDCOM IDs using helper predicates.",
      "mechanism": "Runs ordered checks for parent/child, sibling, spouse, grand relations, and cousins, delegating to gedcom_utils helpers and returning gender-aware terms.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Consolidate duplicate relationship logic shared with gedcom_utils.fast_bidirectional_bfs."
      ],
      "tests": null,
      "notes": "Invoked by convert_gedcom_path_to_unified_format."
    },
    {
      "id": "function:relationship_utils._parse_discovery_relationship",
      "type": "function",
      "name": "relationship_utils._parse_discovery_relationship",
      "path": "relationship_utils.py",
      "summary": "Extracts relationship term and gender hints from Discovery API strings.",
      "mechanism": "Scans for keyword mappings or regex-based 'is the ... of' patterns to classify relationships and infer gender markers.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Handle multilingual Discovery responses if localization expands."
      ],
      "tests": null,
      "notes": "Feeds convert_discovery_api_path_to_unified_format."
    },
    {
      "id": "function:relationship_utils._process_path_person",
      "type": "function",
      "name": "relationship_utils._process_path_person",
      "path": "relationship_utils.py",
      "summary": "Normalizes individual API path entries into unified dictionaries.",
      "mechanism": "Formats names, extracts lifespan years, parses relationship text, infers gender, and returns standardized dicts for later narration.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Share regex cleanup with other API parsing helpers."
      ],
      "tests": null,
      "notes": "Used within convert_api_path_to_unified_format."
    },
    {
      "id": "function:relationship_utils.convert_discovery_api_path_to_unified_format",
      "type": "function",
      "name": "relationship_utils.convert_discovery_api_path_to_unified_format",
      "path": "relationship_utils.py",
      "summary": "Transform Discovery API path objects into unified relationship data.",
      "mechanism": "Validates the JSON payload, extracts relationship phrases, deduces genders, and builds the standardized list consumed by the formatter.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add resilience for newer Discovery API schemas."
      ],
      "tests": "relationship_utils_module_tests",
      "notes": ""
    },
    {
      "id": "function:relationship_utils._format_years_display",
      "type": "function",
      "name": "relationship_utils._format_years_display",
      "path": "relationship_utils.py",
      "summary": "Formats birth and death year combinations into concise suffixes.",
      "mechanism": "Returns full ranges when both years exist, prefixes b./d. for single years, and falls back to an empty string when data is missing.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Support localized prefixes if non-English output becomes necessary."
      ],
      "tests": null,
      "notes": "Leveraged by unified relationship formatting helpers."
    },
    {
      "id": "function:relationship_utils._clean_name_format",
      "type": "function",
      "name": "relationship_utils._clean_name_format",
      "path": "relationship_utils.py",
      "summary": "Strips ged4py Name(...) wrappers for readable output.",
      "mechanism": "Uses regex replacements to remove Name('...') variants, returning plain display strings for presenter usage.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Centralize shared name cleanup between GEDCOM and API layers."
      ],
      "tests": null,
      "notes": "Feeds format_relationship_path_unified path narration."
    },
    {
      "id": "function:relationship_utils._check_uncle_aunt_pattern_sibling",
      "type": "function",
      "name": "relationship_utils._check_uncle_aunt_pattern_sibling",
      "path": "relationship_utils.py",
      "summary": "Detects aunt/uncle relationships via sibling branch analysis.",
      "mechanism": "Validates path length and inspects second/third relationship labels to see if the target's sibling parents the owner, returning gender-aware labels.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Extend detection to non-binary gender markers when data is enriched."
      ],
      "tests": null,
      "notes": "Evaluated within _determine_relationship_type_from_path."
    },
    {
      "id": "function:relationship_utils._check_uncle_aunt_pattern_parent",
      "type": "function",
      "name": "relationship_utils._check_uncle_aunt_pattern_parent",
      "path": "relationship_utils.py",
      "summary": "Detects aunt/uncle relationships using parent branch traversal.",
      "mechanism": "Checks parent then child relationships to infer aunt/uncle roles, falling back to gender-neutral labels when needed.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "Evaluated within _determine_relationship_type_from_path."
    },
    {
      "id": "function:relationship_utils._check_grandparent_pattern",
      "type": "function",
      "name": "relationship_utils._check_grandparent_pattern",
      "path": "relationship_utils.py",
      "summary": "Identifies grandparent relationships via successive child links.",
      "mechanism": "Confirms two child steps, infers gender through _determine_gender_for_person, and returns gender-specific titles.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add great-grandparent heuristics when longer paths are supported."
      ],
      "tests": null,
      "notes": "Evaluated within _determine_relationship_type_from_path."
    },
    {
      "id": "function:relationship_utils._check_cousin_pattern",
      "type": "function",
      "name": "relationship_utils._check_cousin_pattern",
      "path": "relationship_utils.py",
      "summary": "Detects cousin relationships through parent-sibling-child patterns.",
      "mechanism": "Verifies parent, sibling, then child relationships exist in sequence to classify the path as a cousin connection.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Consider distinguishing cousin degrees when depth metadata exists."
      ],
      "tests": null,
      "notes": "Evaluated within _determine_relationship_type_from_path."
    },
    {
      "id": "function:relationship_utils._check_nephew_niece_pattern",
      "type": "function",
      "name": "relationship_utils._check_nephew_niece_pattern",
      "path": "relationship_utils.py",
      "summary": "Determines nephew/niece relationships via parent-child branch inspection.",
      "mechanism": "Confirms parent followed by child relationship labels and consults gender metadata to pick nephew vs niece wording.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "Evaluated within _determine_relationship_type_from_path."
    },
    {
      "id": "function:relationship_utils._determine_relationship_type_from_path",
      "type": "function",
      "name": "relationship_utils._determine_relationship_type_from_path",
      "path": "relationship_utils.py",
      "summary": "Infers high-level relationship labels by running structured pattern detectors over the path.",
      "mechanism": "Iterates through specialized pattern helpers (aunt/uncle, grandparent, cousin, nephew/niece) and returns the first matching classification.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Introduce scoring to select between multiple matching patterns."
      ],
      "tests": null,
      "notes": "Invoked by format_relationship_path_unified when caller omits relationship_type."
    },
    {
      "id": "function:relationship_utils._convert_you_are_relationship",
      "type": "function",
      "name": "relationship_utils._convert_you_are_relationship",
      "path": "relationship_utils.py",
      "summary": "Transforms second-person relationship phrases into third-person inverse narration.",
      "mechanism": "Parses strings like 'You are the son of X' and maps them to parent-focused descriptions for uniform output formatting.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Expand mapping table to cover additional relationship terms surfaced by APIs."
      ],
      "tests": null,
      "notes": "Used within _format_path_step when API responses reference the owner directly."
    },
    {
      "id": "function:relationship_utils._format_path_step",
      "type": "function",
      "name": "relationship_utils._format_path_step",
      "path": "relationship_utils.py",
      "summary": "Builds a single bullet line for the unified relationship narrative.",
      "mechanism": "Cleans person names, appends year suffixes via _format_years_display, handles 'You are...' special cases, and ensures repeated names skip duplicate year output.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Consider extracting bullet prefix formatting for reuse across presenters."
      ],
      "tests": null,
      "notes": "Executed for each hop inside format_relationship_path_unified."
    },
    {
      "id": "function:relationship_utils._get_gendered_term",
      "type": "function",
      "name": "relationship_utils._get_gendered_term",
      "path": "relationship_utils.py",
      "summary": "Chooses gender-appropriate terminology with neutral fallback support.",
      "mechanism": "Examines provided sex character and returns male, female, or neutral term variants to support inclusive narratives.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add support for explicit non-binary indicators if APIs expose them."
      ],
      "tests": null,
      "notes": "Helper for _get_relationship_term and conversion logic."
    },
    {
      "id": "function:relationship_utils._get_relationship_term",
      "type": "function",
      "name": "relationship_utils._get_relationship_term",
      "path": "relationship_utils.py",
      "summary": "Maps API relationship codes to readable, gender-aware labels.",
      "mechanism": "Normalizes the code string, matches against known tokens, and delegates to _get_gendered_term for final wording.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add extended relationship taxonomy when available from APIs."
      ],
      "tests": null,
      "notes": "Feeds unified converters when deriving relationship text."
    },
    {
      "id": "function:relationship_utils._infer_gender_from_name",
      "type": "function",
      "name": "relationship_utils._infer_gender_from_name",
      "path": "relationship_utils.py",
      "summary": "Guesses gender from honorifics and common given names.",
      "mechanism": "Checks lowercased names against curated indicator lists and logs one-time debug entries when inferences occur.",
      "quality": "stable",
      "concerns": [
        "Indicator lists are heuristic and may require localization updates."
      ],
      "opportunities": [
        "Externalize indicator dictionaries for easier maintenance."
      ],
      "tests": null,
      "notes": "Supports _determine_gender_for_person heuristics."
    },
    {
      "id": "function:relationship_utils._infer_gender_from_relationship",
      "type": "function",
      "name": "relationship_utils._infer_gender_from_relationship",
      "path": "relationship_utils.py",
      "summary": "Infers gender by scanning relationship descriptors for gendered terms.",
      "mechanism": "Checks relationship text for male/female keyword lists and records one-time debug logs when inferences succeed.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Handle additional languages or gender-neutral pronouns as data expands."
      ],
      "tests": null,
      "notes": "Supports _determine_gender_for_person heuristics."
    },
    {
      "id": "function:relationship_utils._extract_years_from_lifespan",
      "type": "function",
      "name": "relationship_utils._extract_years_from_lifespan",
      "path": "relationship_utils.py",
      "summary": "Parses birth/death years from lifespan strings returned by APIs.",
      "mechanism": "Uses regex to capture four-digit years, treating '-' or 'Living' markers as missing death years and returning a tuple for downstream formatting.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Accept additional lifespan formats if APIs change notation."
      ],
      "tests": null,
      "notes": "Invoked by convert_api_path_to_unified_format."
    },
    {
      "id": "function:relationship_utils._determine_gender_for_person",
      "type": "function",
      "name": "relationship_utils._determine_gender_for_person",
      "path": "relationship_utils.py",
      "summary": "Determines gender using explicit fields, name heuristics, and relationship context.",
      "mechanism": "Checks provided gender, falls back to _infer_gender_from_name, then relationship-based inference, with special-case overrides for known profiles.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Surface inference provenance to telemetry for auditing accuracy."
      ],
      "tests": null,
      "notes": "Shared by converters and relationship pattern detectors."
    },
    {
      "id": "function:relationship_utils._parse_relationship_term_and_gender",
      "type": "function",
      "name": "relationship_utils._parse_relationship_term_and_gender",
      "path": "relationship_utils.py",
      "summary": "Extracts normalized relationship terms and gender hints from API text.",
      "mechanism": "Inspects relationship strings against a mapping table, prioritizing explicit gender fields before inferring from keywords.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Share mapping table with _get_relationship_term to avoid duplication."
      ],
      "tests": null,
      "notes": "Used by path conversion helpers to populate unified records."
    },
    {
      "id": "function:relationship_utils._log_inferred_gender_once",
      "type": "function",
      "name": "relationship_utils._log_inferred_gender_once",
      "path": "relationship_utils.py",
      "summary": "Guarded debug logger tracking gender inference messages once per name/source pair.",
      "mechanism": "Caches log keys in a module-level set, clearing when oversized, and emits debug messages without disrupting control flow.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Persist counters for telemetry on inference reliance."
      ],
      "tests": null,
      "notes": "Invoked by name and relationship gender inference helpers."
    },
    {
      "id": "function:relationship_utils.format_relationship_path_unified",
      "type": "function",
      "name": "relationship_utils.format_relationship_path_unified",
      "path": "relationship_utils.py",
      "summary": "Render unified relationship path data into multiline narrative text.",
      "mechanism": "Builds a heading, describes each hop between relatives with ordinal phrases, and applies relationship-type specific summaries for CLI output.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Expose HTML/markdown variants alongside plain-text rendering."
      ],
      "tests": "relationship_utils_module_tests",
      "notes": ""
    },
    {
      "id": "function:relationship_utils._run_basic_functionality_tests",
      "type": "function",
      "name": "relationship_utils._run_basic_functionality_tests",
      "path": "relationship_utils.py",
      "summary": "Registers foundational name formatting and BFS smoke tests with the module TestSuite.",
      "mechanism": "Defines inline checks for format_name edge cases and fast_bidirectional_bfs traversal, then delegates each to suite.run_test with descriptive metadata.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add fixtures covering large graphs or unicode-heavy names when extending regression coverage."
      ],
      "tests": null,
      "notes": "Called from relationship_utils_module_tests during suite assembly."
    },
    {
      "id": "function:relationship_utils._run_conversion_tests",
      "type": "function",
      "name": "relationship_utils._run_conversion_tests",
      "path": "relationship_utils.py",
      "summary": "Queues GEDCOM and API conversion exercises into the TestSuite.",
      "mechanism": "Binds the top-level conversion helpers and registers each via suite.run_test to verify unified path generation across data sources.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Incorporate richer mock payloads once fixture data becomes available."
      ],
      "tests": null,
      "notes": "Executed by relationship_utils_module_tests."
    },
    {
      "id": "function:relationship_utils._run_validation_tests",
      "type": "function",
      "name": "relationship_utils._run_validation_tests",
      "path": "relationship_utils.py",
      "summary": "Adds error handling, performance, and function availability validations to the suite.",
      "mechanism": "Defines inline assertions covering format_name edge cases, fast_bidirectional_bfs timing, and test_function_availability checks before routing them through suite.run_test.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Capture performance metrics to telemetry once automated benchmarks are formalized."
      ],
      "tests": null,
      "notes": "Triggered by relationship_utils_module_tests after conversion coverage."
    },
    {
      "id": "function:relationship_utils._test_gedcom_path_conversion",
      "type": "function",
      "name": "relationship_utils._test_gedcom_path_conversion",
      "path": "relationship_utils.py",
      "summary": "Guarantees GEDCOM path conversion produces unified relationship structures.",
      "mechanism": "Invokes convert_gedcom_path_to_unified_format with mocked reader/graph data and asserts list output or logs expected exceptions for placeholder fixtures.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Swap in real GEDCOM fixtures to validate relationship labels end-to-end."
      ],
      "tests": null,
      "notes": "Registered via _run_conversion_tests."
    },
    {
      "id": "function:relationship_utils._test_discovery_api_conversion",
      "type": "function",
      "name": "relationship_utils._test_discovery_api_conversion",
      "path": "relationship_utils.py",
      "summary": "Checks Discovery API payloads convert into the unified relationship format.",
      "mechanism": "Exercises convert_discovery_api_path_to_unified_format with empty and minimal mock payloads, tolerating schema mismatch exceptions while ensuring list outputs when data aligns.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Augment with discovery payload variants reflecting production responses."
      ],
      "tests": null,
      "notes": "Registered via _run_conversion_tests."
    },
    {
      "id": "function:relationship_utils._test_general_api_conversion",
      "type": "function",
      "name": "relationship_utils._test_general_api_conversion",
      "path": "relationship_utils.py",
      "summary": "Validates generic ladder API responses map into unified relationship dictionaries.",
      "mechanism": "Calls convert_api_path_to_unified_format against empty and minimal mock lists, asserting list outputs while logging expected exceptions for incomplete fixtures.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add assertions for gender inference heuristics once richer mock data exists."
      ],
      "tests": null,
      "notes": "Registered via _run_conversion_tests."
    },
    {
      "id": "function:relationship_utils._test_unified_path_formatting",
      "type": "function",
      "name": "relationship_utils._test_unified_path_formatting",
      "path": "relationship_utils.py",
      "summary": "Confirms format_relationship_path_unified can render minimal paths without crashing.",
      "mechanism": "Passes empty unified path data to the formatter and validates a string result while tolerating expected exceptions for placeholder inputs.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Extend assertions to verify descriptive text once deterministic fixtures are added."
      ],
      "tests": null,
      "notes": "Registered via _run_conversion_tests."
    },
    {
      "id": "function:relationship_utils._test_api_relationship_formatting",
      "type": "function",
      "name": "relationship_utils._test_api_relationship_formatting",
      "path": "relationship_utils.py",
      "summary": "Ensures format_api_relationship_path handles null and minimal API responses gracefully.",
      "mechanism": "Invokes format_api_relationship_path with None and simple mock data, asserting string output or logging expected exceptions for incomplete scenarios.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Incorporate real ladder samples to assert exact narrative output."
      ],
      "tests": null,
      "notes": "Registered via _run_conversion_tests."
    },
    {
      "id": "function:relationship_utils._test_relationship_path_cache",
      "type": "function",
      "name": "relationship_utils._test_relationship_path_cache",
      "path": "relationship_utils.py",
      "summary": "Validates LRU cache behaviour, hit rates, and telemetry integration for relationship paths.",
      "mechanism": "Clears the cache, runs repeated fast_bidirectional_bfs lookups over sample graphs, inspects get_relationship_cache_stats counters, and reports results to the performance monitor.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add assertions around persisted cache state when disk-backed storage is introduced."
      ],
      "tests": null,
      "notes": "Invoked directly by relationship_utils_module_tests."
    },
    {
      "id": "function:relationship_utils.relationship_utils_module_tests",
      "type": "function",
      "name": "relationship_utils.relationship_utils_module_tests",
      "path": "relationship_utils.py",
      "summary": "TestSuite entry point covering BFS, converters, and formatters.",
      "mechanism": "Registers unit tests for cache behavior, API parsing, GEDCOM conversion, and unified formatter output via the shared TestSuite harness.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Expand fixtures to cover performance monitor telemetry path."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "function:relationship_utils.run_comprehensive_tests",
      "type": "function",
      "name": "relationship_utils.run_comprehensive_tests",
      "path": "relationship_utils.py",
      "summary": "Standardized runner exposing relationship_utils_module_tests to CLI tooling.",
      "mechanism": "Binds create_standard_test_runner to relationship_utils_module_tests so external callers can execute the suite with consistent reporting.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [],
      "tests": null,
      "notes": "Imported by the module __main__ guard."
    },
    {
      "id": "file:gedcom_utils.py",
      "type": "file",
      "name": "gedcom_utils.py",
      "path": "gedcom_utils.py",
      "summary": "GEDCOM intelligence engine powering offline match scoring and relationship traversal.",
      "mechanism": "Parses GEDCOM records, pre-processes individuals into cached structures, scores candidates, and maps relationships with bidirectional BFS for presenter workflows.",
      "quality": "needs-review",
      "concerns": [
        "Monolithic module mixes parsing, scoring, graph search, and presentation helpers."
      ],
      "opportunities": [
        "Split scoring, traversal, and formatting into focused modules to ease maintenance."
      ],
      "tests": "gedcom_module_tests",
      "notes": "Feeds Action 10 analysis and universal scoring helpers."
    },
    {
      "id": "function:gedcom_utils._normalize_id",
      "type": "function",
      "name": "gedcom_utils._normalize_id",
      "path": "gedcom_utils.py",
      "summary": "Normalize GEDCOM cross-reference identifiers into canonical uppercase tokens.",
      "mechanism": "Strips leading/trailing @ markers, uppercases, and accepts numeric fallbacks with logging when patterns fail.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Share normalization with GEDCOM search helpers to eliminate duplicated regex."
      ],
      "tests": "gedcom_module_tests",
      "notes": ""
    },
    {
      "id": "function:gedcom_utils._get_full_name",
      "type": "function",
      "name": "gedcom_utils._get_full_name",
      "path": "gedcom_utils.py",
      "summary": "Derive formatted individual names by probing multiple GEDCOM tag strategies.",
      "mechanism": "Validates individual objects, attempts .name.format(), tag lookups, and manual GIVN/SURN joins before falling back to cleaned display placeholders.",
      "quality": "stable",
      "concerns": [
        "Handles many edge cases inline; future refactor could centralize sanitization."
      ],
      "opportunities": [
        "Expose structured result (given/surname) alongside formatted string."
      ],
      "tests": "gedcom_module_tests",
      "notes": ""
    },
    {
      "id": "function:gedcom_utils._get_event_info",
      "type": "function",
      "name": "gedcom_utils._get_event_info",
      "path": "gedcom_utils.py",
      "summary": "Extract event date, display string, and place from GEDCOM individuals.",
      "mechanism": "Normalizes individuals, pulls the requested event record, parses dates via helper, and cleans place strings for scoring and presentation.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Return structured error reasons when event tags are missing."
      ],
      "tests": "gedcom_module_tests",
      "notes": ""
    },
    {
      "id": "function:gedcom_utils.format_relative_info",
      "type": "function",
      "name": "gedcom_utils.format_relative_info",
      "path": "gedcom_utils.py",
      "summary": "Format related individual records into presenter-friendly bullet strings.",
      "mechanism": "Coerces inputs to Individual objects, applies _get_full_name and format_life_dates, and falls back to ID diagnostics when records missing.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Return structured data to let callers decide rendering style."
      ],
      "tests": "gedcom_module_tests",
      "notes": ""
    },
    {
      "id": "function:gedcom_utils.fast_bidirectional_bfs",
      "type": "function",
      "name": "gedcom_utils.fast_bidirectional_bfs",
      "path": "gedcom_utils.py",
      "summary": "Search GEDCOM graphs for relationship paths using bidirectional BFS with sibling expansion heuristics.",
      "mechanism": "Validates inputs, checks for direct links via relationship_utils helpers, and walks parents/children queues until a best path is found or limits exceeded.",
      "quality": "stable",
      "concerns": [
        "Maintains duplicated BFS logic alongside relationship_utils.fast_bidirectional_bfs."
      ],
      "opportunities": [
        "Deduplicate shared traversal code with relationship utilities."
      ],
      "tests": "gedcom_module_tests",
      "notes": ""
    },
    {
      "id": "function:gedcom_utils.calculate_match_score",
      "type": "function",
      "name": "gedcom_utils.calculate_match_score",
      "path": "gedcom_utils.py",
      "summary": "Aggregate field-level birth/death/name scores into a total match score for GEDCOM candidates.",
      "mechanism": "Prepares search and candidate data, evaluates name/date/place matches with configurable weights, applies bonuses and penalties, and returns totals with reason strings.",
      "quality": "stable",
      "concerns": [
        "Scoring weights live in config; changes require careful regression validation."
      ],
      "opportunities": [
        "Expose intermediate scoring components for telemetry dashboards."
      ],
      "tests": "gedcom_module_tests",
      "notes": ""
    },
    {
      "id": "class:gedcom_utils.GedcomData",
      "type": "class",
      "name": "gedcom_utils.GedcomData",
      "path": "gedcom_utils.py",
      "summary": "GEDCOM reader wrapper that indexes individuals, pre-processes vital data, and exposes relationship queries.",
      "mechanism": "Loads GEDCOM files with ged4py, builds parent/child maps, caches processed individual summaries, and offers convenience methods for relatives and pathfinding.",
      "quality": "needs-review",
      "concerns": [
        "Constructor performs heavy work; dependency injection would aid testing."
      ],
      "opportunities": [
        "Split cache building from construction to support lazy loading and mocks."
      ],
      "tests": "gedcom_module_tests",
      "notes": ""
    },
    {
      "id": "method:GedcomData.build_caches",
      "type": "method",
      "name": "GedcomData.build_caches",
      "path": "gedcom_utils.py",
      "summary": "Kick off index, family map, and processed data cache construction.",
      "mechanism": "Guards for reader availability, rebuilds the individual index, then populates family graphs and processed attribute caches.",
      "quality": "stable",
      "concerns": [
        "Calls multiple private helpers sequentially without granular error recovery."
      ],
      "opportunities": [
        "Return explicit status to callers for improved diagnostics."
      ],
      "tests": "gedcom_module_tests",
      "notes": ""
    },
    {
      "id": "method:GedcomData._build_indi_index",
      "type": "method",
      "name": "GedcomData._build_indi_index",
      "path": "gedcom_utils.py",
      "summary": "Index GEDCOM individual records by normalized ID.",
      "mechanism": "Iterates INDI records via ged4py, filters invalid entries, normalizes IDs, and tracks timing plus skipped counts for logging.",
      "quality": "stable",
      "concerns": [
        "Logs at DEBUG extensively; consider structured metrics for large files."
      ],
      "opportunities": [
        "Expose iterator hooks for streaming progress updates."
      ],
      "tests": "gedcom_module_tests",
      "notes": ""
    },
    {
      "id": "method:GedcomData._build_family_maps",
      "type": "method",
      "name": "GedcomData._build_family_maps",
      "path": "gedcom_utils.py",
      "summary": "Construct parent/child lookup maps from family records.",
      "mechanism": "Scans FAM entries, extracts spouse and child IDs, and populates bidirectional maps while tracking skipped links.",
      "quality": "stable",
      "concerns": [
        "Full scan can be expensive for massive files; lacks incremental updates."
      ],
      "opportunities": [
        "Persist map snapshots to reuse across runs."
      ],
      "tests": "gedcom_module_tests",
      "notes": ""
    },
    {
      "id": "method:GedcomData._pre_process_individual_data",
      "type": "method",
      "name": "GedcomData._pre_process_individual_data",
      "path": "gedcom_utils.py",
      "summary": "Extract and cache display/scoring attributes for each individual.",
      "mechanism": "Iterates normalized IDs, derives formatted names, gender, vitals, and stores them in processed_data_cache with timing metrics.",
      "quality": "stable",
      "concerns": [
        "Collects large dictionaries in memory; monitor footprint for huge datasets."
      ],
      "opportunities": [
        "Persist processed cache to disk to accelerate restarts."
      ],
      "tests": "gedcom_module_tests",
      "notes": ""
    },
    {
      "id": "method:GedcomData.get_processed_indi_data",
      "type": "method",
      "name": "GedcomData.get_processed_indi_data",
      "path": "gedcom_utils.py",
      "summary": "Return cached individual summary data by normalized ID.",
      "mechanism": "Refreshes cache on-demand when empty and fetches processed_data_cache entries for scoring and presentation calls.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Return immutable views to prevent accidental caller mutation."
      ],
      "tests": "gedcom_module_tests",
      "notes": ""
    },
    {
      "id": "method:GedcomData.get_related_individuals",
      "type": "method",
      "name": "GedcomData.get_related_individuals",
      "path": "gedcom_utils.py",
      "summary": "Lookup parents, children, siblings, or spouses using cached maps.",
      "mechanism": "Normalizes target IDs, ensures maps exist, resolves related IDs, and converts them back into Individual objects for downstream use.",
      "quality": "stable",
      "concerns": [
        "Returns empty list on errors; consider surfacing failure context."
      ],
      "opportunities": [
        "Support relationship graph previews for presenter tooling."
      ],
      "tests": "gedcom_module_tests",
      "notes": ""
    },
    {
      "id": "method:GedcomData.get_relationship_path",
      "type": "method",
      "name": "GedcomData.get_relationship_path",
      "path": "gedcom_utils.py",
      "summary": "Explain relationship between two IDs using cached maps and BFS traversal.",
      "mechanism": "Normalizes inputs, validates caches, runs fast_bidirectional_bfs, and formats the result via explain_relationship_path for CLI display.",
      "quality": "stable",
      "concerns": [
        "Returns formatted string intermixed with profile telemetry; separation could improve reuse."
      ],
      "opportunities": [
        "Expose structured path alongside text for presenter customization."
      ],
      "tests": "gedcom_module_tests",
      "notes": ""
    },
    {
      "id": "function:gedcom_utils.gedcom_module_tests",
      "type": "function",
      "name": "gedcom_utils.gedcom_module_tests",
      "path": "gedcom_utils.py",
      "summary": "Comprehensive TestSuite covering GEDCOM normalization, scoring, and traversal helpers.",
      "mechanism": "Uses shared TestSuite harness to verify ID cleanup, event parsing, scoring fidelity, and pathfinding smoke tests.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add regression fixtures for large GEDCOM files to catch performance drift."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "file:universal_scoring.py",
      "type": "file",
      "name": "universal_scoring.py",
      "path": "universal_scoring.py",
      "summary": "Universal scoring layer consolidating Action 10 and Action 11 scoring logic.",
      "mechanism": "Delegates to gedcom_utils.calculate_match_score, normalizes criteria, formats breakdowns, and calculates display bonuses for shared presentation needs.",
      "quality": "stable",
      "concerns": [
        "Verbose docstring mixes marketing language with technical detail."
      ],
      "opportunities": [
        "Consider trimming module header to essential technical overview."
      ],
      "tests": "universal_scoring_module_tests",
      "notes": "Exports helpers consumed by action10 and api_search_core for consistent formatting."
    },
    {
      "id": "function:universal_scoring.calculate_display_bonuses",
      "type": "function",
      "name": "universal_scoring.calculate_display_bonuses",
      "path": "universal_scoring.py",
      "summary": "Calculate birth and death presentation bonuses based on field scores.",
      "mechanism": "Computes max date component for birth/death, applies 25-point bonus when both date and place are present, and returns dict with keys supporting both Action 10 ('_s' suffix) and Action 11 (no suffix) formats.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Unify key naming across actions once presentation layer consolidation complete."
      ],
      "tests": "universal_scoring_module_tests",
      "notes": ""
    },
    {
      "id": "function:universal_scoring.apply_universal_scoring",
      "type": "function",
      "name": "universal_scoring.apply_universal_scoring",
      "path": "universal_scoring.py",
      "summary": "Score candidate lists using unified algorithm with performance timeouts.",
      "mechanism": "Iterates candidates, invokes gedcom_utils.calculate_match_score per entry, assigns confidence labels, sorts by score descending, and returns top results.",
      "quality": "stable",
      "concerns": [
        "Timeout and early termination thresholds remain hardcoded."
      ],
      "opportunities": [
        "Expose timeouts and quality gates via configuration."
      ],
      "tests": "universal_scoring_module_tests",
      "notes": ""
    },
    {
      "id": "function:universal_scoring.format_scoring_breakdown",
      "type": "function",
      "name": "universal_scoring.format_scoring_breakdown",
      "path": "universal_scoring.py",
      "summary": "Generate tabular scoring breakdowns for CLI display.",
      "mechanism": "Maps field keys to readable labels, formats scores with descriptions, adds confidence summary, and includes top reason bullets.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Support alternate output formats (JSON, HTML) for integration tooling."
      ],
      "tests": "universal_scoring_module_tests",
      "notes": ""
    },
    {
      "id": "function:universal_scoring.validate_search_criteria",
      "type": "function",
      "name": "universal_scoring.validate_search_criteria",
      "path": "universal_scoring.py",
      "summary": "Normalize raw search criteria for consistent scoring inputs.",
      "mechanism": "Lowercases name fields, converts year strings to ints, standardizes gender tokens, and preserves remaining keys unchanged.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Merge with search_criteria_utils normalization to eliminate drift."
      ],
      "tests": "universal_scoring_module_tests",
      "notes": ""
    },
    {
      "id": "function:universal_scoring.universal_scoring_module_tests",
      "type": "function",
      "name": "universal_scoring.universal_scoring_module_tests",
      "path": "universal_scoring.py",
      "summary": "Comprehensive TestSuite covering scoring scenarios and criteria validation.",
      "mechanism": "Registers 15 tests verifying exact/partial/no-match behavior, max_results enforcement, normalization logic, confidence levels, and display helpers.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add integration tests exercising Action 10 and Action 11 end-to-end flows."
      ],
      "tests": null,
      "notes": ""
    },
    {
      "id": "file:ai_api_test.py",
      "type": "file",
      "name": "ai_api_test.py",
      "path": "ai_api_test.py",
      "summary": "CLI utility that validates AI provider credentials, endpoints, and sample completions before running production actions.",
      "mechanism": "Parses arguments, loads .env secrets, normalizes provider base URLs, pings Moonshot/DeepSeek/Gemini/Local LLM endpoints, and renders TestResult summaries with truncated-response detection.",
      "quality": "beta",
      "concerns": [
        "Relies on optional SDKs (openai, google-generativeai, dotenv); missing imports degrade functionality silently.",
        "Stores provider errors as plain text without structured telemetry, limiting automated regression tracking."
      ],
      "opportunities": [
        "Add JSON output mode so CI can record provider health trends.",
        "Share base URL normalization with ai_interface to avoid drift between test and production code."
      ],
      "tests": null,
      "notes": "Run via `python ai_api_test.py --provider gemini` to sanity-check credentials before Action 7 deployments."
    },
    {
      "id": "file:ai_interface.py",
      "type": "file",
      "name": "ai_interface.py",
      "path": "ai_interface.py",
      "summary": "Central AI orchestration layer powering genealogical classification, extraction, and messaging automation.",
      "mechanism": "Loads prompt templates, selects Gemini, DeepSeek, or OpenAI clients via ConfigManager, applies cached_api_call rate limiting, validates responses, and records telemetry with graceful fallbacks.",
      "quality": "stable",
      "concerns": [
        "Monolithic 2.5k-line module mixes provider adapters, prompt logic, and test harnesses, making safe refactors difficult.",
        "Runtime depends on external SDK availability and environment secrets, so offline testing demands heavy mocking."
      ],
      "opportunities": [
        "Extract provider-specific clients into dedicated modules to shrink the public surface.",
        "Add fixture-driven tests that exercise prompt templates without live provider access."
      ],
      "tests": "ai_interface_module_tests",
      "notes": "Integrates with cache_manager.cached_api_call and prompt telemetry for quality scoring."
    },
    {
      "id": "function:ai_interface._call_ai_model",
      "type": "function",
      "name": "ai_interface._call_ai_model",
      "path": "ai_interface.py",
      "summary": "Routes AI requests across configured provider chain with caching, rate limiting, and fallback handling.",
      "mechanism": "Decorated with cached_api_call, applies SessionManager rate limiter, iterates through fallback providers, and delegates to _route_ai_provider_call while capturing exceptions for telemetry.",
      "quality": "stable",
      "concerns": [
        "Fallback attempts do not emit structured telemetry, so it is hard to identify degraded providers from logs alone.",
        "Cached key includes SessionManager repr which may vary per run, limiting cache reuse across identical prompts."
      ],
      "opportunities": [
        "Push provider/fallback metadata into prompt_telemetry for easier health tracking.",
        "Normalize cache key inputs (e.g., replace SessionManager object with user id) to maximize hit rate."
      ],
      "tests": "ai_interface_module_tests",
      "notes": "Shared by all downstream helpers (intent, extraction, replies); TTL 30 minutes balances cost vs. freshness."
    },
    {
      "id": "function:ai_interface.classify_message_intent",
      "type": "function",
      "name": "ai_interface.classify_message_intent",
      "path": "ai_interface.py",
      "summary": "Classifies the final user message in a conversation into one of seven intent categories.",
      "mechanism": "Loads prompt from ai_prompt_utils when available, calls _call_ai_model with low temperature, caches the response for an hour, and normalizes output to uppercase enum values.",
      "quality": "stable",
      "concerns": [
        "Returns None on provider failure, so callers must handle missing classifications explicitly.",
        "Long cache TTL could surface stale intent if the same context string is reused after conversation edits."
      ],
      "opportunities": [
        "Surface confidence metrics alongside the label for downstream decision making.",
        "Record parse success into prompt telemetry to spot prompt drift earlier."
      ],
      "tests": "ai_interface_module_tests",
      "notes": "Consumed by action7_inbox for PRODUCTIVE/DESIST workflow routing."
    },
    {
      "id": "function:ai_interface.extract_genealogical_entities",
      "type": "function",
      "name": "ai_interface.extract_genealogical_entities",
      "path": "ai_interface.py",
      "summary": "Parses conversation history to extract genealogical entities and propose follow-up tasks.",
      "mechanism": "Requests JSON output via prompt, cleans or salvages malformed responses, and records telemetry detailing parse success, latency, and transformed payloads.",
      "quality": "beta",
      "concerns": [
        "On failure it returns an empty structure indistinguishable from a valid no-data response, masking AI outages.",
        "Transformation helpers silently merge flat keys into nested output which could hide schema regressions."
      ],
      "opportunities": [
        "Propagate a failure flag so downstream scoring can differentiate salvage from success.",
        "Add JSON Schema validation to catch prompt template regressions before runtime."
      ],
      "tests": "ai_interface_module_tests",
      "notes": "Feeds Action 7 entity enrichment and Action 9 task scoring."
    },
    {
      "id": "function:ai_interface.generate_genealogical_reply",
      "type": "function",
      "name": "ai_interface.generate_genealogical_reply",
      "path": "ai_interface.py",
      "summary": "Generates a personalised follow-up message combining context, user reply, and extracted genealogical data.",
      "mechanism": "Formats the genealogical_reply prompt, calls _call_ai_model with higher temperature and generous token budget, and logs latency before returning the text.",
      "quality": "stable",
      "concerns": [
        "Prompt formatting failures fall back to unformatted template without signalling callers, risking awkward replies.",
        "Does not update prompt telemetry, so reply quality trends rely on downstream scoring only."
      ],
      "opportunities": [
        "Emit telemetry capturing token usage and formatting fallbacks for quality monitoring.",
        "Support dry-run mode to preview prompts during tuning without hitting providers."
      ],
      "tests": "ai_interface_module_tests",
      "notes": "Primary generator for Action 8 messaging and Action 9 quality scoring."
    },
    {
      "id": "file:ai_prompt_utils.py",
      "type": "file",
      "name": "ai_prompt_utils.py",
      "path": "ai_prompt_utils.py",
      "summary": "Prompt configuration layer that loads, validates, and persists AI prompt templates with backup safeguards.",
      "mechanism": "Manages ai_prompts.json via load_prompts/save_prompts, validates schema before writes, auto-backs up on corruption, imports improved prompt variants, and exposes get_prompt/update_prompt helpers for ai_interface.",
      "quality": "stable",
      "concerns": [
        "Validation only checks key presence; malformed template placeholders can still slip through to runtime."
      ],
      "opportunities": [
        "Add JSON Schema validation encompassing prompt variable definitions.",
        "Version prompts and provide diff reports so quality gating can detect regressions.",
        "Add tests for placeholder formatting and variable substitution safety."
      ],
      "tests": "ai_prompt_utils_module_tests (6/6 passed Nov 2025)",
      "notes": "Updated Nov 2025: Implemented atomic file writes (write to temp + Path.replace) in save_prompts to eliminate concurrent write races. All module tests passing."
    },
    {
      "id": "file:analytics.py",
      "type": "file",
      "name": "analytics.py",
      "path": "analytics.py",
      "summary": "Appends per-action telemetry to Logs/analytics.jsonl and rolls up summaries for health reporting.",
      "mechanism": "Maintains transient extras for exec_actn, writes log_event JSON lines with duration/memory, parses log entries safely, aggregates rolling stats in generate_weekly_summary, and guards IO errors so analytics never block actions.",
      "quality": "beta",
      "concerns": [
        "Synchronous disk writes could slow down actions on network drives without surfacing backpressure.",
        "Module-level extras state is shared globally, so nested actions might overwrite one another."
      ],
      "opportunities": [
        "Buffer events and flush asynchronously when actions complete to reduce latency.",
        "Emit summary metrics to performance_monitor for cross-action dashboards."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Used by main.exec_actn to capture duration/memory across action runs; complements prompt telemetry feeds."
    },
    {
      "id": "file:api_constants.py",
      "type": "file",
      "name": "api_constants.py",
      "path": "api_constants.py",
      "summary": "Single source of truth for Ancestry API endpoint paths with regression guards against accidental drift.",
      "mechanism": "Defines dozens of API_PATH_* constants for auth, messaging, tree, DNA, and ethnicity APIs, and provides validate_all_endpoints plus regression tests to ensure values remain non-empty and unchanged.",
      "quality": "stable",
      "concerns": [
        "Still contains leading slashes on some endpoints while others are relative; callers must normalize to avoid double slashes.",
        "Constants are string literals onlyno typed wrappersso refactors in consumers can silently break substitution placeholders."
      ],
      "opportunities": [
        "Generate typed client helpers from this module so placeholders are enforced at call sites.",
        "Surface last-validated timestamp and count to analytics for endpoint drift monitoring."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Consumed heavily by core.api_manager and action6_gather for REST interactions."
    },
    {
      "id": "file:cache.py",
      "type": "file",
      "name": "cache.py",
      "path": "cache.py",
      "summary": "Central diskcache facade providing decorators, eviction controls, and predictive warming for shared storage.",
      "mechanism": "Bootstraps a global diskcache.Cache using config_schema paths, exposes cache_result and cache_file_based_on_mtime decorators, manages size via enforce_cache_size_limit/check_cache_size_before_add, and layers analytics through IntelligentCacheWarmer, CacheDependencyTracker, and coordination stats helpers.",
      "quality": "beta",
      "concerns": [
        "1.5k line module with multiple import cycles (gedcom_cache, cache_manager, utils) makes changes risky and slows import time.",
        "Global cache handle falls back to None on init failure, but many call sites assume availability and would silently bypass caching."
      ],
      "opportunities": [
        "Split into focused submodules (decorators, warmers, metrics) and inject cache instance to break cycles and improve testability.",
        "Emit cache_coordination stats into analytics pipeline so eviction events and hit rates surface in dashboards."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Consumed by cache_manager, gedcom_cache, action modules, and performance monitors for shared storage primitives."
    },
    {
      "id": "file:cache_manager.py",
      "type": "file",
      "name": "cache_manager.py",
      "path": "cache_manager.py",
      "summary": "Orchestrates session, API, and system caches behind a singleton facade on top of the global diskcache instance.",
      "mechanism": "Defines SessionCacheConfig/SystemCacheConfig defaults, implements SessionComponentCache, APICacheManager, and SystemCacheManager classes, wires them into a UnifiedCacheManager singleton, and exposes helpers like cached_session_component, cached_api_call, warm_all_caches, and stats getters.",
      "quality": "beta",
      "concerns": [
        "Module-level tests are mostly stubs returning True, so cache serialization and TTL regressions could slip through unnoticed.",
        "Singleton `_unified_cache_manager` pulls in the heavy `cache` module at import time, keeping the tight coupling and import cycles that were meant to be reduced."
      ],
      "opportunities": [
        "Route construction through dependency_injection to allow replacing the cache backend or providing in-memory fakes for tests.",
        "Add targeted tests that exercise cached_api_call/cached_session_component end-to-end to verify TTL honors and serialization boundaries."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Used by session_manager, action modules, and performance monitors to reuse expensive session components and throttle API hits."
    },
    {
      "id": "file:chromedriver.py",
      "type": "file",
      "name": "chromedriver.py",
      "path": "chromedriver.py",
      "summary": "Manages undetected_chromedriver setup, profile hygiene, and post-init tuning for Selenium sessions.",
      "mechanism": "Resets Chrome preferences, shapes window geometry, configures uc.ChromeOptions (user data dir, UA spoofing, headless), spins up a driver via _create_chrome_driver with retries and diagnostics, then hardens it through _configure_driver_post_init, close_tabs, and cleanup utilities exposed through init_webdvr.",
      "quality": "beta",
      "concerns": [
        "Hard-coded undetected_chromedriver version_main=142 risks breakage when Chrome auto-updates beyond that major version.",
        "init_webdvr swallows failures by printing guidance but upstream callers do not receive structured error info or retry budgets."
      ],
      "opportunities": [
        "Surface structured init telemetry (attempt count, duration, exception type) to performance_monitor so flaky setups are visible.",
        "Allow version_main override via config_schema.selenium to decouple releases from the locked Chrome 142 build."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "SessionManager relies on init_webdvr for browser sessions; diagnose_chrome.py uses the helpers for troubleshooting."
    },
    {
      "id": "file:common_params.py",
      "type": "file",
      "name": "common_params.py",
      "path": "common_params.py",
      "summary": "Collection of dataclasses that bundle recurring parameter sets for actions, APIs, and telemetry contexts.",
      "mechanism": "Defines ~20 @dataclass containers such as GraphContext, RetryContext, MatchIdentifiers, NavigationConfig, and RequestConfig used across actions 6-11, utils, and telemetry; ships lightweight initialization tests to verify field defaults and type expectations.",
      "quality": "stable",
      "concerns": [
        "Adding new attributes without defaults can break call sites that rely on positional args; module lacks guidance on when to favor keyword-only usage.",
        "Dataclasses accept broad Any/Mapping types, so incorrect shapes pass static checks and only fail at runtime consumers."
      ],
      "opportunities": [
        "Adopt `kw_only=True` and Optional defaults for new fields to protect backwards compatibility when evolving structures.",
        "Integrate with mypy/pyright typed dicts or Protocols so downstream modules get better validation for required keys."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Heavily imported by action6_gather, action8_messaging, api_utils, prompt_telemetry, and relationship utilities."
    },
    {
      "id": "file:comprehensive_auth_tests.py",
      "type": "file",
      "name": "comprehensive_auth_tests.py",
      "path": "comprehensive_auth_tests.py",
      "summary": "White-box regression checks that exercise SessionManager auth lifecycle, cookie sync, and retry safety nets.",
      "mechanism": "Leverages SessionManager and core.error_handling primitives to validate token expiry thresholds, proactive refresh triggers, circuit breaker behavior, retry_on_failure decorators, and MagicMock-based HTTP error handling across 401/403/429 flows.",
      "quality": "beta",
      "concerns": [
        "Tests instantiate real SessionManager which loads browser config and may have side effects or long startup unless patched more aggressively.",
        "Assertions primarily check simple booleans; they do not verify that actual HTTP retries or cookie refresh callbacks fire."
      ],
      "opportunities": [
        "Stub SessionManager dependencies (browser/api managers) so tests run faster and can assert specific method calls like refresh_browser_cookies().",
        "Integrate into CI auth regression stage to catch session expiration bugs before runtime incidents."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Serves as targeted regression coverage for recent auth outage; complements action6 session health checks."
    },
    {
      "id": "file:config/__init__.py",
      "type": "file",
      "name": "config/__init__.py",
      "path": "config/__init__.py",
      "summary": "Package initializer that wires ConfigManager/ConfigSchema and exports the live config singleton for consumers.",
      "mechanism": "Extends sys.path, imports ConfigManager and ConfigSchema, instantiates ConfigManager, calls get_config(), and exposes config_manager/config_schema via __all__ for downstream modules.",
      "quality": "stable",
      "concerns": [
        "Module import triggers config loading immediately, so failures bubble up even for tools that only want type definitions.",
        "Path munging to support legacy absolute imports hints at unresolved package layout debt."
      ],
      "opportunities": [
        "Lazy-load config in a function so scripts can override environment variables before instantiation.",
        "Remove sys.path mutation once all callers use package-relative imports."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Imported everywhere as `from config import config_schema`; anchors new schema-based configuration pipeline."
    },
    {
      "id": "file:config/__main__.py",
      "type": "file",
      "name": "config/__main__.py",
      "path": "config/__main__.py",
      "summary": "Thin entry point so `python -m config` prints package info instead of failing.",
      "mechanism": "Normalizes sys.path for legacy imports, then under __main__ prints version/instructions about config_manager/config_schema availability; no runtime side effects beyond stdout messaging.",
      "quality": "stable",
      "concerns": [
        "Path mutation duplicates logic from __init__, implying both files must stay in sync."
      ],
      "opportunities": [
        "Share a helper for path bootstrapping to avoid drift and consolidate future changes.",
        "Extend with a quick diagnostic that verifies config files exist when run directly."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Convenience wrapper mainly for developers validating configuration packaging."
    },
    {
      "id": "file:config/config_manager.py",
      "type": "file",
      "name": "config/config_manager.py",
      "path": "config/config_manager.py",
      "summary": "Central configuration loader that hydrates ConfigSchema from defaults, files, and environment with safety clamps.",
      "mechanism": "ConfigManager orchestrates .env loading, merges JSON/YAML/TOML files with environment overrides, builds ConfigSchema via from_dict, enforces sequential API rate limits (_enforce_api_safety_constraints), and caches results with hot-reload helpers; exposes ValidationError for callers.",
      "quality": "beta",
      "concerns": [
        "File spans 1.5k lines with duplicated setup_module/path bootstrapping, increasing risk of import-order bugs and making review difficult.",
        "Hot reload relies on file mtimes but lacks watcher integration, so long-running sessions may keep stale config without explicit refresh."
      ],
      "opportunities": [
        "Extract API safety enforcement and file format loaders into submodules to shrink ConfigManager surface area and break cycles.",
        "Add proactive telemetry when unsafe settings are requested so operations can track override usage."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Used by config package __init__ to expose `config_schema`; action modules depend on its rate-limit enforcement for production safety."
    },
    {
      "id": "file:config/config_schema.py",
      "type": "file",
      "name": "config/config_schema.py",
      "path": "config/config_schema.py",
      "summary": "Type-safe dataclass schemas and validators backing the project's configuration surface.",
      "mechanism": "Defines ConfigSchema plus nested DatabaseConfig, APIConfig, CacheConfig, SeleniumConfig, LoggingConfig, SecurityConfig, etc., each with __post_init__ checks using ConfigValidator/ValidationRule helpers, normalizes paths, and enforces environment-specific safety rules.",
      "quality": "beta",
      "concerns": [
        "Validation happens during dataclass construction, so tests that partially build configs hit exceptions before they can patch fields.",
        "1.4k line module duplicates validator scaffolding and makes it hard to track which fields are actually used."
      ],
      "opportunities": [
        "Adopt declarative schema tooling (e.g., pydantic) or codegen to collapse boilerplate and emit docs automatically.",
        "Publish schema version/hash so long-running sessions can detect drift and trigger safe reloads."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Instantiated by ConfigManager.from_dict; informs rate-limiter defaults and Selenium settings consumed by SessionManager."
    },
    {
      "id": "file:connection_resilience.py",
      "type": "file",
      "name": "connection_resilience.py",
      "path": "connection_resilience.py",
      "summary": "Decorators and manager class that keep long Selenium runs alive and recover from browser disconnects.",
      "mechanism": "ConnectionResilienceManager wraps prevent_system_sleep/restore_system_sleep, tracks retry attempts, and exposes with_connection_resilience + with_periodic_health_check decorators that inspect exceptions for connection keywords and call SessionManager.attempt_browser_recovery before retrying.",
      "quality": "beta",
      "concerns": [
        "Keyword-based error detection may miss driver failures (e.g., CDP errors) or misclassify unrelated exceptions.",
        "Global singleton `_resilience_manager` holds mutable state, making concurrent operations prone to interfering with each other's retry budgets."
      ],
      "opportunities": [
        "Emit telemetry on recovery attempts and outcomes so health_monitor can surface chronic disconnects.",
        "Allow dependency injection for sleep prevention to ease testing and better support non-Windows environments."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Applied to action6_gather coord path and other long-running actions to prevent PC sleep mid-run."
    },
    {
      "id": "file:conversation_analytics.py",
      "type": "file",
      "name": "conversation_analytics.py",
      "path": "conversation_analytics.py",
      "summary": "Maintains engagement, template, and research metrics for messaging conversations in the database.",
      "mechanism": "Writes to ConversationMetrics/EngagementTracking via record_engagement_event and update_conversation_metrics, incrementing message counters, computing response times, updating rolling averages, and storing template usage with JSON serialization.",
      "quality": "beta",
      "concerns": [
        "Uses direct session.commit() inside helpers, making it hard to batch operations or roll back on failure.",
        "Metric updates lean on setattr strings; missing attributes or schema changes could go unnoticed until runtime."
      ],
      "opportunities": [
        "Return structured diff objects so callers can log telemetry without re-reading the database.",
        "Move commit responsibility to the caller to participate in larger transactions."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Consumed by action7_inbox and action8_messaging when recording engagement outcomes."
    },
    {
      "id": "file:core/__init__.py",
      "type": "file",
      "name": "core/__init__.py",
      "path": "core/__init__.py",
      "summary": "Package initializer that re-exports core managers, DI helpers, and error classes for clean imports.",
      "mechanism": "Attempts relative imports of APIManager, BrowserManager, DatabaseManager, SessionManager, DI utilities, and error types, falling back to DummyComponent placeholders on ImportError; defines __all__ and a core_package_module_tests suite to verify availability.",
      "quality": "stable",
      "concerns": [
        "DummyComponent fallback masks real import failures and could hide packaging issues until runtime actions execute."
      ],
      "opportunities": [
        "Log a warning when falling back to DummyComponent so developers notice misconfigured paths.",
        "Split test helpers into dedicated file to keep package init lightweight."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Consumers import `from core import SessionManager` etc.; ensures cohesive namespace across refactored core modules."
    },
    {
      "id": "file:core/__main__.py",
      "type": "file",
      "name": "core/__main__.py",
      "path": "core/__main__.py",
      "summary": "Executable harness that verifies core package components import cleanly when run as a module.",
      "mechanism": "Bootstraps sys.path, defines tests that import key core modules and check filesystem presence, then wraps them in run_comprehensive_tests for `python -m core`; emits a summary banner on success.",
      "quality": "stable",
      "concerns": [
        "Filesystem assertions assume monolithic .py files; refactors to packages would require updating checks."
      ],
      "opportunities": [
        "Extend the CLI output with diagnostic info (e.g., config location) to aid onboarding.",
        "Reuse tests in CI to ensure __all__ exports remain intact after refactors."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Primarily a smoke test entry point; retains legacy path shim similar to config/__main__."
    },
    {
      "id": "file:core/api_manager.py",
      "type": "file",
      "name": "core/api_manager.py",
      "path": "core/api_manager.py",
      "summary": "Encapsulates Ancestry API session handling, identifier retrieval, and cookie synchronization for downstream clients.",
      "mechanism": "Maintains a configured requests.Session with pooled adapters, syncs cookies from BrowserManager, fetches CSRF/profile/tree identifiers, and performs guarded API requests with retry-aware helpers.",
      "quality": "stable",
      "concerns": [
        "Cookie synchronization still hinges on a live Selenium driver and cloudscraper availability, complicating recovery paths.",
        "Identifier caching and logging guards are scattered, making state resets easy to overlook during error handling."
      ],
      "opportunities": [
        "Centralize response typing and telemetry so action modules can share richer diagnostics.",
        "Add explicit invalidation hooks when cookies expire to avoid silent stale sessions."
      ],
      "tests": "api_manager_module_tests",
      "notes": "SessionManager caches APIManager instances for all action modules."
    },
    {
      "id": "file:core/browser_manager.py",
      "type": "file",
      "name": "core/browser_manager.py",
      "path": "core/browser_manager.py",
      "summary": "Controls Selenium WebDriver lifecycle, navigation, and cookie access for session-dependent workflows.",
      "mechanism": "Creates Chrome drivers per configuration, tracks driver_live/browser_needed flags, ensures login readiness, fetches cookies with bounded waits, and exposes navigation helpers plus screenshot/debug utilities.",
      "quality": "stable",
      "concerns": [
        "Heavy reliance on global config and live ChromeDriver instances forces extensive mocking in tests.",
        "Timeout tuning is scattered across methods, increasing risk of flakes on slow environments."
      ],
      "opportunities": [
        "Extract driver configuration and launch options into a dedicated builder with headless toggles.",
        "Instrument navigation and login timings so health monitors can react to slowdowns."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "SessionManager.browser_manager delegates nearly all UI automation through this module."
    },
    {
      "id": "file:core/cancellation.py",
      "type": "file",
      "name": "core/cancellation.py",
      "path": "core/cancellation.py",
      "summary": "Cooperative cancellation flag for long-running actions and background loops.",
      "mechanism": "Wraps a module-level threading.Event inside _CancellationState, exposes request_cancel/clear_cancel/is_cancel_requested helpers, tracks optional scope strings for diagnostics, and provides tests ensuring thread visibility.",
      "quality": "stable",
      "concerns": [
        "Global state must be cleared between runs; forgetting to call clear_cancel can leak prior scopes."
      ],
      "opportunities": [
        "Log cancellation requests (scope + timestamp) to analytics so operators know why runs stopped.",
        "Offer context manager helper to auto-clear scope after scoped operations."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "SessionManager and action loops poll is_cancel_requested to exit gracefully during shutdown."
    },
    {
      "id": "file:core/database_manager.py",
      "type": "file",
      "name": "core/database_manager.py",
      "path": "core/database_manager.py",
      "summary": "Provides SQLAlchemy engine/session setup, connection pooling, and telemetry for the ancestry SQLite datastore.",
      "mechanism": "Resolves database path from ConfigManager, builds engines with adaptive pool sizing, tracks connection and query stats, exposes session and batch contexts, and offers backup/maintenance helpers.",
      "quality": "stable",
      "concerns": [
        "Combines pooling heuristics, telemetry, CLI helpers, and tests in one module, leaving a broad maintenance surface.",
        "Adaptive pooling counters reset per process, so tuning decisions lack historical context."
      ],
      "opportunities": [
        "Split performance monitoring into a dedicated analytics helper consumed by SessionManager.",
        "Add integration coverage for migrations and backup workflows against real SQLite files."
      ],
      "tests": "database_manager_module_tests",
      "notes": "SessionManager caches DatabaseManager instances and shares them across actions."
    },
    {
      "id": "file:core/dependency_injection.py",
      "type": "file",
      "name": "core/dependency_injection.py",
      "path": "core/dependency_injection.py",
      "summary": "Provides DI container, decorators, and scopes to wire core services while avoiding circular imports.",
      "mechanism": "Supplies DIContainer for singleton/transient/factory registration, inject decorator for constructor wiring, configure_dependencies bootstrapper, and thread-safe resolution with scope tracking for tests.",
      "quality": "beta",
      "concerns": [
        "Container is effectively global; forgetting to reset between tests can leak mocks and singletons.",
        "Configuration bootstrap still relies on manual registration order, leaving circular dependencies easy to reintroduce."
      ],
      "opportunities": [
        "Add context manager to temporarily override bindings during action-specific operations.",
        "Generate dependency graphs to detect cycles or missing registrations automatically."
      ],
      "tests": "dependency_injection_module_tests",
      "notes": "Action modules primarily resolve SessionManager directly today; DI scaffolding enables future modularization."
    },
    {
      "id": "file:core/error_handling.py",
      "type": "file",
      "name": "core/error_handling.py",
      "path": "core/error_handling.py",
      "summary": "Decorator-driven recovery toolkit layering retries, circuit breaking, and partial-result handling for long Ancestry workflows.",
      "mechanism": "Uses EnhancedErrorRecovery to track failures, generates ErrorContext with jittered backoff, wraps operations via with_enhanced_recovery plus API/DB/File presets, and emits user guidance when retries exhaust.",
      "quality": "beta",
      "concerns": [
        "Global recovery stats and circuit breakers are stored on a singleton without locks, so concurrent workers could race.",
        "Partial success handlers rely on caller-provided lists; weak typing makes it easy to surface misleading guidance."
      ],
      "opportunities": [
        "Share circuit-breaker state with core.error_handling to avoid duplicated resilience logic.",
        "Emit structured telemetry for recovery outcomes so quality gates can detect rising failure counts."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Action 8 messaging wraps outbound sends with with_enhanced_recovery for resilient retries."
    },
    {
      "id": "file:core/error_handling.py",
      "type": "file",
      "name": "core/error_handling.py",
      "path": "core/error_handling.py",
      "summary": "Primary error framework supplying retry decorators, circuit breakers, and exception hierarchy for the platform.",
      "mechanism": "Defines CircuitBreaker with configurable thresholds, RetryConfig-driven retry_on_failure decorator, graceful_degradation wrappers, error_context logging, and central handler registry used across actions and SessionManager.",
      "quality": "stable",
      "concerns": [
        "Module spans 1.4k lines with overlapping features; coupling makes it hard to adopt lighter-weight error utilities.",
        "Retry decorators default to catching broad Exception, so caller must pass stop_on types to avoid masking programming errors."
      ],
      "opportunities": [
        "Integrate enhanced error recovery telemetry into the existing handler registry for unified reporting.",
        "Document common decorator profiles (API, DB, UI) to guide consistent usage across actions."
      ],
      "tests": "error_handling_module_tests",
      "notes": "SessionManager decorators such as retry_on_failure and graceful_degradation originate here."
    },
    {
      "id": "file:core/logging_utils.py",
      "type": "file",
      "name": "core/logging_utils.py",
      "path": "core/logging_utils.py",
      "summary": "Shared logging helpers that bootstrap logging_config, prevent duplicate handlers, and offer lazy debug hooks.",
      "mechanism": "get_logger bootstraps logging_config.setup_logging once, ensure_no_duplicate_handlers cleans handler stacks, suppress_external_loggers tunes third-party noise, and OptimizedLogger/debug_if_enabled gate expensive debug formatting.",
      "quality": "stable",
      "concerns": [
        "Implicit import of logging_config during get_logger can trigger circular imports if called too early in startup.",
        "Global setup flag is module-scoped; concurrent initialization in multi-process scenarios may still double attach handlers."
      ],
      "opportunities": [
        "Expose context manager to temporarily raise verbosity when debugging a specific action.",
        "Emit metrics on suppressed external loggers to ensure important warnings are not hidden."
      ],
      "tests": "logging_utils_module_tests",
      "notes": "standard_imports.setup_module delegates logger creation to get_logger for every module import."
    },
    {
      "id": "file:core/progress_indicators.py",
      "type": "file",
      "name": "core/progress_indicators.py",
      "path": "core/progress_indicators.py",
      "summary": "Provides tqdm-backed progress bars with ETA, memory, and cache metrics for long-running automation actions.",
      "mechanism": "ProgressIndicator wraps tqdm and threadsafe stats tracking, pulling config from common_params, updating rate/memory/ETA display via update() and with_progress context helpers while logging lifecycle events.",
      "quality": "stable",
      "concerns": [
        "Depends on psutil/tqdm being installed; missing packages surface as runtime errors when actions start.",
        "Per-update locking plus frequent memory sampling can add overhead when update_interval is too small."
      ],
      "opportunities": [
        "Emit structured progress snapshots so analytics dashboard can mirror CLI progress.",
        "Allow pluggable formatters for headless environments that prefer log-only output."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Action 6, 7, and 9 use with_progress to show user-facing throughput and ETAs."
    },
    {
      "id": "file:core/registry_utils.py",
      "type": "file",
      "name": "core/registry_utils.py",
      "path": "core/registry_utils.py",
      "summary": "Auto-registers module callables into a shared registry to cut repetitive boilerplate and track availability.",
      "mechanism": "SmartFunctionRegistry scans globals with include/exclude patterns, deduplicates entries, stores stats, and offers helpers like auto_register_module, performance_register, and create_registration_report used by test suites.",
      "quality": "beta",
      "concerns": [
        "Pattern-based filtering may accidentally register helper lambdas or miss new naming conventions.",
        "Global smart_registry persists between tests, so state must be cleared to avoid cross-module leakage."
      ],
      "opportunities": [
        "Add namespace scoping so multiple registries can coexist for different subsystems.",
        "Surface registry stats in diagnostics to confirm critical test hooks remain registered."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Standard import helper auto_register_module(globals(), __name__) uses this to collect test entrypoints."
    },
    {
      "id": "file:core/session_cache.py",
      "type": "file",
      "name": "core/session_cache.py",
      "path": "core/session_cache.py",
      "summary": "Caches expensive SessionManager components to slash startup time and reuse browser/API/database state safely.",
      "mechanism": "Hash-es configuration to key cached DatabaseManager/BrowserManager/APIManager instances, wraps constructors with @cached_session_component, tracks TTLs, and exposes stats/clear hooks layered on cache.BaseCacheModule.",
      "quality": "stable",
      "concerns": [
        "Weak global cache invalidation means stale Selenium drivers or DB engines can linger between runs if TTLs mis-tuned.",
        "Directly imports ConfigManager during hashing, so early use before config bootstraps can raise subtle errors."
      ],
      "opportunities": [
        "Expose deterministic teardown utilities so test suites can reset shared state explicitly.",
        "Record cache hit ratios to telemetry to justify further TTL tuning."
      ],
      "tests": "session_cache_module_tests",
      "notes": "SessionManager relies on cached_* helpers for performance; clearing caches is required in integration tests."
    },
    {
      "id": "file:core/session_manager.py",
      "type": "file",
      "name": "core/session_manager.py",
      "path": "core/session_manager.py",
      "summary": "Primary orchestrator coordinating cached database, browser, and API managers plus rate-limited session workflows.",
      "mechanism": "Builds cached DatabaseManager, BrowserManager, APIManager, and SessionValidator instances, exposes ensure_* readiness guards, manages global rate limiter, and runs proactive health monitoring with analytics hooks.",
      "quality": "stable",
      "concerns": [
        "Nearly 3k-line class interleaves caching, health monitoring, and CLI/test harness logic, so changes are hard to reason about.",
        "Shared cached managers introduce hidden global state; tests must clear caches to avoid cross-suite contamination."
      ],
      "opportunities": [
        "Factor health monitoring and login recovery flows into composable helpers.",
        "Expose a slimmer public interface focused on readiness checks for easier mocking in action modules."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "SessionManager underpins exec_actn and relies on core.session_cache plus utils.RateLimiter."
    },
    {
      "id": "file:core/session_validator.py",
      "type": "file",
      "name": "core/session_validator.py",
      "path": "core/session_validator.py",
      "summary": "Enforces login, cookie, URL, and CSRF readiness checks before actions execute against the Ancestry session.",
      "mechanism": "Coordinates BrowserManager and APIManager to verify login state, sync cookies to requests, validate CSRF tokens, and retry with graceful handling of WebDriver exceptions and action-specific skip rules.",
      "quality": "stable",
      "concerns": [
        "Relies on live Selenium state, so unit tests need extensive mocking to simulate cookie and login flows.",
        "Skip lists for cookie checks are duplicated with action metadata in main.exec_actn, risking divergence."
      ],
      "opportunities": [
        "Expose structured readiness results for analytics instead of boolean flags.",
        "Coalesce skip-check logic into shared configuration consumed by main and SessionValidator."
      ],
      "tests": "session_validator_module_tests",
      "notes": "SessionManager.ensure_session_ready delegates validation here before running actions."
    },
    {
      "id": "file:core/system_cache.py",
      "type": "file",
      "name": "core/system_cache.py",
      "path": "core/system_cache.py",
      "summary": "System-wide cache layer providing API, database, and memory optimization utilities for long-running actions.",
      "mechanism": "Builds APIResponseCache and DatabaseQueryCache atop cache.BaseCacheModule, decorates functions with cached_api_call/cached_database_query/memory_optimized, orchestrates warm_system_caches and telemetry via get_system_cache_stats.",
      "quality": "beta",
      "concerns": [
        "Decorators can mask upstream retry/backoff logic if applied indiscriminately to mutable responses.",
        "Memory optimizer toggles GC thresholds globally, which may interact poorly with concurrent processes."
      ],
      "opportunities": [
        "Add granular cache invalidation hooks so action modules can clear per-service entries after failures.",
        "Surface cache hit/miss metrics to analytics dashboard for production observability."
      ],
      "tests": "system_cache_module_tests",
      "notes": "Integrated with cache_manager.cached_api_call and invoked by main.initialize_aggressive_caching."
    },
    {
      "id": "file:core_imports.py",
      "type": "file",
      "name": "core_imports.py",
      "path": "core_imports.py",
      "summary": "Central registry that exposes get_function/is_function_available and manages sys.path bootstrapping.",
      "mechanism": "Caches project root detection, mutates sys.path once via ensure_imports/import_context, tracks registry stats, and provides register_function/register_many helpers plus telemetry getters for diagnostics.",
      "quality": "beta",
      "concerns": [
        "Project root detection walks fixed parent depths; non-standard deployments could resolve to the wrong directory.",
        "Registry is global and overwrites duplicate names silently, making it easy to clobber entries across modules."
      ],
      "opportunities": [
        "Emit warnings or telemetry when register_function replaces an existing binding.",
        "Allow namespacing or per-module registries so large subsystems can isolate helpers."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "standard_imports relies on these helpers to avoid tight coupling between modules."
    },
    {
      "id": "file:database.py",
      "type": "file",
      "name": "database.py",
      "path": "database.py",
      "summary": "Defines SQLAlchemy ORM models plus helpers for transactions, migrations, and soft deletes across the genealogy datastore.",
      "mechanism": "Declares enums and models (Person, DnaMatch, ConversationLog, EngagementTracking, TaskQueue, etc.), configures engine/session factories, wraps transactions via db_transn, enforces uppercase UUID policy, and includes backup/migration utilities such as ensure_db_initialized and _create_views.",
      "quality": "beta",
      "concerns": [
        "Monolithic module over 3k lines mixes schema definitions with service helpers, increasing cognitive load and import time.",
        "Many helpers call session.commit() internally, making it difficult to compose batched updates or rollbacks."
      ],
      "opportunities": [
        "Split models into submodules (people, conversations, tasks) and load via declarative base to speed imports.",
        "Adopt Alembic or migration metadata to guard future schema changes instead of manual DDL in code."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Shared hub for ORM state; SessionManager obtains its engine/session objects here and action modules rely on the transaction helpers."
    },
    {
      "id": "file:demo_lm_studio_autostart.py",
      "type": "file",
      "name": "demo_lm_studio_autostart.py",
      "path": "demo_lm_studio_autostart.py",
      "summary": "CLI demo that exercises lm_studio_manager auto-start using current configuration values.",
      "mechanism": "Imports config_schema, builds a manager via create_manager_from_config, prints key LM Studio settings, calls ensure_ready(), and surfaces success or troubleshooting tips to stdout.",
      "quality": "beta",
      "concerns": [
        "Direct import of config triggers full ConfigManager load, so running the demo without env vars configured exits with stack traces.",
        "No structured logging; troubleshooting relies entirely on console prints."
      ],
      "opportunities": [
        "Return detailed status codes or JSON output so automated diagnostics can consume results.",
        "Add option to skip ensure_ready() and only print config for quick verification."
      ],
      "tests": null,
      "notes": "Standalone helper for developers verifying LM Studio integration; not invoked by production workflows."
    },
    {
      "id": "file:diagnose_chrome.py",
      "type": "file",
      "name": "diagnose_chrome.py",
      "path": "diagnose_chrome.py",
      "summary": "Interactive PowerShell-style script that diagnoses Chrome and ChromeDriver mismatches and suggests fixes.",
      "mechanism": "Enumerates versions via registry/executables, checks running processes, validates profile directories, pulls ChromeDriver releases when mismatched, and prints remediation guidance for each failure stage.",
      "quality": "beta",
      "concerns": [
        "Intended for Windows; relies on winreg and tasklist so macOS/Linux developers need alternative paths.",
        "Heavy use of print statements makes localization or structured logging difficult."
      ],
      "opportunities": [
        "Return machine-readable JSON summary to integrate with health_monitor diagnostics.",
        "Add non-Windows code paths leveraging chromedriver-autoinstaller for cross-platform support."
      ],
      "tests": null,
      "notes": "Recommended when init_webdvr fails; complements chromedriver module by validating environment prerequisites."
    },
    {
      "id": "file:diagnose_google_ai.py",
      "type": "file",
      "name": "diagnose_google_ai.py",
      "path": "diagnose_google_ai.py",
      "summary": "Interactive CLI checklist that validates google-generativeai installation, API keys, and simple content generation.",
      "mechanism": "Imports google.generativeai, prints availability of core APIs, confirms GOOGLE_API_KEY env, lists models when possible, instantiates GenerativeModel, and issues a sample generate_content call with troubleshooting tips.",
      "quality": "beta",
      "concerns": [
        "Exits with sys.exit on first failure, so later diagnostics never run if earlier steps fail (e.g., missing module)."
      ],
      "opportunities": [
        "Aggregate results into a JSON summary to consume in automated health checks.",
        "Hide API key length output or mask value to avoid leaking secret metadata in logs."
      ],
      "tests": null,
      "notes": "Manual support tool for AI integration; run when Gemini connectivity issues arise."
    },
    {
      "id": "file:dna_ethnicity_utils.py",
      "type": "file",
      "name": "dna_ethnicity_utils.py",
      "path": "dna_ethnicity_utils.py",
      "summary": "Fetches DNA ethnicity data from Ancestry APIs and syncs reference metadata into the local database.",
      "mechanism": "Wraps _api_req to hit owner/region/comparison endpoints, loads fallback metadata from ethnicity_regions.json, adds safe column names via initialize_ethnicity_columns_from_metadata, and compares tree owner vs match percentages for downstream analytics.",
      "quality": "beta",
      "concerns": [
        "Assumes SessionManager.driver is available; limited retry/telemetry when API calls fail or return malformed data.",
        "Dynamic schema updates require running ensure_ethnicity_columns regularly or columns may lag new regions."
      ],
      "opportunities": [
        "Cache region name responses (in diskcache) to reduce repeated POST calls during large batches.",
        "Emit structured comparison summaries to analytics for tracking regional overlap trends."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Consumed by dna_utils and action6_gather to enrich DNA match records with ethnicity context."
    },
    {
      "id": "file:dna_gedcom_crossref.py",
      "type": "file",
      "name": "dna_gedcom_crossref.py",
      "path": "dna_gedcom_crossref.py",
      "summary": "Scores DNA matches against GEDCOM people, surfaces candidate cross-references, conflicts, and follow-up tasks for researchers.",
      "mechanism": "Extracts GEDCOM individuals into GedcomPerson records, runs name/relationship/context heuristics per DNAMatch, deduplicates with confidence boosts, then derives verification tasks, conflict alerts, and recommendation summaries; packaged with TestSuite-based unit helpers and a standard test runner.",
      "quality": "alpha",
      "concerns": [
        "Extraction helpers largely return placeholders (None), so real GEDCOM data yields sparse attributes and weak confidence scores.",
        "Relationship plausibility routine always returns True, inflating matches and hiding false positives until downstream review.",
        "Expected cM ranges are hardcoded and US-centric, risking incorrect conflict flags for endogamy or non-standard relationships."
      ],
      "opportunities": [
        "Integrate actual GEDCOM parsers for birth/death events and family links to enrich scoring inputs.",
        "Replace heuristics with relationship graph traversal using tree_owner_info to compute true distances and probabilities.",
        "Emit telemetry on match/conflict counts so quality gates can track heuristic drift."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Currently standalone; action modules would need to feed SessionManager GEDCOM extracts before relying on results."
    },
    {
      "id": "file:dna_utils.py",
      "type": "file",
      "name": "dna_utils.py",
      "path": "dna_utils.py",
      "summary": "Lightweight event logger capturing action metrics and producing weekly summaries in Logs/analytics.jsonl.",
      "mechanism": "Stores transient extras for exec_actn, appends JSON records via log_event, parses timestamped entries, aggregates run counts/durations, and renders human-readable reports without blocking core flows.",
      "quality": "stable",
      "concerns": [
        "Analytics file grows unbounded; no rotation or size cap implemented.",
        "File writes are not synchronized across processes, so simultaneous actions could interleave lines."
      ],
      "opportunities": [
        "Emit structured stats to telemetry so quality gates can fail when success rates drop.",
        "Add pruning/rotation to keep analytics.jsonl manageable on long-lived installations."
      ],
      "tests": null,
      "notes": "exec_actn logs duration/memory deltas here; run `python analytics.py --weekly` to review summaries."
    },
    {
      "id": "file:end_to_end_tests.py",
      "type": "file",
      "name": "end_to_end_tests.py",
      "path": "end_to_end_tests.py",
      "summary": "Smoke-level integration suite that verifies core action modules, infrastructure, and configuration are present before running full pipelines.",
      "mechanism": "Defines _test_* helpers that import action6/action7/action9, database models, session/rate limiting modules, and configuration artifacts; each returns booleans consumed by a TestSuite in module_tests, with __main__ wiring into create_standard_test_runner for CLI execution.",
      "quality": "alpha",
      "concerns": [
        "Assertions only confirm symbols existnot that workflows run end to end or share data correctly.",
        "Rate limiter check scrapes source text via inspect.getsource, which can break when utils grows large or is zipped.",
  "Action 8 messaging is not covered, so regressions there could slip through despite \"integration\" naming."
      ],
      "opportunities": [
        "Replace existence checks with scenario tests that drive exec_actn across actions using fixtures.",
        "Load utils.RateLimiter class directly and assert attributes instead of brittle string search.",
        "Add Action 8 coverage and basic AI/provider smoke calls when SKIP_LIVE_API_TESTS allows."
      ],
      "tests": "module_tests",
      "notes": "Run via python -m end_to_end_tests; requires local .env/config setup but avoids live API calls."
    },
    {
      "id": "file:error_handling.py",
      "type": "file",
      "name": "error_handling.py",
      "path": "error_handling.py",
      "summary": "Legacy-but-active error resilience toolkit with circuit breakers, intelligent retry handler, and ErrorRecoveryManager abstractions used by early action modules.",
      "mechanism": "Defines CircuitBreaker/RetryStrategy dataclasses, wraps operations through safe_execute, retry_on_failure, with_circuit_breaker, and ErrorRecoveryManager that tracks stats and emits warnings; includes 20+ TestSuite-driven helpers covering config, performance, and failure monitoring plus a standalone runner.",
      "quality": "beta",
      "concerns": [
        "Implementation largely duplicates logic in core/error_handling.py, risking divergence between legacy and SessionManager paths.",
        "Some helpers still rely on default placeholders (e.g., generic Exception lists) so callers must tune RetryConfig manually to avoid retry storms.",
        "Monolithic module (~1.5k lines) blends runtime code with large test harness, making imports heavy for production workers."
      ],
      "opportunities": [
        "Consolidate with core/error_handling.py into a single shared implementation to prevent configuration drift.",
        "Expose metrics from ErrorRecoveryManager to prompt telemetry so regression gate can flag rising failure rates.",
        "Split tests into adjacent module or guard under __name__ check to slim runtime import cost."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Primarily referenced by older scripts; newer flows should favor core.error_handling equivalents once parity is confirmed."
    },
    {
      "id": "file:gedcom_intelligence.py",
      "type": "file",
      "name": "gedcom_intelligence.py",
      "path": "gedcom_intelligence.py",
      "summary": "Traverses GEDCOM trees to flag gaps, conflicts, and research leads, returning insight summaries for downstream automation.",
      "mechanism": "GedcomIntelligenceAnalyzer walks gedcom_data indices, applies completeness/date/location/relationship heuristics, builds GedcomGap/GedcomConflict/ResearchOpportunity records, generates AI-style insight text, and ships TestSuite-driven unit coverage plus a create_standard_test_runner entry point.",
      "quality": "alpha",
      "concerns": [
        "Relies on naive placeholder extractors (birth/death/date parsing) so real GEDCOM parsing fidelity is low.",
        "AI insight generation is mocked with templates; no provider integration despite marketing copy.",
        "No integration points in actions yet, so analyzer risks bitrot without live callers or telemetry."
      ],
      "opportunities": [
        "Plug into gedcom_search_utils loader to reuse normalized events and relationship graphs for scoring.",
        "Wire results into research task pipeline (Action 9) so identified gaps spawn tasks automatically.",
        "Capture metrics on detected gaps/conflicts to validate heuristics before exposing to users."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Invoke via python -m gedcom_intelligence for the bundled diagnostics suite; currently standalone helper awaiting workflow wiring."
    },
    {
      "id": "file:gedcom_search_utils.py",
      "type": "file",
      "name": "gedcom_search_utils.py",
      "path": "gedcom_search_utils.py",
      "summary": "Provides cached GEDCOM loaders plus heuristic search helpers for name/date/place matching and relationship pathfinding.",
      "mechanism": "Caches GedcomData instances, wraps load/get/set helpers, delegates to gedcom_utils/relationship_utils for scoring, exposes matches_* filters and search routines, and bundles a large TestSuite plus create_standard_test_runner entry for regression checks.",
      "quality": "beta",
      "concerns": [
        "Heavy reliance on globals/config_manager means repeated imports hit disk and logging even when cache already set.",
        "Search heuristics share tuning constants inline, so tweaking weights demands code edits instead of config overrides.",
        "Parallel/async claims in header are aspirational; actual lookups run synchronously and may block action workflows."
      ],
      "opportunities": [
        "Expose scoring weights through ConfigManager or .env to align with production tuning knobs.",
        "Persist cached GEDCOM metadata via diskcache to survive process restarts and speed warmup.",
        "Add profiling hooks so performance_monitor can track query latency and accuracy outcomes."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Used by gedcom search/action prototypes; ensure Cache/ preprocessors warmed before invoking high-volume match loops."
    },
    {
      "id": "file:genealogical_normalization.py",
      "type": "file",
      "name": "genealogical_normalization.py",
      "path": "genealogical_normalization.py",
      "summary": "Utility layer that tidies AI extraction payloads: deduping lists, normalizing dates, and mapping legacy keys into structured schemas.",
      "mechanism": "Offers _dedupe_list_str plus date parsing helpers, builds normalize_ai_response to ensure STRUCTURED_KEYS exist, migrates LEGACY_TO_STRUCTURED_MAP entries, and bundles TestSuite coverage via genealogical_normalization_module_tests with a create_standard_test_runner hook.",
      "quality": "beta",
      "concerns": [
        "Regex-based date parsing only handles English month names and a narrow year span, so international data may remain unnormalized.",
        "normalize_ai_response silently drops unknown legacy fields instead of surfacing warnings to telemetry.",
        "Module duplicates logic now present in universal_scoring; divergence could create inconsistent task payloads."
      ],
      "opportunities": [
        "Centralize normalization utilities in a shared package so messaging and task pipelines stay aligned.",
        "Emit normalization diagnostics (e.g., dropped keys) to analytics for tuning AI prompt outputs.",
        "Expand date parsing to leverage dateparser or Babel when available while keeping safe fallbacks."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Imported by messaging personalization and research task builders to sanitize LLM responses before scoring."
    },
    {
      "id": "file:health_monitor.py",
      "type": "file",
      "name": "health_monitor.py",
      "path": "health_monitor.py",
      "summary": "Tracks session vitals, thresholds, and checkpoints for long-running automation, exposing alerts plus recovery helpers.",
      "mechanism": "SessionHealthMonitor aggregates metrics (API latency, memory, page progress), adapts thresholds, records alerts, manages checkpoints/state persistence, and provides integrate_with_session_manager/action6 hooks; wrappers register functions for DI and a TestSuite-driven health_monitor_tests runner feeds create_standard_test_runner.",
      "quality": "beta",
      "concerns": [
        "Large module mixes runtime logic with extensive test harness, dragging in psutil and heavy state even when only helpers needed.",
        "Alert/risk scoring relies on hardcoded thresholds tuned for past 724-page runs; lacks self-calibration or config overrides.",
        "Checkpoint files land under Cache/ without pruning policy beyond manual cleanup, risking disk bloat on busy hosts."
      ],
      "opportunities": [
        "Externalize metric thresholds to config_schema so production tuning can happen without code edits.",
        "Emit health score telemetry to Logs/prompt_experiments.jsonl or analytics pipeline for regression gate visibility.",
        "Move tests into adjacent module or guard heavy imports to slim footprint when SessionManager bootstraps."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "SessionManager.integrate_with_health_monitor invokes this to guard long DNA runs; requires psutil availability on target environment."
    },
    {
      "id": "file:lm_studio_manager.py",
      "type": "file",
      "name": "lm_studio_manager.py",
      "path": "lm_studio_manager.py",
      "summary": "Manages local LM Studio lifecycledetecting running processes, launching the desktop app, and verifying its HTTP API is ready.",
      "mechanism": "LMStudioManager wraps psutil process scans, requests-based health checks, and subprocess launches; create_manager_from_config pulls tuned defaults from config.api while module_tests exercises init/detection/health-check paths via TestSuite.",
      "quality": "beta",
      "concerns": [
        "Defaults assume Windows install paths; macOS/Linux require manual overrides or the manager fails early.",
        "Ensure_ready polls every 2s without exponential backoff, which can linger silently if API never comes online.",
        "Requests import and psutil scans occurs on import even when LM Studio support is disabled, increasing startup cost."
      ],
      "opportunities": [
        "Parameterize executable lookup via config_schema to support cross-platform discovery and user overrides.",
        "Add optional stop/restart controls so automation can recover from stale LM Studio sessions automatically.",
        "Emit telemetry on start attempts and readiness timings to debug local LLM availability issues."
      ],
      "tests": "module_tests",
      "notes": "Used when config.api.lm_studio_auto_start is enabled; verify psutil/requests installed before wiring into automation."
    },
    {
      "id": "file:memory_utils.py",
      "type": "file",
      "name": "memory_utils.py",
      "path": "memory_utils.py",
      "summary": "Provides a tiny ObjectPool helper and tolerant JSON loader used in performance-sensitive utilities.",
      "mechanism": "Defines ObjectPool with acquire/release semantics backed by deque plus fast_json_loads wrapper around json.loads that returns None on errors; TestSuite-driven memory_utils_module_tests validate both behaviors and feed create_standard_test_runner.",
      "quality": "beta",
      "concerns": [
        "ObjectPool lacks thread safetyshared use across worker threads could race.",
        "fast_json_loads swallows exceptions silently, so upstream callers need telemetry to spot malformed inputs.",
        "Factory return type is untyped; inconsistent objects can slip in and break pooling expectations."
      ],
      "opportunities": [
        "Add optional threading.Lock or note single-thread usage contract explicitly.",
        "Emit debug logging or metrics when fast_json_loads returns None to aid quality gating.",
        "Generalize pool with contextmanager helpers so callers auto-release objects."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Currently used by performance_cache and analytics helpers; safe to inline if concurrency requirements grow."
    },
    {
      "id": "file:message_personalization.py",
      "type": "file",
      "name": "message_personalization.py",
      "path": "message_personalization.py",
      "summary": "Generates outbound messages from conversation extractions using db-backed templates, registry-driven formatting, and effectiveness tracking.",
      "mechanism": "MessagePersonalizer loads MessageTemplate rows via SessionManager, maps dozens of personalization functions to stitch AI-derived data into text, applies A/B template selection, and records touches through MessageEffectivenessTracker; bundled TestSuite exercises personalization paths and integrates with create_standard_test_runner.",
      "quality": "alpha",
      "concerns": [
        "Template loading depends on global session registration; runs outside exec_actn will fail silently and return empty templates.",
        "Personalization registry has little input validationunexpected extracted_data shapes can bubble into broken prose.",
        "Effectiveness tracking currently in-memory; restarts reset metrics so optimization never converges."
      ],
      "opportunities": [
        "Persist effectiveness scores to database so template A/B tuning survives sessions.",
        "Surface fallback usage and missing template warnings to analytics for prompt iteration.",
        "Expose configuration to cap personalization function count to keep messages concise."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Action8 messaging pipelines instantiate MessagePersonalizer; ensure global SessionManager registered before calling create_personalized_message."
    },
    {
      "id": "file:ms_graph_utils.py",
      "type": "file",
      "name": "ms_graph_utils.py",
      "path": "ms_graph_utils.py",
      "summary": "Wraps Microsoft Graph authentication and To Do task helpers, handling MSAL token caching and device-code flows for Action 9 outputs.",
      "mechanism": "Loads config/.env secrets, sets up persistent SerializableTokenCache, exposes token acquisition/refresh helpers, list/task CRUD wrappers, and unit tests mocking msal/requests via TestSuite before wiring into create_standard_test_runner.",
      "quality": "alpha",
      "concerns": [
        "Bootstraps msal + dotenv at import timemissing env vars trigger critical logs and set globals to None, complicating mocking.",
        "Device flow instructions write to stdout; integrating in headless automation may need alternative UX.",
        "Token cache path depends on config.database.data_dir; misconfigured paths silently degrade to in-memory cache."
      ],
      "opportunities": [
        "Hide heavy imports behind feature flags so offline environments avoid msal cost.",
        "Emit structured telemetry for token refresh success/failure to aid Microsoft Graph troubleshooting.",
        "Refactor to class-based wrapper so SessionManager can inject credentials and centralize retry logic."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Action9 task generation calls into this when USERS_ENABLE_MS_GRAPH trueensure MS_GRAPH_CLIENT_ID present and device flow completed."
    },
    {
      "id": "file:my_selectors.py",
      "type": "file",
      "name": "my_selectors.py",
      "path": "my_selectors.py",
      "summary": "Central catalogue of CSS selectors feeding Selenium automation against Ancestry UI.",
      "mechanism": "Defines page-scoped constant selectors plus my_selectors_module_tests TestSuite that validates naming, formatting, and coverage heuristics for critical flows (login, matches, messaging).",
      "quality": "beta",
      "concerns": [
        "Selectors rely on English labels and brittle DOM positionsregional UI strings will break :contains filters.",
        "No automatic verification against live site, so drift may go unnoticed until runtime failures.",
        "Module imports the test framework on load just to declare constants, adding unnecessary dependencies during production runs."
      ],
      "opportunities": [
        "Generate selectors from structured metadata to centralize updates and enable documentation tooling.",
        "Add headless smoke tests that exercise selectors regularly to catch site changes early.",
        "Lazy-load or guard test-only imports to keep runtime footprint minimal."
      ],
      "tests": "my_selectors_module_tests",
      "notes": "Consumed by selenium_utils and action modules; update promptly when Ancestry HTML changes."
    },
    {
      "id": "file:performance_monitor.py",
      "type": "file",
      "name": "performance_monitor.py",
      "path": "performance_monitor.py",
      "summary": "Tracks process-level metrics, function timings, and emits alerts/profiles to tune long-running automation workloads.",
      "mechanism": "PerformanceMonitor collects psutil stats, records metrics via record_metric, profiles functions with decorators, spawns background thread for alerts, and exposes dashboards plus advanced monitors; module_tests exercise initialization, profiling, alerting, and serialization using TestSuite + create_standard_test_runner.",
      "quality": "beta",
      "concerns": [
        "Background threads never join on interpreter exit unless stop_monitoring called, risking hanging tests.",
        "Thresholds baked into code; tuning requires edits rather than config adjustments.",
        "High-verbosity logging can flood Logs/app.log when metrics collected every 30 seconds."
      ],
      "opportunities": [
        "Wire metrics into analytics/performance_cache so dashboards persist across sessions.",
        "Allow config_schema overrides for thresholds and sampling intervals.",
        "Integrate with health_monitor to share alerting pipeline instead of duplicating logic."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "SessionManager.enable_performance_monitor toggles this; ensure psutil available and call stop_monitoring during teardown."
    },
    {
      "id": "file:performance_orchestrator.py",
      "type": "file",
      "name": "performance_orchestrator.py",
      "path": "performance_orchestrator.py",
      "summary": "High-level orchestrator coordinating query tuning, memory pressure relief, API batching, and module load optimizations.",
      "mechanism": "Defines SmartQueryOptimizer, MemoryPressureMonitor, APIBatchCoordinator, ModuleLoadOptimizer, and orchestration helpers (optimize_performance/get_performance_report) with caching, threading, and psutil hooks; module_tests run through TestSuite and create_standard_test_runner to verify each subsystem.",
      "quality": "alpha",
      "concerns": [
        "Optimization routines mostly log suggestions without executing real adjustments, so expectations may be misleading.",
        "APIBatchCoordinator assumes sequential processing yet still references legacy parallel settings.",
        "Global singletons stored in module-level caches may survive across tests causing flaky expectations."
      ],
      "opportunities": [
        "Integrate with SessionManager to trigger actual rate limiter tuning or DB index hints when safe.",
        "Persist optimization history so regression gate can track improvement trends.",
        "Consolidate overlapping functionality with performance_monitor/health_monitor to reduce duplication."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Currently serves as experimentation sandbox; ensure orchestrator hooks remain disabled in production until validated."
    },
    {
      "id": "file:person_lookup_utils.py",
      "type": "file",
      "name": "person_lookup_utils.py",
      "path": "person_lookup_utils.py",
      "summary": "Builds structured PersonLookupResult objects from GEDCOM/API lookups for downstream AI prompts and messaging.",
      "mechanism": "Defines PersonLookupResult dataclass with formatting helpers, factory functions for GEDCOM/API/not-found scenarios, and a TestSuite-backed person_lookup_utils_module_tests covering serialization and formatting before wiring into create_standard_test_runner.",
      "quality": "beta",
      "concerns": [
        "Confidence heuristics are simplistic (thresholded by match_score) and may mislead prioritization logic.",
        "Factories assume standard key names from action10/11schema shifts will silently drop data.",
        "Format strings embed English phrases, limiting internationalization."
      ],
      "opportunities": [
        "Track provenance metadata (match_id, source_url) to aid user verification.",
        "Allow configurable match_score thresholds via config_schema.",
        "Integrate with genealogical_normalization to ensure consistent date/place formatting."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Action10/11 pipelines construct these before handing context to messaging and task generators."
    },
    {
      "id": "file:prompt_telemetry.py",
      "type": "file",
      "name": "prompt_telemetry.py",
      "path": "prompt_telemetry.py",
      "summary": "Appends JSONL telemetry for prompt experiments and computes variant-level success/quality metrics plus alerts.",
      "mechanism": "Uses record_extraction_experiment_event to enrich payloads (counts, hashes, coverage) before writing to Logs/prompt_experiments.jsonl, summarizes via summarize_experiments/get_variant_stats, maintains baselines/alerts, and ships prompt_telemetry_module_tests with create_standard_test_runner CLI integration.",
      "quality": "beta",
      "concerns": [
        "Synchronous disk writes on every event can bottleneck high-volume runs on slow media.",
        "Auto alert analyzer swallows exceptions, so telemetry failures may pass silently.",
        "Baseline comparisons assume prompt_quality_baseline.json covers all variants; missing entries produce noisy warnings."
      ],
      "opportunities": [
        "Batch writes or stream via async worker to reduce I/O overhead.",
        "Emit metrics to performance_monitor/analytics for observability into telemetry health.",
        "Offer CLI utility to regenerate baselines after deliberate prompt changes."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "quality_regression_gate imports this module; ensure Logs/ directory writable in CI before running actions."
    },
    {
      "id": "function:prompt_telemetry.record_extraction_experiment_event",
      "type": "function",
      "name": "prompt_telemetry.record_extraction_experiment_event",
      "path": "prompt_telemetry.py",
      "summary": "Persists a single prompt experiment event to JSONL with derived metrics and optional alerts.",
      "mechanism": "Builds count metadata, truncates errors, hashes user identifiers, writes to prompt_experiments.jsonl, and triggers lightweight _auto_analyze_and_alert in a best-effort suppress block.",
      "quality": "beta",
      "concerns": [
        "All exceptions are swallowed, so disk or serialization failures are invisible to callers.",
        "Hashing uses session-level salt only; cross-environment comparisons may be impossible."
      ],
      "opportunities": [
        "Return a success flag so upstream workflows can react to telemetry outages.",
        "Feed alert outcomes into analytics to avoid duplicate real-time computations."
      ],
      "tests": "prompt_telemetry_module_tests",
      "notes": "Invoked from ai_interface extraction telemetry; safe to call without existing files."
    },
    {
      "id": "function:prompt_telemetry.summarize_experiments",
      "type": "function",
      "name": "prompt_telemetry.summarize_experiments",
      "path": "prompt_telemetry.py",
      "summary": "Aggregates the last N telemetry events into per-variant counts, success rates, and quality averages.",
      "mechanism": "Reads prompt_experiments.jsonl, accumulates variant metrics via _accumulate_variant_stats, finalizes success_rate/avg_tasks values, and returns an overall summary dict.",
      "quality": "stable",
      "concerns": [
        "Reads entire file into memory when last_n exceeds file length; large histories may strain memory.",
        "Ignores timestamps, so mix of old/new data depends solely on file order."
      ],
      "opportunities": [
        "Stream data to avoid full file loads and support larger histories.",
        "Add time-window filtering for fresher operational dashboards."
      ],
      "tests": "prompt_telemetry_module_tests",
      "notes": "Used by CLI stats and quality_regression_gate to display recent performance."
    },
    {
      "id": "function:prompt_telemetry.analyze_experiments",
      "type": "function",
      "name": "prompt_telemetry.analyze_experiments",
      "path": "prompt_telemetry.py",
      "summary": "Compares control vs. alt prompt variants over a recent window to flag improvements.",
      "mechanism": "Loads the latest events, aggregates per-variant metrics, computes median quality/success deltas, and emits heuristic promotion recommendations.",
      "quality": "beta",
      "concerns": [
        "Heuristic deltas lack statistical significance checks, risking false positives.",
        "Assumes exactly two variants (control/alt); additional variants fall into 'unknown'."
      ],
      "opportunities": [
        "Incorporate confidence intervals or nonparametric tests before issuing promotion recommendations.",
        "Support arbitrary variant comparisons with configurable baseline selection."
      ],
      "tests": "prompt_telemetry_module_tests",
      "notes": "_auto_analyze_and_alert relies on this to drive alert signatures."
    },
    {
      "id": "function:prompt_telemetry.build_quality_baseline",
      "type": "function",
      "name": "prompt_telemetry.build_quality_baseline",
      "path": "prompt_telemetry.py",
      "summary": "Builds and persists a quality-score baseline for a variant when sufficient data exists.",
      "mechanism": "Collects recent control scores, computes median and quartiles, and writes prompt_quality_baseline.json with metadata and timestamp.",
      "quality": "stable",
      "concerns": [
        "Baseline file overwrites previous data without backup or version history.",
        "Quantile computation assumes at least four scores; fallback None values reduce usefulness."
      ],
      "opportunities": [
        "Maintain per-prompt baselines and append history for trend analysis.",
        "Expose CLI feedback when insufficient events prevent baseline creation."
      ],
      "tests": "prompt_telemetry_module_tests",
      "notes": "quality_regression_gate consumes this baseline to detect degradations."
    },
    {
      "id": "function:prompt_telemetry.detect_quality_regression",
      "type": "function",
      "name": "prompt_telemetry.detect_quality_regression",
      "path": "prompt_telemetry.py",
      "summary": "Evaluates recent telemetry against the stored baseline to spot quality drops.",
      "mechanism": "Loads baseline, filters current control scores, compares median to drop_threshold, and returns status plus delta metadata.",
      "quality": "beta",
      "concerns": [
        "Returns 'no_data' or 'no_baseline' without logging, so silent failures are easy to miss.",
        "Single threshold (drop_threshold) treats all prompt keys equally despite differing variability."
      ],
      "opportunities": [
        "Emit structured logs when no data prevents evaluation to aid CI diagnostics.",
        "Calibrate thresholds per prompt type or variance for more sensitive detection."
      ],
      "tests": "prompt_telemetry_module_tests",
      "notes": "quality_regression_gate delegates regression detection to this helper before exiting with a gate failure."
    },
    {
      "id": "file:quality_regression_gate.py",
      "type": "file",
      "name": "quality_regression_gate.py",
      "path": "quality_regression_gate.py",
      "summary": "CLI gate that compares recent prompt telemetry median against a baseline and exits non-zero on regressions.",
      "mechanism": "Loads JSONL events via load_experiments, filters to last N days, computes medians with calculate_median_quality, stores/reads baselines, and main() wires argparse flags for --generate-baseline, --threshold, and path overrides.",
      "quality": "beta",
      "concerns": [
        "Depends on prompt_telemetry file format; schema changes with missing quality_score break gating silently.",
        "Baseline stored in Logs/quality_baseline.json with no retention/versioningold baselines may go stale."
      ],
      "opportunities": [
        "Add machine-readable (JSON) summary alongside human-friendly prints to simplify CI consumption.",
        "Persist multiple baselines (per prompt key) to avoid mixing unrelated experiments.",
        "Publish results to analytics or CI artifacts for trend tracking."
      ],
      "tests": "test_quality_regression_gate (2/2 passed Nov 2025)",
      "notes": "Updated Nov 2025: Implemented --json flag for machine-readable CI output; added baseline_id and git_ref provenance; fixed timezone-aware UTC comparison. Comprehensive unit tests added and all passing."
    },
    {
      "id": "function:quality_regression_gate.load_experiments",
      "type": "function",
      "name": "quality_regression_gate.load_experiments",
      "path": "quality_regression_gate.py",
      "summary": "Loads recent prompt telemetry events from JSONL within a configurable day window.",
      "mechanism": "Streams prompt_experiments.jsonl, parses ISO timestamps, filters by cutoff, and tolerates malformed lines with best-effort recovery.",
      "quality": "stable",
      "concerns": [
        "Falls back to including entries without timestamps, potentially skewing recent-window analysis.",
        "Silently skips decode errors, so telemetry corruption is easy to miss."
      ],
      "opportunities": [
        "Emit warnings when malformed lines are encountered to surface data issues.",
        "Support variant filtering to align baseline with specific prompt categories."
      ],
      "tests": null,
      "notes": "CI gate entry point; shared by baseline generation and regression checks."
    },
    {
      "id": "function:quality_regression_gate.calculate_median_quality",
      "type": "function",
      "name": "quality_regression_gate.calculate_median_quality",
      "path": "quality_regression_gate.py",
      "summary": "Computes median quality score from recent experiments, ignoring failed parses and invalid ranges.",
      "mechanism": "Extracts numeric quality_score when parse_success is true, clips to [0,100], sorts scores, and returns the midpoint value.",
      "quality": "stable",
      "concerns": [
        "Median calculation ignores timestamps and variant labels, producing a single blended metric.",
        "Returns None silently when no scores exist; callers must handle this path carefully."
      ],
      "opportunities": [
        "Add optional weighting (e.g., recency) to reduce stale influence.",
        "Surface diagnostics about excluded experiments to aid debugging."
      ],
      "tests": null,
      "notes": "Used by both baseline generation and regression evaluation."
    },
    {
      "id": "function:quality_regression_gate.load_baseline",
      "type": "function",
      "name": "quality_regression_gate.load_baseline",
      "path": "quality_regression_gate.py",
      "summary": "Reads the stored quality baseline JSON if present and decodable.",
      "mechanism": "Opens Logs/quality_baseline.json, attempts json.load, and returns an empty dict on error.",
      "quality": "stable",
      "concerns": [
        "Errors are swallowed, so a corrupted baseline file produces silent resets.",
        "Baseline schema is fixed; extra metadata is dropped rather than validated."
      ],
      "opportunities": [
        "Log corruption incidents to prompt rebuilding the baseline.",
        "Validate schema to detect incompatible format changes earlier."
      ],
      "tests": null,
      "notes": "Called by main() to determine if regression check can proceed."
    },
    {
      "id": "function:quality_regression_gate.save_baseline",
      "type": "function",
      "name": "quality_regression_gate.save_baseline",
      "path": "quality_regression_gate.py",
      "summary": "Persists a freshly computed baseline median to disk with summary metadata.",
      "mechanism": "Ensures parent directory exists, writes median, experiment count, and generated timestamp to baseline JSON, and prints confirmation output.",
      "quality": "stable",
      "concerns": [
        "Overwrites existing baseline without backup or change history.",
        "Print-based reporting lacks structured logging for automation."
      ],
      "opportunities": [
        "Archive prior baselines (timestamped filenames) to enable rollbacks.",
        "Expose return status for CI scripts instead of relying on stdout."
      ],
      "tests": null,
      "notes": "Triggered via --generate-baseline workflow before enabling gate enforcement."
    },
    {
      "id": "function:quality_regression_gate.check_regression",
      "type": "function",
      "name": "quality_regression_gate.check_regression",
      "path": "quality_regression_gate.py",
      "summary": "Compares current vs. baseline median and determines if the drop exceeds threshold.",
      "mechanism": "Computes quality_drop as baseline minus current and flags regression when it crosses threshold.",
      "quality": "stable",
      "concerns": [
        "Uses strict greater-than comparison, so equal-to-threshold drops are treated as pass; may need inclusive option.",
        "Returns tuple without context, leaving callers to format messaging."
      ],
      "opportunities": [
        "Include guardrails for negative drops (improvements) to avoid confusing outputs.",
        "Return structured result object with status and delta for easier consumption."
      ],
      "tests": null,
      "notes": "Main regression decision helper; simple to unit test with sample medians."
    },
    {
      "id": "function:quality_regression_gate.main",
      "type": "function",
      "name": "quality_regression_gate.main",
      "path": "quality_regression_gate.py",
      "summary": "CLI entry coordinating argument parsing, baseline generation, and regression enforcement.",
      "mechanism": "Parses CLI flags, loads experiments, computes current median, optionally saves baselines, compares medians, prints status, and returns exit codes for CI integration.",
      "quality": "beta",
      "concerns": [
        "Relies heavily on print statements; logging would integrate better with automation.",
        "Exit code 2 conflates missing data with unexpected errors, reducing actionable feedback."
      ],
      "opportunities": [
        "Expose machine-readable output (JSON) alongside console messaging.",
        "Differentiate error codes for missing data vs. read failures to aid CI triage."
      ],
      "tests": null,
      "notes": "Integrated in deployment pipeline to guard against AI prompt regressions."
    },
    {
      "id": "file:rate_limiter.py",
      "type": "file",
      "name": "rate_limiter.py",
      "path": "rate_limiter.py",
      "summary": "Implements adaptive token-bucket rate limiter with persisted state and endpoint-specific throttling for API safety.",
      "mechanism": "AdaptiveRateLimiter adjusts fill_rate based on success/429 feedback, persists config via Cache/rate_limiter_state.json, exposes configure_endpoint_profiles, wait/on_success/on_429_error hooks, and bundles extensive TestSuite scenarios through run_comprehensive_tests.",
      "quality": "beta",
      "concerns": [
        "Persistence file is per-repo; running multiple instances concurrently may clobber learned rates.",
        "Success threshold defaults (50) assume high request volumes and may starve ramp-up during short runs."
      ],
      "opportunities": [
        "Tie metrics into prompt_telemetry/analytics so regressions surface in dashboards.",
        "Allow per-endpoint persistence to avoid mixing search and messaging rate characteristics.",
        "Expose configuration through config_schema to adjust thresholds without code edits."
      ],
      "tests": "run_comprehensive_tests (13/13 passed Nov 2025)",
      "notes": "Updated Nov 2025: Implemented atomic state persistence (write temp + Path.replace) in _persist_state to eliminate corruption risk from partial writes. All 13 module tests passing including thread-safety and endpoint-specific throttling."
    },
    {
      "id": "file:record_sharing.py",
      "type": "file",
      "name": "record_sharing.py",
      "path": "record_sharing.py",
      "summary": "String helpers that format genealogical record references (with optional URLs) for outbound messaging scripts.",
      "mechanism": "Provides format_record_reference/multiple_records/create_record_sharing_message plus URL extraction, deduping, and TestSuite-backed record_sharing_module_tests validating formatting edge cases.",
      "quality": "beta",
      "concerns": [
        "Formatting logic assumes ASCII bullet and newline conventions; HTML channels may need alternative markup.",
        "No direct integration with database lookupscallers must supply sanitized record_details.",
        "URL validation is minimal (startswith('http')); could accept unsafe protocols if not filtered upstream."
      ],
      "opportunities": [
        "Add Markdown/HTML rendering modes so messaging modules can target multiple channels.",
        "Log when fallback 'No records found' paths triggered to spot data quality issues.",
        "Tie into analytics to track which record types get shared most frequently."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Action8 message builder calls these when AI extractions include supporting records."
    },
    {
      "id": "file:relationship_diagram.py",
      "type": "file",
      "name": "relationship_diagram.py",
      "path": "relationship_diagram.py",
      "summary": "Generates ASCII relationship diagrams for messaging by walking relationship paths and formatting summaries.",
      "mechanism": "generate_relationship_diagram chooses vertical/horizontal/compact renderers, format_relationship_for_message produces textual summaries, and relationship_diagram_module_tests validate each renderer via TestSuite and create_standard_test_runner.",
      "quality": "beta",
      "concerns": [
        "ASCII arrows and English phrasing assume left-to-right languages; lacks localization support.",
        "Diagram styles rely on relationship_path dictionaries having 'name'/'relationship'; missing keys yield 'Unknown'.",
        "Module imports logging and tests at runtime despite only exporting pure functions."
      ],
      "opportunities": [
        "Add Markdown/HTML output for richer channels like email or web UI.",
        "Surface when relationship_path is incomplete so upstream heuristics can improve.",
        "Provide width-aware wrapping so long names don't break vertical diagrams."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Used by messaging personalization to visualize cousin paths; safe to call offline."
    },
    {
      "id": "file:remove_progress_bar.py",
      "type": "file",
      "name": "remove_progress_bar.py",
      "path": "remove_progress_bar.py",
      "summary": "One-off script that strips progress_bar parameters/usages from action6_gather.py using regex replacements.",
      "mechanism": "Reads action6_gather.py, applies a sequence of re.sub patterns to drop function arguments, conditionals, and progress_bar method calls, then writes the modified file and prints a status message.",
      "quality": "prototype",
      "concerns": [
        "Regex-based edits may remove unintended code if formatting diverged from assumptions.",
        "Rewrites file in place without backup or safety checks.",
        "No tests ensure the sanitized file still passes lint/tests."
      ],
      "opportunities": [
        "Replace with AST-based refactor or manual cleanup now that migration complete.",
        "Add --dry-run/backup options before destructive writes.",
        "Delete script after confirming progress bar removal to avoid accidental re-use."
      ],
      "tests": null,
      "notes": "Run only during action6_gather cleanup with clean git state."
    },
    {
      "id": "file:research_guidance_prompts.py",
      "type": "file",
      "name": "research_guidance_prompts.py",
      "path": "research_guidance_prompts.py",
      "summary": "Generates text prompts for AI to deliver research guidance, conversation replies, and brick-wall analyses.",
      "mechanism": "Exports prompt builders (create_research_guidance_prompt/conversation_response/brick_wall_analysis) that compose structured sections from genealogical context; TestSuite-driven research_guidance_prompts_module_tests cover template variations with create_standard_test_runner wiring.",
      "quality": "beta",
      "concerns": [
        "Prompts hardcode English copy; localization requires duplication.",
        "Input lists accepted as raw strings without sanitationmalformed values may leak into prompts.",
        "Module imports logging + standard_imports despite being pure string builder."
      ],
      "opportunities": [
        "Externalize prompt templates into ai_prompts.json for centralized management.",
        "Add guardrails (max list lengths) to keep prompts within model token budgets.",
        "Instrument telemetry to track which prompt variants perform best."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Action9 and messaging experiments call these to prime AI responses; ensure data sanitized upstream."
    },
    {
      "id": "file:research_prioritization.py",
      "type": "file",
      "name": "research_prioritization.py",
      "path": "research_prioritization.py",
      "summary": "Analyzes GEDCOM and DNA cross-ref results to rank research tasks, family lines, and location clusters.",
      "mechanism": "IntelligentResearchPrioritizer builds ResearchPriority, FamilyLineStatus, and LocationResearchCluster records by scanning gedcom_analysis/dna_crossref inputs, scores/filters them, and produces recommendations; module_tests (TestSuite) validate scoring, clustering, and DNA task generation with create_standard_test_runner wiring.",
      "quality": "alpha",
      "concerns": [
        "Relies on placeholder heuristics (_calculate_line_completeness, etc.) returning canned values, so outputs lack fidelity.",
        "Logging claims AI-powered insights though actual implementation uses simple loopsrisk of over-promising.",
        "No integration yet with downstream task pipelines; results may silently rot."
      ],
      "opportunities": [
        "Replace heuristics with real metrics from gedcom_intelligence and dna_gedcom_crossref outputs.",
        "Persist prioritization results to database so Action 9 can schedule tasks automatically.",
        "Track success metrics via prompt_telemetry to tune prioritization weights."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Prototype analyzer; wire cautiously into production until heuristics validated over real data."
    },
    {
      "id": "file:research_suggestions.py",
      "type": "file",
      "name": "research_suggestions.py",
      "path": "research_suggestions.py",
      "summary": "Builds structured research suggestions for conversations using ancestor, location, and era cues.",
      "mechanism": "Helper extractors map locations to curated ANCESTRY_COLLECTIONS, convert year strings into TIME_PERIOD_COLLECTIONS, derive record types and strategies from top common ancestors, deduplicate and clamp list sizes, then compose a bullet-formatted message via _format_research_suggestion_message; run_comprehensive_tests wires the TestSuite covering helpers and end-to-end generation.",
      "quality": "beta",
      "concerns": [
        "Static location heuristics only cover a handful of countries; unmatched regions silently fall through.",
        "String matching assumes lowercase substrings and non-empty location/time inputs, so partial data can yield thin suggestions.",
        "Formatting uses hardcoded bullet prefixes, risking localization or channel rendering issues."
      ],
      "opportunities": [
        "Read collection definitions from config or database to expand coverage without code edits.",
        "Incorporate AI summarization or conversation context weighting to prioritize suggestions.",
        "Surface confidence scores with telemetry hooks so prompt_telemetry can monitor usefulness."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Relies on test_framework.TestSuite plus create_standard_test_runner; import guarded logging makes it safe for automation callers."
    },
    {
      "id": "file:selenium_utils.py",
      "type": "file",
      "name": "selenium_utils.py",
      "path": "selenium_utils.py",
      "summary": "Utility wrappers for Selenium WebDriver interactions with consistent safe_execute error handling.",
      "mechanism": "Decorates element helpers (force_user_agent, extract_text/attribute, wait_for_element, safe_click, etc.) with standard_imports.safe_execute so failures return sentinel defaults, provides cookie export and tab management, and ships a TestSuite-driven selenium_utils_module_tests hooked to run_comprehensive_tests.",
      "quality": "beta",
      "concerns": [
        "Docstring marketing obscures real capabilities; expectations may exceed simple helper scope.",
        "force_user_agent uses execute_script which may not persist for network stack; no verification or fallback.",
        "Performance tests rely on time.sleep/time.time which can flake under CI load."
      ],
      "opportunities": [
        "Integrate with core.browser_manager/session lifecycles to avoid diverging helper stacks.",
        "Add explicit waits for click targets instead of blind element.click to reduce stale element errors.",
        "Expand unit tests with real WebDriver mocks for wait_for_element/scroll_to_element branches."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Requires selenium and safe_execute scaffold from standard_imports; test suite mocks WebDriver via unittest.mock."
    },
    {
      "id": "file:test_diagnostics.py",
      "type": "file",
      "name": "test_diagnostics.py",
      "path": "test_diagnostics.py",
      "summary": "Test Infrastructure TODO #20: Test Diagnostics Enhancement",
      "mechanism": "capture_io decorator wraps tests with stdout/stderr capture returning (result, stdout, stderr, exc); format_test_failure builds rich reports with source lookup, stack trace, and reproduction steps; module_tests aggregates granular assertions via TestSuite with run_comprehensive_tests wiring for CI.",
      "quality": "beta",
      "concerns": [
        "capture_io assumes the wrapped test returns a truthy bool, so suites returning non-bool data get coerced into False and flagged.",
        "format_test_failure uses inspect.getsourcelines which can throw for dynamically defined functions or lambdas, partially caught but still noisy.",
        "No structured logging/export yetreports only surface via stdout; integration with prompt_telemetry or Logs folder missing."
      ],
      "opportunities": [
        "Emit JSON diagnostics alongside human-readable output so analytics tooling can ingest failures.",
        "Attach captured stdout/stderr to telemetry events in run_all_tests for easier triage.",
        "Support async tests or context managers by allowing capture_io to accept *args/**kwargs and propagate."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Decorator and reporter imported by other suites; ensure circular imports handled by local TestSuite import pattern."
    },
    {
      "id": "file:test_examples/example_basic_test.py",
      "type": "file",
      "name": "test_examples/example_basic_test.py",
      "path": "test_examples/example_basic_test.py",
      "summary": "Example: Basic Test Pattern",
      "mechanism": "Defines toy functions (add_numbers, is_even, reverse_string) and demonstrates TestSuite usage via module_tests with create_standard_test_runner wiring for educational purposes.",
      "quality": "reference",
      "concerns": [
        "Examples live under test_examples but still import test_framework at runtime; accidental modifications could affect newcomers copying patterns.",
        "sys.path injection assumes repository layout, which can break when vendored elsewhere."
      ],
      "opportunities": [
        "Link from CONTRIBUTING.md to showcase standard test style for new modules.",
        "Add docstrings explaining TestSuite expectations (return True/False) for clarity."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Primarily instructional; no production dependencies."
    },
    {
      "id": "file:test_examples/example_error_handling_test.py",
      "type": "file",
      "name": "test_examples/example_error_handling_test.py",
      "path": "test_examples/example_error_handling_test.py",
      "summary": "Example: Error Handling Test Pattern",
      "mechanism": "Defines ValidationError plus helpers (validate_age, divide_numbers, parse_year) and demonstrates TestSuite-driven coverage of success/error paths, raising and inspecting exceptions with create_standard_test_runner wiring for hands-on guidance.",
      "quality": "reference",
      "concerns": [
        "Educational module still executes real guardrails (parse_year) that mirror production folders; duplication may drift from canonical logic.",
        "sys.path mutation replicates pattern from other examplesshould be kept in sync if repo layout changes."
      ],
      "opportunities": [
        "Link from onboarding docs to highlight how to assert on message content and chained exceptions.",
        "Add fixtures demonstrating capture_io usage alongside error assertions."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Pure example code; not invoked by automation beyond teaching harness."
    },
    {
      "id": "file:tree_stats_utils.py",
      "type": "file",
      "name": "tree_stats_utils.py",
      "path": "tree_stats_utils.py",
      "summary": "tree_stats_utils.py - Tree Statistics and Ethnicity Analysis",
      "mechanism": "Validates profile ownership via Person lookup/session_utils, aggregates DNA match counts and relationship tiers with SQLAlchemy, computes ethnicity distributions/overlaps, caches results in TreeStatisticsCache with JSON serialization, and exposes calculate_tree_statistics plus calculate_ethnicity_commonality helpers for Action 8 messaging.",
      "quality": "beta",
      "concerns": [
        "Direct session.commit inside utility can clash with caller-managed transactions, risking partial rollbacks.",
        "Ethnicity column discovery inspects table each call; no memoization so repeated invocations hit metadata.",
        "Cache expiration hard-coded at 24h with no invalidation when data changesstats can stale."
      ],
      "opportunities": [
        "Leverage SessionManager db context to reuse transactions and centralize commits.",
        "Memoize ethnicity column list or store in TreeStatisticsCache to avoid inspector churn.",
        "Emit telemetry on cache hits/misses so performance_monitor can observe workload."
      ],
      "tests": "run_comprehensive_tests",
      "notes": "Depends on database.DnaMatch/Person/TreeStatisticsCache models and session_utils.get_global_session; no standalone CLI guard."
    },
    {
      "id": "file:utils.py",
      "type": "file",
      "name": "utils.py",
      "path": "utils.py",
      "summary": "Core utility file bundling session orchestration helpers, rate limiting glue, and shared logging/decorator tooling.",
      "mechanism": "Exposes ApiRequestConfig-driven _api_req implementations, AdaptiveRateLimiter access via get_rate_limiter, cookie/logging formatters, circuit breaker, sleep prevention, and numerous decorators leveraged by SessionManager actions.",
      "quality": "production",
      "concerns": [
        "Sheer size makes refactoring risky; subtle regressions can ripple across actions 6-11.",
        "Several legacy helper aliases remain for backwards compatibility, complicating deprecation efforts.",
        "Manual __main__ TestSuite isn't wired into create_standard_test_runner, so run_all_tests skips it."
      ],
      "opportunities": [
        "Modularize into thematic packages (api_requests, logging_utils, rate_limiting) to simplify imports.",
        "Add telemetry hooks around rate limiter and sleep prevention to capture runtime behavior.",
        "Refactor test harness to export run_comprehensive_tests for consistent CI coverage."
      ],
      "tests": "Manual TestSuite under __main__",
      "notes": "Shared dependency for most modules; relies on config_schema, rate_limiter, session_utils, selenium, and requests."
    },
    {
      "id": "function:observability/metrics_exporter.get_exporter_status",
      "type": "function",
      "name": "get_exporter_status",
      "path": "observability/metrics_exporter.py",
      "summary": "Returns current Prometheus metrics exporter status including host, port, and running state.",
      "mechanism": "Thread-safe check of _EXPORTER_STATE to return dict with host, port, running status if server is active, None otherwise.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add uptime duration and request count statistics."
      ],
      "tests": null,
      "notes": "Added 2025-11-16 to support metrics report display in main menu."
    },
    {
      "id": "function:action9_process_productive._compose_task_body",
      "type": "function",
      "name": "_compose_task_body",
      "path": "action9_process_productive.py",
      "summary": "Builds Microsoft To-Do task body with comprehensive genealogical context including URLs.",
      "mechanism": "Accepts person_name, relationship, shared_dna_cm, importance, due_date, categories, plus new profile_id, uuid, and tree_info parameters. Constructs formatted text with Ancestry profile URL, DNA comparison URL, and tree view links.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add thumbnail images or record previews if MS Graph API supports rich content."
      ],
      "tests": null,
      "notes": "Enhanced 2025-11-16 with profile_id, uuid, tree_info parameters for actionable task context."
    },
    {
      "id": "function:action9_process_productive.PersonProcessor._build_task_body_parts",
      "type": "function",
      "name": "_build_task_body_parts",
      "path": "action9_process_productive.py",
      "summary": "Constructs task body parts array with DNA match and tree information for PersonProcessor.",
      "mechanism": "Builds list with match name, profile ID, Ancestry profile URL, DNA comparison URL (from person.dna_match.compare_link or constructed from UUID), relationship, shared DNA, tree status, tree person ID (CFPID), name in tree, tree view link, and tree relationship.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add validation for URL construction to handle edge cases."
      ],
      "tests": null,
      "notes": "Enhanced 2025-11-16 to include comprehensive match context with direct links to Ancestry resources."
    },
    {
      "id": "function:action9_process_productive.create_enhanced_research_task",
      "type": "function",
      "name": "create_enhanced_research_task",
      "path": "action9_process_productive.py",
      "summary": "Creates MS To-Do task with intelligent priority, due date, and enhanced context.",
      "mechanism": "Accepts person_name, relationship, shared_dna_cm, categories, plus new profile_id, uuid, tree_info parameters. Builds payload via _build_enhanced_task_payload and submits via _submit_enhanced_task.",
      "quality": "stable",
      "concerns": [],
      "opportunities": [
        "Add task templates for common genealogical research scenarios."
      ],
      "tests": null,
      "notes": "Enhanced 2025-11-16 with extended signature to pass profile_id, uuid, tree_info through call chain."
    }
  ],
  "edges": [
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._check_venv",
      "type": "defines",
      "description": "Defines interactive venv guard"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._check_and_use_venv",
      "type": "defines",
      "description": "Defines auto re-run venv helper"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._fix_trailing_whitespace",
      "type": "defines",
      "description": "Defines trailing whitespace fixer"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._invoke_ruff",
      "type": "defines",
      "description": "Defines Ruff invocation helper"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._ruff_available",
      "type": "defines",
      "description": "Defines Ruff availability probe"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._print_tail",
      "type": "defines",
      "description": "Defines tail printer for command output"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._print_nonempty_lines",
      "type": "defines",
      "description": "Defines non-empty line printer"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._should_skip_system_file",
      "type": "defines",
      "description": "Defines system file skip filter"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._should_skip_cache_or_temp_file",
      "type": "defines",
      "description": "Defines cache/temp file exclusion logic"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._should_skip_demo_file",
      "type": "defines",
      "description": "Defines demo file exclusion helper"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._should_skip_interactive_file",
      "type": "defines",
      "description": "Defines interactive module exclusion helper"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._has_test_function",
      "type": "defines",
      "description": "Defines standardized test hook detector"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests.discover_test_modules",
      "type": "defines",
      "description": "Defines project-wide test discovery"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._should_skip_line",
      "type": "defines",
      "description": "Defines docstring line skip predicate"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._extract_docstring_start",
      "type": "defines",
      "description": "Defines docstring start extractor"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._extract_docstring_end",
      "type": "defines",
      "description": "Defines docstring end extractor"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._parse_docstring_lines",
      "type": "defines",
      "description": "Defines docstring parser"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._is_valid_description_line",
      "type": "defines",
      "description": "Defines docstring line validator"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._clean_description_text",
      "type": "defines",
      "description": "Defines description cleanup helper"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._extract_first_meaningful_line",
      "type": "defines",
      "description": "Defines docstring line selector"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests.extract_module_description",
      "type": "defines",
      "description": "Defines module description extractor"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._generate_module_description",
      "type": "defines",
      "description": "Defines fallback description generator"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._try_pattern_passed_failed",
      "type": "defines",
      "description": "Defines emoji pass/fail pattern parser"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._try_pattern_tests_passed",
      "type": "defines",
      "description": "Defines ratio tests-passed pattern parser"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._try_pattern_passed_failed_ansi",
      "type": "defines",
      "description": "Defines ANSI-safe emoji pattern parser"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._try_pattern_unittest_ran",
      "type": "defines",
      "description": "Defines unittest Ran-tests pattern parser"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._try_pattern_numbered_tests",
      "type": "defines",
      "description": "Defines numbered test heading parser"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._try_pattern_number_followed_by_test",
      "type": "defines",
      "description": "Defines generic number tests pattern parser"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._try_pattern_all_tests_completed",
      "type": "defines",
      "description": "Defines all-tests-completed pattern parser"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._try_pattern_all_tests_passed_with_counts",
      "type": "defines",
      "description": "Defines ALL TESTS PASSED banner parser"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._extract_count_from_line",
      "type": "defines",
      "description": "Defines keyword-based count extractor"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._find_passed_failed_counts",
      "type": "defines",
      "description": "Defines passed/failed counter finder"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._try_pattern_passed_failed_counts_any",
      "type": "defines",
      "description": "Defines fallback passed/failed counter aggregator"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._check_for_failures_in_output",
      "type": "defines",
      "description": "Defines stdout failure indicator checker"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests.save_performance_metrics",
      "type": "defines",
      "description": "Defines performance metrics persistence helper"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests.analyze_performance_trends",
      "type": "defines",
      "description": "Defines performance suggestion analyzer"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "class:run_all_tests.TestExecutionMetrics",
      "type": "defines",
      "description": "Declares per-module metrics dataclass"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "class:run_all_tests.TestSuitePerformance",
      "type": "defines",
      "description": "Declares aggregate suite metrics dataclass"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "class:run_all_tests.TestExecutionConfig",
      "type": "defines",
      "description": "Declares execution config dataclass"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "class:run_all_tests.PerformanceMetricsConfig",
      "type": "defines",
      "description": "Declares performance printing config dataclass"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "class:run_all_tests.TestResultCache",
      "type": "defines",
      "description": "Declares optional test result cache manager"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests.optimize_test_order",
      "type": "defines",
      "description": "Defines smart test ordering helper"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests.update_test_history",
      "type": "defines",
      "description": "Defines test history persistence helper"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "class:run_all_tests.PerformanceMonitor",
      "type": "defines",
      "description": "Defines psutil-backed performance sampler"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._build_test_command",
      "type": "defines",
      "description": "Defines subprocess command builder"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._run_quality_analysis",
      "type": "defines",
      "description": "Defines code quality analysis wrapper"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._create_test_metrics",
      "type": "defines",
      "description": "Defines metrics creation helper"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._create_error_metrics",
      "type": "defines",
      "description": "Defines fallback metrics factory"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._run_test_subprocess",
      "type": "defines",
      "description": "Defines subprocess executor"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._analyze_test_output",
      "type": "defines",
      "description": "Defines test output analyzer"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._print_test_result",
      "type": "defines",
      "description": "Defines per-module result printer"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._print_quality_violations",
      "type": "defines",
      "description": "Defines quality violation reporter"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._format_quality_info",
      "type": "defines",
      "description": "Defines quality info formatter"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._categorize_violation",
      "type": "defines",
      "description": "Defines violation category classifier"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._format_violation_message",
      "type": "defines",
      "description": "Defines violation message formatter"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._print_failure_details",
      "type": "defines",
      "description": "Defines failure detail printer"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._extract_numeric_test_count",
      "type": "defines",
      "description": "Defines numeric test count extractor"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._extract_test_count_from_output",
      "type": "defines",
      "description": "Defines test count string extractor"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests.main",
      "type": "defines",
      "description": "Declares comprehensive test runner entry point"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._setup_test_environment",
      "type": "defines",
      "description": "Defines CLI and environment setup helper"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._print_test_header",
      "type": "defines",
      "description": "Defines suite banner formatter"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._run_pre_test_checks",
      "type": "defines",
      "description": "Defines pre-run lint guard"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests.run_linter",
      "type": "defines",
      "description": "Defines Ruff enforcement wrapper"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests.run_quality_checks",
      "type": "defines",
      "description": "Defines curated quality score aggregator"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._discover_and_prepare_modules",
      "type": "defines",
      "description": "Defines discovery and description pipeline"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._execute_tests",
      "type": "defines",
      "description": "Defines execution strategy selector"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests.run_module_tests",
      "type": "defines",
      "description": "Defines module test runner"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests.run_tests_parallel",
      "type": "defines",
      "description": "Defines parallel execution helper"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._print_basic_summary",
      "type": "defines",
      "description": "Defines basic result summary printer"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._print_performance_metrics",
      "type": "defines",
      "description": "Defines performance metrics reporter"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._print_final_results",
      "type": "defines",
      "description": "Defines category breakdown summary"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._print_final_quality_summary",
      "type": "defines",
      "description": "Defines quality score aggregator"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests.analyze_application_logs",
      "type": "defines",
      "description": "Defines log analysis routine"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests.format_log_analysis",
      "type": "defines",
      "description": "Defines log analysis formatter"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests.print_log_analysis",
      "type": "defines",
      "description": "Defines log analysis printer"
    },
    {
      "source": "function:run_all_tests.main",
      "target": "function:run_all_tests._setup_test_environment",
      "type": "calls",
      "description": "Parses CLI flags and environment toggles"
    },
    {
      "source": "function:run_all_tests.main",
      "target": "function:run_all_tests._print_test_header",
      "type": "calls",
      "description": "Outputs execution banner"
    },
    {
      "source": "function:run_all_tests.main",
      "target": "function:run_all_tests._run_pre_test_checks",
      "type": "calls",
      "description": "Runs pre-test lint guard"
    },
    {
      "source": "function:run_all_tests.main",
      "target": "function:run_all_tests._discover_and_prepare_modules",
      "type": "calls",
      "description": "Discovers eligible test modules"
    },
    {
      "source": "function:run_all_tests.main",
      "target": "function:run_all_tests._execute_tests",
      "type": "calls",
      "description": "Executes modules sequentially or in parallel"
    },
    {
      "source": "function:run_all_tests.main",
      "target": "function:run_all_tests._print_basic_summary",
      "type": "calls",
      "description": "Prints high-level results"
    },
    {
      "source": "function:run_all_tests.main",
      "target": "function:run_all_tests._print_performance_metrics",
      "type": "calls",
      "description": "Reports performance metrics when monitoring"
    },
    {
      "source": "function:run_all_tests._print_performance_metrics",
      "target": "function:run_all_tests.analyze_performance_trends",
      "type": "calls",
      "description": "Generates human-readable performance insights"
    },
    {
      "source": "function:run_all_tests._print_performance_metrics",
      "target": "function:run_all_tests.save_performance_metrics",
      "type": "calls",
      "description": "Persists metrics snapshot to history file"
    },
    {
      "source": "function:run_all_tests._print_performance_metrics",
      "target": "class:run_all_tests.TestSuitePerformance",
      "type": "instantiates",
      "description": "Aggregates run telemetry into suite-level dataclass"
    },
    {
      "source": "function:run_all_tests.main",
      "target": "function:run_all_tests._print_final_results",
      "type": "calls",
      "description": "Displays category breakdown and failures"
    },
    {
      "source": "function:run_all_tests.main",
      "target": "function:run_all_tests._print_final_quality_summary",
      "type": "calls",
      "description": "Summarizes quality scores"
    },
    {
      "source": "function:run_all_tests.main",
      "target": "function:run_all_tests.print_log_analysis",
      "type": "calls",
      "description": "Outputs optional log analysis"
    },
    {
      "source": "function:run_all_tests.main",
      "target": "function:run_all_tests._fix_trailing_whitespace",
      "type": "calls",
      "description": "Performs pre-run whitespace cleanup"
    },
    {
      "source": "function:run_all_tests.main",
      "target": "class:run_all_tests.TestExecutionConfig",
      "type": "instantiates",
      "description": "Packages execution parameters for _execute_tests"
    },
    {
      "source": "function:run_all_tests.main",
      "target": "class:run_all_tests.PerformanceMetricsConfig",
      "type": "instantiates",
      "description": "Bundles metrics for performance reporting"
    },
    {
      "source": "function:run_all_tests.main",
      "target": "class:run_all_tests.TestSuitePerformance",
      "type": "instantiates",
      "description": "Constructs suite performance summary before persistence"
    },
    {
      "source": "function:run_all_tests._discover_and_prepare_modules",
      "target": "function:run_all_tests.discover_test_modules",
      "type": "calls",
      "description": "Gathers eligible module paths via filesystem scan"
    },
    {
      "source": "function:run_all_tests._discover_and_prepare_modules",
      "target": "function:run_all_tests.optimize_test_order",
      "type": "calls",
      "description": "Reorders modules for fast feedback when --fast flag set"
    },
    {
      "source": "function:run_all_tests._discover_and_prepare_modules",
      "target": "function:run_all_tests.extract_module_description",
      "type": "calls",
      "description": "Derives module docstring descriptions for reporting"
    },
    {
      "source": "function:run_all_tests._run_pre_test_checks",
      "target": "function:run_all_tests.run_linter",
      "type": "calls",
      "description": "Invokes Ruff enforcement"
    },
    {
      "source": "function:run_all_tests._execute_tests",
      "target": "function:run_all_tests.run_tests_parallel",
      "type": "calls",
      "description": "Delegates to parallel executor when fast mode enabled"
    },
    {
      "source": "function:run_all_tests._execute_tests",
      "target": "function:run_all_tests.run_module_tests",
      "type": "calls",
      "description": "Runs modules sequentially when fast mode disabled"
    },
    {
      "source": "function:run_all_tests._execute_tests",
      "target": "function:run_all_tests.update_test_history",
      "type": "calls",
      "description": "Persists sequential execution metrics for future ordering"
    },
    {
      "source": "function:run_all_tests.run_tests_parallel",
      "target": "function:run_all_tests.run_module_tests",
      "type": "calls",
      "description": "Executes module tests within worker threads"
    },
    {
      "source": "function:run_all_tests.print_log_analysis",
      "target": "function:run_all_tests.analyze_application_logs",
      "type": "calls",
      "description": "Collects structured log metrics"
    },
    {
      "source": "function:run_all_tests.print_log_analysis",
      "target": "function:run_all_tests.format_log_analysis",
      "type": "calls",
      "description": "Formats log metrics for display"
    },
    {
      "source": "function:run_all_tests.run_module_tests",
      "target": "function:run_all_tests._generate_module_description",
      "type": "calls",
      "description": "Synthesizes fallback module descriptions"
    },
    {
      "source": "function:run_all_tests.run_module_tests",
      "target": "class:run_all_tests.PerformanceMonitor",
      "type": "uses",
      "description": "Starts and stops performance monitoring when enabled"
    },
    {
      "source": "function:run_all_tests.run_module_tests",
      "target": "function:run_all_tests._run_test_subprocess",
      "type": "calls",
      "description": "Executes module tests in subprocess"
    },
    {
      "source": "function:run_all_tests.run_module_tests",
      "target": "function:run_all_tests._run_quality_analysis",
      "type": "calls",
      "description": "Collects QualityMetrics for reporting"
    },
    {
      "source": "function:run_all_tests.run_module_tests",
      "target": "function:run_all_tests._analyze_test_output",
      "type": "calls",
      "description": "Interprets subprocess output into success status"
    },
    {
      "source": "function:run_all_tests.run_module_tests",
      "target": "function:run_all_tests._print_test_result",
      "type": "calls",
      "description": "Prints per-module summary"
    },
    {
      "source": "function:run_all_tests.run_module_tests",
      "target": "function:run_all_tests._create_test_metrics",
      "type": "calls",
      "description": "Builds TestExecutionMetrics records"
    },
    {
      "source": "function:run_all_tests.run_module_tests",
      "target": "function:run_all_tests._create_error_metrics",
      "type": "calls",
      "description": "Generates fallback metrics when subprocess fails"
    },
    {
      "source": "function:run_all_tests._run_test_subprocess",
      "target": "function:run_all_tests._build_test_command",
      "type": "calls",
      "description": "Constructs subprocess command and environment"
    },
    {
      "source": "function:run_all_tests._analyze_test_output",
      "target": "function:run_all_tests._extract_test_count_from_output",
      "type": "calls",
      "description": "Derives textual test counts"
    },
    {
      "source": "function:run_all_tests._analyze_test_output",
      "target": "function:run_all_tests._extract_numeric_test_count",
      "type": "calls",
      "description": "Converts test count text into integers"
    },
    {
      "source": "function:run_all_tests._analyze_test_output",
      "target": "function:run_all_tests._check_for_failures_in_output",
      "type": "calls",
      "description": "Double-checks stdout for hidden failure indicators"
    },
    {
      "source": "function:run_all_tests._extract_test_count_from_output",
      "target": "function:run_all_tests._try_pattern_passed_failed",
      "type": "calls",
      "description": "Checks emoji pass/fail summary lines"
    },
    {
      "source": "function:run_all_tests._extract_test_count_from_output",
      "target": "function:run_all_tests._try_pattern_tests_passed",
      "type": "calls",
      "description": "Parses X/Y tests passed ratios"
    },
    {
      "source": "function:run_all_tests._extract_test_count_from_output",
      "target": "function:run_all_tests._try_pattern_passed_failed_ansi",
      "type": "calls",
      "description": "Handles colorized emoji pass/fail summaries"
    },
    {
      "source": "function:run_all_tests._extract_test_count_from_output",
      "target": "function:run_all_tests._try_pattern_unittest_ran",
      "type": "calls",
      "description": "Matches unittest 'Ran X tests' lines"
    },
    {
      "source": "function:run_all_tests._extract_test_count_from_output",
      "target": "function:run_all_tests._try_pattern_numbered_tests",
      "type": "calls",
      "description": "Counts enumerated test headings"
    },
    {
      "source": "function:run_all_tests._extract_test_count_from_output",
      "target": "function:run_all_tests._try_pattern_number_followed_by_test",
      "type": "calls",
      "description": "Finds generic '<n> tests' phrases"
    },
    {
      "source": "function:run_all_tests._extract_test_count_from_output",
      "target": "function:run_all_tests._try_pattern_all_tests_completed",
      "type": "calls",
      "description": "Matches 'All tests completed' summaries"
    },
    {
      "source": "function:run_all_tests._extract_test_count_from_output",
      "target": "function:run_all_tests._try_pattern_all_tests_passed_with_counts",
      "type": "calls",
      "description": "Handles uppercase pass banners with counts"
    },
    {
      "source": "function:run_all_tests._extract_test_count_from_output",
      "target": "function:run_all_tests._try_pattern_passed_failed_counts_any",
      "type": "calls",
      "description": "Falls back to summing Passed:/Failed: totals"
    },
    {
      "source": "function:run_all_tests._try_pattern_passed_failed_counts_any",
      "target": "function:run_all_tests._find_passed_failed_counts",
      "type": "calls",
      "description": "Retrieves explicit Passed:/Failed: counters"
    },
    {
      "source": "function:run_all_tests._find_passed_failed_counts",
      "target": "function:run_all_tests._extract_count_from_line",
      "type": "calls",
      "description": "Extracts numeric values for passed/failed keywords"
    },
    {
      "source": "function:run_all_tests._print_test_result",
      "target": "function:run_all_tests._format_quality_info",
      "type": "calls",
      "description": "Formats quality suffix"
    },
    {
      "source": "function:run_all_tests._print_test_result",
      "target": "function:run_all_tests._print_quality_violations",
      "type": "calls",
      "description": "Displays code quality issues when present"
    },
    {
      "source": "function:run_all_tests._print_test_result",
      "target": "function:run_all_tests._print_failure_details",
      "type": "calls",
      "description": "Outputs failure lines for debugging"
    },
    {
      "source": "function:run_all_tests._print_quality_violations",
      "target": "function:run_all_tests._categorize_violation",
      "type": "calls",
      "description": "Buckets violations into display categories"
    },
    {
      "source": "function:run_all_tests._print_quality_violations",
      "target": "function:run_all_tests._format_violation_message",
      "type": "calls",
      "description": "Formats individual violation bullet lines"
    },
    {
      "source": "function:run_all_tests._create_test_metrics",
      "target": "class:run_all_tests.TestExecutionMetrics",
      "type": "instantiates",
      "description": "Constructs metrics dataclass for successful modules"
    },
    {
      "source": "function:run_all_tests._create_error_metrics",
      "target": "class:run_all_tests.TestExecutionMetrics",
      "type": "instantiates",
      "description": "Builds failure metrics dataclass entry"
    },
    {
      "source": "function:run_all_tests.run_linter",
      "target": "function:run_all_tests._ruff_available",
      "type": "calls",
      "description": "Skips lint when Ruff unavailable"
    },
    {
      "source": "function:run_all_tests.run_linter",
      "target": "function:run_all_tests._invoke_ruff",
      "type": "calls",
      "description": "Executes Ruff commands for auto-fix and blocking checks"
    },
    {
      "source": "function:run_all_tests.run_linter",
      "target": "function:run_all_tests._print_tail",
      "type": "calls",
      "description": "Shows trailing Ruff diagnostics on failure"
    },
    {
      "source": "function:run_all_tests.run_linter",
      "target": "function:run_all_tests._print_nonempty_lines",
      "type": "calls",
      "description": "Prints summary statistics for non-blocking diagnostics"
    },
    {
      "source": "function:run_all_tests._ruff_available",
      "target": "function:run_all_tests._invoke_ruff",
      "type": "calls",
      "description": "Runs ruff --version to detect CLI availability"
    },
    {
      "source": "function:run_all_tests.discover_test_modules",
      "target": "function:run_all_tests._should_skip_system_file",
      "type": "calls",
      "description": "Skips runner and system modules"
    },
    {
      "source": "function:run_all_tests.discover_test_modules",
      "target": "function:run_all_tests._should_skip_cache_or_temp_file",
      "type": "calls",
      "description": "Filters cache, temp, and venv files"
    },
    {
      "source": "function:run_all_tests.discover_test_modules",
      "target": "function:run_all_tests._should_skip_demo_file",
      "type": "calls",
      "description": "Filters demo or prototype scripts"
    },
    {
      "source": "function:run_all_tests.discover_test_modules",
      "target": "function:run_all_tests._should_skip_interactive_file",
      "type": "calls",
      "description": "Avoids interactive-only utilities"
    },
    {
      "source": "function:run_all_tests.discover_test_modules",
      "target": "function:run_all_tests._has_test_function",
      "type": "calls",
      "description": "Checks for standardized test hook"
    },
    {
      "source": "function:run_all_tests.extract_module_description",
      "target": "function:run_all_tests._parse_docstring_lines",
      "type": "calls",
      "description": "Parses module docstring content"
    },
    {
      "source": "function:run_all_tests.extract_module_description",
      "target": "function:run_all_tests._extract_first_meaningful_line",
      "type": "calls",
      "description": "Selects docstring description line"
    },
    {
      "source": "function:run_all_tests._parse_docstring_lines",
      "target": "function:run_all_tests._should_skip_line",
      "type": "calls",
      "description": "Skips comments and blank lines while scanning"
    },
    {
      "source": "function:run_all_tests._parse_docstring_lines",
      "target": "function:run_all_tests._extract_docstring_start",
      "type": "calls",
      "description": "Detects docstring opening"
    },
    {
      "source": "function:run_all_tests._parse_docstring_lines",
      "target": "function:run_all_tests._extract_docstring_end",
      "type": "calls",
      "description": "Detects docstring closing"
    },
    {
      "source": "function:run_all_tests._extract_first_meaningful_line",
      "target": "function:run_all_tests._is_valid_description_line",
      "type": "calls",
      "description": "Validates docstring line content"
    },
    {
      "source": "function:run_all_tests._extract_first_meaningful_line",
      "target": "function:run_all_tests._clean_description_text",
      "type": "calls",
      "description": "Cleans redundant module name fragments"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._check_venv",
      "type": "calls",
      "description": "Executes interactive venv warning at import"
    },
    {
      "source": "file:run_all_tests.py",
      "target": "function:run_all_tests._check_and_use_venv",
      "type": "calls",
      "description": "Reruns script with .venv interpreter when needed"
    },
    {
      "source": "file:main.py",
      "target": "function:main.exec_actn",
      "type": "defines",
      "description": "main.py declares exec_actn dispatcher"
    },
    {
      "source": "file:main.py",
      "target": "function:main.all_but_first_actn",
      "type": "defines",
      "description": "Action 0 implementation"
    },
    {
      "source": "file:main.py",
      "target": "function:main.run_core_workflow_action",
      "type": "defines",
      "description": "Action 1 workflow implementation"
    },
    {
      "source": "file:main.py",
      "target": "function:main.reset_db_actn",
      "type": "defines",
      "description": "Action 2 reset implementation"
    },
    {
      "source": "file:action7_inbox.py",
      "target": "class:action7_inbox.InboxProcessor",
      "type": "defines",
      "description": "Declares inbox automation orchestrator"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._analyze_follow_up_requirements",
      "type": "defines",
      "description": "Provides follow-up payload heuristic helper"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "class:core.session_manager.SessionManager",
      "type": "depends-on",
      "description": "Requires SessionManager for rate limiter access and profile metadata"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._extract_follow_up_requirements",
      "type": "defines",
      "description": "Main entry point for follow-up payload extraction"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._process_follow_up_result",
      "type": "defines",
      "description": "Normalizes heuristic output and schedules due dates"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._default_follow_up_payload",
      "type": "defines",
      "description": "Provides fallback payload structure"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._determine_follow_up_window",
      "type": "defines",
      "description": "Maps sentiment/direction to due-day window"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._determine_pending_items",
      "type": "defines",
      "description": "Identifies pending questions in latest message"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._derive_follow_up_reason",
      "type": "defines",
      "description": "Offers textual rationale for follow-up"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._build_reminder_details",
      "type": "defines",
      "description": "Constructs reminder title and body"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._calculate_urgency_level",
      "type": "defines",
      "description": "Computes follow-up urgency tier"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._build_follow_up_history",
      "type": "defines",
      "description": "Prepares conversation transcript for heuristics"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._should_skip_follow_up",
      "type": "defines",
      "description": "Guards follow-up processing for non-actionable states"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._calculate_task_importance",
      "type": "defines",
      "description": "Ranks reminder importance using DNA & engagement metrics"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._create_follow_up_reminder_task",
      "type": "defines",
      "description": "Integrates with MS To-Do for reminder creation"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._determine_conversation_phase",
      "type": "defines",
      "description": "Calculates conversation lifecycle phase"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._process_in_message",
      "type": "defines",
      "description": "Handles inbound conversation processing"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._process_out_message",
      "type": "defines",
      "description": "Handles outbound conversation processing"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._create_conversation_log_upsert",
      "type": "defines",
      "description": "Builds conversation log payload"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._update_person_status_from_ai",
      "type": "defines",
      "description": "Updates person status based on AI sentiment"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._get_db_timestamp_for_comparison",
      "type": "defines",
      "description": "Fetches cached DB timestamps for comparison"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._commit_batch_updates",
      "type": "defines",
      "description": "Commits batched conversation updates"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._handle_exception_with_save",
      "type": "defines",
      "description": "Attempts final save on exception"
    },
    {
      "source": "class:action7_inbox.InboxProcessor",
      "target": "function:action7_inbox.InboxProcessor._check_cancellation_requested",
      "type": "defines",
      "description": "Checks cooperative cancellation flag"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._create_follow_up_reminder_task",
      "target": "function:action7_inbox.InboxProcessor._calculate_task_importance",
      "type": "calls",
      "description": "Determines task importance before sending payload to MS Graph"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._extract_follow_up_requirements",
      "target": "function:action7_inbox.InboxProcessor._should_skip_follow_up",
      "type": "calls",
      "description": "Skips follow-up extraction when sentiment or phase indicates no action"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._extract_follow_up_requirements",
      "target": "function:action7_inbox.InboxProcessor._build_follow_up_history",
      "type": "calls",
      "description": "Generates condensed transcript for heuristic analysis"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._extract_follow_up_requirements",
      "target": "function:action7_inbox.InboxProcessor._analyze_follow_up_requirements",
      "type": "calls",
      "description": "Delegates to heuristic analyzer for payload construction"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._extract_follow_up_requirements",
      "target": "function:action7_inbox.InboxProcessor._process_follow_up_result",
      "type": "calls",
      "description": "Normalizes heuristic output into final payload"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._extract_follow_up_requirements",
      "target": "function:action7_inbox.InboxProcessor._default_follow_up_payload",
      "type": "calls",
      "description": "Provides fallback when heuristics skipped or error encountered"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._analyze_follow_up_requirements",
      "target": "function:action7_inbox.InboxProcessor._determine_pending_items",
      "type": "calls",
      "description": "Identifies unanswered questions to include in payload"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._analyze_follow_up_requirements",
      "target": "function:action7_inbox.InboxProcessor._derive_follow_up_reason",
      "type": "calls",
      "description": "Provides textual explanation for follow-up"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._analyze_follow_up_requirements",
      "target": "function:action7_inbox.InboxProcessor._build_reminder_details",
      "type": "calls",
      "description": "Builds reminder summary and body"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._analyze_follow_up_requirements",
      "target": "function:action7_inbox.InboxProcessor._calculate_urgency_level",
      "type": "calls",
      "description": "Assigns urgency level based on sentiment/direction"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._analyze_follow_up_requirements",
      "target": "function:action7_inbox.InboxProcessor._determine_follow_up_window",
      "type": "calls",
      "description": "Determines days until follow-up due"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._process_follow_up_result",
      "target": "function:action7_inbox.InboxProcessor._default_follow_up_payload",
      "type": "calls",
      "description": "Falls back to default payload when structure invalid"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._process_in_message",
      "target": "function:action7_inbox.InboxProcessor._get_db_timestamp_for_comparison",
      "type": "calls",
      "description": "Compares API timestamp against cached DB record"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._process_in_message",
      "target": "function:action7_inbox.InboxProcessor._determine_conversation_phase",
      "type": "calls",
      "description": "Derives conversation phase for inbound message"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._process_in_message",
      "target": "function:action7_inbox.InboxProcessor._extract_follow_up_requirements",
      "type": "calls",
      "description": "Generates follow-up payload from inbound message context"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._process_in_message",
      "target": "function:action7_inbox.InboxProcessor._create_conversation_log_upsert",
      "type": "calls",
      "description": "Builds upsert payload for inbound log"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._process_in_message",
      "target": "function:action7_inbox.InboxProcessor._create_follow_up_reminder_task",
      "type": "calls",
      "description": "Creates reminder task when follow-up required"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._process_in_message",
      "target": "function:action7_inbox.InboxProcessor._update_person_status_from_ai",
      "type": "calls",
      "description": "Updates person status dictionary based on AI sentiment"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._process_out_message",
      "target": "function:action7_inbox.InboxProcessor._get_db_timestamp_for_comparison",
      "type": "calls",
      "description": "Checks DB timestamp before logging outbound message"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._process_out_message",
      "target": "function:action7_inbox.InboxProcessor._determine_conversation_phase",
      "type": "calls",
      "description": "Calculates phase for outbound message"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._process_out_message",
      "target": "function:action7_inbox.InboxProcessor._create_conversation_log_upsert",
      "type": "calls",
      "description": "Builds upsert payload for outbound log"
    },
    {
      "source": "function:action7_inbox.InboxProcessor._commit_batch_updates",
      "target": "function:action7_inbox.InboxProcessor._create_conversation_log_upsert",
      "type": "uses",
      "description": "Commits payloads generated earlier in pipeline"
    },
    {
      "source": "file:action8_messaging.py",
      "target": "function:action8_messaging.send_messages_to_matches",
      "type": "defines",
      "description": "Declares Action 8 orchestration entry point"
    },
    {
      "source": "file:action8_messaging.py",
      "target": "function:action8_messaging._execute_main_processing_loop",
      "type": "defines",
      "description": "Defines wrapper for main processing loop"
    },
    {
      "source": "file:action8_messaging.py",
      "target": "function:action8_messaging._process_all_candidates",
      "type": "defines",
      "description": "Defines candidate iteration logic"
    },
    {
      "source": "file:action8_messaging.py",
      "target": "function:action8_messaging._process_single_candidate_iteration",
      "type": "defines",
      "description": "Defines per-person processing routine"
    },
    {
      "source": "file:action8_messaging.py",
      "target": "function:action8_messaging._handle_main_processing_exception",
      "type": "defines",
      "description": "Defines top-level exception handler"
    },
    {
      "source": "file:action8_messaging.py",
      "target": "function:action8_messaging._process_single_person",
      "type": "defines",
      "description": "Defines per-person messaging pipeline"
    },
    {
      "source": "file:action8_messaging.py",
      "target": "function:action8_messaging._handle_person_status",
      "type": "defines",
      "description": "Defines status-based dispatch helper"
    },
    {
      "source": "file:action8_messaging.py",
      "target": "function:action8_messaging._determine_message_to_send",
      "type": "defines",
      "description": "Defines message sequencing helper"
    },
    {
      "source": "file:action8_messaging.py",
      "target": "function:action8_messaging._check_message_interval",
      "type": "defines",
      "description": "Defines adaptive interval guard"
    },
    {
      "source": "file:action8_messaging.py",
      "target": "function:action8_messaging._check_mode_filtering",
      "type": "defines",
      "description": "Defines mode-based recipient filter"
    },
    {
      "source": "file:action8_messaging.py",
      "target": "function:action8_messaging._send_or_simulate_message",
      "type": "defines",
      "description": "Defines send/simulate helper"
    },
    {
      "source": "file:action8_messaging.py",
      "target": "function:action8_messaging._prepare_conversation_log_entry",
      "type": "defines",
      "description": "Defines log preparation helper"
    },
    {
      "source": "file:action8_messaging.py",
      "target": "function:action8_messaging._determine_final_status",
      "type": "defines",
      "description": "Defines outcome normalization helper"
    },
    {
      "source": "file:action8_messaging.py",
      "target": "function:action8_messaging._update_counters_and_collect_data",
      "type": "defines",
      "description": "Defines counter aggregation helper"
    },
    {
      "source": "function:action8_messaging.send_messages_to_matches",
      "target": "function:action8_messaging._validate_action8_prerequisites",
      "type": "calls",
      "description": "Ensures prerequisites satisfied before processing"
    },
    {
      "source": "function:action8_messaging.send_messages_to_matches",
      "target": "function:action8_messaging._initialize_action8_counters_and_config",
      "type": "calls",
      "description": "Initializes counters and default configuration values"
    },
    {
      "source": "function:action8_messaging.send_messages_to_matches",
      "target": "function:action8_messaging._initialize_resource_management",
      "type": "calls",
      "description": "Prepares resource manager, log buffers, and error categorizer"
    },
    {
      "source": "function:action8_messaging.send_messages_to_matches",
      "target": "function:action8_messaging._fetch_messaging_data",
      "type": "calls",
      "description": "Retrieves template map and candidate list from DB"
    },
    {
      "source": "function:action8_messaging.send_messages_to_matches",
      "target": "function:action8_messaging._execute_main_processing_loop",
      "type": "calls",
      "description": "Runs main candidate processing loop"
    },
    {
      "source": "function:action8_messaging.send_messages_to_matches",
      "target": "function:action8_messaging._perform_final_commit",
      "type": "calls",
      "description": "Commits pending logs and updates after loop"
    },
    {
      "source": "function:action8_messaging.send_messages_to_matches",
      "target": "function:action8_messaging._handle_main_processing_exception",
      "type": "calls",
      "description": "Maps fatal exceptions to overall success flag"
    },
    {
      "source": "function:action8_messaging.send_messages_to_matches",
      "target": "function:action8_messaging._perform_final_cleanup",
      "type": "calls",
      "description": "Performs cleanup of sessions, progress bars, analytics"
    },
    {
      "source": "function:action8_messaging.send_messages_to_matches",
      "target": "function:action8_messaging._perform_resource_cleanup",
      "type": "calls",
      "description": "Invokes final resource release on manager"
    },
    {
      "source": "function:action8_messaging.send_messages_to_matches",
      "target": "function:action8_messaging._log_performance_summary",
      "type": "calls",
      "description": "Logs performance telemetry at end of run"
    },
    {
      "source": "function:action8_messaging._execute_main_processing_loop",
      "target": "function:action8_messaging._process_all_candidates",
      "type": "calls",
      "description": "Delegates to candidate iteration pipeline"
    },
    {
      "source": "function:action8_messaging._process_all_candidates",
      "target": "function:action8_messaging._process_single_candidate_iteration",
      "type": "calls",
      "description": "Processes each person sequentially"
    },
    {
      "source": "function:action8_messaging._process_single_candidate_iteration",
      "target": "function:action8_messaging._check_message_send_limit",
      "type": "calls",
      "description": "Applies per-run send limit before proceeding"
    },
    {
      "source": "function:action8_messaging._process_single_candidate_iteration",
      "target": "function:action8_messaging._check_halt_signal",
      "type": "calls",
      "description": "Aborts when session death cascade detected"
    },
    {
      "source": "function:action8_messaging._process_single_candidate_iteration",
      "target": "function:action8_messaging._log_periodic_progress",
      "type": "calls",
      "description": "Logs periodic processing metrics"
    },
    {
      "source": "function:action8_messaging._process_single_candidate_iteration",
      "target": "function:action8_messaging._get_person_message_history",
      "type": "calls",
      "description": "Prefetches latest in/out conversation logs"
    },
    {
      "source": "function:action8_messaging._process_single_candidate_iteration",
      "target": "function:action8_messaging._process_single_person",
      "type": "calls",
      "description": "Executes per-person messaging pipeline"
    },
    {
      "source": "function:action8_messaging._process_single_candidate_iteration",
      "target": "function:action8_messaging._log_message_creation_debug",
      "type": "calls",
      "description": "Logs template usage for debugging"
    },
    {
      "source": "function:action8_messaging._process_single_candidate_iteration",
      "target": "function:action8_messaging._update_messaging_performance",
      "type": "calls",
      "description": "Feeds duration into performance monitor"
    },
    {
      "source": "function:action8_messaging._process_single_candidate_iteration",
      "target": "function:action8_messaging._update_counters_and_collect_data",
      "type": "calls",
      "description": "Updates counters and batch buffers"
    },
    {
      "source": "function:action8_messaging._process_single_candidate_iteration",
      "target": "function:action8_messaging._handle_batch_commit_if_needed",
      "type": "calls",
      "description": "Triggers batch commit when thresholds hit"
    },
    {
      "source": "function:action8_messaging._process_single_person",
      "target": "function:action8_messaging._check_halt_signal",
      "type": "calls",
      "description": "Aborts processing when global halt set"
    },
    {
      "source": "function:action8_messaging._process_single_person",
      "target": "function:action8_messaging._initialize_person_processing",
      "type": "calls",
      "description": "Derives log prefix and identifiers"
    },
    {
      "source": "function:action8_messaging._process_single_person",
      "target": "function:action8_messaging._check_person_eligibility",
      "type": "calls",
      "description": "Skips non-eligible statuses"
    },
    {
      "source": "function:action8_messaging._process_single_person",
      "target": "function:action8_messaging._handle_person_status",
      "type": "calls",
      "description": "Branches based on person status"
    },
    {
      "source": "function:action8_messaging._process_single_person",
      "target": "function:action8_messaging._prepare_message_format_data",
      "type": "calls",
      "description": "Builds template formatting context"
    },
    {
      "source": "function:action8_messaging._process_single_person",
      "target": "function:action8_messaging._format_message_text",
      "type": "calls",
      "description": "Formats message using template or personalizer"
    },
    {
      "source": "function:action8_messaging._process_single_person",
      "target": "function:action8_messaging._check_mode_filtering",
      "type": "calls",
      "description": "Applies app-mode send filters"
    },
    {
      "source": "function:action8_messaging._process_single_person",
      "target": "function:action8_messaging._get_existing_conversation_id",
      "type": "calls",
      "description": "Determines conversation context"
    },
    {
      "source": "function:action8_messaging._process_single_person",
      "target": "function:action8_messaging._send_or_simulate_message",
      "type": "calls",
      "description": "Executes send or simulation"
    },
    {
      "source": "function:action8_messaging._process_single_person",
      "target": "function:action8_messaging._prepare_conversation_log_entry",
      "type": "calls",
      "description": "Creates outbound log object"
    },
    {
      "source": "function:action8_messaging._process_single_person",
      "target": "function:action8_messaging._determine_final_status",
      "type": "calls",
      "description": "Maps API outcome to counters"
    },
    {
      "source": "function:action8_messaging._handle_person_status",
      "target": "function:action8_messaging._handle_desist_status",
      "type": "calls",
      "description": "Handles DESIST acknowledgement workflow"
    },
    {
      "source": "function:action8_messaging._handle_person_status",
      "target": "function:action8_messaging._check_reply_received",
      "type": "calls",
      "description": "Skips when recipient already replied"
    },
    {
      "source": "function:action8_messaging._handle_person_status",
      "target": "function:action8_messaging._check_message_interval",
      "type": "calls",
      "description": "Enforces send interval for ACTIVE matches"
    },
    {
      "source": "function:action8_messaging._handle_person_status",
      "target": "function:action8_messaging._determine_message_to_send",
      "type": "calls",
      "description": "Selects next template in sequence"
    },
    {
      "source": "function:action8_messaging._determine_message_to_send",
      "target": "function:action8_messaging._get_last_script_message_details",
      "type": "calls",
      "description": "Retrieves last script message metadata"
    },
    {
      "source": "function:action8_messaging._determine_message_to_send",
      "target": "function:action8_messaging.determine_next_message_type",
      "type": "calls",
      "description": "Computes base template key"
    },
    {
      "source": "function:action8_messaging._determine_message_to_send",
      "target": "function:action8_messaging.select_template_variant_ab_testing",
      "type": "calls",
      "description": "Applies A/B testing variant"
    },
    {
      "source": "function:action8_messaging._determine_message_to_send",
      "target": "function:action8_messaging.select_template_by_confidence",
      "type": "calls",
      "description": "Uses confidence heuristics when needed"
    },
    {
      "source": "function:action8_messaging._determine_message_to_send",
      "target": "function:action8_messaging.track_template_selection",
      "type": "calls",
      "description": "Logs selection telemetry"
    },
    {
      "source": "function:action8_messaging._check_message_interval",
      "target": "function:action8_messaging.calculate_adaptive_interval",
      "type": "calls",
      "description": "Calculates engagement-based interval extension"
    },
    {
      "source": "function:action8_messaging._send_or_simulate_message",
      "target": "function:action8_messaging._safe_api_call_with_validation",
      "type": "calls",
      "description": "Wraps API send with validation"
    },
    {
      "source": "function:action8_messaging._update_counters_and_collect_data",
      "target": "function:action8_messaging._prepare_log_dict",
      "type": "calls",
      "description": "Converts log objects for batching"
    },
    {
      "source": "function:action8_messaging._update_counters_and_collect_data",
      "target": "function:action8_messaging._handle_sent_status",
      "type": "calls",
      "description": "Increments sent counter and queues log"
    },
    {
      "source": "function:action8_messaging._update_counters_and_collect_data",
      "target": "function:action8_messaging._handle_acked_status",
      "type": "calls",
      "description": "Processes desist acknowledgement outcomes"
    },
    {
      "source": "function:action8_messaging._update_counters_and_collect_data",
      "target": "function:action8_messaging._handle_error_or_skip_status",
      "type": "calls",
      "description": "Classifies skips and errors"
    },
    {
      "source": "function:action8_messaging._process_all_candidates",
      "target": "function:action8_messaging._handle_critical_db_error",
      "type": "calls",
      "description": "Adjusts counters when DB commit fails"
    },
    {
      "source": "function:action8_messaging._process_all_candidates",
      "target": "function:action8_messaging._check_and_handle_browser_health",
      "type": "calls",
      "description": "Ensures browser session remains healthy"
    },
    {
      "source": "function:action8_messaging._process_single_candidate_iteration",
      "target": "function:action8_messaging._create_result_dict",
      "type": "calls",
      "description": "Packages iteration outcomes for caller"
    },
    {
      "source": "function:action8_messaging._handle_batch_commit_if_needed",
      "target": "function:action8_messaging._calculate_batch_memory",
      "type": "calls",
      "description": "Computes batch size metrics"
    },
    {
      "source": "function:action8_messaging._handle_batch_commit_if_needed",
      "target": "function:action8_messaging._should_commit_batch",
      "type": "calls",
      "description": "Determines whether commit thresholds met"
    },
    {
      "source": "function:action8_messaging._handle_batch_commit_if_needed",
      "target": "function:action8_messaging._perform_batch_commit",
      "type": "calls",
      "description": "Commits batch when required"
    },
    {
      "source": "function:action8_messaging._perform_batch_commit",
      "target": "function:action8_messaging._safe_commit_with_rollback",
      "type": "calls",
      "description": "Executes transactional commit with rollback"
    },
    {
      "source": "function:action8_messaging._perform_final_commit",
      "target": "function:action8_messaging._safe_commit_with_rollback",
      "type": "calls",
      "description": "Flushes remaining work using rollback-safe commit"
    },
    {
      "source": "function:action8_messaging._perform_final_cleanup",
      "target": "function:action8_messaging._log_final_summary",
      "type": "calls",
      "description": "Logs final run statistics"
    },
    {
      "source": "function:action8_messaging._prepare_message_format_data",
      "target": "function:action8_messaging._add_tree_statistics_to_format_data",
      "type": "calls",
      "description": "Augments format data with tree stats"
    },
    {
      "source": "function:action8_messaging._prepare_log_dict",
      "target": "function:action8_messaging._convert_log_object_to_dict",
      "type": "calls",
      "description": "Serializes log ORM object"
    },
    {
      "source": "function:action8_messaging._determine_message_to_send",
      "target": "function:action8_messaging.track_template_selection",
      "type": "calls",
      "description": "Records template selection telemetry"
    },
    {
      "source": "function:action8_messaging._prepare_message_format_data",
      "target": "function:action8_messaging._get_best_name_for_person",
      "type": "calls",
      "description": "Selects preferred display name"
    },
    {
      "source": "function:action8_messaging._prepare_message_format_data",
      "target": "function:action8_messaging._format_predicted_relationship",
      "type": "calls",
      "description": "Normalizes predicted relationship text"
    },
    {
      "source": "function:action8_messaging._prepare_message_format_data",
      "target": "function:action8_messaging._format_ethnicity_text",
      "type": "calls",
      "description": "Generates human-readable ethnicity summary"
    },
    {
      "source": "function:action8_messaging._fetch_messaging_data",
      "target": "function:action8_messaging._get_simple_messaging_data",
      "type": "calls",
      "description": "Loads template map and candidates"
    },
    {
      "source": "file:action6_gather.py",
      "target": "workflow:action6_gather.coord",
      "type": "defines",
      "description": "Declares Action 6 coordinator workflow"
    },
    {
      "source": "file:action6_gather.py",
      "target": "function:action6_gather._validate_session_state",
      "type": "defines",
      "description": "Provides session readiness guard"
    },
    {
      "source": "file:action6_gather.py",
      "target": "function:action6_gather._handle_initial_fetch",
      "type": "defines",
      "description": "Initial page fetch handler"
    },
    {
      "source": "file:action6_gather.py",
      "target": "function:action6_gather._main_page_processing_loop",
      "type": "defines",
      "description": "Main page processing loop"
    },
    {
      "source": "file:action6_gather.py",
      "target": "function:action6_gather._process_single_page",
      "type": "defines",
      "description": "Single page processing routine"
    },
    {
      "source": "file:action6_gather.py",
      "target": "function:action6_gather._log_final_results",
      "type": "defines",
      "description": "Final metrics logger"
    },
    {
      "source": "file:action6_gather.py",
      "target": "function:action6_gather._emit_final_summary",
      "type": "defines",
      "description": "Final summary formatter"
    },
    {
      "source": "file:action6_gather.py",
      "target": "function:action6_gather._emit_action_status",
      "type": "defines",
      "description": "Action status logger"
    },
    {
      "source": "file:action6_gather.py",
      "target": "class:action6_gather.PageProcessingMetrics",
      "type": "defines",
      "description": "Metrics accumulator class"
    },
    {
      "source": "workflow:action6_gather.coord",
      "target": "function:action6_gather._validate_session_state",
      "type": "calls",
      "description": "Ensures session readiness before gathering"
    },
    {
      "source": "workflow:action6_gather.coord",
      "target": "function:action6_gather._handle_initial_fetch",
      "type": "calls",
      "description": "Performs initial navigation and page range setup"
    },
    {
      "source": "workflow:action6_gather.coord",
      "target": "function:action6_gather._main_page_processing_loop",
      "type": "calls",
      "description": "Iterates through DNA match pages"
    },
    {
      "source": "workflow:action6_gather.coord",
      "target": "function:action6_gather._log_final_results",
      "type": "calls",
      "description": "Emits final Action 6 metrics and status"
    },
    {
      "source": "function:action6_gather._process_single_page",
      "target": "function:action6_gather._handle_page_fetch_and_validation",
      "type": "calls",
      "description": "Retrieves page matches and control flags"
    },
    {
      "source": "function:action6_gather._process_single_page",
      "target": "function:action6_gather._try_fast_skip_page",
      "type": "calls",
      "description": "Attempts fast skip when all matches unchanged"
    },
    {
      "source": "function:action6_gather._process_single_page",
      "target": "function:action6_gather._do_batch",
      "type": "calls",
      "description": "Delegates batching when processing is required"
    },
    {
      "source": "function:action6_gather._validate_session_state",
      "target": "class:core.session_manager.SessionManager",
      "type": "depends-on",
      "description": "Interrogates SessionManager for driver and UUID state"
    },
    {
      "source": "function:action6_gather._main_page_processing_loop",
      "target": "function:action6_gather._process_single_page",
      "type": "calls",
      "description": "Processes each page sequentially"
    },
    {
      "source": "function:action6_gather._process_single_page",
      "target": "class:action6_gather.PageProcessingMetrics",
      "type": "uses",
      "description": "Consumes metrics returned from batch processing"
    },
    {
      "source": "function:action6_gather._handle_page_fetch_and_validation",
      "target": "function:action6_gather._get_database_session_with_retry",
      "type": "calls",
      "description": "Requests DB session with bounded retries"
    },
    {
      "source": "function:action6_gather._handle_page_fetch_and_validation",
      "target": "function:action6_gather._fetch_page_matches",
      "type": "calls",
      "description": "Invokes page fetch routine once session acquired"
    },
    {
      "source": "function:action6_gather._get_database_session_with_retry",
      "target": "class:core.session_manager.SessionManager",
      "type": "depends-on",
      "description": "Relies on SessionManager connection leasing"
    },
    {
      "source": "function:action6_gather._try_fast_skip_page",
      "target": "function:action6_gather._lookup_existing_persons",
      "type": "calls",
      "description": "Loads existing records to compare against list view"
    },
    {
      "source": "function:action6_gather._try_fast_skip_page",
      "target": "function:action6_gather._identify_fetch_candidates",
      "type": "calls",
      "description": "Determines whether API refresh is needed"
    },
    {
      "source": "function:action6_gather._do_batch",
      "target": "function:action6_gather._process_page_matches",
      "type": "calls",
      "description": "Uses single-batch path when within threshold"
    },
    {
      "source": "function:action6_gather._do_batch",
      "target": "function:action6_gather._process_batches_for_page",
      "type": "calls",
      "description": "Splits large pages into adaptive batches"
    },
    {
      "source": "function:action6_gather._process_batches_for_page",
      "target": "function:action6_gather._execute_single_batch",
      "type": "calls",
      "description": "Executes each batch sequentially"
    },
    {
      "source": "function:action6_gather._execute_single_batch",
      "target": "function:action6_gather._process_page_matches",
      "type": "calls",
      "description": "Defers to core page processing pipeline"
    },
    {
      "source": "function:action6_gather._process_batch_lookups",
      "target": "function:action6_gather._lookup_existing_persons",
      "type": "calls",
      "description": "Queries persistence for existing matches"
    },
    {
      "source": "function:action6_gather._process_batch_lookups",
      "target": "function:action6_gather._identify_fetch_candidates",
      "type": "calls",
      "description": "Evaluates which UUIDs need enrichment"
    },
    {
      "source": "function:action6_gather._process_page_matches",
      "target": "function:action6_gather._process_batch_lookups",
      "type": "calls",
      "description": "Starts pipeline with DB lookups"
    },
    {
      "source": "function:action6_gather._process_page_matches",
      "target": "function:action6_gather._perform_batch_api_prefetches",
      "type": "calls",
      "description": "Performs sequential API prefetch layer"
    },
    {
      "source": "function:action6_gather._process_page_matches",
      "target": "function:action6_gather._prepare_and_commit_batch_data",
      "type": "calls",
      "description": "Persists prepared batch data"
    },
    {
      "source": "function:action6_gather._prepare_and_commit_batch_data",
      "target": "function:action6_gather._prepare_bulk_db_data",
      "type": "calls",
      "description": "Builds bulk payloads from prefetched matches"
    },
    {
      "source": "function:action6_gather._prepare_and_commit_batch_data",
      "target": "function:action6_gather._execute_batch_db_commit",
      "type": "calls",
      "description": "Executes transactional commit for prepared data"
    },
    {
      "source": "function:action6_gather._execute_batch_db_commit",
      "target": "function:action6_gather._execute_bulk_db_operations",
      "type": "calls",
      "description": "Runs bulk insert/update pipeline within transaction"
    },
    {
      "source": "function:action6_gather._prepare_bulk_db_data",
      "target": "function:action6_gather._process_single_match_for_bulk",
      "type": "calls",
      "description": "Processes each candidate match into payload"
    },
    {
      "source": "function:action6_gather._prepare_bulk_db_data",
      "target": "function:action6_gather._handle_match_processing_result",
      "type": "calls",
      "description": "Collects per-match outcomes into bulk list"
    },
    {
      "source": "function:action6_gather._handle_match_processing_result",
      "target": "function:action6_gather._update_page_statuses",
      "type": "calls",
      "description": "Updates counters for match outcome"
    },
    {
      "source": "function:action6_gather._process_single_match_for_bulk",
      "target": "function:action6_gather._get_prefetched_data_for_match",
      "type": "calls",
      "description": "Loads prefetched payloads for match"
    },
    {
      "source": "function:action6_gather._process_single_match_for_bulk",
      "target": "function:action6_gather._do_match",
      "type": "calls",
      "description": "Delegates decision logic per match"
    },
    {
      "source": "function:action6_gather._execute_bulk_db_operations",
      "target": "function:action6_gather._separate_bulk_operations",
      "type": "calls",
      "description": "Splits prepared payloads by table and operation"
    },
    {
      "source": "function:action6_gather._execute_bulk_db_operations",
      "target": "function:action6_gather._process_person_creates",
      "type": "calls",
      "description": "Handles person create operations"
    },
    {
      "source": "function:action6_gather._execute_bulk_db_operations",
      "target": "function:action6_gather._process_person_updates",
      "type": "calls",
      "description": "Applies person updates"
    },
    {
      "source": "function:action6_gather._execute_bulk_db_operations",
      "target": "function:action6_gather._create_master_id_map",
      "type": "calls",
      "description": "Builds UUID to ID map for downstream ops"
    },
    {
      "source": "function:action6_gather._execute_bulk_db_operations",
      "target": "function:action6_gather._process_dna_match_operations",
      "type": "calls",
      "description": "Processes DNA match inserts and updates"
    },
    {
      "source": "function:action6_gather._execute_bulk_db_operations",
      "target": "function:action6_gather._process_family_tree_operations",
      "type": "calls",
      "description": "Applies family tree operations"
    },
    {
      "source": "function:action6_gather._execute_bulk_db_operations",
      "target": "function:action6_gather._handle_integrity_error_recovery",
      "type": "calls",
      "description": "Invokes recovery routine on person insert conflicts"
    },
    {
      "source": "function:action6_gather._process_person_creates",
      "target": "function:action6_gather._deduplicate_person_creates",
      "type": "calls",
      "description": "Removes duplicate create operations"
    },
    {
      "source": "function:action6_gather._process_person_creates",
      "target": "function:action6_gather._prepare_person_insert_data",
      "type": "calls",
      "description": "Normalizes person create payloads"
    },
    {
      "source": "function:action6_gather._process_person_creates",
      "target": "function:action6_gather._validate_no_duplicate_profile_ids",
      "type": "calls",
      "description": "Ensures profile IDs unique before insert"
    },
    {
      "source": "function:action6_gather._process_person_creates",
      "target": "function:action6_gather._get_person_id_mapping",
      "type": "calls",
      "description": "Queries database for new person IDs"
    },
    {
      "source": "function:action6_gather._prepare_person_insert_data",
      "target": "function:action6_gather._check_existing_records",
      "type": "calls",
      "description": "Loads existing profile IDs and UUIDs"
    },
    {
      "source": "function:action6_gather._prepare_person_insert_data",
      "target": "function:action6_gather._should_skip_person_insert",
      "type": "calls",
      "description": "Determines whether to skip duplicate person"
    },
    {
      "source": "function:action6_gather._prepare_person_insert_data",
      "target": "function:action6_gather._convert_status_enums",
      "type": "calls",
      "description": "Normalizes enum fields for insertion"
    },
    {
      "source": "function:action6_gather._check_existing_records",
      "target": "function:action6_gather._check_existing_profile_ids",
      "type": "calls",
      "description": "Queries database for profile ID collisions"
    },
    {
      "source": "function:action6_gather._check_existing_records",
      "target": "function:action6_gather._check_existing_uuids",
      "type": "calls",
      "description": "Queries database for UUID collisions"
    },
    {
      "source": "function:action6_gather._process_person_updates",
      "target": "function:action6_gather._build_person_update_dict",
      "type": "calls",
      "description": "Constructs update mappings for SQLAlchemy"
    },
    {
      "source": "function:action6_gather._create_master_id_map",
      "target": "function:action6_gather._add_update_ids_to_map",
      "type": "calls",
      "description": "Adds update IDs to master mapping"
    },
    {
      "source": "function:action6_gather._create_master_id_map",
      "target": "function:action6_gather._add_existing_ids_to_map",
      "type": "calls",
      "description": "Includes existing person IDs in map"
    },
    {
      "source": "function:action6_gather._process_dna_match_operations",
      "target": "function:action6_gather._classify_dna_match_operations",
      "type": "calls",
      "description": "Splits DNA work into insert vs update"
    },
    {
      "source": "function:action6_gather._process_dna_match_operations",
      "target": "function:action6_gather._bulk_insert_dna_matches",
      "type": "calls",
      "description": "Performs DNA bulk inserts"
    },
    {
      "source": "function:action6_gather._process_dna_match_operations",
      "target": "function:action6_gather._bulk_update_dna_matches",
      "type": "calls",
      "description": "Performs DNA bulk updates"
    },
    {
      "source": "function:action6_gather._classify_dna_match_operations",
      "target": "function:action6_gather._get_existing_dna_matches",
      "type": "calls",
      "description": "Fetches existing DnaMatch rows for comparison"
    },
    {
      "source": "function:action6_gather._classify_dna_match_operations",
      "target": "function:action6_gather._resolve_person_id",
      "type": "calls",
      "description": "Resolves person IDs for DNA operations"
    },
    {
      "source": "function:action6_gather._classify_dna_match_operations",
      "target": "function:action6_gather._prepare_dna_match_data",
      "type": "calls",
      "description": "Builds normalized DNA payloads"
    },
    {
      "source": "function:action6_gather._bulk_insert_dna_matches",
      "target": "function:action6_gather._apply_ethnicity_data",
      "type": "calls",
      "description": "Applies ethnicity columns after insert"
    },
    {
      "source": "function:action6_gather._bulk_update_dna_matches",
      "target": "function:action6_gather._separate_core_and_ethnicity",
      "type": "calls",
      "description": "Splits core and ethnicity fields"
    },
    {
      "source": "function:action6_gather._bulk_update_dna_matches",
      "target": "function:action6_gather._apply_ethnicity_data",
      "type": "calls",
      "description": "Applies ethnicity columns after update"
    },
    {
      "source": "function:action6_gather._process_family_tree_operations",
      "target": "function:action6_gather._prepare_family_tree_inserts",
      "type": "calls",
      "description": "Builds family tree insert payloads"
    },
    {
      "source": "function:action6_gather._process_family_tree_operations",
      "target": "function:action6_gather._prepare_family_tree_updates",
      "type": "calls",
      "description": "Builds family tree update mappings"
    },
    {
      "source": "function:action6_gather._prepare_family_tree_inserts",
      "target": "function:action6_gather._resolve_person_id",
      "type": "calls",
      "description": "Looks up person IDs for family tree inserts"
    },
    {
      "source": "function:action6_gather._perform_batch_api_prefetches",
      "target": "function:action6_gather._perform_api_prefetches",
      "type": "calls",
      "description": "Executes underlying API call loop"
    },
    {
      "source": "function:action6_gather._perform_api_prefetches",
      "target": "function:action6_gather._prepare_prefetch_plan",
      "type": "calls",
      "description": "Builds plan describing candidates and counters"
    },
    {
      "source": "function:action6_gather._perform_api_prefetches",
      "target": "function:action6_gather._enforce_session_health_for_prefetch",
      "type": "calls",
      "description": "Verifies session remains healthy during loop"
    },
    {
      "source": "function:action6_gather._perform_api_prefetches",
      "target": "function:action6_gather._prefetch_combined_details",
      "type": "calls",
      "description": "Fetches combined match details per UUID"
    },
    {
      "source": "function:action6_gather._perform_api_prefetches",
      "target": "function:action6_gather._prefetch_relationship_probability",
      "type": "calls",
      "description": "Attempts relationship probability enrichment"
    },
    {
      "source": "function:action6_gather._perform_api_prefetches",
      "target": "function:action6_gather._prefetch_badge_metadata",
      "type": "calls",
      "description": "Prefetches badge metadata when applicable"
    },
    {
      "source": "function:action6_gather._perform_api_prefetches",
      "target": "function:action6_gather._prefetch_ethnicity_data",
      "type": "calls",
      "description": "Fetches ethnicity info for prioritized matches"
    },
    {
      "source": "function:action6_gather._perform_api_prefetches",
      "target": "function:action6_gather._log_prefetch_progress",
      "type": "calls",
      "description": "Logs progress milestones across candidates"
    },
    {
      "source": "function:action6_gather._perform_api_prefetches",
      "target": "function:action6_gather._fetch_ladder_details_for_badges",
      "type": "calls",
      "description": "Enriches badge results with ladder data"
    },
    {
      "source": "function:action6_gather._perform_api_prefetches",
      "target": "function:action6_gather._log_prefetch_summary",
      "type": "calls",
      "description": "Emits final prefetch telemetry summary"
    },
    {
      "source": "function:action6_gather._prepare_prefetch_plan",
      "target": "function:action6_gather._identify_badge_candidates",
      "type": "calls",
      "description": "Derives badge candidate UUIDs"
    },
    {
      "source": "function:action6_gather._prepare_prefetch_plan",
      "target": "function:action6_gather._classify_match_priorities",
      "type": "calls",
      "description": "Segments matches into priority tiers"
    },
    {
      "source": "function:action6_gather._prepare_prefetch_plan",
      "target": "function:action6_gather._limit_relationship_probability_requests",
      "type": "calls",
      "description": "Trims medium-priority relationship requests"
    },
    {
      "source": "function:action6_gather._prepare_prefetch_plan",
      "target": "function:action6_gather._determine_ethnicity_candidates",
      "type": "calls",
      "description": "Identifies matches needing ethnicity enrichment"
    },
    {
      "source": "function:action6_gather._determine_ethnicity_candidates",
      "target": "function:action6_gather._match_requires_ethnicity_refresh",
      "type": "calls",
      "description": "Checks refresh flags for each candidate"
    },
    {
      "source": "function:action6_gather._determine_ethnicity_candidates",
      "target": "function:action6_gather._is_below_ethnicity_threshold",
      "type": "calls",
      "description": "Applies cM threshold filter"
    },
    {
      "source": "function:action6_gather._determine_ethnicity_candidates",
      "target": "function:action6_gather._log_ethnicity_skip_counts",
      "type": "calls",
      "description": "Logs why candidates were skipped"
    },
    {
      "source": "function:action6_gather._prefetch_combined_details",
      "target": "function:action6_gather._handle_combined_details_fetch",
      "type": "calls",
      "description": "Wraps combined detail fetch with error handling"
    },
    {
      "source": "function:action6_gather._prefetch_relationship_probability",
      "target": "function:action6_gather._fetch_optional_relationship_data",
      "type": "calls",
      "description": "Fetches relationship probability when prioritized"
    },
    {
      "source": "function:action6_gather._prefetch_badge_metadata",
      "target": "function:action6_gather._fetch_optional_badge_data",
      "type": "calls",
      "description": "Loads badge data for tree members"
    },
    {
      "source": "function:action6_gather._prefetch_ethnicity_data",
      "target": "function:action6_gather._process_ethnicity_candidate",
      "type": "calls",
      "description": "Delegates ethnicity API enrichment"
    },
    {
      "source": "function:action6_gather._fetch_ladder_details_for_badges",
      "target": "function:action6_gather._build_cfpid_mapping",
      "type": "calls",
      "description": "Derives CFPID lookups prior to ladder fetch"
    },
    {
      "source": "function:action6_gather._log_final_results",
      "target": "function:action6_gather._emit_final_summary",
      "type": "calls",
      "description": "Delegates final summary logging"
    },
    {
      "source": "function:action6_gather._log_final_results",
      "target": "function:action6_gather._emit_action_status",
      "type": "calls",
      "description": "Delegates action status logging"
    },
    {
      "source": "function:main.exec_actn",
      "target": "class:core.session_manager.SessionManager",
      "type": "depends-on",
      "description": "exec_actn ensures required session state via SessionManager",
      "quality": "stable"
    },
    {
      "source": "function:main.exec_actn",
      "target": "module:analytics",
      "type": "uses",
      "description": "Logs action events to analytics subsystem",
      "quality": "monitor"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main.gather_dna_matches",
      "type": "dispatches",
      "description": "exec_actn invokes action wrappers such as gather_dna_matches"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main.srch_inbox_actn",
      "type": "dispatches",
      "description": "exec_actn handles Action 7 wrapper"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main.send_messages_action",
      "type": "dispatches",
      "description": "exec_actn handles Action 8 wrapper"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main.process_productive_messages_action",
      "type": "dispatches",
      "description": "exec_actn handles Action 9 wrapper"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main.run_gedcom_then_api_fallback",
      "type": "dispatches",
      "description": "exec_actn invokes GEDCOM/API comparison action"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main.check_login_actn",
      "type": "dispatches",
      "description": "exec_actn invokes login check action"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main.reset_db_actn",
      "type": "dispatches",
      "description": "exec_actn handles database reset action"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main.backup_db_actn",
      "type": "dispatches",
      "description": "exec_actn runs backup action"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main.restore_db_actn",
      "type": "dispatches",
      "description": "exec_actn runs restore action"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main.all_but_first_actn",
      "type": "dispatches",
      "description": "exec_actn runs Action 0 deletion"
    },
    {
      "source": "function:main.run_core_workflow_action",
      "target": "function:main._run_action6_gather",
      "type": "calls",
      "description": "Workflow optionally triggers Action 6 helper"
    },
    {
      "source": "function:main.run_core_workflow_action",
      "target": "function:main._run_action7_inbox",
      "type": "calls",
      "description": "Workflow orchestrates Action 7"
    },
    {
      "source": "function:main.run_core_workflow_action",
      "target": "function:main._run_action8_send_messages",
      "type": "calls",
      "description": "Workflow orchestrates Action 8"
    },
    {
      "source": "function:main.run_core_workflow_action",
      "target": "function:main._run_action9_process_productive",
      "type": "calls",
      "description": "Workflow orchestrates Action 9"
    },
    {
      "source": "function:main.main",
      "target": "function:main._initialize_application",
      "type": "calls",
      "description": "main() bootstraps application"
    },
    {
      "source": "function:main.main",
      "target": "function:main._pre_authenticate_session",
      "type": "calls",
      "description": "main() pre-authenticates global session"
    },
    {
      "source": "function:main.main",
      "target": "function:main._dispatch_menu_action",
      "type": "calls",
      "description": "main() dispatches menu selection"
    },
    {
      "source": "function:main._initialize_application",
      "target": "function:utils.prevent_system_sleep",
      "type": "calls",
      "description": "Startup flow attempts to keep host awake for long runs"
    },
    {
      "source": "function:main.main",
      "target": "function:utils.restore_system_sleep",
      "type": "calls",
      "description": "main() restores system sleep state during shutdown"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager.ensure_session_ready",
      "type": "defines",
      "description": "Method ensures readiness before actions"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager.start_sess",
      "type": "defines",
      "description": "Method starts DB/browser resources"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager.get_cookies",
      "type": "defines",
      "description": "Method waits for driver cookies"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager._sync_cookies_to_requests",
      "type": "defines",
      "description": "Method syncs cookies to requests session"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager.check_session_health",
      "type": "defines",
      "description": "Method monitors session health"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager.restart_sess",
      "type": "defines",
      "description": "Method restarts session resources"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager.validate_system_health",
      "type": "defines",
      "description": "Method validates overall system health"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager.check_cascade_before_operation",
      "type": "defines",
      "description": "Method guards against session death cascades"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager.close_sess",
      "type": "defines",
      "description": "Method closes session resources"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager._force_session_restart",
      "type": "defines",
      "description": "Method performs force restart"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager.get_csrf",
      "type": "defines",
      "description": "Method retrieves CSRF token"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager.get_my_profileId",
      "type": "defines",
      "description": "Method retrieves profile ID"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager.get_my_uuid",
      "type": "defines",
      "description": "Method retrieves user UUID"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager.get_my_tree_id",
      "type": "defines",
      "description": "Method retrieves tree ID"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager.get_tree_owner",
      "type": "defines",
      "description": "Method retrieves tree owner"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager._check_cached_readiness",
      "type": "defines",
      "description": "Method validates cached readiness state before expensive checks"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager._initialize_rate_limiter",
      "type": "defines",
      "description": "Method binds adaptive rate limiter using configuration"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager._build_endpoint_profile_config",
      "type": "defines",
      "description": "Method normalizes endpoint throttle profiles"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "method:SessionManager._calculate_endpoint_rate_cap",
      "type": "defines",
      "description": "Method derives rate cap from endpoint profiles"
    },
    {
      "source": "class:core.session_manager.APICallWatchdog",
      "target": "method:SessionManager._force_session_restart",
      "type": "invokes",
      "description": "Watchdog triggers force restart callback on timeout",
      "quality": "monitor"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "module:core.error_handling",
      "type": "depends-on",
      "description": "SessionManager relies on error_handling decorators for readiness, retries, and timeouts"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "class:core.browser_manager.BrowserManager",
      "type": "depends-on",
      "description": "SessionManager coordinates BrowserManager lifecycle"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "class:core.database_manager.DatabaseManager",
      "type": "depends-on",
      "description": "SessionManager owns DatabaseManager instance for DB readiness"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "class:core.api_manager.APIManager",
      "type": "depends-on",
      "description": "SessionManager caches and coordinates APIManager"
    },
    {
      "source": "class:core.api_manager.APIManager",
      "target": "method:APIManager.sync_cookies_from_browser",
      "type": "defines",
      "description": "Method syncs cookies from BrowserManager"
    },
    {
      "source": "class:core.api_manager.APIManager",
      "target": "method:APIManager.load_cookies_from_file",
      "type": "defines",
      "description": "Method loads cookies from JSON file"
    },
    {
      "source": "class:core.api_manager.APIManager",
      "target": "method:APIManager.make_api_request",
      "type": "defines",
      "description": "Method performs HTTP request"
    },
    {
      "source": "class:core.api_manager.APIManager",
      "target": "method:APIManager.get_csrf_token",
      "type": "defines",
      "description": "Method retrieves CSRF token"
    },
    {
      "source": "class:core.api_manager.APIManager",
      "target": "method:APIManager.get_profile_id",
      "type": "defines",
      "description": "Method retrieves profile ID"
    },
    {
      "source": "class:core.api_manager.APIManager",
      "target": "method:APIManager.retrieve_all_identifiers",
      "type": "defines",
      "description": "Method retrieves essential identifiers"
    },
    {
      "source": "class:core.api_manager.APIManager",
      "target": "method:APIManager.verify_api_login_status",
      "type": "defines",
      "description": "Method verifies API login"
    },
    {
      "source": "method:APIManager.sync_cookies_from_browser",
      "target": "class:core.session_manager.SessionManager",
      "type": "depends-on",
      "description": "Uses SessionManager for recovery retry",
      "quality": "monitor"
    },
    {
      "source": "method:APIManager.retrieve_all_identifiers",
      "target": "method:SessionManager.get_my_uuid",
      "type": "depends-on",
      "description": "Relies on SessionManager to populate UUID cache",
      "quality": "monitor"
    },
    {
      "source": "class:core.browser_manager.BrowserManager",
      "target": "method:BrowserManager.start_browser",
      "type": "defines",
      "description": "Method boots WebDriver and loads cookies"
    },
    {
      "source": "class:core.browser_manager.BrowserManager",
      "target": "method:BrowserManager._load_saved_cookies",
      "type": "defines",
      "description": "Method attempts to restore saved cookies into active driver"
    },
    {
      "source": "class:core.browser_manager.BrowserManager",
      "target": "method:BrowserManager.close_browser",
      "type": "defines",
      "description": "Method closes WebDriver safely"
    },
    {
      "source": "class:core.browser_manager.BrowserManager",
      "target": "method:BrowserManager.is_session_valid",
      "type": "defines",
      "description": "Method checks driver health"
    },
    {
      "source": "class:core.browser_manager.BrowserManager",
      "target": "method:BrowserManager.ensure_driver_live",
      "type": "defines",
      "description": "Method ensures browser started when required"
    },
    {
      "source": "class:core.browser_manager.BrowserManager",
      "target": "method:BrowserManager.get_cookies",
      "type": "defines",
      "description": "Method waits for required cookies"
    },
    {
      "source": "class:core.browser_manager.BrowserManager",
      "target": "method:BrowserManager.create_new_tab",
      "type": "defines",
      "description": "Method opens additional browser tab"
    },
    {
      "source": "module:core.error_handling",
      "target": "class:core.error_handling.ErrorSeverity",
      "type": "defines",
      "description": "Module exposes error severity enum"
    },
    {
      "source": "module:core.error_handling",
      "target": "class:core.error_handling.RecoveryStrategy",
      "type": "defines",
      "description": "Module exposes recovery strategy enum"
    },
    {
      "source": "module:core.error_handling",
      "target": "class:core.error_handling.ErrorContext",
      "type": "defines",
      "description": "Module defines retry context dataclass"
    },
    {
      "source": "module:core.error_handling",
      "target": "class:core.error_handling.EnhancedErrorRecovery",
      "type": "defines",
      "description": "Module provides global recovery manager"
    },
    {
      "source": "module:core.error_handling",
      "target": "function:core.error_handling.with_enhanced_recovery",
      "type": "defines",
      "description": "Module exports primary retry decorator"
    },
    {
      "source": "module:core.error_handling",
      "target": "function:core.error_handling.with_api_recovery",
      "type": "defines",
      "description": "Module exports API recovery preset"
    },
    {
      "source": "module:core.error_handling",
      "target": "function:core.error_handling.with_database_recovery",
      "type": "defines",
      "description": "Module exports DB recovery preset"
    },
    {
      "source": "module:core.error_handling",
      "target": "function:core.error_handling.with_file_recovery",
      "type": "defines",
      "description": "Module exports file recovery preset"
    },
    {
      "source": "module:core.error_handling",
      "target": "function:core.error_handling.create_user_guidance",
      "type": "defines",
      "description": "Module provides user guidance mapping"
    },
    {
      "source": "module:core.error_handling",
      "target": "function:core.error_handling.handle_partial_success",
      "type": "defines",
      "description": "Module exposes default partial success handler"
    },
    {
      "source": "module:core.error_handling",
      "target": "class:core.error_handling.CircuitBreakerConfig",
      "type": "defines",
      "description": "Module declares circuit breaker configuration"
    },
    {
      "source": "module:core.error_handling",
      "target": "class:core.error_handling.CircuitBreaker",
      "type": "defines",
      "description": "Module implements circuit breaker"
    },
    {
      "source": "module:core.error_handling",
      "target": "class:core.error_handling.RetryConfig",
      "type": "defines",
      "description": "Module exposes retry configuration"
    },
    {
      "source": "module:core.error_handling",
      "target": "class:core.error_handling.AppError",
      "type": "defines",
      "description": "Module defines AppError base"
    },
    {
      "source": "module:core.error_handling",
      "target": "class:core.error_handling.ErrorHandlerRegistry",
      "type": "defines",
      "description": "Module provides error handler registry"
    },
    {
      "source": "module:core.error_handling",
      "target": "class:core.error_handling.ErrorRecoveryManager",
      "type": "defines",
      "description": "Module defines ErrorRecoveryManager"
    },
    {
      "source": "module:core.error_handling",
      "target": "function:core.error_handling.handle_error",
      "type": "defines",
      "description": "Module exports handle_error helper"
    },
    {
      "source": "module:core.error_handling",
      "target": "function:core.error_handling.safe_execute",
      "type": "defines",
      "description": "Module exports safe_execute utility"
    },
    {
      "source": "module:core.error_handling",
      "target": "function:core.error_handling.retry_on_failure",
      "type": "defines",
      "description": "Module exports retry_on_failure decorator"
    },
    {
      "source": "module:core.error_handling",
      "target": "function:core.error_handling.circuit_breaker",
      "type": "defines",
      "description": "Module exports circuit_breaker decorator"
    },
    {
      "source": "module:core.error_handling",
      "target": "function:core.error_handling.timeout_protection",
      "type": "defines",
      "description": "Module exports timeout_protection decorator"
    },
    {
      "source": "module:core.error_handling",
      "target": "function:core.error_handling.graceful_degradation",
      "type": "defines",
      "description": "Module exports graceful_degradation decorator"
    },
    {
      "source": "module:core.error_handling",
      "target": "function:core.error_handling.error_context",
      "type": "defines",
      "description": "Module exports error_context decorator"
    },
    {
      "source": "module:core.error_handling",
      "target": "function:core.error_handling.error_handler",
      "type": "defines",
      "description": "Module exports error_handler decorator"
    },
    {
      "source": "module:core.error_handling",
      "target": "function:core.error_handling.with_circuit_breaker",
      "type": "defines",
      "description": "Module exports with_circuit_breaker decorator"
    },
    {
      "source": "module:core.error_handling",
      "target": "function:core.error_handling.with_recovery",
      "type": "defines",
      "description": "Module exports with_recovery decorator"
    },
    {
      "source": "method:SessionManager._check_cached_readiness",
      "target": "function:core.error_handling.timeout_protection",
      "type": "decorated-with",
      "description": "Readiness cache check enforces 120s timeout guard"
    },
    {
      "source": "method:SessionManager._check_cached_readiness",
      "target": "function:core.error_handling.graceful_degradation",
      "type": "decorated-with",
      "description": "Caching helper falls back to False when degraded"
    },
    {
      "source": "method:SessionManager._check_cached_readiness",
      "target": "function:core.error_handling.error_context",
      "type": "decorated-with",
      "description": "Decorator enriches readiness cache errors with context label"
    },
    {
      "source": "module:core.session_validator",
      "target": "class:core.session_validator.SessionValidator",
      "type": "defines",
      "description": "Module exposes SessionValidator readiness coordinator"
    },
    {
      "source": "class:core.session_validator.SessionValidator",
      "target": "method:SessionValidator.perform_readiness_checks",
      "type": "defines",
      "description": "Class provides readiness orchestration entry point"
    },
    {
      "source": "class:core.session_validator.SessionValidator",
      "target": "method:SessionValidator._perform_all_checks",
      "type": "defines",
      "description": "Class houses internal readiness stage executor"
    },
    {
      "source": "class:core.session_validator.SessionValidator",
      "target": "method:SessionValidator._handle_check_exception",
      "type": "defines",
      "description": "Class exposes exception normalization helper"
    },
    {
      "source": "class:core.session_validator.SessionValidator",
      "target": "method:SessionValidator._check_login_and_attempt_relogin",
      "type": "defines",
      "description": "Class defines login verification helper"
    },
    {
      "source": "class:core.session_validator.SessionValidator",
      "target": "method:SessionValidator._attempt_relogin",
      "type": "defines",
      "description": "Class encapsulates relogin routine"
    },
    {
      "source": "class:core.session_validator.SessionValidator",
      "target": "method:SessionValidator._check_and_handle_url",
      "type": "defines",
      "description": "Class defines URL validation helper"
    },
    {
      "source": "class:core.session_validator.SessionValidator",
      "target": "method:SessionValidator._should_skip_cookie_check",
      "type": "defines",
      "description": "Class declares action skip heuristics"
    },
    {
      "source": "class:core.session_validator.SessionValidator",
      "target": "method:SessionValidator._check_essential_cookies",
      "type": "defines",
      "description": "Class provides essential cookie validator"
    },
    {
      "source": "class:core.session_validator.SessionValidator",
      "target": "method:SessionValidator._sync_cookies_to_requests",
      "type": "defines",
      "description": "Class bridges browser cookies to API session"
    },
    {
      "source": "class:core.session_validator.SessionValidator",
      "target": "method:SessionValidator._check_csrf_token",
      "type": "defines",
      "description": "Class wraps CSRF fetch logic"
    },
    {
      "source": "class:core.session_validator.SessionValidator",
      "target": "method:SessionValidator.validate_session_cookies",
      "type": "defines",
      "description": "Class exposes cookie validation utility"
    },
    {
      "source": "class:core.session_validator.SessionValidator",
      "target": "method:SessionValidator.verify_login_status",
      "type": "defines",
      "description": "Class exposes login verification utility"
    },
    {
      "source": "module:utils",
      "target": "function:utils.log_action_configuration",
      "type": "defines",
      "description": "Module logs configuration dictionaries with consistent formatting"
    },
    {
      "source": "module:utils",
      "target": "function:utils.log_starting_position",
      "type": "defines",
      "description": "Module reports initial processing scope"
    },
    {
      "source": "module:utils",
      "target": "function:utils.log_cumulative_counts",
      "type": "defines",
      "description": "Module outputs cumulative counter summaries"
    },
    {
      "source": "module:utils",
      "target": "function:utils.log_batch_indicator",
      "type": "defines",
      "description": "Module logs batch and page indicators"
    },
    {
      "source": "module:utils",
      "target": "function:utils.create_standard_progress_bar",
      "type": "defines",
      "description": "Module provides standardized tqdm progress bar"
    },
    {
      "source": "module:utils",
      "target": "function:utils.log_page_complete",
      "type": "defines",
      "description": "Module logs per-page completion metrics"
    },
    {
      "source": "module:utils",
      "target": "function:utils.log_final_summary",
      "type": "defines",
      "description": "Module prints final summary banner"
    },
    {
      "source": "module:utils",
      "target": "function:utils.log_action_status",
      "type": "defines",
      "description": "Module emits success/failure status markers"
    },
    {
      "source": "module:utils",
      "target": "function:utils.fast_json_loads",
      "type": "defines",
      "description": "Module exposes fast JSON loader with orjson fallback"
    },
    {
      "source": "module:utils",
      "target": "function:utils.fast_json_dumps",
      "type": "defines",
      "description": "Module exposes fast JSON serializer with orjson fallback"
    },
    {
      "source": "module:utils",
      "target": "function:utils.parse_cookie",
      "type": "defines",
      "description": "Module parses cookie strings into dictionaries"
    },
    {
      "source": "module:utils",
      "target": "function:utils._get_cookie_file_path",
      "type": "defines",
      "description": "Module centralizes login cookie file path"
    },
    {
      "source": "module:utils",
      "target": "function:utils._save_login_cookies",
      "type": "defines",
      "description": "Module persists Selenium cookies to disk"
    },
    {
      "source": "module:utils",
      "target": "function:utils._load_login_cookies",
      "type": "defines",
      "description": "Module restores cookies from persistence into driver"
    },
    {
      "source": "module:utils",
      "target": "function:utils._get_ordinal_suffix",
      "type": "defines",
      "description": "Module supplies ordinal suffix helper"
    },
    {
      "source": "module:utils",
      "target": "function:utils._format_number_as_ordinal",
      "type": "defines",
      "description": "Module formats integers as ordinal strings"
    },
    {
      "source": "module:utils",
      "target": "function:utils._title_case_with_lowercase_particles",
      "type": "defines",
      "description": "Module title-cases text while preserving particles"
    },
    {
      "source": "module:utils",
      "target": "function:utils.ordinal_case",
      "type": "defines",
      "description": "Module normalizes ordinals or title cases text"
    },
    {
      "source": "module:utils",
      "target": "function:utils._remove_gedcom_slashes",
      "type": "defines",
      "description": "Module strips GEDCOM surname markers"
    },
    {
      "source": "module:utils",
      "target": "function:utils._format_quoted_nickname",
      "type": "defines",
      "description": "Module formats quoted nicknames"
    },
    {
      "source": "module:utils",
      "target": "function:utils._format_hyphenated_name",
      "type": "defines",
      "description": "Module formats hyphenated name tokens"
    },
    {
      "source": "module:utils",
      "target": "function:utils._format_apostrophe_name",
      "type": "defines",
      "description": "Module formats apostrophe-containing names"
    },
    {
      "source": "module:utils",
      "target": "function:utils._format_mc_mac_prefix",
      "type": "defines",
      "description": "Module handles Mc/Mac prefixes"
    },
    {
      "source": "module:utils",
      "target": "function:utils._format_initial",
      "type": "defines",
      "description": "Module normalizes initial tokens"
    },
    {
      "source": "module:utils",
      "target": "function:utils._format_name_part",
      "type": "defines",
      "description": "Module orchestrates per-token name formatting"
    },
    {
      "source": "module:utils",
      "target": "function:utils.format_name",
      "type": "defines",
      "description": "Module exports full name formatter"
    },
    {
      "source": "module:utils",
      "target": "function:utils._validate_driver_session",
      "type": "defines",
      "description": "Module validates driver session before UBE generation"
    },
    {
      "source": "module:utils",
      "target": "function:utils._get_ancsessionid_cookie",
      "type": "defines",
      "description": "Module retrieves ANCSESSIONID cookie"
    },
    {
      "source": "module:utils",
      "target": "function:utils._build_ube_payload",
      "type": "defines",
      "description": "Module constructs UBE analytics payload"
    },
    {
      "source": "module:utils",
      "target": "function:utils._encode_ube_payload",
      "type": "defines",
      "description": "Module encodes UBE payload to base64"
    },
    {
      "source": "module:utils",
      "target": "function:utils.make_ube",
      "type": "defines",
      "description": "Module generates UBE header string"
    },
    {
      "source": "module:utils",
      "target": "function:utils.main",
      "type": "defines",
      "description": "Module provides CLI test entry point"
    },
    {
      "source": "module:utils",
      "target": "function:utils._create_stubbed_session_manager",
      "type": "defines",
      "description": "Module builds stubbed SessionManager for tests"
    },
    {
      "source": "module:utils",
      "target": "function:utils.utils_module_tests",
      "type": "defines",
      "description": "Module exposes quick smoke-test harness"
    },
    {
      "source": "module:utils",
      "target": "function:utils.run_comprehensive_tests",
      "type": "defines",
      "description": "Module runs comprehensive TestSuite"
    },
    {
      "source": "module:utils",
      "target": "function:utils.log_in",
      "type": "defines",
      "description": "Module provides automated login workflow"
    },
    {
      "source": "module:utils",
      "target": "function:utils.login_status",
      "type": "defines",
      "description": "Module exposes login status checker"
    },
    {
      "source": "module:utils",
      "target": "function:utils.nav_to_page",
      "type": "defines",
      "description": "Module exports resilient navigation helper"
    },
    {
      "source": "module:utils",
      "target": "function:utils.get_rate_limiter",
      "type": "defines",
      "description": "Module exposes AdaptiveRateLimiter accessor"
    },
    {
      "source": "module:utils",
      "target": "function:utils.prevent_system_sleep",
      "type": "defines",
      "description": "Module provides cross-platform sleep prevention"
    },
    {
      "source": "module:utils",
      "target": "function:utils.restore_system_sleep",
      "type": "defines",
      "description": "Module restores sleep settings after prevention"
    },
    {
      "source": "module:utils",
      "target": "function:utils._prepare_base_headers",
      "type": "defines",
      "description": "Module constructs base API headers"
    },
    {
      "source": "module:utils",
      "target": "function:utils._prepare_api_headers",
      "type": "defines",
      "description": "Module finalizes API headers"
    },
    {
      "source": "module:utils",
      "target": "function:utils._get_user_agent_from_browser",
      "type": "defines",
      "description": "Module provides user agent fetch helper"
    },
    {
      "source": "module:utils",
      "target": "function:utils._add_origin_header",
      "type": "defines",
      "description": "Module adds Origin header when needed"
    },
    {
      "source": "module:utils",
      "target": "function:utils._parse_csrf_token",
      "type": "defines",
      "description": "Module parses CSRF tokens"
    },
    {
      "source": "module:utils",
      "target": "function:utils._add_csrf_token_header",
      "type": "defines",
      "description": "Module injects CSRF header"
    },
    {
      "source": "module:utils",
      "target": "function:utils._add_user_id_header",
      "type": "defines",
      "description": "Module injects ancestry-userid header"
    },
    {
      "source": "module:utils",
      "target": "function:utils._should_skip_cookie_sync",
      "type": "defines",
      "description": "Module decides whether to skip cookie sync"
    },
    {
      "source": "module:utils",
      "target": "function:utils._validate_driver_for_sync",
      "type": "defines",
      "description": "Module validates driver before cookie sync"
    },
    {
      "source": "module:utils",
      "target": "function:utils._perform_cookie_sync",
      "type": "defines",
      "description": "Module executes cookie synchronization"
    },
    {
      "source": "module:utils",
      "target": "function:utils._sync_cookies_for_request",
      "type": "defines",
      "description": "Module coordinates cookie sync for requests"
    },
    {
      "source": "module:utils",
      "target": "function:utils._apply_rate_limiting",
      "type": "defines",
      "description": "Module wraps adaptive rate limiter wait"
    },
    {
      "source": "module:utils",
      "target": "function:utils._calculate_retry_sleep_time",
      "type": "defines",
      "description": "Module computes retry loop sleep duration"
    },
    {
      "source": "module:utils",
      "target": "function:utils._calculate_sleep_time",
      "type": "defines",
      "description": "Module provides generic exponential backoff calculator"
    },
    {
      "source": "module:utils",
      "target": "function:utils._extract_driver_from_args",
      "type": "defines",
      "description": "Module exports positional driver discovery helper"
    },
    {
      "source": "module:utils",
      "target": "function:utils._extract_driver_from_kwargs",
      "type": "defines",
      "description": "Module exports keyword driver discovery helper"
    },
    {
      "source": "module:utils",
      "target": "function:utils._find_driver_instance",
      "type": "defines",
      "description": "Module provides aggregated driver lookup helper"
    },
    {
      "source": "module:utils",
      "target": "function:utils._validate_driver_instance",
      "type": "defines",
      "description": "Module ships validation helper for browser state"
    },
    {
      "source": "module:utils",
      "target": "function:utils.ensure_browser_open",
      "type": "defines",
      "description": "Module exposes decorator guarding browser availability"
    },
    {
      "source": "module:utils",
      "target": "function:utils.time_wait",
      "type": "defines",
      "description": "Module exposes decorator for timing waits"
    },
    {
      "source": "module:utils",
      "target": "class:utils.CircuitBreaker",
      "type": "defines",
      "description": "Module implements 429-focused circuit breaker"
    },
    {
      "source": "module:utils",
      "target": "function:utils._wait_for_2fa_header",
      "type": "defines",
      "description": "Module provides helper to confirm 2FA header is visible"
    },
    {
      "source": "module:utils",
      "target": "function:utils._find_sms_button_with_selectors",
      "type": "defines",
      "description": "Module supplies selector search for SMS 2FA button"
    },
    {
      "source": "module:utils",
      "target": "function:utils._debug_log_page_buttons",
      "type": "defines",
      "description": "Module logs button metadata for 2FA troubleshooting"
    },
    {
      "source": "module:utils",
      "target": "function:utils._perform_sms_button_click",
      "type": "defines",
      "description": "Module provides click strategy for SMS button"
    },
    {
      "source": "module:utils",
      "target": "function:utils._click_sms_button",
      "type": "defines",
      "description": "Module orchestrates SMS button discovery and click"
    },
    {
      "source": "module:utils",
      "target": "function:utils._wait_for_code_input_field",
      "type": "defines",
      "description": "Module adds wait for 2FA code input field"
    },
    {
      "source": "module:utils",
      "target": "function:utils._wait_for_user_2fa_action",
      "type": "defines",
      "description": "Module polls for user completion of 2FA"
    },
    {
      "source": "module:utils",
      "target": "function:utils._verify_2fa_completion",
      "type": "defines",
      "description": "Module verifies login status after 2FA"
    },
    {
      "source": "module:utils",
      "target": "function:utils.handle_two_fa",
      "type": "defines",
      "description": "Module exposes 2FA handling workflow"
    },
    {
      "source": "module:utils",
      "target": "function:utils._clear_input_field",
      "type": "defines",
      "description": "Module provides resilient input clearing"
    },
    {
      "source": "module:utils",
      "target": "function:utils._enter_username",
      "type": "defines",
      "description": "Module automates username entry"
    },
    {
      "source": "module:utils",
      "target": "function:utils._find_next_button_with_selectors",
      "type": "defines",
      "description": "Module enumerates Next button selectors"
    },
    {
      "source": "module:utils",
      "target": "function:utils._debug_log_page_state_after_next_click",
      "type": "defines",
      "description": "Module logs page state after Next click"
    },
    {
      "source": "module:utils",
      "target": "function:utils._debug_log_signin_page_buttons",
      "type": "defines",
      "description": "Module introspects sign-in page buttons"
    },
    {
      "source": "module:utils",
      "target": "function:utils._perform_next_button_click",
      "type": "defines",
      "description": "Module executes Next button click strategies"
    },
    {
      "source": "module:utils",
      "target": "function:utils._click_next_button",
      "type": "defines",
      "description": "Module orchestrates Next button discovery and action"
    },
    {
      "source": "module:utils",
      "target": "function:utils._enter_password",
      "type": "defines",
      "description": "Module automates password entry"
    },
    {
      "source": "module:utils",
      "target": "function:utils._try_standard_click",
      "type": "defines",
      "description": "Module provides standard click helper for sign-in"
    },
    {
      "source": "module:utils",
      "target": "function:utils._try_javascript_click",
      "type": "defines",
      "description": "Module provides JS click fallback for sign-in"
    },
    {
      "source": "module:utils",
      "target": "function:utils._try_return_key_fallback",
      "type": "defines",
      "description": "Module sends RETURN key fallback for sign-in"
    },
    {
      "source": "module:utils",
      "target": "function:utils._click_sign_in_button",
      "type": "defines",
      "description": "Module coordinates sign-in button activation"
    },
    {
      "source": "module:utils",
      "target": "function:utils.enter_creds",
      "type": "defines",
      "description": "Module automates credential entry"
    },
    {
      "source": "module:utils",
      "target": "function:utils._find_consent_banner",
      "type": "defines",
      "description": "Module detects consent overlay"
    },
    {
      "source": "module:utils",
      "target": "function:utils._click_accept_button_standard",
      "type": "defines",
      "description": "Module attempts standard consent button click"
    },
    {
      "source": "module:utils",
      "target": "function:utils._click_accept_button_js",
      "type": "defines",
      "description": "Module attempts JS consent button click"
    },
    {
      "source": "module:utils",
      "target": "function:utils._handle_consent_button",
      "type": "defines",
      "description": "Module coordinates consent button handling"
    },
    {
      "source": "module:utils",
      "target": "function:utils.consent",
      "type": "defines",
      "description": "Module provides consent overlay handler"
    },
    {
      "source": "module:utils",
      "target": "function:utils._check_initial_login_status",
      "type": "defines",
      "description": "Module checks login status before login flow"
    },
    {
      "source": "module:utils",
      "target": "function:utils._navigate_to_signin",
      "type": "defines",
      "description": "Module navigates to sign-in page"
    },
    {
      "source": "module:utils",
      "target": "function:utils._check_for_login_errors",
      "type": "defines",
      "description": "Module inspects login error banners"
    },
    {
      "source": "module:utils",
      "target": "function:utils._try_2fa_selectors",
      "type": "defines",
      "description": "Module enumerates selectors for detecting 2FA page"
    },
    {
      "source": "module:utils",
      "target": "function:utils._debug_log_page_headers",
      "type": "defines",
      "description": "Module logs header elements for diagnostics"
    },
    {
      "source": "module:utils",
      "target": "function:utils._detect_2fa_page",
      "type": "defines",
      "description": "Module detects presence of 2FA page"
    },
    {
      "source": "module:utils",
      "target": "function:utils._handle_2fa_flow",
      "type": "defines",
      "description": "Module bridges handle_two_fa results to status codes"
    },
    {
      "source": "module:utils",
      "target": "function:utils._verify_login_no_2fa",
      "type": "defines",
      "description": "Module validates login success when 2FA absent"
    },
    {
      "source": "module:utils",
      "target": "function:utils._debug_log_page_errors",
      "type": "defines",
      "description": "Module logs visible alert elements"
    },
    {
      "source": "module:utils",
      "target": "function:utils._debug_log_post_credentials_state",
      "type": "defines",
      "description": "Module records state after credentials submission"
    },
    {
      "source": "module:utils",
      "target": "function:utils._handle_credentials_entry",
      "type": "defines",
      "description": "Module wraps credential entry with error mapping"
    },
    {
      "source": "module:utils",
      "target": "function:utils._execute_login_flow",
      "type": "defines",
      "description": "Module implements orchestrated login flow"
    },
    {
      "source": "module:utils",
      "target": "function:utils._handle_login_exception",
      "type": "defines",
      "description": "Module maps login exceptions to status codes"
    },
    {
      "source": "module:utils",
      "target": "function:utils._validate_login_status_inputs",
      "type": "defines",
      "description": "Module validates session prerequisites for login status checks"
    },
    {
      "source": "module:utils",
      "target": "function:utils._perform_api_login_check",
      "type": "defines",
      "description": "Module performs API-first login status verification"
    },
    {
      "source": "module:utils",
      "target": "function:utils._check_ui_login_indicators",
      "type": "defines",
      "description": "Module inspects DOM elements to infer login state"
    },
    {
      "source": "module:utils",
      "target": "function:utils._perform_ui_login_check_with_navigation",
      "type": "defines",
      "description": "Module provides UI-based login verification with navigation retry"
    },
    {
      "source": "module:utils",
      "target": "function:utils._validate_nav_inputs",
      "type": "defines",
      "description": "Module guards navigation inputs"
    },
    {
      "source": "module:utils",
      "target": "function:utils._parse_and_normalize_url",
      "type": "defines",
      "description": "Module normalizes navigation URLs"
    },
    {
      "source": "module:utils",
      "target": "function:utils._check_browser_session",
      "type": "defines",
      "description": "Module ensures browser session is alive before navigation"
    },
    {
      "source": "module:utils",
      "target": "function:utils._execute_navigation",
      "type": "defines",
      "description": "Module executes driver.get with readiness wait"
    },
    {
      "source": "module:utils",
      "target": "function:utils._get_landed_url_base",
      "type": "defines",
      "description": "Module derives normalized landed URL"
    },
    {
      "source": "module:utils",
      "target": "function:utils._check_for_mfa_page",
      "type": "defines",
      "description": "Module detects MFA page during navigation"
    },
    {
      "source": "module:utils",
      "target": "function:utils._check_for_login_page",
      "type": "defines",
      "description": "Module detects login page redirects"
    },
    {
      "source": "module:utils",
      "target": "function:utils._handle_login_redirect",
      "type": "defines",
      "description": "Module handles unexpected login redirects"
    },
    {
      "source": "module:utils",
      "target": "function:utils._check_signin_redirect",
      "type": "defines",
      "description": "Module validates signin redirect outcomes"
    },
    {
      "source": "module:utils",
      "target": "function:utils._handle_url_mismatch",
      "type": "defines",
      "description": "Module processes landing URL mismatches"
    },
    {
      "source": "module:utils",
      "target": "function:utils._wait_for_element",
      "type": "defines",
      "description": "Module waits for target selector after navigation"
    },
    {
      "source": "module:utils",
      "target": "function:utils._handle_navigation_alert",
      "type": "defines",
      "description": "Module resolves unexpected navigation alerts"
    },
    {
      "source": "module:utils",
      "target": "function:utils._handle_webdriver_exception",
      "type": "defines",
      "description": "Module recovers from WebDriver exceptions"
    },
    {
      "source": "module:utils",
      "target": "function:utils._check_url_mismatch_and_handle",
      "type": "defines",
      "description": "Module coordinates URL mismatch handling"
    },
    {
      "source": "module:utils",
      "target": "function:utils._validate_post_navigation",
      "type": "defines",
      "description": "Module validates navigation outcome"
    },
    {
      "source": "module:utils",
      "target": "function:utils._perform_navigation_attempt",
      "type": "defines",
      "description": "Module performs a single navigation attempt"
    },
    {
      "source": "module:utils",
      "target": "function:utils._check_for_unavailability",
      "type": "defines",
      "description": "Module detects maintenance and unavailable banners"
    },
    {
      "source": "function:utils._wait_for_2fa_header",
      "target": "function:utils.login_status",
      "type": "calls",
      "description": "Falls back to login_status check when 2FA header fails to appear"
    },
    {
      "source": "function:utils._perform_sms_button_click",
      "target": "function:utils._wait_for_code_input_field",
      "type": "calls",
      "description": "Waits for code input after triggering SMS"
    },
    {
      "source": "function:utils._click_sms_button",
      "target": "function:utils._find_sms_button_with_selectors",
      "type": "calls",
      "description": "Searches multiple selectors to locate SMS trigger"
    },
    {
      "source": "function:utils._click_sms_button",
      "target": "function:utils._debug_log_page_buttons",
      "type": "calls",
      "description": "Logs available buttons when SMS option is missing"
    },
    {
      "source": "function:utils._click_sms_button",
      "target": "function:utils._perform_sms_button_click",
      "type": "calls",
      "description": "Executes resilient click strategies for SMS option"
    },
    {
      "source": "function:utils.handle_two_fa",
      "target": "function:utils._wait_for_2fa_header",
      "type": "calls",
      "description": "Confirms 2FA page is active before proceeding"
    },
    {
      "source": "function:utils.handle_two_fa",
      "target": "function:utils.consent",
      "type": "calls",
      "description": "Dismisses consent overlay encountered on 2FA page"
    },
    {
      "source": "function:utils.handle_two_fa",
      "target": "function:utils._click_sms_button",
      "type": "calls",
      "description": "Attempts to request SMS verification code"
    },
    {
      "source": "function:utils.handle_two_fa",
      "target": "function:utils._wait_for_user_2fa_action",
      "type": "calls",
      "description": "Polls for user-submitted verification code"
    },
    {
      "source": "function:utils.handle_two_fa",
      "target": "function:utils._verify_2fa_completion",
      "type": "calls",
      "description": "Re-validates login after user completes 2FA"
    },
    {
      "source": "function:utils._verify_2fa_completion",
      "target": "function:utils.login_status",
      "type": "calls",
      "description": "Checks final authentication state post-2FA"
    },
    {
      "source": "function:utils._verify_2fa_completion",
      "target": "function:utils._save_login_cookies",
      "type": "calls",
      "description": "Persists refreshed cookies after successful 2FA"
    },
    {
      "source": "function:utils._enter_username",
      "target": "function:utils._clear_input_field",
      "type": "calls",
      "description": "Clears any stale characters before typing username"
    },
    {
      "source": "function:utils._enter_password",
      "target": "function:utils._clear_input_field",
      "type": "calls",
      "description": "Ensures password field is empty before entry"
    },
    {
      "source": "function:utils._click_next_button",
      "target": "function:utils._find_next_button_with_selectors",
      "type": "calls",
      "description": "Iterates through known selectors to locate Next"
    },
    {
      "source": "function:utils._click_next_button",
      "target": "function:utils._perform_next_button_click",
      "type": "calls",
      "description": "Applies layered strategies to activate Next"
    },
    {
      "source": "function:utils._click_next_button",
      "target": "function:utils._debug_log_signin_page_buttons",
      "type": "calls",
      "description": "Logs button inventory when Next cannot be clicked"
    },
    {
      "source": "function:utils._perform_next_button_click",
      "target": "function:utils._debug_log_page_state_after_next_click",
      "type": "calls",
      "description": "Captures page diagnostics after Next click"
    },
    {
      "source": "function:utils._click_sign_in_button",
      "target": "function:utils._try_standard_click",
      "type": "calls",
      "description": "Attempts normal button click first"
    },
    {
      "source": "function:utils._click_sign_in_button",
      "target": "function:utils._try_javascript_click",
      "type": "calls",
      "description": "Falls back to JavaScript click when standard fails"
    },
    {
      "source": "function:utils._click_sign_in_button",
      "target": "function:utils._try_return_key_fallback",
      "type": "calls",
      "description": "Uses RETURN key as last-resort submission"
    },
    {
      "source": "function:utils.enter_creds",
      "target": "function:utils._enter_username",
      "type": "calls",
      "description": "Types username into login form"
    },
    {
      "source": "function:utils.enter_creds",
      "target": "function:utils._click_next_button",
      "type": "calls",
      "description": "Advances multi-step login after username"
    },
    {
      "source": "function:utils.enter_creds",
      "target": "function:utils._enter_password",
      "type": "calls",
      "description": "Populates password field"
    },
    {
      "source": "function:utils.enter_creds",
      "target": "function:utils._click_sign_in_button",
      "type": "calls",
      "description": "Submits credentials via sign-in control"
    },
    {
      "source": "function:utils._handle_consent_button",
      "target": "function:utils._click_accept_button_standard",
      "type": "calls",
      "description": "Prefers standard click for consent dismissal"
    },
    {
      "source": "function:utils._handle_consent_button",
      "target": "function:utils._click_accept_button_js",
      "type": "calls",
      "description": "Falls back to JavaScript click when needed"
    },
    {
      "source": "function:utils.consent",
      "target": "function:utils._find_consent_banner",
      "type": "calls",
      "description": "Detects presence of cookie consent overlay"
    },
    {
      "source": "function:utils.consent",
      "target": "function:utils._handle_consent_button",
      "type": "calls",
      "description": "Attempts to dismiss consent overlay"
    },
    {
      "source": "function:utils._check_initial_login_status",
      "target": "function:utils.login_status",
      "type": "calls",
      "description": "Skips login when already authenticated"
    },
    {
      "source": "function:utils._navigate_to_signin",
      "target": "function:utils.nav_to_page",
      "type": "calls",
      "description": "Uses resilient navigation helper to reach sign-in"
    },
    {
      "source": "function:utils._navigate_to_signin",
      "target": "function:utils.login_status",
      "type": "calls",
      "description": "Confirms authentication if navigation fails"
    },
    {
      "source": "function:utils._detect_2fa_page",
      "target": "function:utils._try_2fa_selectors",
      "type": "calls",
      "description": "Probes multiple selectors to detect 2FA"
    },
    {
      "source": "function:utils._detect_2fa_page",
      "target": "function:utils._debug_log_page_headers",
      "type": "calls",
      "description": "Logs headers when 2FA not detected"
    },
    {
      "source": "function:utils._handle_2fa_flow",
      "target": "function:utils.handle_two_fa",
      "type": "calls",
      "description": "Delegates to primary 2FA workflow"
    },
    {
      "source": "function:utils._handle_2fa_flow",
      "target": "function:utils.login_status",
      "type": "calls",
      "description": "Verifies login after 2FA handling"
    },
    {
      "source": "function:utils._verify_login_no_2fa",
      "target": "function:utils.login_status",
      "type": "calls",
      "description": "Determines success when no 2FA prompt appears"
    },
    {
      "source": "function:utils._verify_login_no_2fa",
      "target": "function:utils._save_login_cookies",
      "type": "calls",
      "description": "Saves cookies after non-2FA login success"
    },
    {
      "source": "function:utils._verify_login_no_2fa",
      "target": "function:utils._check_for_login_errors",
      "type": "calls",
      "description": "Inspects UI for error banners on failure"
    },
    {
      "source": "function:utils._debug_log_post_credentials_state",
      "target": "function:utils._debug_log_page_errors",
      "type": "calls",
      "description": "Captures visible error elements after submission"
    },
    {
      "source": "function:utils._handle_credentials_entry",
      "target": "function:utils.enter_creds",
      "type": "calls",
      "description": "Executes credential entry routine"
    },
    {
      "source": "function:utils._handle_credentials_entry",
      "target": "function:utils._check_for_login_errors",
      "type": "calls",
      "description": "Translates credential failures into status codes"
    },
    {
      "source": "function:utils._execute_login_flow",
      "target": "function:utils._navigate_to_signin",
      "type": "calls",
      "description": "Navigates to login page before processing"
    },
    {
      "source": "function:utils._execute_login_flow",
      "target": "function:utils.consent",
      "type": "calls",
      "description": "Handles consent overlay during login"
    },
    {
      "source": "function:utils._execute_login_flow",
      "target": "function:utils._handle_credentials_entry",
      "type": "calls",
      "description": "Orchestrates credential entry and error handling"
    },
    {
      "source": "function:utils._execute_login_flow",
      "target": "function:utils._debug_log_post_credentials_state",
      "type": "calls",
      "description": "Logs diagnostics after submitting credentials"
    },
    {
      "source": "function:utils._execute_login_flow",
      "target": "function:utils._detect_2fa_page",
      "type": "calls",
      "description": "Checks if 2FA flow is required"
    },
    {
      "source": "function:utils._execute_login_flow",
      "target": "function:utils._handle_2fa_flow",
      "type": "calls",
      "description": "Routes through 2FA handling when necessary"
    },
    {
      "source": "function:utils._execute_login_flow",
      "target": "function:utils._verify_login_no_2fa",
      "type": "calls",
      "description": "Validates login when 2FA not present"
    },
    {
      "source": "function:utils._handle_login_exception",
      "target": "function:selenium_utils.is_browser_open",
      "type": "calls",
      "description": "Verifies browser health after WebDriver errors"
    },
    {
      "source": "function:utils.log_in",
      "target": "function:utils._check_initial_login_status",
      "type": "calls",
      "description": "Skips login when session is already authenticated"
    },
    {
      "source": "function:utils.log_in",
      "target": "function:utils._execute_login_flow",
      "type": "calls",
      "description": "Runs main login orchestration"
    },
    {
      "source": "function:utils.log_in",
      "target": "function:utils._handle_login_exception",
      "type": "calls",
      "description": "Normalizes unexpected login exceptions"
    },
    {
      "source": "function:utils.login_status",
      "target": "function:utils._validate_login_status_inputs",
      "type": "calls",
      "description": "Verifies SessionManager prerequisites before status checks"
    },
    {
      "source": "function:utils.login_status",
      "target": "function:utils._perform_api_login_check",
      "type": "calls",
      "description": "Attempts API-driven login verification first"
    },
    {
      "source": "function:utils.login_status",
      "target": "function:utils._perform_ui_login_check_with_navigation",
      "type": "calls",
      "description": "Falls back to UI heuristics when API result is inconclusive"
    },
    {
      "source": "function:utils.login_status",
      "target": "method:SessionManager.close_sess",
      "type": "calls",
      "description": "Closes session when UI fallback encounters WebDriver failures"
    },
    {
      "source": "function:utils.login_status",
      "target": "function:utils.retry",
      "type": "decorated-with",
      "description": "Retries ambiguous login status checks twice"
    },
    {
      "source": "function:utils._perform_api_login_check",
      "target": "method:SessionManager._sync_cookies_to_requests",
      "type": "calls",
      "description": "Syncs browser cookies into requests session prior to API probe"
    },
    {
      "source": "function:utils._perform_api_login_check",
      "target": "method:APIManager.verify_api_login_status",
      "type": "calls",
      "description": "Queries API endpoint to determine authentication state"
    },
    {
      "source": "function:utils._check_ui_login_indicators",
      "target": "function:selenium_utils.is_elem_there",
      "type": "calls",
      "description": "Uses reusable DOM probe helper for login selectors"
    },
    {
      "source": "function:utils._perform_ui_login_check_with_navigation",
      "target": "function:utils._check_ui_login_indicators",
      "type": "calls",
      "description": "Reuses indicator detection before and after navigation retry"
    },
    {
      "source": "function:utils.nav_to_page",
      "target": "function:utils._validate_nav_inputs",
      "type": "calls",
      "description": "Guards against empty or invalid navigation targets"
    },
    {
      "source": "function:utils.nav_to_page",
      "target": "class:common_params.NavigationConfig",
      "type": "instantiates",
      "description": "Builds navigation configuration object for retry loop"
    },
    {
      "source": "function:utils.nav_to_page",
      "target": "function:utils._parse_and_normalize_url",
      "type": "calls",
      "description": "Normalizes target URL for redirect comparisons"
    },
    {
      "source": "function:utils.nav_to_page",
      "target": "function:utils._perform_navigation_attempt",
      "type": "calls",
      "description": "Executes navigation attempts with retry control"
    },
    {
      "source": "function:utils._check_browser_session",
      "target": "function:selenium_utils.is_browser_open",
      "type": "calls",
      "description": "Inspects driver health prior to navigation"
    },
    {
      "source": "function:utils._check_browser_session",
      "target": "method:SessionManager.restart_sess",
      "type": "calls",
      "description": "Attempts to restart session when browser is invalid"
    },
    {
      "source": "function:utils._handle_login_redirect",
      "target": "function:utils.login_status",
      "type": "calls",
      "description": "Reconfirms authentication after unexpected login redirect"
    },
    {
      "source": "function:utils._handle_login_redirect",
      "target": "function:utils.log_in",
      "type": "calls",
      "description": "Triggers full login when redirect indicates logged-out state"
    },
    {
      "source": "function:utils._check_signin_redirect",
      "target": "function:utils.login_status",
      "type": "calls",
      "description": "Verifies authentication before treating signin redirect as success"
    },
    {
      "source": "function:utils._handle_url_mismatch",
      "target": "function:utils._check_for_unavailability",
      "type": "calls",
      "description": "Consults known error banners to decide retry strategy"
    },
    {
      "source": "function:utils._wait_for_element",
      "target": "function:utils._check_for_unavailability",
      "type": "calls",
      "description": "Checks for maintenance banners when target selector fails to appear"
    },
    {
      "source": "function:utils._check_for_unavailability",
      "target": "function:selenium_utils.is_browser_open",
      "type": "calls",
      "description": "Skips banner checks when browser session is invalid"
    },
    {
      "source": "function:utils._check_for_unavailability",
      "target": "function:selenium_utils.is_elem_there",
      "type": "calls",
      "description": "Searches for known outage selectors with shared helper"
    },
    {
      "source": "function:utils._check_url_mismatch_and_handle",
      "target": "function:utils._check_signin_redirect",
      "type": "calls",
      "description": "Allows acceptable signin redirects before flagging mismatch"
    },
    {
      "source": "function:utils._check_url_mismatch_and_handle",
      "target": "function:utils._handle_url_mismatch",
      "type": "calls",
      "description": "Delegates to mismatch handler for retry guidance"
    },
    {
      "source": "function:utils._validate_post_navigation",
      "target": "function:utils._check_for_mfa_page",
      "type": "calls",
      "description": "Stops navigation when MFA page is detected"
    },
    {
      "source": "function:utils._validate_post_navigation",
      "target": "function:utils._check_for_login_page",
      "type": "calls",
      "description": "Detects unexpected login redirects"
    },
    {
      "source": "function:utils._validate_post_navigation",
      "target": "function:utils._handle_login_redirect",
      "type": "calls",
      "description": "Invokes relogin workflow when login page encountered"
    },
    {
      "source": "function:utils._validate_post_navigation",
      "target": "function:utils._check_url_mismatch_and_handle",
      "type": "calls",
      "description": "Resolves URL mismatches before element checks"
    },
    {
      "source": "function:utils._validate_post_navigation",
      "target": "function:utils._wait_for_element",
      "type": "calls",
      "description": "Waits for target selector once URL deemed correct"
    },
    {
      "source": "function:utils._perform_navigation_attempt",
      "target": "function:utils._check_browser_session",
      "type": "calls",
      "description": "Ensures driver ready before attempting navigation"
    },
    {
      "source": "function:utils._perform_navigation_attempt",
      "target": "function:utils._execute_navigation",
      "type": "calls",
      "description": "Invokes driver.get and page readiness wait"
    },
    {
      "source": "function:utils._perform_navigation_attempt",
      "target": "function:utils._get_landed_url_base",
      "type": "calls",
      "description": "Normalizes landed URL for comparison"
    },
    {
      "source": "function:utils._perform_navigation_attempt",
      "target": "function:utils._validate_post_navigation",
      "type": "calls",
      "description": "Determines success/failure after navigation"
    },
    {
      "source": "function:utils._perform_navigation_attempt",
      "target": "function:utils._handle_navigation_alert",
      "type": "calls",
      "description": "Handles unexpected alerts encountered mid-navigation"
    },
    {
      "source": "function:utils._perform_navigation_attempt",
      "target": "function:utils._handle_webdriver_exception",
      "type": "calls",
      "description": "Recovers from WebDriver exceptions during navigation"
    },
    {
      "source": "function:utils._handle_webdriver_exception",
      "target": "function:selenium_utils.is_browser_open",
      "type": "calls",
      "description": "Checks browser state before attempting recovery"
    },
    {
      "source": "function:utils._handle_webdriver_exception",
      "target": "method:SessionManager.restart_sess",
      "type": "calls",
      "description": "Restarts session when WebDriver is no longer valid"
    },
    {
      "source": "module:utils",
      "target": "function:utils.retry",
      "type": "defines",
      "description": "Module offers legacy retry decorator"
    },
    {
      "source": "module:utils",
      "target": "function:utils._get_retry_config",
      "type": "defines",
      "description": "Module normalizes retry configuration dict"
    },
    {
      "source": "module:utils",
      "target": "function:utils._should_retry_status_code",
      "type": "defines",
      "description": "Module determines if response status warrants retry"
    },
    {
      "source": "module:utils",
      "target": "function:utils._handle_status_code_retry",
      "type": "defines",
      "description": "Module handles retry flow for HTTP statuses"
    },
    {
      "source": "module:utils",
      "target": "function:utils._handle_exception_retry",
      "type": "defines",
      "description": "Module handles retry flow for exceptions"
    },
    {
      "source": "module:utils",
      "target": "function:utils.retry_api",
      "type": "defines",
      "description": "Module exposes configurable API retry decorator"
    },
    {
      "source": "class:utils.CircuitBreaker",
      "target": "method:CircuitBreaker.__init__",
      "type": "defines",
      "description": "Constructor prepares thresholds, locks, and metrics"
    },
    {
      "source": "class:utils.CircuitBreaker",
      "target": "method:CircuitBreaker.call",
      "type": "defines",
      "description": "Primary execution guard for protected callables"
    },
    {
      "source": "class:utils.CircuitBreaker",
      "target": "method:CircuitBreaker.record_success",
      "type": "defines",
      "description": "Updates counters and closes circuit after successful probes"
    },
    {
      "source": "class:utils.CircuitBreaker",
      "target": "method:CircuitBreaker.record_failure",
      "type": "defines",
      "description": "Records throttling failures and may open circuit"
    },
    {
      "source": "class:utils.CircuitBreaker",
      "target": "method:CircuitBreaker._transition_to_open",
      "type": "defines",
      "description": "Handles transition to OPEN state with logging"
    },
    {
      "source": "class:utils.CircuitBreaker",
      "target": "method:CircuitBreaker._transition_to_half_open",
      "type": "defines",
      "description": "Moves circuit to HALF_OPEN for recovery probes"
    },
    {
      "source": "class:utils.CircuitBreaker",
      "target": "method:CircuitBreaker._transition_to_closed",
      "type": "defines",
      "description": "Returns breaker to CLOSED state after recovery"
    },
    {
      "source": "class:utils.CircuitBreaker",
      "target": "method:CircuitBreaker.get_state",
      "type": "defines",
      "description": "Exposes current breaker state"
    },
    {
      "source": "class:utils.CircuitBreaker",
      "target": "method:CircuitBreaker.get_metrics",
      "type": "defines",
      "description": "Provides snapshot of breaker metrics"
    },
    {
      "source": "class:utils.CircuitBreaker",
      "target": "method:CircuitBreaker.reset",
      "type": "defines",
      "description": "Resets breaker state and counters"
    },
    {
      "source": "module:utils",
      "target": "class:utils.ApiRequestConfig",
      "type": "defines",
      "description": "Module declares ApiRequestConfig dataclass for HTTP request configuration"
    },
    {
      "source": "module:utils",
      "target": "function:utils._api_req",
      "type": "defines",
      "description": "Module exposes legacy-compatible API request wrapper"
    },
    {
      "source": "module:utils",
      "target": "function:utils._api_req_impl",
      "type": "defines",
      "description": "Module provides primary API request implementation"
    },
    {
      "source": "module:utils",
      "target": "function:utils._execute_request_with_retries",
      "type": "defines",
      "description": "Module exports retry loop helper for API requests"
    },
    {
      "source": "module:utils",
      "target": "function:utils._process_request_attempt",
      "type": "defines",
      "description": "Module declares single-attempt handler for API requests"
    },
    {
      "source": "module:utils",
      "target": "function:utils._prepare_api_request",
      "type": "defines",
      "description": "Module exports request preparation helper"
    },
    {
      "source": "module:utils",
      "target": "function:utils._execute_api_request",
      "type": "defines",
      "description": "Module exposes thin requests.Session wrapper"
    },
    {
      "source": "module:utils",
      "target": "function:utils._validate_api_req_prerequisites",
      "type": "defines",
      "description": "Module defines prerequisite guard for API requests"
    },
    {
      "source": "module:utils",
      "target": "function:utils._get_retry_configuration",
      "type": "defines",
      "description": "Module provides retry configuration accessor"
    },
    {
      "source": "module:utils",
      "target": "function:utils._handle_response_status",
      "type": "defines",
      "description": "Module declares central response status handler"
    },
    {
      "source": "module:utils",
      "target": "function:utils._handle_retryable_status",
      "type": "defines",
      "description": "Module exposes retryable status handler"
    },
    {
      "source": "module:utils",
      "target": "function:utils._handle_redirect_response",
      "type": "defines",
      "description": "Module exports redirect response handler"
    },
    {
      "source": "module:utils",
      "target": "function:utils._handle_error_status",
      "type": "defines",
      "description": "Module exports non-retryable error handler"
    },
    {
      "source": "module:utils",
      "target": "function:utils._process_api_response",
      "type": "defines",
      "description": "Module provides response normalization helper"
    },
    {
      "source": "module:utils",
      "target": "function:utils._handle_request_exception",
      "type": "defines",
      "description": "Module declares request exception handler"
    },
    {
      "source": "module:utils",
      "target": "function:utils._handle_failed_request_response",
      "type": "defines",
      "description": "Module exports handler for missing response objects"
    },
    {
      "source": "module:common_params",
      "target": "class:common_params.NavigationConfig",
      "type": "defines",
      "description": "Module defines NavigationConfig dataclass for navigation attempts"
    },
    {
      "source": "module:common_params",
      "target": "class:common_params.RetryContext",
      "type": "defines",
      "description": "Module defines RetryContext dataclass for retry bookkeeping"
    },
    {
      "source": "function:utils.log_page_complete",
      "target": "function:utils.log_cumulative_counts",
      "type": "calls",
      "description": "Outputs cumulative totals after page summary"
    },
    {
      "source": "function:utils._save_login_cookies",
      "target": "function:utils._get_cookie_file_path",
      "type": "calls",
      "description": "Resolves cookie persistence path before writing"
    },
    {
      "source": "function:utils._load_login_cookies",
      "target": "function:utils._get_cookie_file_path",
      "type": "calls",
      "description": "Retrieves cookie persistence path before loading"
    },
    {
      "source": "function:utils._format_number_as_ordinal",
      "target": "function:utils._get_ordinal_suffix",
      "type": "calls",
      "description": "Appends ordinal suffix supplied by helper"
    },
    {
      "source": "function:utils.ordinal_case",
      "target": "function:utils._format_number_as_ordinal",
      "type": "calls",
      "description": "Uses numeric ordinal formatter when input is integer"
    },
    {
      "source": "function:utils.ordinal_case",
      "target": "function:utils._title_case_with_lowercase_particles",
      "type": "calls",
      "description": "Title-cases non-numeric strings while preserving particles"
    },
    {
      "source": "function:utils._format_name_part",
      "target": "function:utils._format_quoted_nickname",
      "type": "calls",
      "description": "Handles quoted nickname tokens"
    },
    {
      "source": "function:utils._format_name_part",
      "target": "function:utils._format_hyphenated_name",
      "type": "calls",
      "description": "Processes hyphenated name segments"
    },
    {
      "source": "function:utils._format_name_part",
      "target": "function:utils._format_apostrophe_name",
      "type": "calls",
      "description": "Formats apostrophe-containing names"
    },
    {
      "source": "function:utils._format_name_part",
      "target": "function:utils._format_mc_mac_prefix",
      "type": "calls",
      "description": "Normalizes Mc/Mac prefixes"
    },
    {
      "source": "function:utils._format_name_part",
      "target": "function:utils._format_initial",
      "type": "calls",
      "description": "Uppercases initial tokens"
    },
    {
      "source": "function:utils.format_name",
      "target": "function:utils._remove_gedcom_slashes",
      "type": "calls",
      "description": "Strips GEDCOM delimiters prior to formatting"
    },
    {
      "source": "function:utils.format_name",
      "target": "function:utils._format_name_part",
      "type": "calls",
      "description": "Formats each token within the name"
    },
    {
      "source": "function:utils.make_ube",
      "target": "function:utils._validate_driver_session",
      "type": "calls",
      "description": "Ensures driver session valid before building UBE"
    },
    {
      "source": "function:utils.make_ube",
      "target": "function:utils._get_ancsessionid_cookie",
      "type": "calls",
      "description": "Fetches ANCSESSIONID cookie needed for payload"
    },
    {
      "source": "function:utils.make_ube",
      "target": "function:utils._build_ube_payload",
      "type": "calls",
      "description": "Constructs analytics payload for encoding"
    },
    {
      "source": "function:utils.make_ube",
      "target": "function:utils._encode_ube_payload",
      "type": "calls",
      "description": "Encodes payload to base64 header string"
    },
    {
      "source": "function:utils.main",
      "target": "function:utils.run_comprehensive_tests",
      "type": "calls",
      "description": "Executes module comprehensive test suite"
    },
    {
      "source": "function:utils._create_stubbed_session_manager",
      "target": "class:core.session_manager.SessionManager",
      "type": "instantiates",
      "description": "Creates SessionManager with patched dependencies"
    },
    {
      "source": "function:utils.utils_module_tests",
      "target": "function:utils.format_name",
      "type": "calls",
      "description": "Asserts name formatter behavior"
    },
    {
      "source": "function:utils.utils_module_tests",
      "target": "function:utils.get_rate_limiter",
      "type": "calls",
      "description": "Ensures adaptive rate limiter can be acquired"
    },
    {
      "source": "function:utils.utils_module_tests",
      "target": "function:utils._create_stubbed_session_manager",
      "type": "calls",
      "description": "Builds stubbed SessionManager for smoke tests"
    },
    {
      "source": "function:utils.run_comprehensive_tests",
      "target": "function:utils.parse_cookie",
      "type": "calls",
      "description": "Runs cookie parsing test cases"
    },
    {
      "source": "function:utils.run_comprehensive_tests",
      "target": "function:utils.ordinal_case",
      "type": "calls",
      "description": "Exercises ordinal formatting helper"
    },
    {
      "source": "function:utils.run_comprehensive_tests",
      "target": "function:utils.format_name",
      "type": "calls",
      "description": "Validates name formatting scenarios"
    },
    {
      "source": "function:utils.run_comprehensive_tests",
      "target": "class:utils.CircuitBreaker",
      "type": "uses",
      "description": "Tests circuit breaker state transitions"
    },
    {
      "source": "function:utils.run_comprehensive_tests",
      "target": "function:utils.get_rate_limiter",
      "type": "calls",
      "description": "Exercises adaptive rate limiter interface"
    },
    {
      "source": "function:utils.run_comprehensive_tests",
      "target": "function:utils.prevent_system_sleep",
      "type": "calls",
      "description": "Verifies sleep prevention helper behavior"
    },
    {
      "source": "function:utils.run_comprehensive_tests",
      "target": "function:utils.restore_system_sleep",
      "type": "calls",
      "description": "Ensures sleep restoration helper performs cleanup"
    },
    {
      "source": "function:utils.run_comprehensive_tests",
      "target": "function:utils._create_stubbed_session_manager",
      "type": "calls",
      "description": "Creates stubbed SessionManager for session tests"
    },
    {
      "source": "function:utils.run_comprehensive_tests",
      "target": "function:utils._api_req",
      "type": "calls",
      "description": "Validates API helper availability"
    },
    {
      "source": "function:utils.run_comprehensive_tests",
      "target": "function:utils.login_status",
      "type": "calls",
      "description": "Confirms login_status signature and availability"
    },
    {
      "source": "function:utils.run_comprehensive_tests",
      "target": "function:utils._check_for_unavailability",
      "type": "calls",
      "description": "Exercises unavailability detection logic"
    },
    {
      "source": "function:utils.run_comprehensive_tests",
      "target": "function:utils.retry",
      "type": "calls",
      "description": "Ensures retry decorator reachable"
    },
    {
      "source": "function:utils.run_comprehensive_tests",
      "target": "function:utils.retry_api",
      "type": "calls",
      "description": "Ensures retry_api decorator reachable"
    },
    {
      "source": "function:action6_gather._emit_final_summary",
      "target": "function:utils.log_final_summary",
      "type": "calls",
      "description": "Delegates final metrics logging to shared formatter"
    },
    {
      "source": "function:action6_gather._emit_action_status",
      "target": "function:utils.log_action_status",
      "type": "calls",
      "description": "Uses shared status helper to report action outcome"
    },
    {
      "source": "function:action6_gather._handle_initial_fetch",
      "target": "function:utils.log_starting_position",
      "type": "calls",
      "description": "Records starting scope details via shared logging helper"
    },
    {
      "source": "function:utils.run_comprehensive_tests",
      "target": "function:utils.ensure_browser_open",
      "type": "calls",
      "description": "Asserts ensure_browser_open decorator availability"
    },
    {
      "source": "function:utils.run_comprehensive_tests",
      "target": "function:utils.time_wait",
      "type": "calls",
      "description": "Asserts timing decorator availability"
    },
    {
      "source": "function:utils._api_req",
      "target": "function:utils._api_req_impl",
      "type": "calls",
      "description": "Legacy wrapper delegates to config-driven implementation"
    },
    {
      "source": "function:utils._api_req_impl",
      "target": "function:utils._validate_api_req_prerequisites",
      "type": "calls",
      "description": "Ensures prerequisites before executing retry loop"
    },
    {
      "source": "function:utils._api_req_impl",
      "target": "function:utils._get_retry_configuration",
      "type": "calls",
      "description": "Hydrates retry settings from configuration schema"
    },
    {
      "source": "function:utils._api_req_impl",
      "target": "function:utils._execute_request_with_retries",
      "type": "calls",
      "description": "Invokes retry loop to perform HTTP call"
    },
    {
      "source": "function:utils._execute_request_with_retries",
      "target": "function:utils._process_request_attempt",
      "type": "calls",
      "description": "Retry loop delegates each attempt to handler"
    },
    {
      "source": "function:utils._process_request_attempt",
      "target": "function:utils._prepare_api_request",
      "type": "calls",
      "description": "Attempts begin by preparing headers, cookies, and limiter waits"
    },
    {
      "source": "function:utils._process_request_attempt",
      "target": "function:utils._execute_api_request",
      "type": "calls",
      "description": "Executes HTTP request via shared requests session"
    },
    {
      "source": "function:utils._process_request_attempt",
      "target": "function:utils._handle_failed_request_response",
      "type": "calls",
      "description": "Handles None responses before deciding to retry"
    },
    {
      "source": "function:utils._process_request_attempt",
      "target": "function:utils._handle_response_status",
      "type": "calls",
      "description": "Evaluates HTTP response status to determine retry"
    },
    {
      "source": "function:utils._process_request_attempt",
      "target": "function:utils._handle_request_exception",
      "type": "calls",
      "description": "Handles RequestException raised during attempt"
    },
    {
      "source": "function:utils._process_request_attempt",
      "target": "class:common_params.RetryContext",
      "type": "instantiates",
      "description": "Constructs RetryContext to pass retry metadata to handlers"
    },
    {
      "source": "function:utils._prepare_api_request",
      "target": "function:utils._prepare_base_headers",
      "type": "calls",
      "description": "Builds baseline headers before finalization"
    },
    {
      "source": "function:utils._prepare_api_request",
      "target": "function:utils._sync_cookies_for_request",
      "type": "calls",
      "description": "Ensures requests session cookies are fresh"
    },
    {
      "source": "function:utils._prepare_api_request",
      "target": "function:utils._prepare_api_headers",
      "type": "calls",
      "description": "Generates final HTTP headers for request"
    },
    {
      "source": "function:utils._prepare_api_request",
      "target": "function:utils._apply_rate_limiting",
      "type": "calls",
      "description": "Invokes adaptive rate limiter prior to network call"
    },
    {
      "source": "function:utils._prepare_api_headers",
      "target": "class:core.session_manager.SessionManager",
      "type": "depends-on",
      "description": "Reads SessionManager tokens and profile ID"
    },
    {
      "source": "function:utils._prepare_api_headers",
      "target": "function:utils._get_user_agent_from_browser",
      "type": "calls",
      "description": "Attempts to reuse browser user agent"
    },
    {
      "source": "function:utils._prepare_api_headers",
      "target": "function:utils._add_origin_header",
      "type": "calls",
      "description": "Adds Origin header for mutating requests"
    },
    {
      "source": "function:utils._prepare_api_headers",
      "target": "function:utils._add_csrf_token_header",
      "type": "calls",
      "description": "Injects CSRF token when required"
    },
    {
      "source": "function:utils._prepare_api_headers",
      "target": "function:utils._add_user_id_header",
      "type": "calls",
      "description": "Adds ancestry-userid header when profile ID available"
    },
    {
      "source": "function:utils._add_csrf_token_header",
      "target": "class:core.session_manager.SessionManager",
      "type": "depends-on",
      "description": "Consumes SessionManager cached csrf_token"
    },
    {
      "source": "function:utils._add_csrf_token_header",
      "target": "function:utils._parse_csrf_token",
      "type": "calls",
      "description": "Normalizes raw CSRF token strings"
    },
    {
      "source": "function:utils._add_user_id_header",
      "target": "class:core.session_manager.SessionManager",
      "type": "depends-on",
      "description": "Reads my_profile_id from SessionManager"
    },
    {
      "source": "function:utils._sync_cookies_for_request",
      "target": "function:utils._should_skip_cookie_sync",
      "type": "calls",
      "description": "Uses cache heuristics to skip unnecessary sync"
    },
    {
      "source": "function:utils._sync_cookies_for_request",
      "target": "function:utils._validate_driver_for_sync",
      "type": "calls",
      "description": "Checks driver availability before syncing"
    },
    {
      "source": "function:utils._sync_cookies_for_request",
      "target": "function:utils._perform_cookie_sync",
      "type": "calls",
      "description": "Delegates actual cookie transfer to API manager"
    },
    {
      "source": "function:utils._perform_cookie_sync",
      "target": "class:core.api_manager.APIManager",
      "type": "depends-on",
      "description": "Relies on APIManager.sync_cookies_from_browser implementation"
    },
    {
      "source": "function:utils._perform_cookie_sync",
      "target": "class:core.session_manager.SessionManager",
      "type": "depends-on",
      "description": "Needs SessionManager for browser and API access"
    },
    {
      "source": "function:utils._apply_rate_limiting",
      "target": "class:core.session_manager.SessionManager",
      "type": "depends-on",
      "description": "Invokes rate_limiter stored on SessionManager"
    },
    {
      "source": "function:utils._handle_failed_request_response",
      "target": "function:utils._calculate_retry_sleep_time",
      "type": "calls",
      "description": "Calculates sleep before retrying after missing response"
    },
    {
      "source": "function:utils._find_driver_instance",
      "target": "function:utils._extract_driver_from_args",
      "type": "calls",
      "description": "Checks positional parameters for driver handles"
    },
    {
      "source": "function:utils._find_driver_instance",
      "target": "function:utils._extract_driver_from_kwargs",
      "type": "calls",
      "description": "Falls back to keyword arguments to resolve a driver"
    },
    {
      "source": "function:utils.ensure_browser_open",
      "target": "function:utils._find_driver_instance",
      "type": "calls",
      "description": "Locates driver context prior to executing guarded function"
    },
    {
      "source": "function:utils.ensure_browser_open",
      "target": "function:utils._validate_driver_instance",
      "type": "calls",
      "description": "Validates driver presence and open browser state"
    },
    {
      "source": "function:utils._handle_request_exception",
      "target": "function:utils._calculate_retry_sleep_time",
      "type": "calls",
      "description": "Determines backoff after RequestException"
    },
    {
      "source": "method:CircuitBreaker.call",
      "target": "method:CircuitBreaker._transition_to_half_open",
      "type": "calls",
      "description": "Transitions from OPEN when recovery timeout elapsed"
    },
    {
      "source": "method:CircuitBreaker.call",
      "target": "method:CircuitBreaker.record_success",
      "type": "calls",
      "description": "Updates breaker after successful execution"
    },
    {
      "source": "method:CircuitBreaker.call",
      "target": "method:CircuitBreaker.record_failure",
      "type": "calls",
      "description": "Notifies breaker of throttling failure"
    },
    {
      "source": "method:CircuitBreaker.record_success",
      "target": "method:CircuitBreaker._transition_to_closed",
      "type": "calls",
      "description": "Closes circuit when half-open successes threshold met"
    },
    {
      "source": "method:CircuitBreaker.record_failure",
      "target": "method:CircuitBreaker._transition_to_open",
      "type": "calls",
      "description": "Opens circuit after threshold exceeded"
    },
    {
      "source": "function:utils._handle_retryable_status",
      "target": "function:utils._calculate_sleep_time",
      "type": "calls",
      "description": "Computes delay for retryable HTTP statuses"
    },
    {
      "source": "function:utils._prepare_api_request",
      "target": "class:core.session_manager.SessionManager",
      "type": "depends-on",
      "description": "Requires SessionManager for cookie sync, requests session, and rate limiter"
    },
    {
      "source": "function:utils._execute_api_request",
      "target": "class:core.session_manager.SessionManager",
      "type": "depends-on",
      "description": "Uses SessionManager requests session to issue HTTP calls"
    },
    {
      "source": "function:utils._handle_response_status",
      "target": "function:utils._handle_retryable_status",
      "type": "calls",
      "description": "Delegates retryable status handling"
    },
    {
      "source": "function:utils._handle_response_status",
      "target": "function:utils._handle_redirect_response",
      "type": "calls",
      "description": "Inspects redirect responses based on allow_redirects"
    },
    {
      "source": "function:utils._handle_response_status",
      "target": "function:utils._handle_error_status",
      "type": "calls",
      "description": "Processes non-retryable error statuses"
    },
    {
      "source": "function:utils._handle_response_status",
      "target": "function:utils._process_api_response",
      "type": "calls",
      "description": "Parses successful responses into JSON or text"
    },
    {
      "source": "function:utils._handle_response_status",
      "target": "class:core.session_manager.SessionManager",
      "type": "depends-on",
      "description": "Updates rate limiter feedback and readiness flags via SessionManager"
    },
    {
      "source": "function:utils._handle_retryable_status",
      "target": "class:core.session_manager.SessionManager",
      "type": "depends-on",
      "description": "Notifies SessionManager rate limiter on 429 throttling"
    },
    {
      "source": "function:utils._handle_error_status",
      "target": "class:core.session_manager.SessionManager",
      "type": "mutates",
      "description": "Flips SessionManager.session_ready to False when auth fails"
    },
    {
      "source": "function:utils._handle_status_code_retry",
      "target": "function:utils._calculate_sleep_time",
      "type": "calls",
      "description": "Computes backoff delay for retryable HTTP status codes"
    },
    {
      "source": "function:utils._handle_exception_retry",
      "target": "function:utils._calculate_sleep_time",
      "type": "calls",
      "description": "Computes backoff delay for retryable exceptions"
    },
    {
      "source": "function:utils.retry_api",
      "target": "function:utils._get_retry_config",
      "type": "calls",
      "description": "Loads retry parameters before entering loop"
    },
    {
      "source": "function:utils.retry_api",
      "target": "function:utils._should_retry_status_code",
      "type": "calls",
      "description": "Tests responses against retryable status codes"
    },
    {
      "source": "function:utils.retry_api",
      "target": "function:utils._handle_status_code_retry",
      "type": "calls",
      "description": "Handles retry flow for retryable HTTP statuses"
    },
    {
      "source": "function:utils.retry_api",
      "target": "function:utils._handle_exception_retry",
      "type": "calls",
      "description": "Handles retry flow when exceptions occur"
    },
    {
      "source": "class:core.session_manager.SessionManager",
      "target": "class:core.session_validator.SessionValidator",
      "type": "depends-on",
      "description": "SessionManager delegates readiness workflow to SessionValidator"
    },
    {
      "source": "method:SessionValidator.perform_readiness_checks",
      "target": "method:SessionValidator._perform_all_checks",
      "type": "calls",
      "description": "Primary readiness method executes staged checks"
    },
    {
      "source": "method:SessionValidator.perform_readiness_checks",
      "target": "method:SessionValidator._handle_check_exception",
      "type": "calls",
      "description": "Retry loop relies on exception handler for abort decisions"
    },
    {
      "source": "method:SessionValidator.perform_readiness_checks",
      "target": "class:core.browser_manager.BrowserManager",
      "type": "depends-on",
      "description": "Needs browser manager for driver validation and navigation"
    },
    {
      "source": "method:SessionValidator.perform_readiness_checks",
      "target": "class:core.api_manager.APIManager",
      "type": "depends-on",
      "description": "Requires API manager for cookie sync and CSRF checks"
    },
    {
      "source": "method:SessionValidator.perform_readiness_checks",
      "target": "class:core.session_manager.SessionManager",
      "type": "depends-on",
      "description": "Relies on SessionManager for relogin support and recovery hooks"
    },
    {
      "source": "method:SessionValidator._perform_all_checks",
      "target": "method:SessionValidator._check_login_and_attempt_relogin",
      "type": "calls",
      "description": "Stage 1 validates login status"
    },
    {
      "source": "method:SessionValidator._perform_all_checks",
      "target": "method:SessionValidator._check_and_handle_url",
      "type": "calls",
      "description": "Stage 2 ensures browser navigated to base domain"
    },
    {
      "source": "method:SessionValidator._perform_all_checks",
      "target": "method:SessionValidator._check_essential_cookies",
      "type": "calls",
      "description": "Stage 3 verifies essential cookie presence"
    },
    {
      "source": "method:SessionValidator._perform_all_checks",
      "target": "method:SessionValidator._sync_cookies_to_requests",
      "type": "calls",
      "description": "Stage 4 syncs cookies to API session"
    },
    {
      "source": "method:SessionValidator._perform_all_checks",
      "target": "method:SessionValidator._check_csrf_token",
      "type": "calls",
      "description": "Stage 5 retrieves CSRF token when required"
    },
    {
      "source": "method:SessionValidator._handle_check_exception",
      "target": "class:core.browser_manager.BrowserManager",
      "type": "depends-on",
      "description": "Consults BrowserManager.is_session_valid to decide abort"
    },
    {
      "source": "method:SessionValidator._check_login_and_attempt_relogin",
      "target": "method:SessionValidator._attempt_relogin",
      "type": "calls",
      "description": "Retries login via helper when API status fails"
    },
    {
      "source": "method:SessionValidator._check_login_and_attempt_relogin",
      "target": "class:core.session_manager.SessionManager",
      "type": "depends-on",
      "description": "Requires SessionManager instance for login_status and relogin"
    },
    {
      "source": "method:SessionValidator._check_login_and_attempt_relogin",
      "target": "function:utils.login_status",
      "type": "calls",
      "description": "Imports login_status to confirm authentication state"
    },
    {
      "source": "method:SessionValidator._attempt_relogin",
      "target": "class:core.session_manager.SessionManager",
      "type": "depends-on",
      "description": "Uses SessionManager credentials/state to log back in"
    },
    {
      "source": "method:SessionValidator._attempt_relogin",
      "target": "function:utils.log_in",
      "type": "calls",
      "description": "Delegates to log_in for browser-based reauthentication"
    },
    {
      "source": "method:SessionValidator._check_and_handle_url",
      "target": "class:core.browser_manager.BrowserManager",
      "type": "depends-on",
      "description": "Reads driver.current_url and navigates via BrowserManager"
    },
    {
      "source": "method:SessionValidator._check_and_handle_url",
      "target": "function:utils.nav_to_page",
      "type": "calls",
      "description": "Uses nav_to_page to recover when outside expected domain"
    },
    {
      "source": "method:SessionValidator._check_essential_cookies",
      "target": "method:SessionValidator._should_skip_cookie_check",
      "type": "calls",
      "description": "Determines whether to bypass cookie enforcement"
    },
    {
      "source": "method:SessionValidator._check_essential_cookies",
      "target": "method:BrowserManager.get_cookies",
      "type": "depends-on",
      "description": "Requires BrowserManager to retrieve cookie list"
    },
    {
      "source": "method:SessionValidator._sync_cookies_to_requests",
      "target": "method:APIManager.sync_cookies_from_browser",
      "type": "calls",
      "description": "Delegates actual cookie transfer to APIManager"
    },
    {
      "source": "method:SessionValidator._check_csrf_token",
      "target": "method:APIManager.get_csrf_token",
      "type": "calls",
      "description": "Fetches CSRF token via APIManager when missing"
    },
    {
      "source": "method:SessionValidator.validate_session_cookies",
      "target": "class:core.browser_manager.BrowserManager",
      "type": "depends-on",
      "description": "Needs browser session to confirm cookie presence"
    },
    {
      "source": "method:SessionValidator.validate_session_cookies",
      "target": "method:BrowserManager.get_cookies",
      "type": "depends-on",
      "description": "Delegates cookie lookup to BrowserManager"
    },
    {
      "source": "method:SessionValidator.verify_login_status",
      "target": "method:APIManager.verify_api_login_status",
      "type": "calls",
      "description": "Uses APIManager tri-state login check"
    },
    {
      "source": "class:core.database_manager.DatabaseManager",
      "target": "method:DatabaseManager.ensure_ready",
      "type": "defines",
      "description": "Method ensures DB ready"
    },
    {
      "source": "class:core.database_manager.DatabaseManager",
      "target": "method:DatabaseManager._initialize_engine_and_session",
      "type": "defines",
      "description": "Method initializes engine and session"
    },
    {
      "source": "class:core.database_manager.DatabaseManager",
      "target": "method:DatabaseManager.get_session",
      "type": "defines",
      "description": "Method obtains DB session"
    },
    {
      "source": "class:core.database_manager.DatabaseManager",
      "target": "method:DatabaseManager.return_session",
      "type": "defines",
      "description": "Method returns DB session"
    },
    {
      "source": "class:core.database_manager.DatabaseManager",
      "target": "method:DatabaseManager.get_session_context",
      "type": "defines",
      "description": "Method provides session context manager"
    },
    {
      "source": "class:core.database_manager.DatabaseManager",
      "target": "method:DatabaseManager.batch_operation_context",
      "type": "defines",
      "description": "Method provides batch context"
    },
    {
      "source": "class:core.database_manager.DatabaseManager",
      "target": "method:DatabaseManager.async_session_context",
      "type": "defines",
      "description": "Method provides async session context"
    },
    {
      "source": "class:core.database_manager.DatabaseManager",
      "target": "method:DatabaseManager.async_execute_query",
      "type": "defines",
      "description": "Method executes async query"
    },
    {
      "source": "class:core.database_manager.DatabaseManager",
      "target": "method:DatabaseManager.get_performance_stats",
      "type": "defines",
      "description": "Method exposes DB performance stats"
    },
    {
      "source": "class:core.database_manager.DatabaseManager",
      "target": "method:DatabaseManager.close_connections",
      "type": "defines",
      "description": "Method closes connections"
    },
    {
      "source": "function:core.error_handling.with_enhanced_recovery",
      "target": "class:core.error_handling.ErrorContext",
      "type": "uses",
      "description": "Decorator instantiates ErrorContext to track attempts"
    },
    {
      "source": "function:core.error_handling.with_enhanced_recovery",
      "target": "class:core.error_handling.EnhancedErrorRecovery",
      "type": "uses",
      "description": "Decorator consults global EnhancedErrorRecovery for stats and circuit breaker"
    },
    {
      "source": "function:core.error_handling.with_enhanced_recovery",
      "target": "function:core.error_handling.handle_partial_success",
      "type": "calls",
      "description": "Decorator routes to partial success handler when retries exhausted"
    },
    {
      "source": "function:core.error_handling.with_enhanced_recovery",
      "target": "function:core.error_handling.create_user_guidance",
      "type": "relates-to",
      "description": "Presets pass guidance mapping for user tips"
    },
    {
      "source": "function:core.error_handling.with_api_recovery",
      "target": "function:core.error_handling.with_enhanced_recovery",
      "type": "wraps",
      "description": "API decorator returns configured enhanced recovery wrapper"
    },
    {
      "source": "function:core.error_handling.with_database_recovery",
      "target": "function:core.error_handling.with_enhanced_recovery",
      "type": "wraps",
      "description": "Database decorator returns configured enhanced recovery wrapper"
    },
    {
      "source": "function:core.error_handling.with_file_recovery",
      "target": "function:core.error_handling.with_enhanced_recovery",
      "type": "wraps",
      "description": "File decorator returns configured enhanced recovery wrapper"
    },
    {
      "source": "method:BrowserManager.ensure_driver_live",
      "target": "method:BrowserManager.start_browser",
      "type": "calls",
      "description": "Launches start_browser when browser_needed is True",
      "quality": "stable"
    },
    {
      "source": "method:BrowserManager.start_browser",
      "target": "method:BrowserManager._load_saved_cookies",
      "type": "calls",
      "description": "Loads persisted cookies immediately after navigation"
    },
    {
      "source": "method:BrowserManager._load_saved_cookies",
      "target": "function:utils._load_login_cookies",
      "type": "calls",
      "description": "Delegates cookie restoration to shared utils helper"
    },
    {
      "source": "method:SessionManager.ensure_session_ready",
      "target": "module:core.session_validator",
      "type": "depends-on",
      "description": "Delegates readiness checks to SessionValidator"
    },
    {
      "source": "method:SessionManager.ensure_session_ready",
      "target": "module:core.browser_manager",
      "type": "depends-on",
      "description": "Requires BrowserManager.ensure_driver_live"
    },
    {
      "source": "method:SessionManager.ensure_session_ready",
      "target": "method:BrowserManager.ensure_driver_live",
      "type": "calls",
      "description": "Readiness path confirms BrowserManager can start or validate driver"
    },
    {
      "source": "method:SessionManager.ensure_session_ready",
      "target": "module:core.api_manager",
      "type": "uses",
      "description": "Retrieves identifiers and CSRF token via APIManager"
    },
    {
      "source": "method:SessionManager.ensure_db_ready",
      "target": "method:DatabaseManager.ensure_ready",
      "type": "calls",
      "description": "Delegates database readiness to DatabaseManager"
    },
    {
      "source": "method:SessionManager._initialize_rate_limiter",
      "target": "function:utils.get_rate_limiter",
      "type": "calls",
      "description": "Requests AdaptiveRateLimiter singleton from utils"
    },
    {
      "source": "method:SessionManager._initialize_rate_limiter",
      "target": "method:SessionManager._build_endpoint_profile_config",
      "type": "calls",
      "description": "Builds throttle profiles prior to limiter creation"
    },
    {
      "source": "method:SessionManager._initialize_rate_limiter",
      "target": "method:SessionManager._calculate_endpoint_rate_cap",
      "type": "calls",
      "description": "Derives max fill rate from endpoint profiles"
    },
    {
      "source": "method:SessionManager.start_sess",
      "target": "method:DatabaseManager.ensure_ready",
      "type": "calls",
      "description": "Session start ensures database ready first"
    },
    {
      "source": "method:SessionManager.start_sess",
      "target": "method:BrowserManager.start_browser",
      "type": "calls",
      "description": "Session start routine boots BrowserManager when browser required",
      "quality": "stable"
    },
    {
      "source": "method:SessionManager.close_sess",
      "target": "method:BrowserManager.close_browser",
      "type": "calls",
      "description": "Session shutdown tears down BrowserManager driver"
    },
    {
      "source": "method:DatabaseManager.ensure_ready",
      "target": "method:DatabaseManager._initialize_engine_and_session",
      "type": "calls",
      "description": "Triggers initialization when engine missing"
    },
    {
      "source": "method:DatabaseManager.get_session",
      "target": "method:DatabaseManager._initialize_engine_and_session",
      "type": "calls",
      "description": "Lazy initialization path before creating session"
    },
    {
      "source": "method:DatabaseManager.get_session",
      "target": "method:DatabaseManager.return_session",
      "type": "relates-to",
      "description": "Sessions obtained here must be returned via return_session"
    },
    {
      "source": "method:DatabaseManager.get_session_context",
      "target": "method:DatabaseManager.get_session",
      "type": "calls",
      "description": "Context manager acquires session"
    },
    {
      "source": "method:DatabaseManager.get_session_context",
      "target": "method:DatabaseManager.return_session",
      "type": "calls",
      "description": "Context manager ensures session returned"
    },
    {
      "source": "method:DatabaseManager.batch_operation_context",
      "target": "method:DatabaseManager.get_session",
      "type": "calls",
      "description": "Batch context acquires session for work"
    },
    {
      "source": "method:DatabaseManager.batch_operation_context",
      "target": "method:DatabaseManager.return_session",
      "type": "calls",
      "description": "Batch context returns session after use"
    },
    {
      "source": "method:DatabaseManager.async_session_context",
      "target": "method:DatabaseManager.get_session",
      "type": "calls",
      "description": "Async context fetches session via executor"
    },
    {
      "source": "method:DatabaseManager.async_session_context",
      "target": "method:DatabaseManager.return_session",
      "type": "calls",
      "description": "Async context returns session in executor"
    },
    {
      "source": "method:DatabaseManager.async_execute_query",
      "target": "method:DatabaseManager.async_session_context",
      "type": "relates-to",
      "description": "Designed to be used inside async session context"
    },
    {
      "source": "method:SessionManager._sync_cookies_to_requests",
      "target": "module:core.api_manager",
      "type": "mutates",
      "description": "Writes cookies into APIManager requests session",
      "quality": "monitor"
    },
    {
      "source": "method:SessionManager.check_session_health",
      "target": "method:SessionManager.is_sess_valid",
      "type": "calls",
      "description": "Health monitoring relies on session validity"
    },
    {
      "source": "file:main.py",
      "target": "function:main._load_and_validate_config_schema",
      "type": "defines",
      "description": "Defines configuration helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._check_processing_limits",
      "type": "defines",
      "description": "Defines configuration helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._check_rate_limiting_settings",
      "type": "defines",
      "description": "Defines configuration helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._log_basic_configuration_values",
      "type": "defines",
      "description": "Defines configuration helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._should_suppress_config_warnings",
      "type": "defines",
      "description": "Defines configuration helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._warn_if_unsafe_profile",
      "type": "defines",
      "description": "Defines configuration helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._log_persisted_rate_state",
      "type": "defines",
      "description": "Defines configuration helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._log_rate_limiter_summary",
      "type": "defines",
      "description": "Defines configuration helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._log_configuration_summary",
      "type": "defines",
      "description": "Defines configuration helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main.validate_action_config",
      "type": "defines",
      "description": "Defines configuration validation entry"
    },
    {
      "source": "function:main.validate_action_config",
      "target": "function:main._load_and_validate_config_schema",
      "type": "calls",
      "description": "Loads configuration schema"
    },
    {
      "source": "function:main.validate_action_config",
      "target": "function:main._check_processing_limits",
      "type": "calls",
      "description": "Validates processing limits"
    },
    {
      "source": "function:main.validate_action_config",
      "target": "function:main._check_rate_limiting_settings",
      "type": "calls",
      "description": "Checks rate limiting settings"
    },
    {
      "source": "function:main.validate_action_config",
      "target": "function:main._log_configuration_summary",
      "type": "calls",
      "description": "Displays configuration summary"
    },
    {
      "source": "function:main._log_configuration_summary",
      "target": "function:main._log_basic_configuration_values",
      "type": "calls",
      "description": "Prints core configuration values"
    },
    {
      "source": "function:main._log_configuration_summary",
      "target": "function:main._should_suppress_config_warnings",
      "type": "calls",
      "description": "Determines warning suppression"
    },
    {
      "source": "function:main._log_configuration_summary",
      "target": "function:main._warn_if_unsafe_profile",
      "type": "calls",
      "description": "Warns about unsafe profiles"
    },
    {
      "source": "function:main._log_configuration_summary",
      "target": "function:main._log_rate_limiter_summary",
      "type": "calls",
      "description": "Summarizes rate limiter state"
    },
    {
      "source": "function:main._log_rate_limiter_summary",
      "target": "function:main._log_persisted_rate_state",
      "type": "calls",
      "description": "Logs persisted limiter history"
    },
    {
      "source": "file:main.py",
      "target": "class:main._CachingState",
      "type": "defines",
      "description": "Declares caching initialization state holder"
    },
    {
      "source": "file:main.py",
      "target": "function:main.initialize_aggressive_caching",
      "type": "defines",
      "description": "Defines aggressive caching initializer"
    },
    {
      "source": "file:main.py",
      "target": "function:main.ensure_caching_initialized",
      "type": "defines",
      "description": "Defines lazy caching guard"
    },
    {
      "source": "file:main.py",
      "target": "function:main._determine_browser_requirement",
      "type": "defines",
      "description": "Defines exec_actn helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._determine_required_state",
      "type": "defines",
      "description": "Defines exec_actn helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._ensure_required_state",
      "type": "defines",
      "description": "Defines exec_actn helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._prepare_action_arguments",
      "type": "defines",
      "description": "Defines exec_actn helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._execute_action_function",
      "type": "defines",
      "description": "Defines exec_actn helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._should_close_session",
      "type": "defines",
      "description": "Defines exec_actn helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._log_performance_metrics",
      "type": "defines",
      "description": "Defines exec_actn helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._perform_session_cleanup",
      "type": "defines",
      "description": "Defines exec_actn helper"
    },
    {
      "source": "function:main.ensure_caching_initialized",
      "target": "function:main.initialize_aggressive_caching",
      "type": "calls",
      "description": "Warms caches when first requested"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main._determine_browser_requirement",
      "type": "calls",
      "description": "Evaluates browser necessity for action"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main._determine_required_state",
      "type": "calls",
      "description": "Identifies required session readiness"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main._ensure_required_state",
      "type": "calls",
      "description": "Prepares SessionManager state before execution"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main._prepare_action_arguments",
      "type": "calls",
      "description": "Builds argument list for action function"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main._execute_action_function",
      "type": "calls",
      "description": "Invokes the action callable"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main._should_close_session",
      "type": "calls",
      "description": "Determines whether to close session post-run"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main._log_performance_metrics",
      "type": "calls",
      "description": "Logs action duration and memory usage"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:main._perform_session_cleanup",
      "type": "calls",
      "description": "Performs post-action session cleanup"
    },
    {
      "source": "file:main.py",
      "target": "function:main.menu",
      "type": "defines",
      "description": "Defines CLI menu renderer"
    },
    {
      "source": "file:main.py",
      "target": "function:main.clear_log_file",
      "type": "defines",
      "description": "Defines log maintenance helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._delete_table_records",
      "type": "defines",
      "description": "Defines table deletion helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._perform_deletions",
      "type": "defines",
      "description": "Defines deletion coordinator"
    },
    {
      "source": "file:main.py",
      "target": "function:main._run_action6_gather",
      "type": "defines",
      "description": "Defines Action 6 workflow wrapper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._run_action7_inbox",
      "type": "defines",
      "description": "Defines Action 7 workflow wrapper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._run_action9_process_productive",
      "type": "defines",
      "description": "Defines Action 9 workflow wrapper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._run_action8_send_messages",
      "type": "defines",
      "description": "Defines Action 8 workflow wrapper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._truncate_all_tables",
      "type": "defines",
      "description": "Defines reset truncation helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._reinitialize_database_schema",
      "type": "defines",
      "description": "Defines schema recreation helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._seed_message_templates",
      "type": "defines",
      "description": "Defines template seeding helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._initialize_ethnicity_columns_from_metadata",
      "type": "defines",
      "description": "Defines ethnicity metadata initializer"
    },
    {
      "source": "file:main.py",
      "target": "function:main._close_main_pool_for_reset",
      "type": "defines",
      "description": "Defines pool shutdown helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._perform_database_reset_steps",
      "type": "defines",
      "description": "Defines reset orchestration helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._display_table_statistics",
      "type": "defines",
      "description": "Defines restore statistics reporter"
    },
    {
      "source": "file:main.py",
      "target": "function:main._display_session_info",
      "type": "defines",
      "description": "Defines session info printer"
    },
    {
      "source": "file:main.py",
      "target": "function:main._handle_logged_in_status",
      "type": "defines",
      "description": "Defines login success handler"
    },
    {
      "source": "file:main.py",
      "target": "function:main._verify_login_success",
      "type": "defines",
      "description": "Defines post-login verification helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._attempt_login",
      "type": "defines",
      "description": "Defines credential login helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._perform_gedcom_search",
      "type": "defines",
      "description": "Defines GEDCOM search helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._perform_api_search_fallback",
      "type": "defines",
      "description": "Defines API fallback helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._format_table_row",
      "type": "defines",
      "description": "Defines table row formatter"
    },
    {
      "source": "file:main.py",
      "target": "function:main._compute_table_widths",
      "type": "defines",
      "description": "Defines table width calculator"
    },
    {
      "source": "file:main.py",
      "target": "function:main._log_result_table",
      "type": "defines",
      "description": "Defines table logging helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._display_search_results",
      "type": "defines",
      "description": "Defines comparison result display"
    },
    {
      "source": "file:main.py",
      "target": "function:main._display_detailed_match_info",
      "type": "defines",
      "description": "Defines detailed match reporter"
    },
    {
      "source": "function:main._perform_deletions",
      "target": "function:main._delete_table_records",
      "type": "calls",
      "description": "Deletes each dependent table"
    },
    {
      "source": "function:main.all_but_first_actn",
      "target": "function:main._perform_deletions",
      "type": "calls",
      "description": "Executes coordinated deletions"
    },
    {
      "source": "function:main._run_action6_gather",
      "target": "function:main.gather_dna_matches",
      "type": "calls",
      "description": "Delegates to gather wrapper"
    },
    {
      "source": "function:main._run_action7_inbox",
      "target": "function:utils.nav_to_page",
      "type": "calls",
      "description": "Navigates to inbox page"
    },
    {
      "source": "function:main._run_action7_inbox",
      "target": "class:action7_inbox.InboxProcessor",
      "type": "uses",
      "description": "Instantiates inbox processor"
    },
    {
      "source": "function:main._run_action9_process_productive",
      "target": "function:utils.nav_to_page",
      "type": "calls",
      "description": "Navigates before productive processing"
    },
    {
      "source": "function:main._run_action8_send_messages",
      "target": "function:utils.nav_to_page",
      "type": "calls",
      "description": "Navigates before messaging"
    },
    {
      "source": "function:main._run_action8_send_messages",
      "target": "function:action8_messaging.send_messages_to_matches",
      "type": "calls",
      "description": "Executes messaging workflow"
    },
    {
      "source": "function:main._perform_database_reset_steps",
      "target": "function:main._truncate_all_tables",
      "type": "calls",
      "description": "Truncates tables pre-reset"
    },
    {
      "source": "function:main._perform_database_reset_steps",
      "target": "function:main._reinitialize_database_schema",
      "type": "calls",
      "description": "Rebuilds schema"
    },
    {
      "source": "function:main._perform_database_reset_steps",
      "target": "function:main._seed_message_templates",
      "type": "calls",
      "description": "Seeds message templates"
    },
    {
      "source": "function:main._perform_database_reset_steps",
      "target": "function:main._initialize_ethnicity_columns_from_metadata",
      "type": "calls",
      "description": "Initializes ethnicity metadata"
    },
    {
      "source": "function:main.reset_db_actn",
      "target": "function:main._close_main_pool_for_reset",
      "type": "calls",
      "description": "Closes primary pool before reset"
    },
    {
      "source": "function:main.reset_db_actn",
      "target": "function:main._perform_database_reset_steps",
      "type": "calls",
      "description": "Orchestrates reset steps"
    },
    {
      "source": "function:main.restore_db_actn",
      "target": "function:main._display_table_statistics",
      "type": "calls",
      "description": "Displays restored table counts"
    },
    {
      "source": "function:main._handle_logged_in_status",
      "target": "function:main._display_session_info",
      "type": "calls",
      "description": "Shows session identifiers"
    },
    {
      "source": "function:main._verify_login_success",
      "target": "function:main._display_session_info",
      "type": "calls",
      "description": "Prints identifiers after verifying"
    },
    {
      "source": "function:main._attempt_login",
      "target": "function:main._verify_login_success",
      "type": "calls",
      "description": "Validates login result"
    },
    {
      "source": "function:main.check_login_actn",
      "target": "function:main._handle_logged_in_status",
      "type": "calls",
      "description": "Handles already-logged-in path"
    },
    {
      "source": "function:main.check_login_actn",
      "target": "function:main._attempt_login",
      "type": "calls",
      "description": "Attempts credential login"
    },
    {
      "source": "function:main.run_gedcom_then_api_fallback",
      "target": "function:main._perform_gedcom_search",
      "type": "calls",
      "description": "Executes GEDCOM search"
    },
    {
      "source": "function:main.run_gedcom_then_api_fallback",
      "target": "function:main._perform_api_search_fallback",
      "type": "calls",
      "description": "Runs API fallback search"
    },
    {
      "source": "function:main.run_gedcom_then_api_fallback",
      "target": "function:main._display_search_results",
      "type": "calls",
      "description": "Displays comparison tables"
    },
    {
      "source": "function:main.run_gedcom_then_api_fallback",
      "target": "function:main._display_detailed_match_info",
      "type": "calls",
      "description": "Shows detailed match info"
    },
    {
      "source": "function:main._display_search_results",
      "target": "function:main._log_result_table",
      "type": "calls",
      "description": "Logs detailed tables"
    },
    {
      "source": "function:main._log_result_table",
      "target": "function:main._compute_table_widths",
      "type": "calls",
      "description": "Calculates column widths"
    },
    {
      "source": "function:main._log_result_table",
      "target": "function:main._format_table_row",
      "type": "calls",
      "description": "Formats row output"
    },
    {
      "source": "function:main.main",
      "target": "function:main.menu",
      "type": "calls",
      "description": "Displays menu each loop"
    },
    {
      "source": "function:main._perform_api_search_fallback",
      "target": "method:SessionManager.ensure_session_ready",
      "type": "calls",
      "description": "Ensures session readiness for API fallback"
    },
    {
      "source": "function:main._perform_api_search_fallback",
      "target": "method:APIManager.sync_cookies_from_browser",
      "type": "calls",
      "description": "Syncs cookies before API search"
    },
    {
      "source": "file:main.py",
      "target": "function:main._import_search_modules",
      "type": "defines",
      "description": "Defines GEDCOM/API import aggregator"
    },
    {
      "source": "file:main.py",
      "target": "function:main._set_windows_console_focus",
      "type": "defines",
      "description": "Defines console focus helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._print_config_error_message",
      "type": "defines",
      "description": "Defines configuration error notifier"
    },
    {
      "source": "file:main.py",
      "target": "function:main._check_action_confirmation",
      "type": "defines",
      "description": "Defines destructive action confirmation"
    },
    {
      "source": "file:main.py",
      "target": "function:main._run_main_tests",
      "type": "defines",
      "description": "Defines main-specific test runner"
    },
    {
      "source": "file:main.py",
      "target": "function:main._run_all_tests",
      "type": "defines",
      "description": "Defines full test suite launcher"
    },
    {
      "source": "file:main.py",
      "target": "function:main._show_analytics_dashboard",
      "type": "defines",
      "description": "Defines analytics dashboard viewer"
    },
    {
      "source": "file:main.py",
      "target": "function:main._show_base_cache_stats",
      "type": "defines",
      "description": "Defines base cache stats viewer"
    },
    {
      "source": "file:main.py",
      "target": "function:main._show_unified_cache_stats",
      "type": "defines",
      "description": "Defines unified cache stats viewer"
    },
    {
      "source": "file:main.py",
      "target": "function:main._show_tree_stats_cache",
      "type": "defines",
      "description": "Defines tree stats cache viewer"
    },
    {
      "source": "file:main.py",
      "target": "function:main._show_performance_cache_stats",
      "type": "defines",
      "description": "Defines performance cache stats viewer"
    },
    {
      "source": "file:main.py",
      "target": "function:main._show_cache_statistics",
      "type": "defines",
      "description": "Defines aggregated cache stats screen"
    },
    {
      "source": "file:main.py",
      "target": "function:main._toggle_log_level",
      "type": "defines",
      "description": "Defines log level toggle helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._handle_database_actions",
      "type": "defines",
      "description": "Defines database action dispatcher"
    },
    {
      "source": "file:main.py",
      "target": "function:main._handle_action6_with_start_page",
      "type": "defines",
      "description": "Defines Action 6 start page handler"
    },
    {
      "source": "file:main.py",
      "target": "function:main._handle_browser_actions",
      "type": "defines",
      "description": "Defines browser action dispatcher"
    },
    {
      "source": "file:main.py",
      "target": "function:main._handle_test_options",
      "type": "defines",
      "description": "Defines test command handler"
    },
    {
      "source": "file:main.py",
      "target": "function:main._handle_meta_options",
      "type": "defines",
      "description": "Defines meta command handler"
    },
    {
      "source": "file:main.py",
      "target": "function:main._dispatch_menu_action",
      "type": "defines",
      "description": "Defines top-level menu dispatcher"
    },
    {
      "source": "file:main.py",
      "target": "function:main._check_startup_status",
      "type": "defines",
      "description": "Defines startup health check"
    },
    {
      "source": "function:main.main",
      "target": "function:main._set_windows_console_focus",
      "type": "calls",
      "description": "Focuses the console window on Windows"
    },
    {
      "source": "function:main.main",
      "target": "function:main._check_action_confirmation",
      "type": "calls",
      "description": "Confirms destructive actions before dispatch"
    },
    {
      "source": "function:main._initialize_application",
      "target": "function:main._print_config_error_message",
      "type": "calls",
      "description": "Terminates when configuration is missing"
    },
    {
      "source": "function:main._show_cache_statistics",
      "target": "function:main._show_base_cache_stats",
      "type": "calls",
      "description": "Displays base cache stats"
    },
    {
      "source": "function:main._show_cache_statistics",
      "target": "function:main._show_unified_cache_stats",
      "type": "calls",
      "description": "Displays unified cache stats"
    },
    {
      "source": "function:main._show_cache_statistics",
      "target": "function:main._show_tree_stats_cache",
      "type": "calls",
      "description": "Displays tree stats cache"
    },
    {
      "source": "function:main._show_cache_statistics",
      "target": "function:main._show_performance_cache_stats",
      "type": "calls",
      "description": "Displays performance cache stats"
    },
    {
      "source": "function:main._handle_database_actions",
      "target": "function:main.exec_actn",
      "type": "calls",
      "description": "Routes database action via exec_actn"
    },
    {
      "source": "function:main._handle_database_actions",
      "target": "function:main.all_but_first_actn",
      "type": "calls",
      "description": "Dispatches Action 0"
    },
    {
      "source": "function:main._handle_database_actions",
      "target": "function:main.reset_db_actn",
      "type": "calls",
      "description": "Dispatches Action 2"
    },
    {
      "source": "function:main._handle_database_actions",
      "target": "function:main.backup_db_actn",
      "type": "calls",
      "description": "Dispatches Action 3"
    },
    {
      "source": "function:main._handle_database_actions",
      "target": "function:main.restore_db_actn",
      "type": "calls",
      "description": "Dispatches Action 4"
    },
    {
      "source": "function:main._handle_action6_with_start_page",
      "target": "function:main.exec_actn",
      "type": "calls",
      "description": "Executes Action 6 via exec_actn"
    },
    {
      "source": "function:main._handle_action6_with_start_page",
      "target": "function:main.gather_dna_matches",
      "type": "calls",
      "description": "Invokes gather wrapper with parsed start page"
    },
    {
      "source": "function:main._handle_browser_actions",
      "target": "function:main.ensure_caching_initialized",
      "type": "calls",
      "description": "Warms caches before certain actions"
    },
    {
      "source": "function:main._handle_browser_actions",
      "target": "function:main.exec_actn",
      "type": "calls",
      "description": "Executes browser actions via exec_actn"
    },
    {
      "source": "function:main._handle_browser_actions",
      "target": "function:main.run_core_workflow_action",
      "type": "calls",
      "description": "Dispatches Action 1 core workflow"
    },
    {
      "source": "function:main._handle_browser_actions",
      "target": "function:main.check_login_actn",
      "type": "calls",
      "description": "Dispatches Action 5"
    },
    {
      "source": "function:main._handle_browser_actions",
      "target": "function:main.srch_inbox_actn",
      "type": "calls",
      "description": "Dispatches Action 7"
    },
    {
      "source": "function:main._handle_browser_actions",
      "target": "function:main.send_messages_action",
      "type": "calls",
      "description": "Dispatches Action 8"
    },
    {
      "source": "function:main._handle_browser_actions",
      "target": "function:main.process_productive_messages_action",
      "type": "calls",
      "description": "Dispatches Action 9"
    },
    {
      "source": "function:main._handle_browser_actions",
      "target": "function:main.run_gedcom_then_api_fallback",
      "type": "calls",
      "description": "Dispatches Action 10"
    },
    {
      "source": "function:main._handle_browser_actions",
      "target": "function:main._handle_action6_with_start_page",
      "type": "calls",
      "description": "Handles Action 6 variants"
    },
    {
      "source": "function:main._handle_test_options",
      "target": "function:main._run_main_tests",
      "type": "calls",
      "description": "Runs main test suite"
    },
    {
      "source": "function:main._handle_test_options",
      "target": "function:main._run_all_tests",
      "type": "calls",
      "description": "Runs full module tests"
    },
    {
      "source": "function:main._handle_meta_options",
      "target": "function:main._show_analytics_dashboard",
      "type": "calls",
      "description": "Displays analytics dashboard"
    },
    {
      "source": "function:main._handle_meta_options",
      "target": "function:main._show_cache_statistics",
      "type": "calls",
      "description": "Displays cache statistics"
    },
    {
      "source": "function:main._handle_meta_options",
      "target": "function:main._toggle_log_level",
      "type": "calls",
      "description": "Toggles console log level"
    },
    {
      "source": "function:main._dispatch_menu_action",
      "target": "function:main._handle_database_actions",
      "type": "calls",
      "description": "Routes database actions"
    },
    {
      "source": "function:main._dispatch_menu_action",
      "target": "function:main._handle_browser_actions",
      "type": "calls",
      "description": "Routes browser actions"
    },
    {
      "source": "function:main._dispatch_menu_action",
      "target": "function:main._handle_test_options",
      "type": "calls",
      "description": "Routes test commands"
    },
    {
      "source": "function:main._dispatch_menu_action",
      "target": "function:main._handle_meta_options",
      "type": "calls",
      "description": "Routes meta commands"
    },
    {
      "source": "function:main._check_startup_status",
      "target": "method:DatabaseManager.ensure_ready",
      "type": "calls",
      "description": "Ensures database is ready"
    },
    {
      "source": "function:main._check_startup_status",
      "target": "method:APIManager.sync_cookies_from_browser",
      "type": "calls",
      "description": "Syncs cookies into API session"
    },
    {
      "source": "file:main.py",
      "target": "function:main._check_lm_studio_running",
      "type": "defines",
      "description": "Defines LM Studio process detector"
    },
    {
      "source": "file:main.py",
      "target": "function:main._validate_local_llm_config",
      "type": "defines",
      "description": "Defines local LLM validation helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._validate_cloud_provider",
      "type": "defines",
      "description": "Defines cloud provider config validator"
    },
    {
      "source": "file:main.py",
      "target": "function:main._validate_ai_provider_on_startup",
      "type": "defines",
      "description": "Defines AI provider startup validator"
    },
    {
      "source": "file:main.py",
      "target": "function:main._display_tree_owner",
      "type": "defines",
      "description": "Defines tree owner display helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._pre_authenticate_session",
      "type": "defines",
      "description": "Defines session pre-auth helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._pre_authenticate_ms_graph",
      "type": "defines",
      "description": "Defines MS Graph pre-auth helper"
    },
    {
      "source": "file:main.py",
      "target": "function:main._cleanup_session_manager",
      "type": "defines",
      "description": "Defines session cleanup routine"
    },
    {
      "source": "file:main.py",
      "target": "function:main._test_clear_log_file_function",
      "type": "defines",
      "description": "Defines log file clearing test"
    },
    {
      "source": "file:main.py",
      "target": "function:main._test_main_function_structure",
      "type": "defines",
      "description": "Defines main() structure test"
    },
    {
      "source": "file:main.py",
      "target": "function:main._test_reset_db_actn_integration",
      "type": "defines",
      "description": "Defines reset_db_actn integration test"
    },
    {
      "source": "file:main.py",
      "target": "function:main._test_edge_case_handling",
      "type": "defines",
      "description": "Defines edge case import test"
    },
    {
      "source": "file:main.py",
      "target": "function:main._test_import_error_handling",
      "type": "defines",
      "description": "Defines import error handling test"
    },
    {
      "source": "file:main.py",
      "target": "function:main._test_validate_action_config",
      "type": "defines",
      "description": "Defines action config validation test"
    },
    {
      "source": "file:main.py",
      "target": "function:main._test_database_integration",
      "type": "defines",
      "description": "Defines database integration test"
    },
    {
      "source": "file:main.py",
      "target": "function:main._test_action_integration",
      "type": "defines",
      "description": "Defines action integration test"
    },
    {
      "source": "file:main.py",
      "target": "function:main._test_import_performance",
      "type": "defines",
      "description": "Defines import performance test"
    },
    {
      "source": "file:main.py",
      "target": "function:main._test_memory_efficiency",
      "type": "defines",
      "description": "Defines memory efficiency test"
    },
    {
      "source": "file:main.py",
      "target": "function:main._test_function_call_performance",
      "type": "defines",
      "description": "Defines function call performance test"
    },
    {
      "source": "file:main.py",
      "target": "function:main._test_error_handling_structure",
      "type": "defines",
      "description": "Defines error handling structure test"
    },
    {
      "source": "file:main.py",
      "target": "function:main._test_cleanup_procedures",
      "type": "defines",
      "description": "Defines cleanup procedure test"
    },
    {
      "source": "file:main.py",
      "target": "function:main._test_exception_handling_coverage",
      "type": "defines",
      "description": "Defines exception handling coverage test"
    },
    {
      "source": "file:main.py",
      "target": "function:main.main_module_tests",
      "type": "defines",
      "description": "Defines main module test suite"
    },
    {
      "source": "file:main.py",
      "target": "function:main.run_comprehensive_tests",
      "type": "defines",
      "description": "Defines comprehensive test wrapper"
    },
    {
      "source": "function:main.main",
      "target": "function:main._validate_ai_provider_on_startup",
      "type": "calls",
      "description": "Validates AI providers during startup"
    },
    {
      "source": "function:main.main",
      "target": "function:main._display_tree_owner",
      "type": "calls",
      "description": "Displays tree owner after startup"
    },
    {
      "source": "function:main.main",
      "target": "function:main._pre_authenticate_ms_graph",
      "type": "calls",
      "description": "Pre-authenticates Microsoft Graph"
    },
    {
      "source": "function:main.main",
      "target": "function:main._cleanup_session_manager",
      "type": "calls",
      "description": "Cleans up session manager on exit"
    },
    {
      "source": "function:main._validate_ai_provider_on_startup",
      "target": "function:main._validate_local_llm_config",
      "type": "calls",
      "description": "Validates local LM Studio configuration"
    },
    {
      "source": "function:main._validate_ai_provider_on_startup",
      "target": "function:main._validate_cloud_provider",
      "type": "calls",
      "description": "Validates cloud AI provider settings"
    },
    {
      "source": "function:main.main_module_tests",
      "target": "function:main._test_clear_log_file_function",
      "type": "uses",
      "description": "Registers log clearing test"
    },
    {
      "source": "function:main.main_module_tests",
      "target": "function:main._test_main_function_structure",
      "type": "uses",
      "description": "Registers main() structure test"
    },
    {
      "source": "function:main.main_module_tests",
      "target": "function:main._test_reset_db_actn_integration",
      "type": "uses",
      "description": "Registers reset_db_actn integration test"
    },
    {
      "source": "function:main.main_module_tests",
      "target": "function:main._test_edge_case_handling",
      "type": "uses",
      "description": "Registers edge case import test"
    },
    {
      "source": "function:main.main_module_tests",
      "target": "function:main._test_import_error_handling",
      "type": "uses",
      "description": "Registers import error handling test"
    },
    {
      "source": "function:main.main_module_tests",
      "target": "function:main._test_validate_action_config",
      "type": "uses",
      "description": "Registers action config validation test"
    },
    {
      "source": "function:main.main_module_tests",
      "target": "function:main._test_database_integration",
      "type": "uses",
      "description": "Registers database integration test"
    },
    {
      "source": "function:main.main_module_tests",
      "target": "function:main._test_action_integration",
      "type": "uses",
      "description": "Registers action integration test"
    },
    {
      "source": "function:main.main_module_tests",
      "target": "function:main._test_import_performance",
      "type": "uses",
      "description": "Registers import performance test"
    },
    {
      "source": "function:main.main_module_tests",
      "target": "function:main._test_memory_efficiency",
      "type": "uses",
      "description": "Registers memory efficiency test"
    },
    {
      "source": "function:main.main_module_tests",
      "target": "function:main._test_function_call_performance",
      "type": "uses",
      "description": "Registers function call performance test"
    },
    {
      "source": "function:main.main_module_tests",
      "target": "function:main._test_error_handling_structure",
      "type": "uses",
      "description": "Registers error handling structure test"
    },
    {
      "source": "function:main.main_module_tests",
      "target": "function:main._test_cleanup_procedures",
      "type": "uses",
      "description": "Registers cleanup procedure test"
    },
    {
      "source": "function:main.main_module_tests",
      "target": "function:main._test_exception_handling_coverage",
      "type": "uses",
      "description": "Registers exception handling coverage test"
    },
    {
      "source": "function:main.run_comprehensive_tests",
      "target": "function:main.main_module_tests",
      "type": "calls",
      "description": "Runs main module test suite"
    },
    {
      "source": "file:analytics.py",
      "target": "class:analytics._State",
      "type": "defines",
      "description": "Defines transient analytics state container"
    },
    {
      "source": "file:analytics.py",
      "target": "function:analytics.set_transient_extras",
      "type": "defines",
      "description": "Defines analytics extras setter"
    },
    {
      "source": "file:analytics.py",
      "target": "function:analytics.pop_transient_extras",
      "type": "defines",
      "description": "Defines analytics extras popper"
    },
    {
      "source": "file:analytics.py",
      "target": "function:analytics._get_analytics_path",
      "type": "defines",
      "description": "Defines analytics log path resolver"
    },
    {
      "source": "file:analytics.py",
      "target": "function:analytics.log_event",
      "type": "defines",
      "description": "Defines analytics event logger"
    },
    {
      "source": "file:analytics.py",
      "target": "function:analytics._parse_analytics_line",
      "type": "defines",
      "description": "Defines analytics line parser"
    },
    {
      "source": "file:analytics.py",
      "target": "function:analytics._parse_timestamp",
      "type": "defines",
      "description": "Defines analytics timestamp parser"
    },
    {
      "source": "file:analytics.py",
      "target": "function:analytics._initialize_action_entry",
      "type": "defines",
      "description": "Defines rollup entry initializer"
    },
    {
      "source": "file:analytics.py",
      "target": "function:analytics._update_action_entry",
      "type": "defines",
      "description": "Defines rollup entry updater"
    },
    {
      "source": "file:analytics.py",
      "target": "function:analytics._finalize_action_entry",
      "type": "defines",
      "description": "Defines rollup entry finalizer"
    },
    {
      "source": "file:analytics.py",
      "target": "function:analytics.generate_weekly_summary",
      "type": "defines",
      "description": "Defines analytics weekly summary generator"
    },
    {
      "source": "file:analytics.py",
      "target": "function:analytics.print_weekly_summary",
      "type": "defines",
      "description": "Defines analytics weekly summary printer"
    },
    {
      "source": "function:analytics.set_transient_extras",
      "target": "class:analytics._State",
      "type": "mutates",
      "description": "Stores extras metadata in module state"
    },
    {
      "source": "function:analytics.pop_transient_extras",
      "target": "class:analytics._State",
      "type": "mutates",
      "description": "Clears and returns stored extras"
    },
    {
      "source": "function:analytics.log_event",
      "target": "function:analytics._get_analytics_path",
      "type": "calls",
      "description": "Resolves analytics output file"
    },
    {
      "source": "function:analytics.generate_weekly_summary",
      "target": "function:analytics._get_analytics_path",
      "type": "calls",
      "description": "Locates analytics log file"
    },
    {
      "source": "function:analytics.generate_weekly_summary",
      "target": "function:analytics._parse_analytics_line",
      "type": "calls",
      "description": "Parses raw analytics lines"
    },
    {
      "source": "function:analytics.generate_weekly_summary",
      "target": "function:analytics._parse_timestamp",
      "type": "calls",
      "description": "Parses analytics timestamps"
    },
    {
      "source": "function:analytics.generate_weekly_summary",
      "target": "function:analytics._initialize_action_entry",
      "type": "calls",
      "description": "Initializes new action rollup"
    },
    {
      "source": "function:analytics.generate_weekly_summary",
      "target": "function:analytics._update_action_entry",
      "type": "calls",
      "description": "Accumulates per-run metrics"
    },
    {
      "source": "function:analytics.generate_weekly_summary",
      "target": "function:analytics._finalize_action_entry",
      "type": "calls",
      "description": "Finalizes rollup entry averages"
    },
    {
      "source": "function:analytics.print_weekly_summary",
      "target": "function:analytics.generate_weekly_summary",
      "type": "calls",
      "description": "Generates summary data"
    },
    {
      "source": "function:main.run_gedcom_then_api_fallback",
      "target": "function:analytics.set_transient_extras",
      "type": "calls",
      "description": "Captures comparison analytics extras"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:analytics.pop_transient_extras",
      "type": "calls",
      "description": "Retrieves stored analytics extras"
    },
    {
      "source": "function:main.exec_actn",
      "target": "function:analytics.log_event",
      "type": "calls",
      "description": "Writes analytics record for completed action"
    },
    {
      "source": "class:analyze_test_quality.TestQualityAnalyzer",
      "target": "method:TestQualityAnalyzer.__init__",
      "type": "defines",
      "description": "Defines __init__ helper"
    },
    {
      "source": "class:analyze_test_quality.TestQualityAnalyzer",
      "target": "method:TestQualityAnalyzer.analyze_all_modules",
      "type": "defines",
      "description": "Defines analyze_all_modules helper"
    },
    {
      "source": "class:analyze_test_quality.TestQualityAnalyzer",
      "target": "method:TestQualityAnalyzer.analyze_module",
      "type": "defines",
      "description": "Defines analyze_module helper"
    },
    {
      "source": "class:analyze_test_quality.TestQualityAnalyzer",
      "target": "method:TestQualityAnalyzer._find_test_functions",
      "type": "defines",
      "description": "Defines _find_test_functions helper"
    },
    {
      "source": "class:analyze_test_quality.TestQualityAnalyzer",
      "target": "method:TestQualityAnalyzer._analyze_test_function",
      "type": "defines",
      "description": "Defines _analyze_test_function helper"
    },
    {
      "source": "class:analyze_test_quality.TestQualityAnalyzer",
      "target": "method:TestQualityAnalyzer._is_smoke_test",
      "type": "defines",
      "description": "Defines _is_smoke_test helper"
    },
    {
      "source": "class:analyze_test_quality.TestQualityAnalyzer",
      "target": "method:TestQualityAnalyzer._has_explicit_assertions",
      "type": "defines",
      "description": "Defines _has_explicit_assertions helper"
    },
    {
      "source": "class:analyze_test_quality.TestQualityAnalyzer",
      "target": "method:TestQualityAnalyzer._has_boolean_return_pattern",
      "type": "defines",
      "description": "Defines _has_boolean_return_pattern helper"
    },
    {
      "source": "class:analyze_test_quality.TestQualityAnalyzer",
      "target": "method:TestQualityAnalyzer._has_comparison_return",
      "type": "defines",
      "description": "Defines _has_comparison_return helper"
    },
    {
      "source": "class:analyze_test_quality.TestQualityAnalyzer",
      "target": "method:TestQualityAnalyzer._has_result_variable_pattern",
      "type": "defines",
      "description": "Defines _has_result_variable_pattern helper"
    },
    {
      "source": "class:analyze_test_quality.TestQualityAnalyzer",
      "target": "method:TestQualityAnalyzer._has_aggregation_pattern",
      "type": "defines",
      "description": "Defines _has_aggregation_pattern helper"
    },
    {
      "source": "class:analyze_test_quality.TestQualityAnalyzer",
      "target": "method:TestQualityAnalyzer._has_suite_finish_pattern",
      "type": "defines",
      "description": "Defines _has_suite_finish_pattern helper"
    },
    {
      "source": "class:analyze_test_quality.TestQualityAnalyzer",
      "target": "method:TestQualityAnalyzer._has_assertions",
      "type": "defines",
      "description": "Defines _has_assertions helper"
    },
    {
      "source": "class:analyze_test_quality.TestQualityAnalyzer",
      "target": "method:TestQualityAnalyzer._always_returns_true",
      "type": "defines",
      "description": "Defines _always_returns_true helper"
    },
    {
      "source": "class:analyze_test_quality.TestQualityAnalyzer",
      "target": "method:TestQualityAnalyzer._needs_authentication",
      "type": "defines",
      "description": "Defines _needs_authentication helper"
    },
    {
      "source": "class:analyze_test_quality.TestQualityAnalyzer",
      "target": "method:TestQualityAnalyzer._is_minimal_test",
      "type": "defines",
      "description": "Defines _is_minimal_test helper"
    },
    {
      "source": "class:analyze_test_quality.TestQualityAnalyzer",
      "target": "method:TestQualityAnalyzer.print_report",
      "type": "defines",
      "description": "Defines print_report helper"
    },
    {
      "source": "method:TestQualityAnalyzer.analyze_all_modules",
      "target": "method:TestQualityAnalyzer.analyze_module",
      "type": "calls",
      "description": "Processes each discovered module"
    },
    {
      "source": "method:TestQualityAnalyzer.analyze_module",
      "target": "method:TestQualityAnalyzer._find_test_functions",
      "type": "calls",
      "description": "Extracts test_* functions"
    },
    {
      "source": "method:TestQualityAnalyzer.analyze_module",
      "target": "method:TestQualityAnalyzer._analyze_test_function",
      "type": "calls",
      "description": "Evaluates each test function"
    },
    {
      "source": "method:TestQualityAnalyzer._analyze_test_function",
      "target": "method:TestQualityAnalyzer._has_assertions",
      "type": "calls",
      "description": "Checks for assertion presence"
    },
    {
      "source": "method:TestQualityAnalyzer._analyze_test_function",
      "target": "method:TestQualityAnalyzer._is_smoke_test",
      "type": "calls",
      "description": "Detects smoke-test patterns"
    },
    {
      "source": "method:TestQualityAnalyzer._analyze_test_function",
      "target": "method:TestQualityAnalyzer._always_returns_true",
      "type": "calls",
      "description": "Flags unconditional return True"
    },
    {
      "source": "method:TestQualityAnalyzer._analyze_test_function",
      "target": "method:TestQualityAnalyzer._needs_authentication",
      "type": "calls",
      "description": "Identifies auth-intensive tests"
    },
    {
      "source": "method:TestQualityAnalyzer._analyze_test_function",
      "target": "method:TestQualityAnalyzer._is_minimal_test",
      "type": "calls",
      "description": "Labels minimal logic tests"
    },
    {
      "source": "method:TestQualityAnalyzer._has_assertions",
      "target": "method:TestQualityAnalyzer._has_explicit_assertions",
      "type": "calls",
      "description": "Checks for explicit asserts"
    },
    {
      "source": "method:TestQualityAnalyzer._has_assertions",
      "target": "method:TestQualityAnalyzer._has_boolean_return_pattern",
      "type": "calls",
      "description": "Detects boolean return heuristics"
    },
    {
      "source": "method:TestQualityAnalyzer._has_assertions",
      "target": "method:TestQualityAnalyzer._has_comparison_return",
      "type": "calls",
      "description": "Detects comparison-based returns"
    },
    {
      "source": "method:TestQualityAnalyzer._has_assertions",
      "target": "method:TestQualityAnalyzer._has_result_variable_pattern",
      "type": "calls",
      "description": "Detects result variable patterns"
    },
    {
      "source": "method:TestQualityAnalyzer._has_assertions",
      "target": "method:TestQualityAnalyzer._has_aggregation_pattern",
      "type": "calls",
      "description": "Detects aggregation helpers"
    },
    {
      "source": "method:TestQualityAnalyzer._has_assertions",
      "target": "method:TestQualityAnalyzer._has_suite_finish_pattern",
      "type": "calls",
      "description": "Detects finish_suite returns"
    },
    {
      "source": "script:analyze_test_quality.__main__",
      "target": "class:analyze_test_quality.TestQualityAnalyzer",
      "type": "instantiates",
      "description": "Creates analyzer instance for CLI execution"
    },
    {
      "source": "script:analyze_test_quality.__main__",
      "target": "method:TestQualityAnalyzer.analyze_all_modules",
      "type": "calls",
      "description": "Runs repository-wide analysis"
    },
    {
      "source": "script:analyze_test_quality.__main__",
      "target": "method:TestQualityAnalyzer.print_report",
      "type": "calls",
      "description": "Outputs quality report"
    },
    {
      "source": "file:analyze_test_quality.py",
      "target": "class:analyze_test_quality.TestQualityAnalyzer",
      "type": "defines",
      "description": "Defines test quality analyzer class"
    },
    {
      "source": "file:code_quality_checker.py",
      "target": "class:code_quality_checker.QualityMetrics",
      "type": "defines",
      "description": "Defines immutable metrics dataclass"
    },
    {
      "source": "file:code_quality_checker.py",
      "target": "class:code_quality_checker.CodeQualityChecker",
      "type": "defines",
      "description": "Defines AST-driven quality checker"
    },
    {
      "source": "file:code_quality_checker.py",
      "target": "function:code_quality_checker.code_quality_checker_module_tests",
      "type": "defines",
      "description": "Registers module-level tests"
    },
    {
      "source": "file:code_quality_checker.py",
      "target": "function:code_quality_checker.run_comprehensive_tests",
      "type": "defines",
      "description": "Exports standard test runner binding"
    },
    {
      "source": "file:code_quality_checker.py",
      "target": "script:code_quality_checker.__main__",
      "type": "defines",
      "description": "Provides CLI entrypoint"
    },
    {
      "source": "class:code_quality_checker.QualityMetrics",
      "target": "method:QualityMetrics.type_hint_coverage",
      "type": "defines",
      "description": "Exposes type hint coverage property"
    },
    {
      "source": "class:code_quality_checker.QualityMetrics",
      "target": "method:QualityMetrics.quality_score",
      "type": "defines",
      "description": "Exposes composite quality score property"
    },
    {
      "source": "class:code_quality_checker.CodeQualityChecker",
      "target": "method:CodeQualityChecker.__init__",
      "type": "defines",
      "description": "Defines __init__ helper"
    },
    {
      "source": "class:code_quality_checker.CodeQualityChecker",
      "target": "method:CodeQualityChecker.check_file",
      "type": "defines",
      "description": "Defines check_file helper"
    },
    {
      "source": "class:code_quality_checker.CodeQualityChecker",
      "target": "method:CodeQualityChecker._analyze_ast",
      "type": "defines",
      "description": "Defines _analyze_ast helper"
    },
    {
      "source": "class:code_quality_checker.CodeQualityChecker",
      "target": "method:CodeQualityChecker._has_type_hints",
      "type": "defines",
      "description": "Defines _has_type_hints helper"
    },
    {
      "source": "class:code_quality_checker.CodeQualityChecker",
      "target": "method:CodeQualityChecker._calculate_complexity",
      "type": "defines",
      "description": "Defines _calculate_complexity helper"
    },
    {
      "source": "class:code_quality_checker.CodeQualityChecker",
      "target": "method:CodeQualityChecker._has_mutable_defaults",
      "type": "defines",
      "description": "Defines _has_mutable_defaults helper"
    },
    {
      "source": "class:code_quality_checker.CodeQualityChecker",
      "target": "method:CodeQualityChecker.check_directory",
      "type": "defines",
      "description": "Defines check_directory helper"
    },
    {
      "source": "class:code_quality_checker.CodeQualityChecker",
      "target": "method:CodeQualityChecker.generate_report",
      "type": "defines",
      "description": "Defines generate_report helper"
    },
    {
      "source": "method:CodeQualityChecker.check_file",
      "target": "method:CodeQualityChecker._analyze_ast",
      "type": "calls",
      "description": "Parses file AST and delegates analysis"
    },
    {
      "source": "method:CodeQualityChecker._analyze_ast",
      "target": "method:CodeQualityChecker._has_type_hints",
      "type": "calls",
      "description": "Checks annotation coverage"
    },
    {
      "source": "method:CodeQualityChecker._analyze_ast",
      "target": "method:CodeQualityChecker._calculate_complexity",
      "type": "calls",
      "description": "Computes complexity score"
    },
    {
      "source": "method:CodeQualityChecker._analyze_ast",
      "target": "method:CodeQualityChecker._has_mutable_defaults",
      "type": "calls",
      "description": "Flags mutable default args"
    },
    {
      "source": "method:CodeQualityChecker.check_directory",
      "target": "method:CodeQualityChecker.check_file",
      "type": "calls",
      "description": "Analyzes each eligible file"
    },
    {
      "source": "function:code_quality_checker.code_quality_checker_module_tests",
      "target": "class:code_quality_checker.QualityMetrics",
      "type": "instantiates",
      "description": "Creates metrics instances for assertions"
    },
    {
      "source": "function:code_quality_checker.code_quality_checker_module_tests",
      "target": "class:code_quality_checker.CodeQualityChecker",
      "type": "instantiates",
      "description": "Constructs checker during initialization test"
    },
    {
      "source": "function:code_quality_checker.run_comprehensive_tests",
      "target": "function:code_quality_checker.code_quality_checker_module_tests",
      "type": "calls",
      "description": "Executes module tests via runner"
    },
    {
      "source": "script:code_quality_checker.__main__",
      "target": "class:code_quality_checker.CodeQualityChecker",
      "type": "instantiates",
      "description": "Builds checker for CLI scan"
    },
    {
      "source": "script:code_quality_checker.__main__",
      "target": "method:CodeQualityChecker.check_directory",
      "type": "calls",
      "description": "Scans current directory for metrics"
    },
    {
      "source": "script:code_quality_checker.__main__",
      "target": "method:CodeQualityChecker.generate_report",
      "type": "calls",
      "description": "Formats and prints quality report"
    },
    {
      "source": "script:code_quality_checker.__main__",
      "target": "function:code_quality_checker.run_comprehensive_tests",
      "type": "calls",
      "description": "Runs module tests after report"
    },
    {
      "source": "file:test_utilities.py",
      "target": "class:test_utilities.EmptyTestService",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.mock_func",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.mock_func_with_param",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.sample_function",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.temp_function",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.safe_func",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.decorated_safe_func",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.create_test_function",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.create_parameterized_test_function",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.get_test_function",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.create_property_delegator",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.create_method_delegator",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.create_range_validator",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.create_type_validator",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.create_string_validator",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.create_composite_validator",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.create_file_extension_validator",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.create_standard_test_runner",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.create_mock_session_manager",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.create_test_database",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.load_test_gedcom",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.create_test_person",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.run_parameterized_tests",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.assert_function_behavior",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.create_test_session",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.assert_database_state",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.mock_api_response",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities._test_basic_functions",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities._test_factory_functions",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities._test_function_registry",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities._test_runner_factory",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities._test_assert_function_behavior",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities._test_mock_api_response",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities._test_create_mock_session_manager",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities._test_create_test_database",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities._test_create_test_person",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.test_utilities_module_tests",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "function:test_utilities.run_comprehensive_tests",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "file:test_utilities.py",
      "target": "script:test_utilities.__main__",
      "type": "defines",
      "description": "Defined in test utilities module"
    },
    {
      "source": "function:test_utilities.get_test_function",
      "target": "function:test_utilities.mock_func",
      "type": "returns",
      "description": "Registry maps mock_func name to callable"
    },
    {
      "source": "function:test_utilities.get_test_function",
      "target": "function:test_utilities.mock_func_with_param",
      "type": "returns",
      "description": "Registry maps mock_func_with_param name to callable"
    },
    {
      "source": "function:test_utilities.get_test_function",
      "target": "function:test_utilities.sample_function",
      "type": "returns",
      "description": "Registry maps sample_function name to callable"
    },
    {
      "source": "function:test_utilities.get_test_function",
      "target": "function:test_utilities.temp_function",
      "type": "returns",
      "description": "Registry maps temp_function name to callable"
    },
    {
      "source": "function:test_utilities.get_test_function",
      "target": "function:test_utilities.safe_func",
      "type": "returns",
      "description": "Registry maps safe_func name to callable"
    },
    {
      "source": "function:test_utilities.get_test_function",
      "target": "function:test_utilities.decorated_safe_func",
      "type": "returns",
      "description": "Registry maps decorated_safe_func name to callable"
    },
    {
      "source": "function:test_utilities.run_comprehensive_tests",
      "target": "function:test_utilities.test_utilities_module_tests",
      "type": "calls",
      "description": "Wrapper executes module tests via standardized runner"
    },
    {
      "source": "script:test_utilities.__main__",
      "target": "function:test_utilities.test_utilities_module_tests",
      "type": "calls",
      "description": "CLI entry triggers module test execution"
    },
    {
      "source": "function:test_utilities.test_utilities_module_tests",
      "target": "function:test_utilities._test_basic_functions",
      "type": "calls",
      "description": "Registers basic utility function tests"
    },
    {
      "source": "function:test_utilities.test_utilities_module_tests",
      "target": "function:test_utilities._test_factory_functions",
      "type": "calls",
      "description": "Registers factory function tests"
    },
    {
      "source": "function:test_utilities.test_utilities_module_tests",
      "target": "function:test_utilities._test_function_registry",
      "type": "calls",
      "description": "Registers registry lookup tests"
    },
    {
      "source": "function:test_utilities.test_utilities_module_tests",
      "target": "function:test_utilities._test_runner_factory",
      "type": "calls",
      "description": "Registers runner factory tests"
    },
    {
      "source": "function:test_utilities.test_utilities_module_tests",
      "target": "function:test_utilities._test_assert_function_behavior",
      "type": "calls",
      "description": "Registers assertion helper tests"
    },
    {
      "source": "function:test_utilities.test_utilities_module_tests",
      "target": "function:test_utilities._test_mock_api_response",
      "type": "calls",
      "description": "Registers mock API response tests"
    },
    {
      "source": "function:test_utilities.test_utilities_module_tests",
      "target": "function:test_utilities._test_create_mock_session_manager",
      "type": "calls",
      "description": "Registers session manager mock tests"
    },
    {
      "source": "function:test_utilities.test_utilities_module_tests",
      "target": "function:test_utilities._test_create_test_database",
      "type": "calls",
      "description": "Registers test database helper tests"
    },
    {
      "source": "function:test_utilities.test_utilities_module_tests",
      "target": "function:test_utilities._test_create_test_person",
      "type": "calls",
      "description": "Registers test person helper tests"
    },
    {
      "source": "function:test_utilities._test_basic_functions",
      "target": "function:test_utilities.mock_func",
      "type": "calls",
      "description": "Verifies mock_func return value"
    },
    {
      "source": "function:test_utilities._test_basic_functions",
      "target": "function:test_utilities.mock_func_with_param",
      "type": "calls",
      "description": "Verifies mock_func_with_param behavior"
    },
    {
      "source": "function:test_utilities._test_basic_functions",
      "target": "function:test_utilities.sample_function",
      "type": "calls",
      "description": "Verifies sample_function output"
    },
    {
      "source": "function:test_utilities._test_basic_functions",
      "target": "function:test_utilities.temp_function",
      "type": "calls",
      "description": "Verifies temp_function output"
    },
    {
      "source": "function:test_utilities._test_basic_functions",
      "target": "function:test_utilities.safe_func",
      "type": "calls",
      "description": "Verifies safe_func output"
    },
    {
      "source": "function:test_utilities._test_basic_functions",
      "target": "function:test_utilities.decorated_safe_func",
      "type": "calls",
      "description": "Verifies decorated_safe_func output"
    },
    {
      "source": "function:test_utilities._test_factory_functions",
      "target": "function:test_utilities.create_test_function",
      "type": "calls",
      "description": "Generates closure for result assertions"
    },
    {
      "source": "function:test_utilities._test_factory_functions",
      "target": "function:test_utilities.create_parameterized_test_function",
      "type": "calls",
      "description": "Generates arithmetic closures for assertions"
    },
    {
      "source": "function:test_utilities._test_function_registry",
      "target": "function:test_utilities.get_test_function",
      "type": "calls",
      "description": "Fetches registered mock function"
    },
    {
      "source": "function:test_utilities._test_runner_factory",
      "target": "function:test_utilities.create_standard_test_runner",
      "type": "calls",
      "description": "Builds runner wrapper"
    },
    {
      "source": "function:test_utilities._test_assert_function_behavior",
      "target": "function:test_utilities.assert_function_behavior",
      "type": "calls",
      "description": "Exercises assertion helper"
    },
    {
      "source": "function:test_utilities._test_mock_api_response",
      "target": "function:test_utilities.mock_api_response",
      "type": "calls",
      "description": "Builds mock response for checks"
    },
    {
      "source": "function:test_utilities._test_create_mock_session_manager",
      "target": "function:test_utilities.create_mock_session_manager",
      "type": "calls",
      "description": "Builds session manager mock"
    },
    {
      "source": "function:test_utilities._test_create_test_database",
      "target": "function:test_utilities.create_test_database",
      "type": "calls",
      "description": "Creates test database to validate helper"
    },
    {
      "source": "function:test_utilities._test_create_test_person",
      "target": "function:test_utilities.create_test_person",
      "type": "calls",
      "description": "Constructs person mock for assertions"
    },
    {
      "source": "function:test_utilities.create_test_session",
      "target": "class:core.database_manager.DatabaseManager",
      "type": "instantiates",
      "description": "Creates DatabaseManager to retrieve test session"
    },
    {
      "source": "file:action9_process_productive.py",
      "target": "class:action9.ProcessingState",
      "type": "defines",
      "description": "Defined in Action 9 module"
    },
    {
      "source": "file:action9_process_productive.py",
      "target": "class:action9.MSGraphState",
      "type": "defines",
      "description": "Defined in Action 9 module"
    },
    {
      "source": "file:action9_process_productive.py",
      "target": "class:action9.DatabaseState",
      "type": "defines",
      "description": "Defined in Action 9 module"
    },
    {
      "source": "file:action9_process_productive.py",
      "target": "class:action9.MessageConfig",
      "type": "defines",
      "description": "Defined in Action 9 module"
    },
    {
      "source": "file:action9_process_productive.py",
      "target": "class:action9.PersonProcessor",
      "type": "defines",
      "description": "Defined in Action 9 module"
    },
    {
      "source": "file:action9_process_productive.py",
      "target": "class:action9.BatchCommitManager",
      "type": "defines",
      "description": "Defined in Action 9 module"
    },
    {
      "source": "file:action9_process_productive.py",
      "target": "function:action9_process_productive.process_productive_messages",
      "type": "defines",
      "description": "Defined in Action 9 module"
    },
    {
      "source": "file:action9_process_productive.py",
      "target": "function:action9_process_productive._setup_configuration",
      "type": "defines",
      "description": "Defined in Action 9 module"
    },
    {
      "source": "file:action9_process_productive.py",
      "target": "function:action9_process_productive._query_candidates",
      "type": "defines",
      "description": "Defined in Action 9 module"
    },
    {
      "source": "file:action9_process_productive.py",
      "target": "function:action9_process_productive._process_candidates",
      "type": "defines",
      "description": "Defined in Action 9 module"
    },
    {
      "source": "file:action9_process_productive.py",
      "target": "function:action9_process_productive._final_commit",
      "type": "defines",
      "description": "Defined in Action 9 module"
    },
    {
      "source": "file:action9_process_productive.py",
      "target": "function:action9_process_productive._log_summary",
      "type": "defines",
      "description": "Defined in Action 9 module"
    },
    {
      "source": "function:action9_process_productive.process_productive_messages",
      "target": "function:action9_process_productive._setup_configuration",
      "type": "calls",
      "description": "Initial setup for templates and database session"
    },
    {
      "source": "function:action9_process_productive.process_productive_messages",
      "target": "function:action9_process_productive._query_candidates",
      "type": "calls",
      "description": "Retrieves eligible productive matches"
    },
    {
      "source": "function:action9_process_productive.process_productive_messages",
      "target": "function:action9_process_productive._process_candidates",
      "type": "calls",
      "description": "Processes each candidate person"
    },
    {
      "source": "function:action9_process_productive.process_productive_messages",
      "target": "function:action9_process_productive._final_commit",
      "type": "calls",
      "description": "Commits any remaining staged changes"
    },
    {
      "source": "function:action9_process_productive.process_productive_messages",
      "target": "function:action9_process_productive._log_summary",
      "type": "calls",
      "description": "Logs summary metrics at completion"
    },
    {
      "source": "function:action9_process_productive._process_candidates",
      "target": "class:action9.PersonProcessor",
      "type": "instantiates",
      "description": "Creates PersonProcessor to handle per-person workflow"
    },
    {
      "source": "function:action9_process_productive._process_candidates",
      "target": "class:action9.BatchCommitManager",
      "type": "instantiates",
      "description": "Uses BatchCommitManager for batched commits"
    },
    {
      "source": "function:action9_process_productive._final_commit",
      "target": "class:action9.BatchCommitManager",
      "type": "instantiates",
      "description": "Uses BatchCommitManager to flush remaining records"
    },
    {
      "source": "file:action10.py",
      "target": "function:action10.main",
      "type": "defines",
      "description": "Defined in Action 10 module"
    },
    {
      "source": "file:action10.py",
      "target": "function:action10._initialize_analysis",
      "type": "defines",
      "description": "Defined in Action 10 module"
    },
    {
      "source": "file:action10.py",
      "target": "function:action10._create_input_getter",
      "type": "defines",
      "description": "Defined in Action 10 module"
    },
    {
      "source": "file:action10.py",
      "target": "function:action10._load_and_validate_gedcom",
      "type": "defines",
      "description": "Defined in Action 10 module"
    },
    {
      "source": "file:action10.py",
      "target": "function:action10.load_gedcom_data",
      "type": "defines",
      "description": "Defined in Action 10 module"
    },
    {
      "source": "file:action10.py",
      "target": "function:action10._build_filter_criteria",
      "type": "defines",
      "description": "Defined in Action 10 module"
    },
    {
      "source": "file:action10.py",
      "target": "function:action10.filter_and_score_individuals",
      "type": "defines",
      "description": "Defined in Action 10 module"
    },
    {
      "source": "file:action10.py",
      "target": "function:action10.display_top_matches",
      "type": "defines",
      "description": "Defined in Action 10 module"
    },
    {
      "source": "file:action10.py",
      "target": "function:action10.analyze_top_match",
      "type": "defines",
      "description": "Defined in Action 10 module"
    },
    {
      "source": "file:action10.py",
      "target": "function:action10._calculate_display_bonuses",
      "type": "defines",
      "description": "Defines wrapper for universal display bonus helper"
    },
    {
      "source": "file:action10.py",
      "target": "function:standard_imports.setup_module",
      "type": "uses",
      "description": "Invokes setup_module during import to standardize registration and logging"
    },
    {
      "source": "file:action10.py",
      "target": "file:config.py",
      "type": "uses",
      "description": "Imports config_schema to access GEDCOM paths, scoring weights, and reference person defaults"
    },
    {
      "source": "file:action10.py",
      "target": "function:performance_cache.fast_test_cache",
      "type": "uses",
      "description": "Applies fast_test_cache to memoize the comprehensive Action 10 test suite between runs"
    },
    {
      "source": "function:action10.main",
      "target": "function:action10._initialize_analysis",
      "type": "calls",
      "description": "Parses args and configuration for analysis"
    },
    {
      "source": "function:action10.main",
      "target": "function:action10._create_input_getter",
      "type": "calls",
      "description": "Creates input provider from CLI arguments"
    },
    {
      "source": "function:action10.main",
      "target": "function:action10._load_and_validate_gedcom",
      "type": "calls",
      "description": "Loads GEDCOM data after gathering criteria"
    },
    {
      "source": "function:action10.main",
      "target": "function:action10._build_filter_criteria",
      "type": "calls",
      "description": "Creates normalized filters for scoring"
    },
    {
      "source": "function:action10.main",
      "target": "function:action10.filter_and_score_individuals",
      "type": "calls",
      "description": "Scores GEDCOM individuals against criteria"
    },
    {
      "source": "function:action10.main",
      "target": "function:action10.display_top_matches",
      "type": "calls",
      "description": "Shows top matches and picks candidate"
    },
    {
      "source": "function:action10.main",
      "target": "function:action10.analyze_top_match",
      "type": "calls",
      "description": "Analyzes selected match in depth"
    },
    {
      "source": "function:action10.display_top_matches",
      "target": "function:action10._calculate_display_bonuses",
      "type": "calls",
      "description": "Computes bonus breakdown used in match summary tables"
    },
    {
      "source": "function:action10._load_with_aggressive_caching",
      "target": "function:gedcom_cache.load_gedcom_with_aggressive_caching",
      "type": "uses",
      "description": "Falls back to the shared GEDCOM cache loader when the module-level cache is cold"
    },
    {
      "source": "function:action10.test_api_search_peter_fraser",
      "target": "function:session_utils.get_global_session",
      "type": "uses",
      "description": "Obtains the globally registered SessionManager before issuing live API calls"
    },
    {
      "source": "script:action10.__main__",
      "target": "function:logging_config.setup_logging",
      "type": "uses",
      "description": "Configures logging handlers when running the Action 10 module directly"
    },
    {
      "source": "function:action10._calculate_display_bonuses",
      "target": "function:universal_scoring.calculate_display_bonuses",
      "type": "calls",
      "description": "Delegates bonus math to universal scoring helper"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core._extract_field_scores_for_display",
      "type": "defines",
      "description": "Defines score normalization helper for table output"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core._calc_display_bonuses_wrap",
      "type": "defines",
      "description": "Defines adapter over universal display bonuses"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core._create_table_row_for_candidate",
      "type": "defines",
      "description": "Defines fallback console row formatter"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core._normalize_search_criteria",
      "type": "defines",
      "description": "Defines cache criteria normalizer"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core._generate_cache_key",
      "type": "defines",
      "description": "Defines SHA256 cache key generator"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core._get_cached_search_results",
      "type": "defines",
      "description": "Defines database cache lookup helper"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core._store_search_results_in_cache",
      "type": "defines",
      "description": "Defines database cache storage helper"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core.get_api_search_cache_stats",
      "type": "defines",
      "description": "Defines cache stats accessor"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core.get_api_search_cache_hit_rate",
      "type": "defines",
      "description": "Defines cache hit rate accessor"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core.clear_api_search_cache",
      "type": "defines",
      "description": "Defines cache clearing routine"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core.report_api_cache_stats_to_performance_monitor",
      "type": "defines",
      "description": "Defines telemetry reporting helper"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core._extract_candidate_data",
      "type": "defines",
      "description": "Defines candidate normalization helper"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core._calculate_candidate_score",
      "type": "defines",
      "description": "Defines API candidate scoring wrapper"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core._build_processed_candidate",
      "type": "defines",
      "description": "Defines processed candidate formatter"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core._process_and_score_suggestions",
      "type": "defines",
      "description": "Defines suggestion scoring pipeline"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core._resolve_base_and_tree",
      "type": "defines",
      "description": "Defines tree resolution helper"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core.search_ancestry_api_for_person",
      "type": "defines",
      "description": "Defines API search entry point"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core.cleanup_expired_api_search_cache",
      "type": "defines",
      "description": "Defines expired cache cleanup helper"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core._extract_year_from_candidate",
      "type": "defines",
      "description": "Defines candidate year extractor"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core._get_relationship_paths",
      "type": "defines",
      "description": "Defines relationship path fetcher"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core._format_kinship_persons_path",
      "type": "defines",
      "description": "Defines kinship path formatter"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core._handle_supplementary_info_phase",
      "type": "defines",
      "description": "Defines supplementary info presenter"
    },
    {
      "source": "file:api_search_core.py",
      "target": "function:api_search_core._api_search_core_module_tests",
      "type": "defines",
      "description": "Defines module TestSuite entry"
    },
    {
      "source": "file:api_utils.py",
      "target": "function:api_utils.call_treesui_list_api",
      "type": "defines",
      "description": "Defines TreesUI list API caller"
    },
    {
      "source": "file:api_utils.py",
      "target": "function:api_utils.call_discovery_relationship_api",
      "type": "defines",
      "description": "Defines discovery relationship API helper"
    },
    {
      "source": "file:api_utils.py",
      "target": "function:api_utils.call_relation_ladder_with_labels_api",
      "type": "defines",
      "description": "Defines relation ladder with labels API helper"
    },
    {
      "source": "file:api_utils.py",
      "target": "function:api_utils.call_newfamilyview_api",
      "type": "defines",
      "description": "Defines New Family View API helper"
    },
    {
      "source": "file:api_utils.py",
      "target": "function:api_utils.call_edit_relationships_api",
      "type": "defines",
      "description": "Defines Edit Relationships API helper"
    },
    {
      "source": "file:api_utils.py",
      "target": "function:api_utils.call_getladder_api",
      "type": "defines",
      "description": "Defines GetLadder API helper"
    },
    {
      "source": "file:api_utils.py",
      "target": "function:api_utils.call_suggest_api",
      "type": "defines",
      "description": "Defines Suggest API helper"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._extract_year_from_date",
      "type": "defines",
      "description": "Defines year extraction helper"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._get_scoring_weights",
      "type": "defines",
      "description": "Defines scoring weight resolver"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._get_year_range",
      "type": "defines",
      "description": "Defines year range accessor"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._extract_search_criteria",
      "type": "defines",
      "description": "Defines search criteria normalizer"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._extract_candidate_data",
      "type": "defines",
      "description": "Defines candidate data normalizer"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._places_requirements_satisfied",
      "type": "defines",
      "description": "Defines place requirement checker"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._score_name_match",
      "type": "defines",
      "description": "Defines name matching scorer"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._score_year_match",
      "type": "defines",
      "description": "Defines year matching scorer"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._score_place_match",
      "type": "defines",
      "description": "Defines place matching scorer"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._apply_bonus_scores",
      "type": "defines",
      "description": "Defines scoring bonus aggregator"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._run_simple_suggestion_scoring",
      "type": "defines",
      "description": "Defines simplified suggestion scoring"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._parse_hyphenated_lifespan",
      "type": "defines",
      "description": "Defines hyphenated lifespan parser"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._parse_birth_notation",
      "type": "defines",
      "description": "Defines birth notation parser"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._parse_death_notation",
      "type": "defines",
      "description": "Defines death notation parser"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._parse_lifespan",
      "type": "defines",
      "description": "Defines lifespan parser"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._process_suggest_result",
      "type": "defines",
      "description": "Defines suggest result processor"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._process_suggest_results",
      "type": "defines",
      "description": "Defines suggest results scorer"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._validate_session",
      "type": "defines",
      "description": "Defines session validator"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._call_suggest_api_for_search",
      "type": "defines",
      "description": "Defines suggest API caller"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._build_treesui_search_params",
      "type": "defines",
      "description": "Defines TreesUI parameter builder"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._call_treesui_api_for_search",
      "type": "defines",
      "description": "Defines TreesUI API caller"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._process_treesui_person",
      "type": "defines",
      "description": "Defines TreesUI person processor"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._process_treesui_results",
      "type": "defines",
      "description": "Defines TreesUI results processor"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._build_search_query",
      "type": "defines",
      "description": "Defines search query builder"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._get_tree_id",
      "type": "defines",
      "description": "Defines tree ID resolver"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils.search_api_for_criteria",
      "type": "defines",
      "description": "Defines API search orchestrator"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils.get_api_relationship_path",
      "type": "defines",
      "description": "Defines relationship path formatter"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._resolve_tree_id",
      "type": "defines",
      "description": "Defines tree resolver for Edit Relationships"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._resolve_owner_profile_id",
      "type": "defines",
      "description": "Defines owner profile resolver"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._get_facts_data_from_api",
      "type": "defines",
      "description": "Defines Edit Relationships data fetcher"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._initialize_family_result",
      "type": "defines",
      "description": "Defines family result initializer"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._extract_person_info_from_target",
      "type": "defines",
      "description": "Defines target person info extractor"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._format_person_from_relationship_data",
      "type": "defines",
      "description": "Defines relationship person formatter"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._format_date",
      "type": "defines",
      "description": "Defines date formatter"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._debug_log_facts_structure",
      "type": "defines",
      "description": "Defines facts structure debugger"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._get_data_section_from_facts",
      "type": "defines",
      "description": "Defines facts data section accessor"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._extract_target_person_info_if_available",
      "type": "defines",
      "description": "Defines optional target info extractor"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._extract_parents_from_data_section",
      "type": "defines",
      "description": "Defines parents extractor"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._extract_spouses_from_data_section",
      "type": "defines",
      "description": "Defines spouses extractor"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._extract_children_from_data_section",
      "type": "defines",
      "description": "Defines children extractor"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._find_target_person_in_list",
      "type": "defines",
      "description": "Defines target finder"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._create_persons_lookup",
      "type": "defines",
      "description": "Defines persons lookup builder"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._extract_direct_family",
      "type": "defines",
      "description": "Defines direct family extractor"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._extract_siblings",
      "type": "defines",
      "description": "Defines siblings extractor"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._extract_person_id_from_gid",
      "type": "defines",
      "description": "Defines gid person ID extractor"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._extract_full_name_from_names",
      "type": "defines",
      "description": "Defines full name extractor"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._extract_year_from_event_type",
      "type": "defines",
      "description": "Defines event year extractor"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._parse_person_from_newfamilyview",
      "type": "defines",
      "description": "Defines New Family View person parser"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._get_tree_id_for_relationship",
      "type": "defines",
      "description": "Defines relationship tree resolver"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._get_reference_id_for_relationship",
      "type": "defines",
      "description": "Defines relationship reference resolver"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._test_module_initialization",
      "type": "defines",
      "description": "Defines module initialization test"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._test_core_functionality",
      "type": "defines",
      "description": "Defines core functionality test"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._test_edge_cases",
      "type": "defines",
      "description": "Defines edge case test"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._test_integration",
      "type": "defines",
      "description": "Defines integration test"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._test_performance",
      "type": "defines",
      "description": "Defines performance test"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils._test_error_handling",
      "type": "defines",
      "description": "Defines error handling test"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils.api_search_utils_module_tests",
      "type": "defines",
      "description": "Defines module TestSuite runner"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils.run_comprehensive_tests",
      "type": "defines",
      "description": "Defines comprehensive test runner"
    },
    {
      "source": "file:api_search_utils.py",
      "target": "function:api_search_utils.get_api_family_details",
      "type": "defines",
      "description": "Defines family details retrieval helper"
    },
    {
      "source": "function:api_search_core._generate_cache_key",
      "target": "function:api_search_core._normalize_search_criteria",
      "type": "calls",
      "description": "Normalizes criteria before hashing"
    },
    {
      "source": "function:api_search_core._get_cached_search_results",
      "target": "function:api_search_core.get_api_search_cache_hit_rate",
      "type": "calls",
      "description": "Calculates hit rate for logging"
    },
    {
      "source": "function:api_search_core.report_api_cache_stats_to_performance_monitor",
      "target": "function:api_search_core.get_api_search_cache_stats",
      "type": "calls",
      "description": "Fetches cache stats snapshot"
    },
    {
      "source": "function:api_search_core.report_api_cache_stats_to_performance_monitor",
      "target": "function:api_search_core.get_api_search_cache_hit_rate",
      "type": "calls",
      "description": "Retrieves current hit rate"
    },
    {
      "source": "function:api_search_core._process_and_score_suggestions",
      "target": "function:api_search_core._extract_candidate_data",
      "type": "calls",
      "description": "Extracts normalized candidate data"
    },
    {
      "source": "function:api_search_core._process_and_score_suggestions",
      "target": "function:api_search_core._calculate_candidate_score",
      "type": "calls",
      "description": "Scores normalized candidates"
    },
    {
      "source": "function:api_search_core._process_and_score_suggestions",
      "target": "function:api_search_core._build_processed_candidate",
      "type": "calls",
      "description": "Wraps candidates with display metadata"
    },
    {
      "source": "function:api_search_core._calculate_candidate_score",
      "target": "function:gedcom_utils.calculate_match_score",
      "type": "calls",
      "description": "Delegates to universal GEDCOM scoring"
    },
    {
      "source": "function:api_search_core.search_ancestry_api_for_person",
      "target": "function:api_search_core._resolve_base_and_tree",
      "type": "calls",
      "description": "Resolves API base URL and tree ID"
    },
    {
      "source": "function:api_search_core.search_ancestry_api_for_person",
      "target": "function:api_search_core._generate_cache_key",
      "type": "calls",
      "description": "Creates cache key for search criteria"
    },
    {
      "source": "function:api_search_core.search_ancestry_api_for_person",
      "target": "function:api_search_core._get_cached_search_results",
      "type": "calls",
      "description": "Checks database for cached results"
    },
    {
      "source": "function:api_search_core.search_ancestry_api_for_person",
      "target": "function:api_search_core._process_and_score_suggestions",
      "type": "calls",
      "description": "Scores TreesUI suggestions"
    },
    {
      "source": "function:api_search_core.search_ancestry_api_for_person",
      "target": "function:api_utils.call_treesui_list_api",
      "type": "calls",
      "description": "Fetches TreesUI suggestions from Ancestry API"
    },
    {
      "source": "function:api_search_core.search_ancestry_api_for_person",
      "target": "function:api_search_core._store_search_results_in_cache",
      "type": "calls",
      "description": "Persists fresh results to cache"
    },
    {
      "source": "function:api_search_core._build_processed_candidate",
      "target": "function:gedcom_utils._clean_display_date",
      "type": "calls",
      "description": "Formats raw birth/death dates for presentation"
    },
    {
      "source": "function:api_search_core._calc_display_bonuses_wrap",
      "target": "function:universal_scoring.calculate_display_bonuses",
      "type": "calls",
      "description": "Uses shared bonus calculator with Action 10 suffix convention"
    },
    {
      "source": "function:api_search_core._handle_supplementary_info_phase",
      "target": "function:api_search_core._resolve_base_and_tree",
      "type": "calls",
      "description": "Resolves API context before supplementary fetches"
    },
    {
      "source": "function:api_search_core._handle_supplementary_info_phase",
      "target": "function:api_search_core._get_relationship_paths",
      "type": "calls",
      "description": "Obtains relationship path data"
    },
    {
      "source": "function:api_search_core._handle_supplementary_info_phase",
      "target": "function:api_search_core._extract_year_from_candidate",
      "type": "calls",
      "description": "Extracts year metadata for presentation"
    },
    {
      "source": "function:api_search_core._handle_supplementary_info_phase",
      "target": "function:genealogy_presenter.present_post_selection",
      "type": "calls",
      "description": "Delegates final presentation of supplementary data"
    },
    {
      "source": "function:api_search_core._handle_supplementary_info_phase",
      "target": "function:api_search_utils.get_api_family_details",
      "type": "calls",
      "description": "Fetches family detail data for candidate"
    },
    {
      "source": "function:api_search_utils.get_api_family_details",
      "target": "function:api_utils.call_newfamilyview_api",
      "type": "calls",
      "description": "Retrieves raw family view data"
    },
    {
      "source": "function:api_search_utils._run_simple_suggestion_scoring",
      "target": "function:api_search_utils._get_scoring_weights",
      "type": "calls",
      "description": "Loads configured scoring weights"
    },
    {
      "source": "function:api_search_utils._run_simple_suggestion_scoring",
      "target": "function:api_search_utils._get_year_range",
      "type": "calls",
      "description": "Retrieves year tolerance window"
    },
    {
      "source": "function:api_search_utils._run_simple_suggestion_scoring",
      "target": "function:api_search_utils._extract_search_criteria",
      "type": "calls",
      "description": "Normalizes search criteria before scoring"
    },
    {
      "source": "function:api_search_utils._run_simple_suggestion_scoring",
      "target": "function:api_search_utils._extract_candidate_data",
      "type": "calls",
      "description": "Normalizes candidate attributes"
    },
    {
      "source": "function:api_search_utils._run_simple_suggestion_scoring",
      "target": "function:api_search_utils._score_name_match",
      "type": "calls",
      "description": "Applies name match scoring"
    },
    {
      "source": "function:api_search_utils._run_simple_suggestion_scoring",
      "target": "function:api_search_utils._score_year_match",
      "type": "calls",
      "description": "Applies year match scoring"
    },
    {
      "source": "function:api_search_utils._run_simple_suggestion_scoring",
      "target": "function:api_search_utils._score_place_match",
      "type": "calls",
      "description": "Applies place match scoring"
    },
    {
      "source": "function:api_search_utils._run_simple_suggestion_scoring",
      "target": "function:api_search_utils._apply_bonus_scores",
      "type": "calls",
      "description": "Adds bonus scoring"
    },
    {
      "source": "function:api_search_utils._places_requirements_satisfied",
      "target": "function:api_search_utils._extract_search_criteria",
      "type": "calls",
      "description": "Normalizes search criteria for place checks"
    },
    {
      "source": "function:api_search_utils._places_requirements_satisfied",
      "target": "function:api_search_utils._extract_candidate_data",
      "type": "calls",
      "description": "Normalizes candidate places for comparison"
    },
    {
      "source": "function:api_search_utils._parse_lifespan",
      "target": "function:api_search_utils._parse_hyphenated_lifespan",
      "type": "calls",
      "description": "Handles hyphenated lifespan format"
    },
    {
      "source": "function:api_search_utils._parse_lifespan",
      "target": "function:api_search_utils._parse_birth_notation",
      "type": "calls",
      "description": "Parses birth notation lifespan format"
    },
    {
      "source": "function:api_search_utils._parse_lifespan",
      "target": "function:api_search_utils._parse_death_notation",
      "type": "calls",
      "description": "Parses death notation lifespan format"
    },
    {
      "source": "function:api_search_utils._process_suggest_result",
      "target": "function:api_search_utils._parse_lifespan",
      "type": "calls",
      "description": "Extracts birth/death years from lifespan"
    },
    {
      "source": "function:api_search_utils._process_suggest_result",
      "target": "function:api_search_utils._run_simple_suggestion_scoring",
      "type": "calls",
      "description": "Scores suggestion candidate"
    },
    {
      "source": "function:api_search_utils._process_suggest_result",
      "target": "function:api_search_utils._places_requirements_satisfied",
      "type": "calls",
      "description": "Validates place requirements"
    },
    {
      "source": "function:api_search_utils._process_suggest_results",
      "target": "function:api_search_utils._process_suggest_result",
      "type": "calls",
      "description": "Processes individual suggestion entries"
    },
    {
      "source": "function:api_search_utils._process_treesui_person",
      "target": "function:api_search_utils._extract_year_from_date",
      "type": "calls",
      "description": "Extracts normalized year data"
    },
    {
      "source": "function:api_search_utils._process_treesui_person",
      "target": "function:api_search_utils._run_simple_suggestion_scoring",
      "type": "calls",
      "description": "Scores TreesUI candidate"
    },
    {
      "source": "function:api_search_utils._process_treesui_person",
      "target": "function:api_search_utils._places_requirements_satisfied",
      "type": "calls",
      "description": "Ensures place requirements are met"
    },
    {
      "source": "function:api_search_utils._process_treesui_results",
      "target": "function:api_search_utils._process_treesui_person",
      "type": "calls",
      "description": "Processes each TreesUI person"
    },
    {
      "source": "function:api_search_utils._call_suggest_api_for_search",
      "target": "function:api_search_utils._build_search_query",
      "type": "calls",
      "description": "Builds query string for logging"
    },
    {
      "source": "function:api_search_utils._call_suggest_api_for_search",
      "target": "function:api_utils.call_suggest_api",
      "type": "calls",
      "description": "Delegates to Suggest API helper"
    },
    {
      "source": "function:api_search_utils._call_treesui_api_for_search",
      "target": "function:api_utils.call_treesui_list_api",
      "type": "calls",
      "description": "Delegates to TreesUI list API helper"
    },
    {
      "source": "function:api_search_utils.search_api_for_criteria",
      "target": "function:api_search_utils._validate_session",
      "type": "calls",
      "description": "Verifies session readiness"
    },
    {
      "source": "function:api_search_utils.search_api_for_criteria",
      "target": "function:api_search_utils._build_search_query",
      "type": "calls",
      "description": "Constructs loggable query"
    },
    {
      "source": "function:api_search_utils.search_api_for_criteria",
      "target": "function:api_search_utils._get_tree_id",
      "type": "calls",
      "description": "Resolves tree identifier"
    },
    {
      "source": "function:api_search_utils.search_api_for_criteria",
      "target": "function:api_search_utils._call_suggest_api_for_search",
      "type": "calls",
      "description": "Fetches suggestion results"
    },
    {
      "source": "function:api_search_utils.search_api_for_criteria",
      "target": "function:api_search_utils._process_suggest_results",
      "type": "calls",
      "description": "Scores suggestion list"
    },
    {
      "source": "function:api_search_utils.search_api_for_criteria",
      "target": "function:api_search_utils._build_treesui_search_params",
      "type": "calls",
      "description": "Builds TreesUI search parameters"
    },
    {
      "source": "function:api_search_utils.search_api_for_criteria",
      "target": "function:api_search_utils._call_treesui_api_for_search",
      "type": "calls",
      "description": "Fetches TreesUI fallback results"
    },
    {
      "source": "function:api_search_utils.search_api_for_criteria",
      "target": "function:api_search_utils._process_treesui_results",
      "type": "calls",
      "description": "Processes TreesUI fallback results"
    },
    {
      "source": "function:api_search_utils._get_facts_data_from_api",
      "target": "function:api_utils.call_edit_relationships_api",
      "type": "calls",
      "description": "Invokes Edit Relationships API helper"
    },
    {
      "source": "function:api_search_utils._extract_person_info_from_target",
      "target": "function:api_search_utils._format_date",
      "type": "calls",
      "description": "Formats birth and death dates"
    },
    {
      "source": "function:api_search_utils._extract_parents_from_data_section",
      "target": "function:api_search_utils._format_person_from_relationship_data",
      "type": "calls",
      "description": "Formats parent entries"
    },
    {
      "source": "function:api_search_utils._extract_spouses_from_data_section",
      "target": "function:api_search_utils._format_person_from_relationship_data",
      "type": "calls",
      "description": "Formats spouse entries"
    },
    {
      "source": "function:api_search_utils._extract_children_from_data_section",
      "target": "function:api_search_utils._format_person_from_relationship_data",
      "type": "calls",
      "description": "Formats child entries"
    },
    {
      "source": "function:api_search_utils._extract_target_person_info_if_available",
      "target": "function:api_search_utils._extract_person_info_from_target",
      "type": "calls",
      "description": "Delegates to target person extractor"
    },
    {
      "source": "function:api_search_utils._extract_direct_family",
      "target": "function:api_search_utils._parse_person_from_newfamilyview",
      "type": "calls",
      "description": "Normalizes related persons"
    },
    {
      "source": "function:api_search_utils._extract_siblings",
      "target": "function:api_search_utils._parse_person_from_newfamilyview",
      "type": "calls",
      "description": "Normalizes sibling records"
    },
    {
      "source": "function:api_search_utils._parse_person_from_newfamilyview",
      "target": "function:api_search_utils._extract_person_id_from_gid",
      "type": "calls",
      "description": "Extracts person identifier"
    },
    {
      "source": "function:api_search_utils._parse_person_from_newfamilyview",
      "target": "function:api_search_utils._extract_full_name_from_names",
      "type": "calls",
      "description": "Builds display name"
    },
    {
      "source": "function:api_search_utils._parse_person_from_newfamilyview",
      "target": "function:api_search_utils._extract_year_from_event_type",
      "type": "calls",
      "description": "Extracts birth/death years"
    },
    {
      "source": "function:api_search_utils.get_api_family_details",
      "target": "function:api_search_utils._initialize_family_result",
      "type": "calls",
      "description": "Initializes result structure"
    },
    {
      "source": "function:api_search_utils.get_api_family_details",
      "target": "function:api_search_utils._find_target_person_in_list",
      "type": "calls",
      "description": "Finds target person in response"
    },
    {
      "source": "function:api_search_utils.get_api_family_details",
      "target": "function:api_search_utils._create_persons_lookup",
      "type": "calls",
      "description": "Builds person lookup for relatives"
    },
    {
      "source": "function:api_search_utils.get_api_family_details",
      "target": "function:api_search_utils._extract_direct_family",
      "type": "calls",
      "description": "Extracts immediate family"
    },
    {
      "source": "function:api_search_utils.get_api_family_details",
      "target": "function:api_search_utils._extract_siblings",
      "type": "calls",
      "description": "Extracts sibling data"
    },
    {
      "source": "function:api_search_utils.get_api_relationship_path",
      "target": "function:api_search_utils._get_tree_id_for_relationship",
      "type": "calls",
      "description": "Resolves tree context"
    },
    {
      "source": "function:api_search_utils.get_api_relationship_path",
      "target": "function:api_search_utils._get_reference_id_for_relationship",
      "type": "calls",
      "description": "Resolves reference person"
    },
    {
      "source": "function:api_search_utils.get_api_relationship_path",
      "target": "function:api_utils.call_getladder_api",
      "type": "calls",
      "description": "Requests ladder data for relationship path"
    },
    {
      "source": "function:api_search_utils.get_api_relationship_path",
      "target": "function:relationship_utils.format_api_relationship_path",
      "type": "calls",
      "description": "Formats ladder data into readable path"
    },
    {
      "source": "function:api_search_utils._test_core_functionality",
      "target": "function:api_search_utils._extract_year_from_date",
      "type": "calls",
      "description": "Validates year parsing helper"
    },
    {
      "source": "function:api_search_utils._test_core_functionality",
      "target": "function:api_search_utils._run_simple_suggestion_scoring",
      "type": "calls",
      "description": "Exercises simplified scoring"
    },
    {
      "source": "function:api_search_utils._test_edge_cases",
      "target": "function:api_search_utils._extract_year_from_date",
      "type": "calls",
      "description": "Checks year parsing edge cases"
    },
    {
      "source": "function:api_search_utils._test_edge_cases",
      "target": "function:api_search_utils._run_simple_suggestion_scoring",
      "type": "calls",
      "description": "Ensures scoring handles empty inputs"
    },
    {
      "source": "function:api_search_utils._test_integration",
      "target": "function:api_search_utils.search_api_for_criteria",
      "type": "calls",
      "description": "Runs integration search with mocks"
    },
    {
      "source": "function:api_search_utils._test_performance",
      "target": "function:api_search_utils._run_simple_suggestion_scoring",
      "type": "calls",
      "description": "Measures scoring throughput"
    },
    {
      "source": "function:api_search_utils._test_error_handling",
      "target": "function:api_search_utils.search_api_for_criteria",
      "type": "calls",
      "description": "Verifies graceful failure handling"
    },
    {
      "source": "function:api_search_utils.api_search_utils_module_tests",
      "target": "class:test_framework.TestSuite",
      "type": "instantiates",
      "description": "Creates module TestSuite instance"
    },
    {
      "source": "function:api_search_utils.api_search_utils_module_tests",
      "target": "function:test_framework.suppress_logging",
      "type": "calls",
      "description": "Suppresses logging during tests"
    },
    {
      "source": "function:api_search_utils.api_search_utils_module_tests",
      "target": "function:api_search_utils._test_module_initialization",
      "type": "calls",
      "description": "Runs configuration sanity test"
    },
    {
      "source": "function:api_search_utils.api_search_utils_module_tests",
      "target": "function:api_search_utils._test_core_functionality",
      "type": "calls",
      "description": "Runs core functionality test"
    },
    {
      "source": "function:api_search_utils.api_search_utils_module_tests",
      "target": "function:api_search_utils._test_edge_cases",
      "type": "calls",
      "description": "Runs edge case test"
    },
    {
      "source": "function:api_search_utils.api_search_utils_module_tests",
      "target": "function:api_search_utils._test_integration",
      "type": "calls",
      "description": "Runs integration test"
    },
    {
      "source": "function:api_search_utils.api_search_utils_module_tests",
      "target": "function:api_search_utils._test_performance",
      "type": "calls",
      "description": "Runs performance test"
    },
    {
      "source": "function:api_search_utils.api_search_utils_module_tests",
      "target": "function:api_search_utils._test_error_handling",
      "type": "calls",
      "description": "Runs error handling test"
    },
    {
      "source": "function:api_search_utils.api_search_utils_module_tests",
      "target": "method:TestSuite.start_suite",
      "type": "calls",
      "description": "Starts TestSuite run"
    },
    {
      "source": "function:api_search_utils.api_search_utils_module_tests",
      "target": "method:TestSuite.run_test",
      "type": "calls",
      "description": "Registers individual tests"
    },
    {
      "source": "function:api_search_utils.api_search_utils_module_tests",
      "target": "method:TestSuite.finish_suite",
      "type": "calls",
      "description": "Finalizes TestSuite execution"
    },
    {
      "source": "function:api_search_utils.run_comprehensive_tests",
      "target": "function:api_search_utils.api_search_utils_module_tests",
      "type": "calls",
      "description": "Delegates to module TestSuite"
    },
    {
      "source": "function:api_search_core._get_relationship_paths",
      "target": "function:api_utils.call_relation_ladder_with_labels_api",
      "type": "calls",
      "description": "Retrieves enriched relation ladder data"
    },
    {
      "source": "function:api_search_core._get_relationship_paths",
      "target": "function:api_utils.call_discovery_relationship_api",
      "type": "calls",
      "description": "Falls back to discovery relationship API"
    },
    {
      "source": "function:api_search_core._get_relationship_paths",
      "target": "function:relationship_utils.convert_discovery_api_path_to_unified_format",
      "type": "calls",
      "description": "Converts discovery API response to unified path"
    },
    {
      "source": "function:api_search_core._api_search_core_module_tests",
      "target": "class:test_framework.TestSuite",
      "type": "instantiates",
      "description": "Creates module TestSuite instance"
    },
    {
      "source": "function:api_search_core._api_search_core_module_tests",
      "target": "method:TestSuite.start_suite",
      "type": "calls",
      "description": "Starts TestSuite timing cycle"
    },
    {
      "source": "function:api_search_core._api_search_core_module_tests",
      "target": "method:TestSuite.run_test",
      "type": "calls",
      "description": "Registers individual test cases"
    },
    {
      "source": "function:api_search_core._api_search_core_module_tests",
      "target": "method:TestSuite.finish_suite",
      "type": "calls",
      "description": "Finalizes suite execution"
    },
    {
      "source": "function:api_search_core._api_search_core_module_tests",
      "target": "function:api_search_core._create_table_row_for_candidate",
      "type": "calls",
      "description": "Exercises table row formatter"
    },
    {
      "source": "function:api_search_core._api_search_core_module_tests",
      "target": "function:api_search_core._resolve_base_and_tree",
      "type": "calls",
      "description": "Tests base/tree resolver"
    },
    {
      "source": "function:api_search_core._api_search_core_module_tests",
      "target": "function:api_search_core.search_ancestry_api_for_person",
      "type": "calls",
      "description": "Validates search flow with mocks"
    },
    {
      "source": "function:api_search_core._api_search_core_module_tests",
      "target": "function:api_search_core._generate_cache_key",
      "type": "calls",
      "description": "Checks cache key normalization"
    },
    {
      "source": "function:api_search_core._api_search_core_module_tests",
      "target": "function:api_search_core._normalize_search_criteria",
      "type": "calls",
      "description": "Verifies search criteria normalization"
    },
    {
      "source": "function:api_search_core._api_search_core_module_tests",
      "target": "function:api_search_core._get_cached_search_results",
      "type": "calls",
      "description": "Asserts cache miss handling"
    },
    {
      "source": "function:api_search_core._api_search_core_module_tests",
      "target": "function:api_search_core._store_search_results_in_cache",
      "type": "calls",
      "description": "Ensures cache store commits"
    },
    {
      "source": "function:api_search_core._api_search_core_module_tests",
      "target": "function:api_search_core.get_api_search_cache_stats",
      "type": "calls",
      "description": "Evaluates cache stats helper"
    },
    {
      "source": "function:api_search_core._api_search_core_module_tests",
      "target": "function:api_search_core.get_api_search_cache_hit_rate",
      "type": "calls",
      "description": "Evaluates cache hit rate helper"
    },
    {
      "source": "function:api_search_core._api_search_core_module_tests",
      "target": "function:api_search_core.clear_api_search_cache",
      "type": "calls",
      "description": "Checks cache clearing logic"
    },
    {
      "source": "function:api_search_core._api_search_core_module_tests",
      "target": "function:api_search_core.cleanup_expired_api_search_cache",
      "type": "calls",
      "description": "Tests expired cache cleanup helper"
    },
    {
      "source": "function:api_search_core._create_table_row_for_candidate",
      "target": "function:api_search_core._extract_field_scores_for_display",
      "type": "calls",
      "description": "Derives normalized score fields for rendering"
    },
    {
      "source": "function:api_search_core._create_table_row_for_candidate",
      "target": "function:api_search_core._calc_display_bonuses_wrap",
      "type": "calls",
      "description": "Adds bonus columns to table row"
    },
    {
      "source": "function:api_search_core._get_relationship_paths",
      "target": "function:api_search_core._format_kinship_persons_path",
      "type": "calls",
      "description": "Formats relation ladder response into readable path"
    },
    {
      "source": "function:api_search_core._get_relationship_paths",
      "target": "function:api_utils.call_discovery_relationship_api",
      "type": "calls",
      "description": "Falls back to discovery relationship API"
    },
    {
      "source": "function:api_search_core._get_relationship_paths",
      "target": "function:relationship_utils.convert_discovery_api_path_to_unified_format",
      "type": "calls",
      "description": "Converts discovery API output to unified format"
    },
    {
      "source": "function:api_search_core._get_relationship_paths",
      "target": "function:api_utils.call_relation_ladder_with_labels_api",
      "type": "calls",
      "description": "Primary call to relation ladder with labels API"
    },
    {
      "source": "file:universal_scoring.py",
      "target": "function:universal_scoring.calculate_display_bonuses",
      "type": "defines",
      "description": "Defines shared display bonus calculator"
    },
    {
      "source": "file:universal_scoring.py",
      "target": "function:universal_scoring.apply_universal_scoring",
      "type": "defines",
      "description": "Defines universal candidate scoring entry point"
    },
    {
      "source": "file:universal_scoring.py",
      "target": "function:universal_scoring._get_confidence_level",
      "type": "defines",
      "description": "Defines helper translating scores into confidence labels"
    },
    {
      "source": "file:universal_scoring.py",
      "target": "function:universal_scoring.format_scoring_breakdown",
      "type": "defines",
      "description": "Defines formatted score breakdown generator"
    },
    {
      "source": "file:universal_scoring.py",
      "target": "function:universal_scoring.universal_scoring_module_tests",
      "type": "defines",
      "description": "Defines module TestSuite entry point"
    },
    {
      "source": "function:action10._load_and_validate_gedcom",
      "target": "function:action10.load_gedcom_data",
      "type": "calls",
      "description": "Delegates GEDCOM loading to shared helper"
    },
    {
      "source": "file:search_criteria_utils.py",
      "target": "function:search_criteria_utils.get_unified_search_criteria",
      "type": "defines",
      "description": "Defined in search criteria helper module"
    },
    {
      "source": "file:search_criteria_utils.py",
      "target": "function:search_criteria_utils._sanitize_input",
      "type": "defines",
      "description": "Defined in search criteria helper module"
    },
    {
      "source": "file:search_criteria_utils.py",
      "target": "function:search_criteria_utils._parse_year_input",
      "type": "defines",
      "description": "Defined in search criteria helper module"
    },
    {
      "source": "file:search_criteria_utils.py",
      "target": "function:search_criteria_utils._create_date_object",
      "type": "defines",
      "description": "Defined in search criteria helper module"
    },
    {
      "source": "file:search_criteria_utils.py",
      "target": "function:search_criteria_utils._debug_log_criteria",
      "type": "defines",
      "description": "Defined in search criteria helper module"
    },
    {
      "source": "file:search_criteria_utils.py",
      "target": "function:search_criteria_utils._print_criteria_summary",
      "type": "defines",
      "description": "Defined in search criteria helper module"
    },
    {
      "source": "file:search_criteria_utils.py",
      "target": "function:search_criteria_utils._test_display_family_members",
      "type": "defines",
      "description": "Defined in search criteria helper module"
    },
    {
      "source": "file:search_criteria_utils.py",
      "target": "function:search_criteria_utils.search_criteria_utils_module_tests",
      "type": "defines",
      "description": "Defines module TestSuite entry point"
    },
    {
      "source": "function:search_criteria_utils.get_unified_search_criteria",
      "target": "function:search_criteria_utils._sanitize_input",
      "type": "calls",
      "description": "Sanitizes name and place prompts"
    },
    {
      "source": "function:search_criteria_utils.get_unified_search_criteria",
      "target": "function:search_criteria_utils._parse_year_input",
      "type": "calls",
      "description": "Parses year inputs for birth/death"
    },
    {
      "source": "function:search_criteria_utils.get_unified_search_criteria",
      "target": "function:search_criteria_utils._create_date_object",
      "type": "calls",
      "description": "Creates datetime placeholders"
    },
    {
      "source": "function:search_criteria_utils.get_unified_search_criteria",
      "target": "function:search_criteria_utils._debug_log_criteria",
      "type": "calls",
      "description": "Logs collected criteria"
    },
    {
      "source": "function:search_criteria_utils.get_unified_search_criteria",
      "target": "function:search_criteria_utils._print_criteria_summary",
      "type": "calls",
      "description": "Prints criteria summary for operator"
    },
    {
      "source": "function:action10.main",
      "target": "function:search_criteria_utils.get_unified_search_criteria",
      "type": "calls",
      "description": "Delegates search criteria collection to unified helper"
    },
    {
      "source": "function:search_criteria_utils.search_criteria_utils_module_tests",
      "target": "class:test_framework.TestSuite",
      "type": "instantiates",
      "description": "Creates module TestSuite instance"
    },
    {
      "source": "function:search_criteria_utils.search_criteria_utils_module_tests",
      "target": "method:TestSuite.start_suite",
      "type": "calls",
      "description": "Starts TestSuite timing cycle"
    },
    {
      "source": "function:search_criteria_utils.search_criteria_utils_module_tests",
      "target": "method:TestSuite.run_test",
      "type": "calls",
      "description": "Registers categorized test cases"
    },
    {
      "source": "function:search_criteria_utils.search_criteria_utils_module_tests",
      "target": "method:TestSuite.finish_suite",
      "type": "calls",
      "description": "Finalizes TestSuite execution"
    },
    {
      "source": "function:search_criteria_utils.search_criteria_utils_module_tests",
      "target": "function:search_criteria_utils._test_sanitize_input",
      "type": "calls",
      "description": "Runs input sanitization regression test"
    },
    {
      "source": "function:search_criteria_utils.search_criteria_utils_module_tests",
      "target": "function:search_criteria_utils._test_parse_year_input",
      "type": "calls",
      "description": "Runs year parsing validation test"
    },
    {
      "source": "function:search_criteria_utils.search_criteria_utils_module_tests",
      "target": "function:search_criteria_utils._test_present_post_selection_minimal",
      "type": "calls",
      "description": "Runs presenter smoke test with minimal data"
    },
    {
      "source": "function:search_criteria_utils.search_criteria_utils_module_tests",
      "target": "function:search_criteria_utils._test_create_date_object",
      "type": "calls",
      "description": "Runs date placeholder creation test"
    },
    {
      "source": "function:search_criteria_utils.search_criteria_utils_module_tests",
      "target": "function:search_criteria_utils._test_get_unified_search_criteria_valid",
      "type": "calls",
      "description": "Runs full criteria collection test"
    },
    {
      "source": "function:search_criteria_utils.search_criteria_utils_module_tests",
      "target": "function:search_criteria_utils._test_get_unified_search_criteria_minimal",
      "type": "calls",
      "description": "Runs minimal criteria collection test"
    },
    {
      "source": "function:search_criteria_utils.search_criteria_utils_module_tests",
      "target": "function:search_criteria_utils._test_get_unified_search_criteria_cancelled",
      "type": "calls",
      "description": "Runs cancellation path test"
    },
    {
      "source": "function:search_criteria_utils.search_criteria_utils_module_tests",
      "target": "function:search_criteria_utils._test_display_family_members",
      "type": "calls",
      "description": "Runs family display regression test"
    },
    {
      "source": "function:search_criteria_utils._test_sanitize_input",
      "target": "function:search_criteria_utils._sanitize_input",
      "type": "calls",
      "description": "Exercises input trimming helper"
    },
    {
      "source": "function:search_criteria_utils._test_parse_year_input",
      "target": "function:search_criteria_utils._parse_year_input",
      "type": "calls",
      "description": "Validates year parsing logic"
    },
    {
      "source": "function:search_criteria_utils._test_present_post_selection_minimal",
      "target": "function:genealogy_presenter.present_post_selection",
      "type": "calls",
      "description": "Invokes presenter to verify minimal output pathway"
    },
    {
      "source": "function:search_criteria_utils._test_create_date_object",
      "target": "function:search_criteria_utils._create_date_object",
      "type": "calls",
      "description": "Checks datetime construction helper"
    },
    {
      "source": "function:search_criteria_utils._test_get_unified_search_criteria_valid",
      "target": "function:search_criteria_utils.get_unified_search_criteria",
      "type": "calls",
      "description": "Asserts full criteria collection succeeds"
    },
    {
      "source": "function:search_criteria_utils._test_get_unified_search_criteria_minimal",
      "target": "function:search_criteria_utils.get_unified_search_criteria",
      "type": "calls",
      "description": "Asserts minimal criteria path works"
    },
    {
      "source": "function:search_criteria_utils._test_get_unified_search_criteria_cancelled",
      "target": "function:search_criteria_utils.get_unified_search_criteria",
      "type": "calls",
      "description": "Asserts cancellation returns None"
    },
    {
      "source": "function:search_criteria_utils._test_display_family_members",
      "target": "function:genealogy_presenter.display_family_members",
      "type": "calls",
      "description": "Invokes presenter family section renderer"
    },
    {
      "source": "file:genealogy_presenter.py",
      "target": "function:genealogy_presenter._format_years_display",
      "type": "defines",
      "description": "Defined in genealogy presenter module"
    },
    {
      "source": "file:genealogy_presenter.py",
      "target": "function:genealogy_presenter._print_section_header",
      "type": "defines",
      "description": "Defined in genealogy presenter module"
    },
    {
      "source": "file:genealogy_presenter.py",
      "target": "function:genealogy_presenter._print_family_member",
      "type": "defines",
      "description": "Defined in genealogy presenter module"
    },
    {
      "source": "file:genealogy_presenter.py",
      "target": "function:genealogy_presenter._deduplicate_members",
      "type": "defines",
      "description": "Defined in genealogy presenter module"
    },
    {
      "source": "file:genealogy_presenter.py",
      "target": "function:genealogy_presenter._filter_valid_members",
      "type": "defines",
      "description": "Defined in genealogy presenter module"
    },
    {
      "source": "file:genealogy_presenter.py",
      "target": "function:genealogy_presenter.display_family_members",
      "type": "defines",
      "description": "Defined in genealogy presenter module"
    },
    {
      "source": "file:genealogy_presenter.py",
      "target": "function:genealogy_presenter.present_post_selection",
      "type": "defines",
      "description": "Defined in genealogy presenter module"
    },
    {
      "source": "file:genealogy_presenter.py",
      "target": "function:genealogy_presenter.genealogy_presenter_module_tests",
      "type": "defines",
      "description": "Defined in genealogy presenter module"
    },
    {
      "source": "function:genealogy_presenter._print_family_member",
      "target": "function:genealogy_presenter._format_years_display",
      "type": "calls",
      "description": "Formats years for family member display"
    },
    {
      "source": "function:genealogy_presenter.display_family_members",
      "target": "function:genealogy_presenter._deduplicate_members",
      "type": "calls",
      "description": "Removes duplicate members before printing"
    },
    {
      "source": "function:genealogy_presenter.display_family_members",
      "target": "function:genealogy_presenter._filter_valid_members",
      "type": "calls",
      "description": "Filters placeholder members"
    },
    {
      "source": "function:genealogy_presenter.display_family_members",
      "target": "function:genealogy_presenter._print_section_header",
      "type": "calls",
      "description": "Prints section headers"
    },
    {
      "source": "function:genealogy_presenter.display_family_members",
      "target": "function:genealogy_presenter._print_family_member",
      "type": "calls",
      "description": "Prints each member entry"
    },
    {
      "source": "function:genealogy_presenter.present_post_selection",
      "target": "function:genealogy_presenter._format_years_display",
      "type": "calls",
      "description": "Builds header year string"
    },
    {
      "source": "function:genealogy_presenter.present_post_selection",
      "target": "function:genealogy_presenter.display_family_members",
      "type": "calls",
      "description": "Delegates family section rendering"
    },
    {
      "source": "function:genealogy_presenter.genealogy_presenter_module_tests",
      "target": "class:test_framework.TestSuite",
      "type": "instantiates",
      "description": "Creates module TestSuite instance"
    },
    {
      "source": "function:genealogy_presenter.genealogy_presenter_module_tests",
      "target": "method:TestSuite.start_suite",
      "type": "calls",
      "description": "Starts TestSuite timing cycle"
    },
    {
      "source": "function:genealogy_presenter.genealogy_presenter_module_tests",
      "target": "method:TestSuite.run_test",
      "type": "calls",
      "description": "Registers presenter smoke test"
    },
    {
      "source": "function:genealogy_presenter.genealogy_presenter_module_tests",
      "target": "function:genealogy_presenter._test_presenter_runs",
      "type": "calls",
      "description": "Invokes internal presenter smoke test"
    },
    {
      "source": "function:genealogy_presenter.genealogy_presenter_module_tests",
      "target": "method:TestSuite.finish_suite",
      "type": "calls",
      "description": "Finalizes TestSuite execution"
    },
    {
      "source": "function:genealogy_presenter._test_presenter_runs",
      "target": "function:genealogy_presenter.present_post_selection",
      "type": "calls",
      "description": "Smoke tests unified presenter"
    },
    {
      "source": "function:genealogy_presenter.run_comprehensive_tests",
      "target": "function:genealogy_presenter.genealogy_presenter_module_tests",
      "type": "calls",
      "description": "Delegates to module TestSuite"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "class:relationship_utils.RelationshipPathCache",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._run_basic_functionality_tests",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._run_conversion_tests",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._run_validation_tests",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._test_gedcom_path_conversion",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._test_discovery_api_conversion",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._test_general_api_conversion",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._test_unified_path_formatting",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._test_api_relationship_formatting",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._test_relationship_path_cache",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils.get_relationship_cache_stats",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils.clear_relationship_cache",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils.report_cache_stats_to_performance_monitor",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils.fast_bidirectional_bfs",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils.explain_relationship_path",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils.format_api_relationship_path",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils.convert_gedcom_path_to_unified_format",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils.convert_api_path_to_unified_format",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils.convert_discovery_api_path_to_unified_format",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._extract_person_basic_info",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._create_person_dict",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._determine_gedcom_relationship",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._parse_discovery_relationship",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._process_path_person",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._format_years_display",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._clean_name_format",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._check_uncle_aunt_pattern_sibling",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._check_uncle_aunt_pattern_parent",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._check_grandparent_pattern",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._check_cousin_pattern",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._check_nephew_niece_pattern",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._determine_relationship_type_from_path",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._convert_you_are_relationship",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._format_path_step",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._get_gendered_term",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._get_relationship_term",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._infer_gender_from_name",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._infer_gender_from_relationship",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._extract_years_from_lifespan",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._determine_gender_for_person",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._parse_relationship_term_and_gender",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils._log_inferred_gender_once",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils.format_relationship_path_unified",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils.relationship_utils_module_tests",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:relationship_utils.py",
      "target": "function:relationship_utils.run_comprehensive_tests",
      "type": "defines",
      "description": "Defined in relationship utilities module"
    },
    {
      "source": "file:test_framework.py",
      "target": "function:test_framework.test_function_availability",
      "type": "defines",
      "description": "Defined in shared test framework"
    },
    {
      "source": "function:relationship_utils.relationship_utils_module_tests",
      "target": "class:test_framework.TestSuite",
      "type": "instantiates",
      "description": "Creates module TestSuite instance"
    },
    {
      "source": "function:relationship_utils.relationship_utils_module_tests",
      "target": "method:TestSuite.start_suite",
      "type": "calls",
      "description": "Starts TestSuite timing cycle"
    },
    {
      "source": "function:relationship_utils.relationship_utils_module_tests",
      "target": "function:relationship_utils._run_basic_functionality_tests",
      "type": "calls",
      "description": "Registers foundational name and BFS checks"
    },
    {
      "source": "function:relationship_utils.relationship_utils_module_tests",
      "target": "function:relationship_utils._run_conversion_tests",
      "type": "calls",
      "description": "Queues conversion-focused tests"
    },
    {
      "source": "function:relationship_utils.relationship_utils_module_tests",
      "target": "function:relationship_utils._run_validation_tests",
      "type": "calls",
      "description": "Adds validation and performance coverage"
    },
    {
      "source": "function:relationship_utils.relationship_utils_module_tests",
      "target": "method:TestSuite.run_test",
      "type": "calls",
      "description": "Registers cache regression scenario"
    },
    {
      "source": "function:relationship_utils.relationship_utils_module_tests",
      "target": "function:relationship_utils._test_relationship_path_cache",
      "type": "calls",
      "description": "Runs LRU cache regression test"
    },
    {
      "source": "function:relationship_utils.relationship_utils_module_tests",
      "target": "method:TestSuite.finish_suite",
      "type": "calls",
      "description": "Finalizes TestSuite execution"
    },
    {
      "source": "function:relationship_utils._run_basic_functionality_tests",
      "target": "method:TestSuite.run_test",
      "type": "calls",
      "description": "Queues foundational name/BFS tests"
    },
    {
      "source": "function:relationship_utils._run_conversion_tests",
      "target": "method:TestSuite.run_test",
      "type": "calls",
      "description": "Registers conversion test cases"
    },
    {
      "source": "function:relationship_utils._run_conversion_tests",
      "target": "function:relationship_utils._test_gedcom_path_conversion",
      "type": "calls",
      "description": "Adds GEDCOM conversion smoke test"
    },
    {
      "source": "function:relationship_utils._run_conversion_tests",
      "target": "function:relationship_utils._test_discovery_api_conversion",
      "type": "calls",
      "description": "Adds Discovery API conversion test"
    },
    {
      "source": "function:relationship_utils._run_conversion_tests",
      "target": "function:relationship_utils._test_general_api_conversion",
      "type": "calls",
      "description": "Adds general API conversion test"
    },
    {
      "source": "function:relationship_utils._run_conversion_tests",
      "target": "function:relationship_utils._test_unified_path_formatting",
      "type": "calls",
      "description": "Adds unified formatter smoke test"
    },
    {
      "source": "function:relationship_utils._run_conversion_tests",
      "target": "function:relationship_utils._test_api_relationship_formatting",
      "type": "calls",
      "description": "Adds API formatter smoke test"
    },
    {
      "source": "function:relationship_utils._run_validation_tests",
      "target": "method:TestSuite.run_test",
      "type": "calls",
      "description": "Registers validation and performance tests"
    },
    {
      "source": "function:relationship_utils._run_basic_functionality_tests",
      "target": "function:relationship_utils.format_name",
      "type": "calls",
      "description": "Exercises name formatting helper"
    },
    {
      "source": "function:relationship_utils._run_basic_functionality_tests",
      "target": "function:relationship_utils.fast_bidirectional_bfs",
      "type": "calls",
      "description": "Exercises relationship path finder"
    },
    {
      "source": "function:relationship_utils._run_validation_tests",
      "target": "function:relationship_utils.format_name",
      "type": "calls",
      "description": "Validates name formatter edge cases"
    },
    {
      "source": "function:relationship_utils._run_validation_tests",
      "target": "function:relationship_utils.fast_bidirectional_bfs",
      "type": "calls",
      "description": "Measures BFS performance"
    },
    {
      "source": "function:relationship_utils._run_validation_tests",
      "target": "function:test_framework.test_function_availability",
      "type": "calls",
      "description": "Ensures required helpers are present"
    },
    {
      "source": "function:relationship_utils.format_api_relationship_path",
      "target": "function:relationship_utils._extract_html_from_response",
      "type": "calls",
      "description": "Splits incoming API payload into HTML and JSON components"
    },
    {
      "source": "function:relationship_utils.format_api_relationship_path",
      "target": "function:relationship_utils._try_json_api_format",
      "type": "calls",
      "description": "Attempts JSON-based relationship formatting first"
    },
    {
      "source": "function:relationship_utils.format_api_relationship_path",
      "target": "function:relationship_utils._try_html_formats",
      "type": "calls",
      "description": "Falls back to HTML parsing when JSON path unavailable"
    },
    {
      "source": "function:relationship_utils.convert_gedcom_path_to_unified_format",
      "target": "function:relationship_utils._extract_person_basic_info",
      "type": "calls",
      "description": "Pulls GEDCOM individual metadata"
    },
    {
      "source": "function:relationship_utils.convert_gedcom_path_to_unified_format",
      "target": "function:relationship_utils._create_person_dict",
      "type": "calls",
      "description": "Builds unified person dictionaries"
    },
    {
      "source": "function:relationship_utils.convert_gedcom_path_to_unified_format",
      "target": "function:relationship_utils._determine_gedcom_relationship",
      "type": "calls",
      "description": "Classifies relationships between GEDCOM IDs"
    },
    {
      "source": "function:relationship_utils._determine_gedcom_relationship",
      "target": "function:relationship_utils._get_gendered_term",
      "type": "calls",
      "description": "Selects gender-specific terminology"
    },
    {
      "source": "function:relationship_utils._determine_gedcom_relationship",
      "target": "function:gedcom_utils._are_siblings",
      "type": "calls",
      "description": "Checks sibling relationships via GEDCOM helpers"
    },
    {
      "source": "function:relationship_utils._determine_gedcom_relationship",
      "target": "function:relationship_utils._are_spouses",
      "type": "calls",
      "description": "Checks spouse relationships via local GEDCOM wrapper"
    },
    {
      "source": "function:relationship_utils._determine_gedcom_relationship",
      "target": "function:gedcom_utils._is_grandparent",
      "type": "calls",
      "description": "Detects grandparent relationships"
    },
    {
      "source": "function:relationship_utils._determine_gedcom_relationship",
      "target": "function:gedcom_utils._is_grandchild",
      "type": "calls",
      "description": "Detects grandchild relationships"
    },
    {
      "source": "function:relationship_utils._determine_gedcom_relationship",
      "target": "function:gedcom_utils._is_great_grandparent",
      "type": "calls",
      "description": "Checks great-grandparent relationships"
    },
    {
      "source": "function:relationship_utils._determine_gedcom_relationship",
      "target": "function:gedcom_utils._is_great_grandchild",
      "type": "calls",
      "description": "Checks great-grandchild relationships"
    },
    {
      "source": "function:relationship_utils._determine_gedcom_relationship",
      "target": "function:gedcom_utils._is_aunt_or_uncle",
      "type": "calls",
      "description": "Determines aunt/uncle relationships"
    },
    {
      "source": "function:relationship_utils._determine_gedcom_relationship",
      "target": "function:gedcom_utils._is_niece_or_nephew",
      "type": "calls",
      "description": "Determines niece/nephew relationships"
    },
    {
      "source": "function:relationship_utils._determine_gedcom_relationship",
      "target": "function:gedcom_utils._are_cousins",
      "type": "calls",
      "description": "Detects cousin relationships"
    },
    {
      "source": "function:relationship_utils.convert_discovery_api_path_to_unified_format",
      "target": "function:relationship_utils._create_person_dict",
      "type": "calls",
      "description": "Wraps Discovery entries in unified dictionaries"
    },
    {
      "source": "function:relationship_utils.convert_discovery_api_path_to_unified_format",
      "target": "function:relationship_utils._parse_discovery_relationship",
      "type": "calls",
      "description": "Parses relationship text for term and gender"
    },
    {
      "source": "function:relationship_utils.convert_discovery_api_path_to_unified_format",
      "target": "function:relationship_utils.format_name",
      "type": "calls",
      "description": "Normalizes Discovery-provided names"
    },
    {
      "source": "function:relationship_utils._format_discovery_api_path",
      "target": "function:relationship_utils.format_name",
      "type": "calls",
      "description": "Ensures Discovery names follow project casing rules"
    },
    {
      "source": "function:relationship_utils._format_discovery_api_path",
      "target": "function:relationship_utils._get_relationship_term",
      "type": "calls",
      "description": "Maps relationship codes to gender-aware terms"
    },
    {
      "source": "function:relationship_utils._try_json_api_format",
      "target": "function:relationship_utils._format_discovery_api_path",
      "type": "calls",
      "description": "Delegates to Discovery-specific formatter when JSON exists"
    },
    {
      "source": "function:relationship_utils._try_html_formats",
      "target": "function:relationship_utils._try_simple_text_relationship",
      "type": "calls",
      "description": "Attempts quick plain-text extraction before HTML parsing"
    },
    {
      "source": "function:relationship_utils._try_html_formats",
      "target": "function:relationship_utils._parse_html_relationship_data",
      "type": "calls",
      "description": "Parses structured HTML into relationship dictionaries"
    },
    {
      "source": "function:relationship_utils._try_html_formats",
      "target": "function:relationship_utils.convert_api_path_to_unified_format",
      "type": "calls",
      "description": "Normalizes HTML-derived relationships into unified form"
    },
    {
      "source": "function:relationship_utils._try_html_formats",
      "target": "function:relationship_utils.format_relationship_path_unified",
      "type": "calls",
      "description": "Produces final narrative after HTML parsing"
    },
    {
      "source": "function:relationship_utils.convert_api_path_to_unified_format",
      "target": "function:relationship_utils.format_name",
      "type": "calls",
      "description": "Normalizes first path entry display name"
    },
    {
      "source": "function:relationship_utils.convert_api_path_to_unified_format",
      "target": "function:relationship_utils._extract_years_from_lifespan",
      "type": "calls",
      "description": "Parses lifespan strings for years"
    },
    {
      "source": "function:relationship_utils.convert_api_path_to_unified_format",
      "target": "function:relationship_utils._determine_gender_for_person",
      "type": "calls",
      "description": "Infers gender for the target individual"
    },
    {
      "source": "function:relationship_utils.convert_api_path_to_unified_format",
      "target": "function:relationship_utils._process_path_person",
      "type": "calls",
      "description": "Normalizes subsequent path entries"
    },
    {
      "source": "function:relationship_utils._process_path_person",
      "target": "function:relationship_utils.format_name",
      "type": "calls",
      "description": "Cleans API-sourced person names"
    },
    {
      "source": "function:relationship_utils._process_path_person",
      "target": "function:relationship_utils._extract_years_from_lifespan",
      "type": "calls",
      "description": "Derives birth/death year suffixes"
    },
    {
      "source": "function:relationship_utils._process_path_person",
      "target": "function:relationship_utils._parse_relationship_term_and_gender",
      "type": "calls",
      "description": "Interprets relationship wording"
    },
    {
      "source": "function:relationship_utils._process_path_person",
      "target": "function:relationship_utils._infer_gender_from_name",
      "type": "calls",
      "description": "Falls back to name-based gender inference"
    },
    {
      "source": "function:relationship_utils.format_name",
      "target": "function:relationship_utils._clean_gedcom_slashes",
      "type": "calls",
      "description": "Strips GEDCOM slash markers before formatting"
    },
    {
      "source": "function:relationship_utils.format_name",
      "target": "function:relationship_utils._format_single_word",
      "type": "calls",
      "description": "Applies per-word title casing with special handling"
    },
    {
      "source": "function:relationship_utils._parse_html_relationship_data",
      "target": "function:relationship_utils._extract_person_from_list_item",
      "type": "calls",
      "description": "Transforms each HTML list item into structured data"
    },
    {
      "source": "function:relationship_utils._extract_person_from_list_item",
      "target": "function:relationship_utils._should_skip_list_item",
      "type": "calls",
      "description": "Skips non-person entries before extraction"
    },
    {
      "source": "function:relationship_utils._extract_person_from_list_item",
      "target": "function:relationship_utils._extract_name_from_item",
      "type": "calls",
      "description": "Pulls display name text from HTML element"
    },
    {
      "source": "function:relationship_utils._extract_person_from_list_item",
      "target": "function:relationship_utils._extract_relationship_from_item",
      "type": "calls",
      "description": "Captures relationship description from HTML element"
    },
    {
      "source": "function:relationship_utils._extract_person_from_list_item",
      "target": "function:relationship_utils._extract_lifespan_from_item",
      "type": "calls",
      "description": "Parses lifespan years from HTML element"
    },
    {
      "source": "function:relationship_utils._determine_gender_for_person",
      "target": "function:relationship_utils._infer_gender_from_name",
      "type": "calls",
      "description": "Attempts name-based gender inference"
    },
    {
      "source": "function:relationship_utils._determine_gender_for_person",
      "target": "function:relationship_utils._infer_gender_from_relationship",
      "type": "calls",
      "description": "Uses relationship text for inference"
    },
    {
      "source": "function:relationship_utils._infer_gender_from_name",
      "target": "function:relationship_utils._log_inferred_gender_once",
      "type": "calls",
      "description": "Logs inference result once per name"
    },
    {
      "source": "function:relationship_utils._infer_gender_from_relationship",
      "target": "function:relationship_utils._log_inferred_gender_once",
      "type": "calls",
      "description": "Logs relationship-based inference once"
    },
    {
      "source": "function:relationship_utils._check_grandparent_pattern",
      "target": "function:relationship_utils._determine_gender_for_person",
      "type": "calls",
      "description": "Infers grandparent gender for labeling"
    },
    {
      "source": "function:relationship_utils._determine_relationship_type_from_path",
      "target": "function:relationship_utils._check_uncle_aunt_pattern_sibling",
      "type": "calls",
      "description": "Evaluates sibling-based aunt/uncle pattern"
    },
    {
      "source": "function:relationship_utils._determine_relationship_type_from_path",
      "target": "function:relationship_utils._check_uncle_aunt_pattern_parent",
      "type": "calls",
      "description": "Evaluates parent-based aunt/uncle pattern"
    },
    {
      "source": "function:relationship_utils._determine_relationship_type_from_path",
      "target": "function:relationship_utils._check_grandparent_pattern",
      "type": "calls",
      "description": "Evaluates grandparent pattern"
    },
    {
      "source": "function:relationship_utils._determine_relationship_type_from_path",
      "target": "function:relationship_utils._check_cousin_pattern",
      "type": "calls",
      "description": "Evaluates cousin pattern"
    },
    {
      "source": "function:relationship_utils._determine_relationship_type_from_path",
      "target": "function:relationship_utils._check_nephew_niece_pattern",
      "type": "calls",
      "description": "Evaluates nephew/niece pattern"
    },
    {
      "source": "function:relationship_utils.format_relationship_path_unified",
      "target": "function:relationship_utils._clean_name_format",
      "type": "calls",
      "description": "Cleans Name(...) wrappers for narration"
    },
    {
      "source": "function:relationship_utils.format_relationship_path_unified",
      "target": "function:relationship_utils._format_years_display",
      "type": "calls",
      "description": "Formats birth/death year suffixes"
    },
    {
      "source": "function:relationship_utils.format_relationship_path_unified",
      "target": "function:relationship_utils._determine_relationship_type_from_path",
      "type": "calls",
      "description": "Infers relationship label when unspecified"
    },
    {
      "source": "function:relationship_utils.format_relationship_path_unified",
      "target": "function:relationship_utils._format_path_step",
      "type": "calls",
      "description": "Formats each intermediate hop"
    },
    {
      "source": "function:relationship_utils._format_path_step",
      "target": "function:relationship_utils._clean_name_format",
      "type": "calls",
      "description": "Cleans person names for bullet text"
    },
    {
      "source": "function:relationship_utils._format_path_step",
      "target": "function:relationship_utils._format_years_display",
      "type": "calls",
      "description": "Appends year display when first seen"
    },
    {
      "source": "function:relationship_utils._format_path_step",
      "target": "function:relationship_utils._convert_you_are_relationship",
      "type": "calls",
      "description": "Normalizes second-person relationship phrases"
    },
    {
      "source": "function:relationship_utils._run_bfs_search_loop",
      "target": "function:relationship_utils._check_search_limits",
      "type": "calls",
      "description": "Verifies timeout and node budgets"
    },
    {
      "source": "function:relationship_utils._run_bfs_search_loop",
      "target": "function:relationship_utils._process_forward_queue",
      "type": "calls",
      "description": "Advances forward frontier"
    },
    {
      "source": "function:relationship_utils._run_bfs_search_loop",
      "target": "function:relationship_utils._process_backward_queue",
      "type": "calls",
      "description": "Advances backward frontier"
    },
    {
      "source": "function:relationship_utils._process_forward_queue",
      "target": "function:relationship_utils._expand_to_relatives",
      "type": "calls",
      "description": "Expands forward neighbors"
    },
    {
      "source": "function:relationship_utils._process_backward_queue",
      "target": "function:relationship_utils._expand_to_relatives",
      "type": "calls",
      "description": "Expands backward neighbors"
    },
    {
      "source": "function:relationship_utils._expand_to_relatives",
      "target": "function:relationship_utils._add_relative_to_queue",
      "type": "calls",
      "description": "Queues parent/child relatives"
    },
    {
      "source": "function:relationship_utils._expand_to_relatives",
      "target": "function:relationship_utils._expand_to_siblings",
      "type": "calls",
      "description": "Handles sibling expansions"
    },
    {
      "source": "function:relationship_utils._score_path",
      "target": "function:relationship_utils._has_direct_relationship",
      "type": "calls",
      "description": "Measures direct relationship edges"
    },
    {
      "source": "function:relationship_utils._select_best_path",
      "target": "function:relationship_utils._score_path",
      "type": "calls",
      "description": "Evaluates candidate paths"
    },
    {
      "source": "function:relationship_utils._get_relationship_term",
      "target": "function:relationship_utils._get_gendered_term",
      "type": "calls",
      "description": "Applies gender-specific vocabulary"
    },
    {
      "source": "function:relationship_utils._test_gedcom_path_conversion",
      "target": "function:relationship_utils.convert_gedcom_path_to_unified_format",
      "type": "calls",
      "description": "Exercises GEDCOM path converter"
    },
    {
      "source": "function:relationship_utils._test_discovery_api_conversion",
      "target": "function:relationship_utils.convert_discovery_api_path_to_unified_format",
      "type": "calls",
      "description": "Exercises Discovery API converter"
    },
    {
      "source": "function:relationship_utils._test_general_api_conversion",
      "target": "function:relationship_utils.convert_api_path_to_unified_format",
      "type": "calls",
      "description": "Exercises generic API converter"
    },
    {
      "source": "function:relationship_utils._test_unified_path_formatting",
      "target": "function:relationship_utils.format_relationship_path_unified",
      "type": "calls",
      "description": "Exercises unified relationship formatter"
    },
    {
      "source": "function:relationship_utils._test_api_relationship_formatting",
      "target": "function:relationship_utils.format_api_relationship_path",
      "type": "calls",
      "description": "Exercises API relationship formatter"
    },
    {
      "source": "function:relationship_utils._test_relationship_path_cache",
      "target": "function:relationship_utils.clear_relationship_cache",
      "type": "calls",
      "description": "Resets cache before validation"
    },
    {
      "source": "function:relationship_utils._test_relationship_path_cache",
      "target": "function:relationship_utils.fast_bidirectional_bfs",
      "type": "calls",
      "description": "Generates paths for cache warm-up"
    },
    {
      "source": "function:relationship_utils._test_relationship_path_cache",
      "target": "function:relationship_utils.get_relationship_cache_stats",
      "type": "calls",
      "description": "Reads cache metrics for assertions"
    },
    {
      "source": "function:relationship_utils._test_relationship_path_cache",
      "target": "function:relationship_utils.report_cache_stats_to_performance_monitor",
      "type": "calls",
      "description": "Exercises telemetry reporting"
    },
    {
      "source": "function:relationship_utils.run_comprehensive_tests",
      "target": "function:relationship_utils.relationship_utils_module_tests",
      "type": "calls",
      "description": "Delegates to module TestSuite"
    },
    {
      "source": "function:relationship_utils.fast_bidirectional_bfs",
      "target": "method:RelationshipPathCache.get",
      "type": "calls",
      "description": "Checks cache for existing path"
    },
    {
      "source": "function:relationship_utils.fast_bidirectional_bfs",
      "target": "method:RelationshipPathCache.get_stats",
      "type": "calls",
      "description": "Reads cache hit rate for debug logging"
    },
    {
      "source": "function:relationship_utils.fast_bidirectional_bfs",
      "target": "function:relationship_utils._validate_bfs_inputs",
      "type": "calls",
      "description": "Ensures graph inputs are usable"
    },
    {
      "source": "function:relationship_utils.fast_bidirectional_bfs",
      "target": "function:relationship_utils._find_direct_relationship",
      "type": "calls",
      "description": "Detects immediate relationship shortcuts"
    },
    {
      "source": "function:relationship_utils.fast_bidirectional_bfs",
      "target": "function:relationship_utils._initialize_bfs_queues",
      "type": "calls",
      "description": "Seeds frontiers for bidirectional search"
    },
    {
      "source": "function:relationship_utils.fast_bidirectional_bfs",
      "target": "function:relationship_utils._run_bfs_search_loop",
      "type": "calls",
      "description": "Runs alternating forward/backward expansions"
    },
    {
      "source": "function:relationship_utils.fast_bidirectional_bfs",
      "target": "function:relationship_utils._select_best_path",
      "type": "calls",
      "description": "Chooses the highest scoring path"
    },
    {
      "source": "function:relationship_utils.fast_bidirectional_bfs",
      "target": "method:RelationshipPathCache.put",
      "type": "calls",
      "description": "Stores computed paths for reuse"
    },
    {
      "source": "function:relationship_utils.get_relationship_cache_stats",
      "target": "method:RelationshipPathCache.get_stats",
      "type": "calls",
      "description": "Retrieves cache metrics for reporting"
    },
    {
      "source": "function:relationship_utils.clear_relationship_cache",
      "target": "method:RelationshipPathCache.clear",
      "type": "calls",
      "description": "Clears cached paths and counters"
    },
    {
      "source": "function:relationship_utils.report_cache_stats_to_performance_monitor",
      "target": "method:RelationshipPathCache.get_stats",
      "type": "calls",
      "description": "Fetches stats before posting to telemetry"
    },
    {
      "source": "method:RelationshipPathCache.get",
      "target": "method:RelationshipPathCache._make_key",
      "type": "calls",
      "description": "Normalizes cache key for lookup"
    },
    {
      "source": "method:RelationshipPathCache.put",
      "target": "method:RelationshipPathCache._make_key",
      "type": "calls",
      "description": "Normalizes cache key for storage"
    },
    {
      "source": "function:relationship_utils.fast_bidirectional_bfs",
      "target": "class:relationship_utils.RelationshipPathCache",
      "type": "uses",
      "description": "Checks and updates cached path results"
    },
    {
      "source": "function:relationship_utils.get_relationship_cache_stats",
      "target": "class:relationship_utils.RelationshipPathCache",
      "type": "uses",
      "description": "Reads metrics from global cache"
    },
    {
      "source": "function:relationship_utils.clear_relationship_cache",
      "target": "class:relationship_utils.RelationshipPathCache",
      "type": "uses",
      "description": "Clears stored cache entries"
    },
    {
      "source": "function:relationship_utils.report_cache_stats_to_performance_monitor",
      "target": "class:relationship_utils.RelationshipPathCache",
      "type": "uses",
      "description": "Obtains stats before reporting"
    },
    {
      "source": "function:relationship_utils.explain_relationship_path",
      "target": "function:relationship_utils.convert_gedcom_path_to_unified_format",
      "type": "calls",
      "description": "Transforms GEDCOM IDs into unified path"
    },
    {
      "source": "function:relationship_utils.explain_relationship_path",
      "target": "function:relationship_utils.format_relationship_path_unified",
      "type": "calls",
      "description": "Renders the unified path"
    },
    {
      "source": "function:relationship_utils.format_api_relationship_path",
      "target": "function:relationship_utils.convert_api_path_to_unified_format",
      "type": "calls",
      "description": "Converts ladder entries into unified path"
    },
    {
      "source": "function:relationship_utils.format_api_relationship_path",
      "target": "function:relationship_utils.format_relationship_path_unified",
      "type": "calls",
      "description": "Formats unified path into narrative"
    },
    {
      "source": "function:relationship_utils.format_api_relationship_path",
      "target": "function:relationship_utils.convert_discovery_api_path_to_unified_format",
      "type": "calls",
      "description": "Handles Discovery API JSON payloads"
    },
    {
      "source": "function:relationship_utils.relationship_utils_module_tests",
      "target": "function:relationship_utils.fast_bidirectional_bfs",
      "type": "calls",
      "description": "Invokes exercises BFS behaviour"
    },
    {
      "source": "function:relationship_utils.relationship_utils_module_tests",
      "target": "function:relationship_utils.format_relationship_path_unified",
      "type": "calls",
      "description": "Tests narrative formatter output"
    },
    {
      "source": "function:action10.analyze_top_match",
      "target": "function:relationship_utils.fast_bidirectional_bfs",
      "type": "calls",
      "description": "Computes relationship ladder for top match"
    },
    {
      "source": "function:action10.analyze_top_match",
      "target": "function:relationship_utils.convert_gedcom_path_to_unified_format",
      "type": "calls",
      "description": "Builds unified path for presenter"
    },
    {
      "source": "function:genealogy_presenter.present_post_selection",
      "target": "function:relationship_utils.format_relationship_path_unified",
      "type": "calls",
      "description": "Generates relationship narrative when unified path provided"
    },
    {
      "source": "file:gedcom_utils.py",
      "target": "function:gedcom_utils._normalize_id",
      "type": "defines",
      "description": "Defined in GEDCOM utilities module"
    },
    {
      "source": "file:gedcom_utils.py",
      "target": "function:gedcom_utils._get_full_name",
      "type": "defines",
      "description": "Defined in GEDCOM utilities module"
    },
    {
      "source": "file:gedcom_utils.py",
      "target": "function:gedcom_utils._get_event_info",
      "type": "defines",
      "description": "Defined in GEDCOM utilities module"
    },
    {
      "source": "file:gedcom_utils.py",
      "target": "function:gedcom_utils.format_relative_info",
      "type": "defines",
      "description": "Defined in GEDCOM utilities module"
    },
    {
      "source": "file:gedcom_utils.py",
      "target": "function:gedcom_utils.fast_bidirectional_bfs",
      "type": "defines",
      "description": "Defined in GEDCOM utilities module"
    },
    {
      "source": "file:gedcom_utils.py",
      "target": "function:gedcom_utils.calculate_match_score",
      "type": "defines",
      "description": "Defined in GEDCOM utilities module"
    },
    {
      "source": "file:gedcom_utils.py",
      "target": "class:gedcom_utils.GedcomData",
      "type": "defines",
      "description": "Defined in GEDCOM utilities module"
    },
    {
      "source": "file:gedcom_utils.py",
      "target": "function:gedcom_utils.gedcom_module_tests",
      "type": "defines",
      "description": "Defined in GEDCOM utilities module"
    },
    {
      "source": "class:gedcom_utils.GedcomData",
      "target": "method:GedcomData.build_caches",
      "type": "defines",
      "description": "Defines cache construction workflow"
    },
    {
      "source": "class:gedcom_utils.GedcomData",
      "target": "method:GedcomData._build_indi_index",
      "type": "defines",
      "description": "Defines INDI indexing helper"
    },
    {
      "source": "class:gedcom_utils.GedcomData",
      "target": "method:GedcomData._build_family_maps",
      "type": "defines",
      "description": "Defines family map builder"
    },
    {
      "source": "class:gedcom_utils.GedcomData",
      "target": "method:GedcomData._pre_process_individual_data",
      "type": "defines",
      "description": "Defines individual preprocessing helper"
    },
    {
      "source": "class:gedcom_utils.GedcomData",
      "target": "method:GedcomData.get_processed_indi_data",
      "type": "defines",
      "description": "Defines processed data accessor"
    },
    {
      "source": "class:gedcom_utils.GedcomData",
      "target": "method:GedcomData.get_related_individuals",
      "type": "defines",
      "description": "Defines related individual lookup"
    },
    {
      "source": "class:gedcom_utils.GedcomData",
      "target": "method:GedcomData.get_relationship_path",
      "type": "defines",
      "description": "Defines relationship path explainer"
    },
    {
      "source": "method:GedcomData.build_caches",
      "target": "method:GedcomData._build_indi_index",
      "type": "calls",
      "description": "Starts individual index build"
    },
    {
      "source": "method:GedcomData.build_caches",
      "target": "method:GedcomData._build_family_maps",
      "type": "calls",
      "description": "Builds parent/child maps"
    },
    {
      "source": "method:GedcomData.build_caches",
      "target": "method:GedcomData._pre_process_individual_data",
      "type": "calls",
      "description": "Pre-processes individuals for scoring"
    },
    {
      "source": "method:GedcomData.get_processed_indi_data",
      "target": "method:GedcomData._pre_process_individual_data",
      "type": "calls",
      "description": "Triggers preprocessing when cache empty"
    },
    {
      "source": "method:GedcomData.get_relationship_path",
      "target": "function:gedcom_utils.fast_bidirectional_bfs",
      "type": "calls",
      "description": "Runs local bidirectional BFS to discover path"
    },
    {
      "source": "method:GedcomData.get_relationship_path",
      "target": "function:relationship_utils.explain_relationship_path",
      "type": "calls",
      "description": "Delegates final explanation rendering"
    },
    {
      "source": "function:action10.load_gedcom_data",
      "target": "class:gedcom_utils.GedcomData",
      "type": "uses",
      "description": "Instantiates GedcomData for offline analysis"
    },
    {
      "source": "function:action10.filter_and_score_individuals",
      "target": "class:gedcom_utils.GedcomData",
      "type": "uses",
      "description": "Iterates processed GEDCOM cache"
    },
    {
      "source": "function:action10.filter_and_score_individuals",
      "target": "function:gedcom_utils.calculate_match_score",
      "type": "calls",
      "description": "Delegates candidate scoring"
    },
    {
      "source": "function:action10.analyze_top_match",
      "target": "class:gedcom_utils.GedcomData",
      "type": "uses",
      "description": "Retrieves individuals and family maps"
    },
    {
      "source": "function:action10.analyze_top_match",
      "target": "function:gedcom_utils.format_relative_info",
      "type": "calls",
      "description": "Formats related relatives for display"
    },
    {
      "source": "function:gedcom_utils.gedcom_module_tests",
      "target": "function:gedcom_utils.calculate_match_score",
      "type": "calls",
      "description": "Verifies scoring behaviour"
    },
    {
      "source": "function:gedcom_utils.gedcom_module_tests",
      "target": "class:gedcom_utils.GedcomData",
      "type": "uses",
      "description": "Exercises GedcomData cache helpers"
    },
    {
      "source": "function:gedcom_utils.gedcom_module_tests",
      "target": "function:gedcom_utils.fast_bidirectional_bfs",
      "type": "calls",
      "description": "Smoke tests relationship traversal entry point"
    }
  ]
}
